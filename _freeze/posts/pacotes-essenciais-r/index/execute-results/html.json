{
  "hash": "42596fafb41e8ced6efb324f8ea20cf1",
  "result": {
    "markdown": "---\ntitle: \"Pacotes Essenciais R\"\ndate: '2023-06-30'\ncategories: ['data-science', 'econometria', 'tutorial-R']\nexecute: \n  warning: false\n  message: false\nimage: \"/static/installing_packages.png\"\nimage-alt: \"/static/installing_packages.png\"\n---\n\n\nR é uma das linguagens de programação mais populares para ciência de dados, estatística, economia e várias outras áreas quantitativas. O `R` já vem com alguns pacotes \"imbutidos\" que, em geral, são referidos como `base R`, são os pacotes que são instalados automaticamente junto com o `R` como o `stats`, `utils`, `graphics`, `datasets` entre outros.\n\nOu seja, já é possível importar dados e limpá-los, fazer análises estatísticas, gráficos e tabelas sem carregar nenhum pacote adicional.\n\nMas para o usufruir de todo o potencial que o R pode oferecer é essencial conhecer os melhores pacotes e as suas funções.\n\n# A lista de pacotes essenciais\n\n+----------------------------------------------+-----------------------------------------------------------------------+\n| Nome do Pacote                               | Principal Uso                                                         |\n+==============================================+=======================================================================+\n| | `data.table`                               | | Manipulação de dados extremamente veloz para bigdata                |\n+----------------------------------------------+-----------------------------------------------------------------------+\n| | `dplyr` + `tidyr`                          | | Manipulação de dados                                                |\n+----------------------------------------------+-----------------------------------------------------------------------+\n| | `readr`                                    | | Importar e exportar arquivos                                        |\n+----------------------------------------------+-----------------------------------------------------------------------+\n| | `stringr`                                  | | Trabalhar com strings                                               |\n+----------------------------------------------+-----------------------------------------------------------------------+\n| | `lubridate`                                | | Trabalhar com datas                                                 |\n+----------------------------------------------+-----------------------------------------------------------------------+\n| | `ggplot2`                                  | | Visualização de dados com varias extensões                          |\n+----------------------------------------------+-----------------------------------------------------------------------+\n| | `knitr` + `shiny` + `rmarkdown` + `quarto` | | Desenvolvimento de relatórios, apresentações, dashboards e Apps     |\n+----------------------------------------------+-----------------------------------------------------------------------+\n| | `dbplyr`                                   | | Interface para interagir com Bases de Dados (SQL, PostGreSQL, etc.) |\n+----------------------------------------------+-----------------------------------------------------------------------+\n\nA verdade é que cada usuário de `R` tem demandas específicas, então é difícil dizer quais são os pacotes **indisipensáveis**. Por isso o foco da minha lista foi em pacotes que facilitam três partes essenciais de qualquer análise de dados: importação, manipulação e apresentação dos dados.\n\nIndependentemente do foco do seu projeto ou da sua pesquisa eu garanto que será necessário:\n\n1.  Importar dados no `R`\n2.  Transformar esses dados\n3.  Apresentar seus resultados na forma de gráficos, tabelas, relatórios, dashboards, etc.\n\n# Importar dados\n\n### Tabelas csv\n\nQuando comecei a usar `R` uma das partes mais agoniantes era conseguir importar arquivos de dados externos corretamente. As funções `read.csv`, `read.csv2`, `read.delim` funcionam bem, mas o `readr` tornou isso tudo muito mais fácil.\n\nO pacote essencialmente tem funções `read_*` (`read_csv`, `read_fwf`, etc.) que servem para importar dados e funções `write_` (`write_csv`, `write_excel_csv`, etc.) que servem para exportar dados num formato específico.\n\nAlém das funções `read_*` e `write_*`, vale a pena explorar as funções `parse_*` como `parse_number` e `parse_date` que são muito convenientes para garantir que seus dados estejam sendo interpretados da maneira correta.\n\nPara arquivos mais pesados vale considerar duas opções: `vroom` e `data.table`. O primeiro é um pacote enxuto que permite a importação e exportação rápida de arquivos `csv` mais pesados. Já a segunda opção é um pacote completo, que será disuctido em maiores detalhes abaixo, de importação e manipulação de dados. A função `data.table::fread` é extremamente veloz.\n\n### Outros formatos\n\nSe você utiliza dados em formatos mais específicos então outros pacotes se tornam essenciais. A lista abaixo cita alguns dos casos mais comuns:\n\n-   `haven` - SPSS, SAS e Stata\n-   `readxl` - Excel\n-   `jsonlite` - Json\n-   `sf` - Shapefiles em geral\n\nPor fim, vale notar um pacote simpático chamado `rio` que tem duas funções centrais `import` e `export`. Essas funções automaticamente detectam o tipo de arquivo que você quer importar ou exportar e chamam a função do pacote apropriado para executar a tarefa.\n\nA única desvantagem desta conveniência é que em casos mais complicados pode ser difícil lembrar do nome dos argumentos da função que você precisa. Por exemplo, o `import` usa o o `readxl` para importar um arquivo `xlsx`. Mas você precisa lembrar de cabeça que o argumento para selecionar uma aba específica é `sheet`.\n\n# Manipulação de dados\n\nToda análise começa com uma base de dados (ou muitas bases de dados). E se você já se aventurou o suficiente no mundo, você sabe que são raríssimas as bases de dados que já vem prontas no momento em que você baixa o `csv` ou `xlsx`. Na grande maioria dos casos, é preciso passar por diversas etapas de limpeza ou de pré-processamento para transformar os dados em algo que possa ser analisado.\n\nO `R` tem várias funções no seu core para realizar essas tarefas mas há dois pacotes essenciais que melhoram (e muito) essa tarefa: `dplyr` e `data.table`.\n\n## dplyr x data.table\n\nO `dplyr` é bastante intuitivo, poderoso e há centenas de tutoriais e livros sobre ele. Ele serve para transformar os dados: criar colunas, filtrar linhas, reordernar dados, etc. Ele integra um \"ecossistema\" de pacotes chamado [tidyverse](https://www.tidyverse.org), uma coleção de pacotes para processamento e visualização de dados, construídos em torno de uma filosofia comum.\n\nO `data.table` surgiu com o intuito de fazer o `R` funcionar melhor num mundo de big data. Seu desenvolvimento foi focado em ser o mais rápido, eficiente e sucinto possível, permitindo trabalhar com bases de dados muito grandes dentro do `R` (\\~100GB). Em termos de velocidade, o `data.table` ganha facilmente de praticamente [todas as outras linguagens populares em data science](https://h2oai.github.io/db-benchmark/). Ele é centena de vezes mais rápido que base `R` e também ganha com folga do seu competidor `dplyr`.\n\nSe o `data.table` é tão mais eficiente então como o `dplyr` se tornou mais popular do que ele?\n\nAcontece que o `dplyr` é melhor integrado com vários outros pacotes podersos do `tidyverse`. Também há muito material de apoio ao `dplyr` na forma de tutoriais, vídeos, livros, etc. disponíveis na internet. Quase todo curso de R ensina a usar o `dplyr`. Assim, a curva de aprendizado fica mais fácil.\n\nO `data.table` funciona muito bem com funções do `base R` como `lapply`, `colMeans()`, etc. e tem uma sintaxe concisa e flexível, onde o usuário acaba tendo bastante liberdade para criar as suas soluções. Já o `dplyr` vai pelo caminho de tentar facilitar ao máximo a vida do usuário criando várias funções com usos bastante específicos para otimizar pequenas tarefas do dia-a-dia do processamento de dados.\n\nOutra pequena desvantagem do `data.table` é que ele **não funciona de primeira no Mac**. Como ele usa OpenMP é preciso baixar outros programas e modificar algumas configurações no `R` o que pode ser bem trabalhoso e chato.\n\nNa comparação fica o seguinte:\n\n+---------------------------------------------------------------------------+----------------------------------------+\n| `dplyr`                                                                   | `data.table`                           |\n+===========================================================================+========================================+\n| Mais funções para aprender. Em geral, o código fica mais comprido         | Sintaxe sucinta                        |\n+---------------------------------------------------------------------------+----------------------------------------+\n| Funções melhor integradas com o `tidyverse`                               | Funções melhor integradas com base `R` |\n+---------------------------------------------------------------------------+----------------------------------------+\n| Muito mais veloz que o base `R`                                           | Opção mais veloz possível              |\n+---------------------------------------------------------------------------+----------------------------------------+\n| Sintaxe mais intuitiva, mais material de apoio na internet, mais popular. | Menos material de apoio disponível     |\n+---------------------------------------------------------------------------+----------------------------------------+\n|                                                                           |                                        |\n+---------------------------------------------------------------------------+----------------------------------------+\n\n## tidyverse\n\nIndepedentemente da sua escolha entre `dplyr` e/ou `data.table` (recomendo usar os dois!) vale a pena explorar os demais pacotes do `tidyverse`.\n\n### tidyr\n\nO `tidyr` acrescenta algumas importantes funcionalidades que faltam no `dplyr`. Talvez as duas funções mais importantes do pacote sejam `pivot_longer` e `pivot_wider` que servem para converter seus dados de transversais (wide) para longitudinais (long) e vice-versa. O `tidyr` também traz um novo tipo de objeto o `tibble`, uma versão moderna do `data.frame`.\n\nVale também explorar algumas funções muito úteis como `separate`, `fill`, `complete`, `replace_na` entre outras.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyr)\nlibrary(dplyr)\n# Exemplo de tibble\ndata <- as_tibble(USPersonalExpenditure)\ndata <- mutate(data, variable = rownames(USPersonalExpenditure))\ndata\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 5 × 6\n  `1940` `1945` `1950` `1955` `1960` variable           \n   <dbl>  <dbl>  <dbl>  <dbl>  <dbl> <chr>              \n1 22.2   44.5    59.6    73.2  86.8  Food and Tobacco   \n2 10.5   15.5    29      36.5  46.2  Household Operation\n3  3.53   5.76    9.71   14    21.1  Medical and Health \n4  1.04   1.98    2.45    3.4   5.4  Personal Care      \n5  0.341  0.974   1.8     2.6   3.64 Private Education  \n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Exemplo de dado longitudinal\nlong <- pivot_longer(data, cols = !variable, names_to = \"year\")\nlong\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 25 × 3\n   variable            year  value\n   <chr>               <chr> <dbl>\n 1 Food and Tobacco    1940   22.2\n 2 Food and Tobacco    1945   44.5\n 3 Food and Tobacco    1950   59.6\n 4 Food and Tobacco    1955   73.2\n 5 Food and Tobacco    1960   86.8\n 6 Household Operation 1940   10.5\n 7 Household Operation 1945   15.5\n 8 Household Operation 1950   29  \n 9 Household Operation 1955   36.5\n10 Household Operation 1960   46.2\n# ℹ 15 more rows\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Calcula a variação e apresenta de maneira transversal\nlong %>%\n  group_by(variable) %>%\n  mutate(variacao = (value / lag(value) - 1) * 100) %>%\n  na.omit() %>%\n  pivot_wider(\n    id_cols = \"variable\",\n    names_from = \"year\",\n    values_from = \"variacao\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 5 × 5\n# Groups:   variable [5]\n  variable            `1945` `1950` `1955` `1960`\n  <chr>                <dbl>  <dbl>  <dbl>  <dbl>\n1 Food and Tobacco     100.    33.9   22.8   18.6\n2 Household Operation   47.6   87.1   25.9   26.6\n3 Medical and Health    63.2   68.6   44.2   50.7\n4 Personal Care         90.4   23.7   38.8   58.8\n5 Private Education    186.    84.8   44.4   40  \n```\n:::\n:::\n\n\n### stringr\n\nO `stringr` é um pacote voltado para facilitar a manipulação de vetores de texto (`character`). Todas as funções do pacote são convenientemente precedidas pelo prefixo `str_` e a lista dos argumentos segue um padrão uniforme. O nome das funções também é bastante intuitivo.\n\nNovamente, há funções base como `gsub`, `grep`, `strsplit`, `sub`, entre outras, que servem para manipular vetores de string, mas essas funções carecem de \"coesão interna\" e em alguns casos elas podem retornar valores inesperados ou \"erros silenciosos\".\n\nUma função muito divertida do pacote é a `str_glue` que facilita na hora de concatenar strings. Note como é simples incluir variáveis como parte do texto e inclusive fazer transformações nas variáveis.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(stringr)\n\nnome <- \"Vinicius Oike\"\nidade <- 29\nnfav <- runif(1, min = 0, max = 10)\n\nstr_glue(\"Olá, meu nome é {nome}, tenho {idade} anos. Ano que vem, terei {idade + 1} anos. Meu número favorito é {round(nfav)}.\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nOlá, meu nome é Vinicius Oike, tenho 29 anos. Ano que vem, terei 30 anos. Meu número favorito é 6.\n```\n:::\n:::\n\n\n### lubridate\n\nO `lubridate` é um pacote exclusivamente focado em manipulação de vetores de datas e tudo relacionado ao tempo como variável. Variáveis de datas podem ser uma dor de cabeça tremenda no processo de limpeza de dados, pois há inúmeros formatos diferentes, que variam para cada país, fora os problemas potenciais de ano bissextos, fusos-horários diferentes, etc.\n\nEspecialmente para quem precisa trabalhar com séries de tempo ou dados em painel, o `lubridate` é um pacote é essencial.\n\nO pacote também facilita \"operações aritméticas\" com datas como no exemplo abaixo:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(lubridate)\n\nstart <- ymd(\"2020-01-15\")\nstart + years(1) + months(3)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"2021-04-15\"\n```\n:::\n:::\n\n\nEle também permite a extração de qualquer informação específica de uma data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nagora <- ymd_hms(\"2022-06-10 20:36:15\")\n```\n:::\n\n\nComo o dia da semana:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwday(agora)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 6\n```\n:::\n:::\n\n\nO trimestre:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nquarter(agora)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 2\n```\n:::\n:::\n\n\nOu o mês (com a opção de ter a abreviação do mês já no padrão desejado!):\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmonth(agora, label = TRUE, locale = \"pt_BR\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] Jun\n12 Levels: Jan < Fev < Mar < Abr < Mai < Jun < Jul < Ago < Set < ... < Dez\n```\n:::\n:::\n\n\n### dbplyr\n\nO `dbplyr` é um pacote muito interessante que transforma o `R` numa \"interface\" para o SQL. O pacote traduz código escrito em `dplyr` para código em SQL. Assim, é possível acessar, transformar e baixar dados de uma Base de Dados em SQL, PostGreSQL, etc. diretamente no `R`.\n\nO código abaixo é um exemplo (bem artficial) que demonstra o funcionamento da pacote. A função `show_query()` não costuma ser usada na prática, mas ela serve para mostrar o que o pacote está fazendo.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\nlibrary(dbplyr)\n\n# Abre um servidor SQL para servir de exemplo\ncon <- DBI::dbConnect(RSQLite::SQLite(), dbname = \":memory:\")\n# Faz o update da tabela mtcars para esse servidor\ncopy_to(con, mtcars)\n# Acessa a tabela do servidor usando tbl\ndb <- tbl(con, \"mtcars\")\n\n# Trabalha normalmente usando comandos do dplyr\ndb %>%\n  filter(cyl %in% c(4, 6)) %>%\n  mutate(disp = log(round(disp))) %>%\n  group_by(cyl) %>%\n  summarise(a1 = mean(disp, na.rm = TRUE), a2 = median(wt, na.rm = TRUE)) %>%\n  arrange(desc(a1)) %>%\n  # No lugar de show_query() use collect() para baixar os dados\n  show_query()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n<SQL>\nSELECT `cyl`, AVG(`disp`) AS `a1`, MEDIAN(`wt`) AS `a2`\nFROM (\n  SELECT\n    `mpg`,\n    `cyl`,\n    LOG(ROUND(`disp`, 0)) AS `disp`,\n    `hp`,\n    `drat`,\n    `wt`,\n    `qsec`,\n    `vs`,\n    `am`,\n    `gear`,\n    `carb`\n  FROM `mtcars`\n  WHERE (`cyl` IN (4.0, 6.0))\n)\nGROUP BY `cyl`\nORDER BY `a1` DESC\n```\n:::\n:::\n\n\n# Visualização de dados\n\nAqui a lista fica simples pois o `ggplot2` é simplesmente indispensável. O `ggplot2` foi lançado em 2005 e até hoje ainda é o pacote mais baixado de `R` na [lista oficial do CRAN](https://www.r-pkg.org/downloaded). É um pacote sinônimo de `R` e dá um baile em qualquer outro pacote de visualização.\n\nO `ggplot2` tem uma sintaxe bastante intuitiva em que o usário vai adicionando camadas e elementos sobre o gráfico.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\n\nggplot(data = mtcars, aes(x = wt, y = mpg)) +\n  geom_smooth(color = \"#ef476f\", method = \"lm\", se = FALSE) +\n  geom_point(aes(color = as.factor(cyl))) +\n  scale_color_manual(name = \"\", values = c(\"#073b4c\", \"#06d6a0\", \"#ffd166\")) +\n  theme_bw()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\nO pacote por si só já é muito poderoso, mas há ainda inúmeras [extensões desnenvolvidas por outros usuários](https://exts.ggplot2.tidyverse.org/gallery/).\n\nPara ter uma ideia do potencial do pacote vale olhar, por exemplo, a [galeria de visualizações do Cédric Scherer](https://www.cedricscherer.com/top/dataviz/#&gid=1&pid=50).\n\n# Relatórios e Apps\n\n## RMarkdown\n\nUma análise de dados, em geral, vira um de dois produtos: um relatório/artigo ou um aplicativo interativo. Novamente o `R` tem funcionalidades incríveis para ambos os objetivos. Existe um tipo de arquivo chamado `RMarkdown` que junto com o pacote `knitr` permite compilar um arquivo misto de `Markdown` e `R` em formato `pdf`, `html`, `doc` ou `ppt`.\n\nEssa extensão é tão poderosa que não só é possível escrever um artigo científico com ela, mas também, um [dashboard interativo](https://pkgs.rstudio.com/flexdashboard/), um [livro inteiro](https://bookdown.org), ou até um [blog/site](https://bookdown.org/yihui/blogdown/) (este blog é escrito em `RMarkdown`).\n\nAtualmente o formato do código é ainda mais flexível, permitindo misturar linguagens como `R`, `Python`, `SQL` e outras num mesmo arquivo. [Um resumo das funcionalidades pode ser visto aqui](https://rmarkdown.rstudio.com).\n\n## Shiny\n\nO pacote `shiny` tem se tornado cada vez mais potente nos últimos anos. Inicialmente, ele servia para montar dashboards relativamente simples, que permitiam ao usuário mais liberdade para explorar e montar suas próprias análises. Atualmente, tanto o pacote como as suas extensões melhoraram muito o seu potencial.\n\nA [galeria de apps do RStudio](https://shiny.rstudio.com/gallery/) já está um pouco desatualizada, mas dá um sabor do que é possível fazer com `shiny`.\n\nAlguns exemplos:\n\n-   [Radiant](https://vnijs.shinyapps.io/radiant/?SSUID=102af87a3a) - Esta é, sem dúvida, uma das aplicações mais completas e impressionantes de Shiny, vale um post inteiro por si só.\n-   [Monitor de Covid](https://vac-lshtm.shinyapps.io/ncov_tracker/?_ga=2.208589338.945012269.1654951879-1352143415.1654951879#)\n-   [Anaálise do Perfil de Eleitor no Brasil](https://voronoys.shinyapps.io/voronoys/?_ga=2.21641907.945012269.1654951879-1352143415.1654951879)\n\n## Quarto\n\nRecentemente lançado, o `quarto` não é um pacote de `R` propriamente dito. O Quarto é como um `RMarkdown` turbinado, é um meio de publicar análises de dados com textos. De maneira geral o Quarto te permite:\n\n-   Escrever e rodar análises de dados em `R`, python e julia\n-   Publicar relatórios, dashboards, livros, sites, etc.\n-   Publicar artigos científicos utilizando equações, citações, etc.\n\nPara conhecer mais sobre o Quarto vale a pena checar o [site](https://quarto.org/). Como o Quarto foi desenvolvido pela Posit, que desenvolvou o `RStudio` a IDE mais popular de `R`, o Quarto e o `R` funcionam muito bem no `RStudio`.\n\n# Quero baixar tudo\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# O tidyverse inclui a instalação do dplyr, tidyr, readr, stringr e outros\npacks <- c(\n  \"data.table\",\n  \"vroom\",\n  \"tidyverse\",\n  \"readxl\",\n  \"haven\",\n  \"jsonlite\",\n  \"sf\",\n  \"rio\",\n  \"lubridate\",\n  \"dbplyr\",\n  \"odbc\",\n  \"DBI\",\n  \"knitr\",\n  \"shiny\",\n  \"quarto\"\n  )\n\ninstall.packages(packs, repos = \"https://vps.fmvz.usp.br/CRAN/\")\n```\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}