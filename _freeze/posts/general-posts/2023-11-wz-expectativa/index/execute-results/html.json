{
  "hash": "313047a79842b06d8e7520c4048ed7aa",
  "result": {
    "markdown": "---\ntitle: \"Expectativa de Vida em São Paulo\"\ndate: \"2023-11-03\"\ncategories: ['data-visualization', 'mapas', 'sao-paulo', 'ggplot2']\ndescription: \"Um mapa coroplético que apresenta a desigualdade na expectativa de vida nos distritos de São Paulo. Do Jardim Paulista até Anhanguera são 23 anos de diferença na idade média ao morrer. Enquanto no Jardim Paulista espera-se viver até 82 anos, em Anhanguera a expectativa de vida não chega aos 60 anos.\"\nformat:\n  html:\n    code-tools: true\nexecute: \n  echo: false\n  warning: false\n  message: false\n---\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nlibrary(ggplot2)\nlibrary(tidypod)\nlibrary(dplyr)\nlibrary(showtext)\nlibrary(readxl)\nlibrary(here)\nlibrary(sf)\nlibrary(patchwork)\n\nfont_add_google(\"Roboto Mono\", \"Roboto Mono\")\nshowtext_auto()\n\n# Import districts shapefile\ndstr <- tidypod::districts\ndstr <- filter(dstr, code_muni == 36)\n\n# Import Mapa Desigualdade Data\nsp <- read_excel(\n  \"/Users/viniciusoike/Documents/GitHub/maps/data/mapa_da_desigualdade_2023_dados.xlsx\",\n  sheet = 4,\n  .name_repair = janitor::make_clean_names\n)\n\nsp <- sp |> \n  rename(name_district = distritos) |> \n  mutate(name_district = if_else(name_district == \"Moóca\", \"Mooca\", name_district))\n\n\nmapasp <- dstr |> \n  left_join(sp, by = \"name_district\")\n\n\npmap <- ggplot(mapasp, aes(fill = idade_media_ao_morrer)) +\n  geom_sf() +\n  scale_fill_fermenter(\n    name = \"\",\n    palette = \"RdBu\",\n    breaks = seq(55, 85, 5),\n    direction = 1) +\n  labs(\n    title = \"Expectativa de Vida\",\n    subtitle = \"Idade média ao morrer por distrito em São Paulo\",\n    caption = \"Fonte: Nossa São Paulo, Mapa da Desigualdade (2023)\"\n    ) +\n  ggthemes::theme_map(base_family = \"Roboto Mono\") +\n  theme(\n    legend.position = \"top\",\n    legend.justification = 0.5,\n    legend.key.size = unit(0.5, \"cm\"),\n    legend.key.width = unit(1.25, \"cm\"),\n    legend.text = element_text(size = 12),\n    legend.margin = margin(),\n    plot.margin = margin(10, 5, 5, 10),\n    plot.title = element_text(size = 28, hjust = 0.5),\n    plot.subtitle = element_text(size = 14, hjust = 0.5)\n  )\n\ncount_group <- mapasp |> \n  st_drop_geometry() |> \n  as_tibble() |> \n  mutate(\n    group = findInterval(idade_media_ao_morrer, seq(55, 85, 5))\n  ) |> \n  summarise(\n    count = n(),\n    min = min(idade_media_ao_morrer),\n    pop = sum(populacao_total),\n    .by = \"group\"\n  ) |> \n  mutate(share = pop / sum(pop) * 100) |> \n  arrange(group)\n\npcol <- ggplot(count_group, aes(x = group, y = share, fill = as.factor(group))) +\n  geom_col() +\n  geom_text(\n    family = \"Roboto Mono\",\n    size = 5,\n    aes(x = group, y = share + 2, label = round(share, 1))\n    ) +\n  labs(title = stringr::str_wrap(\"Percentual da população dentro de cada grupo\", 25)) +\n  scale_fill_brewer(palette = \"RdBu\") +\n  guides(fill = 'none') +\n  theme_void(base_family = \"Roboto Mono\") +\n  theme(plot.title = element_text(size = 10, hjust = 0))\n\nmap_expectativa_de_vida <- \n  pmap + inset_element(pcol, left = 0.55, bottom = 0.05, right = 1, top = 0.4)\n```\n:::\n\n\n# Expectativa de vida\n\nSão Paulo é uma cidada marcada por desigualdades. Talvez uma das mais surpreendentes seja a da expectativa de vida. Do Jardim Paulista até Anhanguera são 23 anos de diferença na idade média ao morrer. Enquanto no Jardim Paulista espera-se viver até 82 anos, em Anhanguera a expectativa de vida não chega aos 60 anos.\n\n\n::: {.cell fig.showtext='true'}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-2-1.svg){width=100% height=900px}\n:::\n:::\n\n\n-   Dados: Nossa São Paulo ([Mapa da Desigualdade, 2023](https://www.nossasaopaulo.org.br/category/mapa-da-desigualdade/))\n\n-   Paleta: `RdBu` ([ColorBrewer](https://colorbrewer2.org/#type=diverging&scheme=RdBu&n=9))\n\n-   Tipografia: [Roboto Mono](https://fonts.google.com/specimen/Roboto+Mono)\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}