{
  "hash": "590672124884cfd6538b8f26319ef71b",
  "result": {
    "markdown": "---\ntitle: \"Domicilios em Sao Paulo\"\ncategories: ['data-visualization', 'mapas', 'ggplot2', 'sao-paulo']\ndate: \"2024-04-02\"\ndescription: \"Um mapa coroplético em formato de grid retangular 100 x 100m mostrando a densidade de domicílios particulares em São Paulo. Os dados são do Censo mais recente, de 2022.\"\nexecute: \n  warning: false\n  message: false\n  echo: false\n---\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\n# Setup ---------------------------------------------------------\n\n# Libraries\nlibrary(ggplot2)\nlibrary(geobr)\nlibrary(dplyr)\nlibrary(showtext)\nlibrary(dplyr)\nlibrary(sf)\nlibrary(MetBrewer)\n# https://github.com/viniciusoike/tidypod\nlibrary(tidypod)\n\n# Fonts\nfont_add(\"HelveticaNeue\", \"HelveticaNeue.ttc\")\nshowtext_auto()\n\n# Data ----------------------------------------------------------\n\n# Import Sao Paulo shapefile\nsp_border <- geobr::read_municipality(3550308, showProgress = FALSE)\n\n# Import locally Census data\ncenso22 <- data.table::fread(\"/Volumes/T7 Touch/github/tidyibge/data-raw/35.csv\")\n\n# Convert column names to lowercase and filter only capital\ncenso22 <- censo22 |> \n  rename_with(tolower) |> \n  filter(cod_mun == 3550308)\n\n# Variable dictionary\ndictionary_censo <- tribble(\n  ~cod_especie, ~label_especie,\n  1, \"Domicílio particular\",\n  2, \"Domicílio coletivo\",\n  3, \"Estabelecimento agropecuário\",\n  4, \"Estabelecimento de ensino\",\n  5, \"Estabelecimento de saúde\",\n  6, \"Estabelecimento de outras finalidades\",\n  7, \"Edificação em construção\",\n  8, \"Estabelecimento religioso\"\n)\n\n# Join data with dictionary -------------------------------------\ncenso22 <- left_join(censo22, dictionary_censo, by = \"cod_especie\")\n\n\n# Spatial data --------------------------------------------------\n\n# Import districts shapefile\ndstr <- tidypod::districts\ndstr <- filter(dstr, code_muni == 36)\n\ndomicilios <- st_as_sf(\n  censo22[cod_especie == 1],\n  coords = c(\"longitude\", \"latitude\"),\n  crs = 4674\n  )\n\nsp_grid_rectangular <- sp_border |> \n  st_transform(crs = 32722) |> \n  st_make_grid(cellsize = 100) |> \n  st_as_sf() |> \n  st_transform(crs = 4326) |> \n  mutate(gid = row_number())\n\ndomi_grid <- domicilios |> \n  st_transform(crs = 4326) |> \n  st_join(sp_grid_rectangular) |> \n  filter(!is.na(gid))\n\ndomi_grid_count <- domi_grid |> \n  st_drop_geometry() |> \n  summarise(total = n(), .by = \"gid\")\n\ngrid_count <- left_join(sp_grid_rectangular, domi_grid_count, by = \"gid\")\n\n# Plot ----------------------------------------------------------\n\nbreaks <- BAMMtools::getJenksBreaks(na.omit(grid_count$total), 7)\nlabels <- format(round(breaks, -1), big.mark = \".\")\n\nmap_sp <- ggplot() +\n  geom_sf(data = sp_border, lwd = 0.05, fill = NA) +\n  geom_sf(\n    data = filter(grid_count, !is.na(total)),\n    aes(fill = total, color = total),\n    alpha = 0.8\n    ) +\n  scale_fill_fermenter(\n    name = \"\",\n    na.value = \"gray50\",\n    direction = 1,\n    palette = \"BuPu\",\n    breaks = breaks,\n    labels = labels\n    ) +\n  scale_color_fermenter(\n    name = \"\",\n    na.value = \"gray50\",\n    direction = 1,\n    palette = \"BuPu\",\n    breaks = breaks,\n    labels = labels\n    ) +\n  coord_sf() +\n  labs(\n    title = \"Domicílios em São Paulo\",\n    subtitle = \"Concentração de domicílios em grid 100x100m em São Paulo\") +\n  ggthemes::theme_map(base_family = \"HelveticaNeue\") +\n  theme(\n    legend.position = \"top\",\n    legend.justification = 0.5,\n    legend.key.size = unit(0.85, \"cm\"),\n    legend.key.width = unit(1.5, \"cm\"),\n    legend.text = element_text(size = 12),\n    legend.margin = margin(),\n    plot.margin = margin(10, 5, 5, 10),\n    plot.title = element_text(size = 24, hjust = 0.5),\n    plot.subtitle = element_text(size = 10, hjust = 0.5)\n  )\n```\n:::\n\n\n# Domicilios\n\nO mapa abaixo mostra a densidade de domicílios[^1] em São Paulo num grid de 100 x 100m. Como se vê no mapa, há uma grande concentração de domicílios no Centro da cidade. De modo geral, a região com maior número de domicílios é a Zona Leste. Os dados provêm do Cadastro Nacional de Endereços, divulgados recentemente pelo IBGE. Esta base contém dados georeferenciados detalhados sobre os domicílios no Brasil.\n\n[^1]: Definidos como domicílios particulares permanentes, segundo o Censo do IBGE (2022).\n\n\n::: {.cell fig.showtext='true'}\n::: {.cell-output-display}\n![](index_files/figure-html/plot-map-1.svg){width=100% height=900px}\n:::\n:::\n\n\n-   Dados: IBGE ([**Cadastro Nacional de Endereços para Fins Estatísticos**](https://www.ibge.gov.br/estatisticas/sociais/populacao/38734-cadastro-nacional-de-enderecos-para-fins-estatisticos.html))\n\n-   Tipografia: Helvetica Neue\n\n-   Paleta: `BuPu` ([ColorBrewer](https://colorbrewer2.org/#type=diverging&scheme=BrBG&n=3))\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}