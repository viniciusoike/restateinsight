{
  "hash": "d3824822ce42033c23cdb53cbf4c6041",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Finding All Starbucks in Brazil\"\ndate: \"2024-07-14\"\ncategories: ['starbucks', 'web-scrapping', 'data-science', 'brazil', 'tutorial-R', 'finding', 'english']\ndescription: \"In this post, I show how to find all Starbucks in Brazil using web scraping in R. I also show how to use the Google Places API to add ratings information for all Starbucks units. Web scraping is useful in market studies to acquire information that isn't readily available.\"\nimage: \"/static/images/thumbnails/starbucks_logo.png\"\nimage-alt: \"/static/images/thumbnails/starbucks_logo.png\"\nexecute: \n  message: false\n  warning: false\n---\n\n\n\n# Starbucks\n\n## Web scraping\n\nWeb scraping consists of extracting information from a web page. The difficulty or ease of extracting this information depends on how well the page is constructed. In more complex cases, the information may be behind a captcha or within an interactive panel that depends on user input.\n\nIn this simple example, **I will show how to find the locations of all Starbucks stores in Brazil**. The full list of active Starbucks stores can be found on the [Starbucks Brasil website](https://starbucks.com.br/lojas). As usual, we will use the `tidyverse` along with the `rvest` and `xml2` packages.\n\n### Setup\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(rvest)   # Used for web scraping and extracting HTML content\nlibrary(xml2)    # Helps in working with XML and HTML data\nlibrary(tidyverse)\n```\n:::\n\n\n\n### The website\n\nThe full list of active Starbucks stores can be found on the [Starbucks Brasil website](https://starbucks.com.br/lojas). To read the page, we use read_html.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nurl <- \"https://starbucks.com.br/lojas\"\npage <- xml2::read_html(url)   # Fetches the HTML content of the page\n```\n:::\n\n\n\nThe \"xpath\" shows the path to a specific element on the page. For example, to find the Starbucks logo in the top-left corner of the page, we can use the following code:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Extracts the HTML element for the logo image\npage %>%\n  html_element(xpath = \"/html/body/div[1]/div[1]/header/nav/div/div[1]/a/img\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n{html_node}\n<img alt=\"Starbucks Logo\" src=\"/public/img/icons/starbucks-nav-logo.svg\">\n```\n\n\n:::\n:::\n\n\n\nTo learn more about xpaths, you can consult [this cheatsheet](https://devhints.io/xpath).\n\nIn general, on well-constructed pages, the name of elements will be quite self-explanatory. In the case above, the `alt` attribute already indicates that the object is the Starbucks logo, and the `src` links to an image file in `svg` format called `starbucks-nav-logo`. Unfortunately, this won't always be the case. On some pages, elements can be quite confusing.\n\nTo extract a specific attribute, we use the `html_attr` function.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npage %>%\n  html_element(\n    xpath = \"/html/body/div[1]/div[1]/header/nav/div/div[1]/a/img\"\n    ) %>%\n  # Extracts the \"src\" attribute (URL to the image)\n  html_attr(\"src\")  \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"/public/img/icons/starbucks-nav-logo.svg\"\n```\n\n\n:::\n:::\n\n\n\nIf you combine this last link with \"www.starbucks.com.br\", you should arrive at an image of the company's logo[^1].\n\n[^1]: <https://starbucks.com.br/public/img/icons/starbucks-nav-logo.svg>\n\n![Starbucks logo](https://starbucks.com.br/public/img/icons/starbucks-nav-logo.svg){width=\"30%\" fig-align=\"center\"}\n\nTo find the big list of stores in the left panel, we will take advantage of the fact that the `div` holding this list has a unique class called `\"place-list\"`. It's easy to verify this directly in your browser. If you use Chrome, for instance, just right-click on the panel and click on Inspect.\n\n![](images/Screenshot%202024-03-23%20at%2015.20.37.png){fig-align=\"center\"}\n\n![](images/Screenshot%202024-03-23%20at%2015.20.47.png){fig-align=\"center\"}\n\nAs I mentioned above, things aren't always well organized. Note that since we want to extract multiple elements and multiple (all) attributes, we use the variants: `html_elements` and `html_attrs`.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlist_attr <- page %>%\n  # Selects all divs under \"place-list\" that hold store info\n  html_elements(xpath = '//div[@class=\"place-list\"]/div')  %>%\n  # Extracts all attributes of the selected elements\n  html_attrs()  \n```\n:::\n\n\n\nThe extracted object is a list where each element is a text vector containing the following information. We have the store name, latitude/longitude, and the address.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Extracts the first store's information from the list\npluck(list_attr, 1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                  class           data-latitude          data-longitude \n\"place-item r-place-15\"           \"-23.5658059\"           \"-46.6508012\" \n              data-name             data-street              data-index \n  \"Shopping Top Center\" \"Avenida Paulista, 854\"                     \"0\" \n```\n\n\n:::\n:::\n\n\n\nAt this point, the web scraping process is complete. Once again, the process was easy because the data is well structured on the Starbucks page. Now, we just need to clean the data.\n\n## Data Cleaning\n\nI won't go in depth about the data cleaning process. Basically, we need to convert each element of the list into a `data.frame`, stack the results, and then adjust the data types of each column.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Convert the elements into data.frame\ndat <- map(list_attr, \\(x) as.data.frame(t(x)))\n# Stack the results\ndat <- bind_rows(dat)\n\nclean_dat <- dat %>%\n  as_tibble() %>%\n  # Rename the columns\n  rename_with(~str_remove(.x, \"data-\")) %>%\n  rename(lat = latitude, lng = longitude) %>%\n  # Select the columns of interest\n  select(index, name, street, lat, lng) %>%\n  # Convert lat/lng to numeric\n  mutate(\n    lat = as.numeric(lat),\n    lng = as.numeric(lng),\n    index = as.numeric(index),\n    name = str_trim(name)\n    )\n```\n:::\n\n\n\nThe final dataset is presented below\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"datatables html-widget html-fill-item\" id=\"htmlwidget-bb41c343c0a185b37192\" style=\"width:100%;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-bb41c343c0a185b37192\">{\"x\":{\"filter\":\"none\",\"vertical\":false,\"data\":[[\"1\",\"2\",\"3\",\"4\",\"5\",\"6\",\"7\",\"8\",\"9\",\"10\",\"11\",\"12\",\"13\",\"14\",\"15\",\"16\",\"17\",\"18\",\"19\",\"20\",\"21\",\"22\",\"23\",\"24\",\"25\",\"26\",\"27\",\"28\",\"29\",\"30\",\"31\",\"32\",\"33\",\"34\",\"35\",\"36\",\"37\",\"38\",\"39\",\"40\",\"41\",\"42\",\"43\",\"44\",\"45\",\"46\",\"47\",\"48\",\"49\",\"50\",\"51\",\"52\",\"53\",\"54\",\"55\",\"56\",\"57\",\"58\",\"59\",\"60\",\"61\",\"62\",\"63\",\"64\",\"65\",\"66\",\"67\",\"68\",\"69\",\"70\",\"71\",\"72\",\"73\",\"74\",\"75\",\"76\",\"77\",\"78\",\"79\",\"80\",\"81\",\"82\",\"83\",\"84\",\"85\",\"86\",\"87\",\"88\",\"89\",\"90\",\"91\",\"92\",\"93\",\"94\",\"95\",\"96\",\"97\",\"98\",\"99\",\"100\",\"101\",\"102\",\"103\",\"104\",\"105\",\"106\",\"107\",\"108\",\"109\",\"110\"],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109],[\"Shopping Top Center\",\"Paulista 500\",\"Shopping Cidade São Paulo\",\"Shopping Patio Paulista\",\"Eliseu Guilherme\",\"Shopping Center 3\",\"Shopping Frei Caneca\",\"Haddock Lobo\",\"Mackenzie\",\"Shopping Higienopolis\",\"Shopping Metrô Santa Cruz\",\"SP Corporate Towers\",\"Gomes de Carvalho\",\"Bourbon Shopping\",\"Berrini\",\"Shopping Mooca\",\"Bráz Leme\",\"Shopping Plaza Sul\",\"Shopping Center Norte - Portaria\",\"Vivo Eco Berrini\",\"Aeroporto de Congonhas\",\"João Saad\",\"Shopping Market Place\",\"Shopping Morumbi Térreo\",\"Shopping Metrô Tatuapé\",\"Rochaverá Corporate Towers\",\"Shopping Anália Franco\",\"Tiete Plaza Shopping\",\"Shopping São Caetano\",\"Shopping Morumbi Town\",\"Shopping Interlagos\",\"Super Shopping Osasco\",\"Shopping SP Market\",\"Shopping Internacional de Guarulhos\",\"Shopping Aricanduva\",\"Shopping Aricanduva Quiosque\",\"Grand Plaza Shopping\",\"Shopping ABC\",\"Shopping Metro Itaquera\",\"Shopping São Bernardo Plaza\",\"Aeroporto GRU - Terminal 2 Nacional – Praça de Alimentação / Área Pública - ASA E\",\"Aeroporto GRU - Terminal 2 Internacional Embarque Área Restrita - Portão 268\",\"Aeroporto GRU -   Terminal 3 Internacional Área Restrita - Portão 306\",\"Iguatemi Alphaville\",\"Jundiaí Shopping\",\"Mogi Shopping\",\"Maxi Shopping Jundiaí\",\"Lago Azul km 58 (Sentido Interior)\",\"Litoral Plaza Shopping\",\"Lago Azul km 64\",\"Praia Mar Shopping\",\"Morro Azul\",\"Lago Azul Km 72 (Rodovia Anhanguera)\",\"Outlet Premium Itupeva\",\"Aeroporto Viracopos - Desembarque\",\"Aeroporto Viracopos - Embarque\",\"Iguatemi Esplanada Sorocaba\",\"Iguatemi Campinas\",\"Cambuí\",\"Shopping Vale Sul\",\"Dom Pedro Flores\",\"Dom Pedro Shopping Livraria\",\"Pátio Limeira\",\"Roseira Posto Arco-Íris\",\"Bauru Shopping\",\"Iguatemi Ribeirão\",\"Ribeirão Shopping - Quiosque\",\"Ribeirão Shopping - Loja\",\"ParkShopping Campo Grande\",\"Shopping Jockey Plaza\",\"Shopping Mueller - Curitiba\",\"Aeroporto de Curitiba – Airside\",\"Estação Curitiba\",\"Spot Compact Mall Batel\",\"Shopping Nova Iguaçu\",\"Pátio Batel\",\"Park Shopping Barigui\",\"Shopping Palladium\",\"Barra Shopping\",\"Shopping Village Mall\",\"Shopping Nova América\",\"Aeroporto Galeão - Mezanino Área Pública 1° Piso - Terminal 2\",\"Aeroporto Galeão - T2 Doméstico Embarque Restrito Portão 34\",\"Cinelândia\",\"Assembleia do Carmo\",\"Aeroporto Santos Dumont\",\"Shopping Mueller Joinville\",\"Shopping Iguatemi São José do Rio Preto\",\"Norte Shopping Blumenau\",\"Porto Belo Outlet\",\"Partage Betim Shopping\",\"Villa Romana Shopping\",\"Itaú Power\",\"Aeroporto de Florianópolis -  Boulevard\",\"Área restrita, sala de embarque - BH Aeroporto\",\"Piso 1, Check in - BH Aeroporto\",\"ParkShopping Canoas\",\"POA Airport Desembarque- área externa 1° piso\",\"POA Airport Embarque Restrito - próximo ao Portão 115\",\"Outlet Premium Brasilia\",\"Galeria Chaves\",\"Barra Shopping Sul\",\"Aeroporto Brasília  - Embarque 1° piso\",\"Aeroporto Brasília  -  Desembarque Térreo\",\"Aeroporto de Brasília - Portão 10 (Pier Norte)\",\"Taguatinga Shopping\",\"Shopping Venâncio\",\"Conjunto Nacional\",\"Shopping Barra\",\"Shopping da Bahia\"],[\"Avenida Paulista, 854\",\"Avenida Paulista, 500\",\"Avenida Paulista, 1154\",\"Rua Treze de Maio, 1933\",\"Rua Desembargador Eliseu Guilherme, 200\",\"Avenida Paulista, 2064\",\"Rua Frei Caneca, 569\",\"Rua Haddock Lobo, 608\",\"Rua Maria Antônia, 293 - 403\",\"Avenida Higienópolis, 618\",\"Rua Domingos de Morais, 2564\",\"Avenida Presidente Juscelino Kubitschek, 1909\",\"Rua Gomes de Carvalho, 1740\",\"Rua Palestra Itália, 500\",\"Avenida Engenheiro Luís Carlos Berrini, 773\",\"Rua Capitão Pacheco e Chaves, 313\",\"Avenida Braz Leme, 1200\",\"Praça Leonor Kaupa, 100\",\"Travessa Casalbuono, 120\",\"Avenida Engenheiro Luís Carlos Berrini, 1376\",\"Avenida Washington Luís, S/N\",\"Avenida Jorge João Saad, 900\",\"Avenida das Nações Unidas, 13947\",\"Avenida Roque Petroni Júnior, 1089\",\"Rua Domingos Agostim, 91\",\"Avenida das Nações Unidas, 14171\",\"Avenida Regente Feijó, 1739\",\"Avenida Raimundo Pereira de Magalhães, 1465\",\"Alameda Terracota, 545\",\"Avenida Giovanni Gronchi, 5930\",\"Avenida Interlagos, 2255\",\"Avenida dos Autonomistas, 1768\",\"Avenida das Nações Unidas, 22540\",\"Rua Engenheiro Camilo Oliveti, 295\",\"Avenida Aricanduva, 5555\",\"Avenida Aricanduva, 5555\",\"Avenida Industrial, 600\",\"Avenida Pereira Barreto, 42\",\"Avenida José Pinheiro Borges, S/N\",\"Avenida Rotary, 624\",\"Rodovia Hélio Smidt, S/N\",\"Rodovia Hélio Smidt, S/N\",\"Rodovia Hélio Smidt, S/N\",\"Alameda Rio Negro, 111\",\"Avenida 9 de Julho, 3333\",\"Avenida Vereador Narciso Yague Guimarães, 1001\",\"Avenida Antonio Frederico Ozanam, 6000\",\"Rodovia dos Bandeirantes, S/n\",\"Avenida Ayrton Senna da Silva, 1511\",\"Rodovia dos Bandeirantes, S/N\",\"Rua Alexandre Martins, 80\",\"Rodovia Dom Pedro I, Km 95,5\",\"Avenida José Nicolau Estabile, S/N\",\"Rodovia dos Bandeirantes, Km 72\",\"Rodovia Santos Dumont, km 66\",\"Rodovia Santos Dumont, km 66\",\"Avenida Gisele Constantino, S/N\",\"Avenida Iguatemi, 777\",\"Rua Coronel Quirino, 1067\",\"Avenida Andrômeda, 227\",\"Avenida Guilherme Campos, 500\",\"Avenida Guilherme Campos, 500\",\"Rua Carlos Gomes, 1321\",\"Rodovia Presidente Dutra, Km 82 , km 82\",\"Rua Henrique Savi, 55\",\"Avenida Luiz Eduardo Toledo Prado, 900\",\"Avenida Coronel Fernando Ferreira Leite, 1540\",\"Avenida Coronel Fernando Ferreira Leite, 1540\",\"Estrada do Monteiro, 1200\",\"Avenida Victor Ferreira do Amaral, 2633\",\"Avenida Cândido de Abreu, 488\",\"Avenida Rocha Pombo, 2730\",\"Avenida Sete de Setembro, 2775\",\"Avenida Vicente Machado, 520\",\"Avenida Abílio Augusto Távora, 1111\",\"Avenida do Batel, 1868\",\"Rua Professor Pedro Viriato Parigot de Souza, 600\",\"Avenida Presidente Kennedy, 4121\",\"Avenida das Américas, 4666\",\"Avenida das Américas, 3900\",\"Avenida Pastor Martin Luther King Júnior, 126\",\"Avenida Vinte de Janeiro, S/N\",\"Avenida Vinte de Janeiro, S/N\",\"Praça Floriano, 7\",\"Rua do Carmo, 11\",\"Praça Senador Salgado Filho, S/N\",\"Rua Visconde de Taunay, 235 \",\"Avenida Presidente Juscelino K. de Oliveira, 5000\",\"BR-470, 3000\",\"BR-101, Km 159\",\"Rodovia Fernão Dias, 601\",\"Avenida Madre Benvenuta, 687\",\"Avenida General David Sarnoff, 5160\",\"Avenida Deputado Diomício Freitas, S/N\",\"LMG-800 Km 7,9 , S/N\",\"LMG-800, S/N\",\"Avenida Farroupilha, 4545\",\"Avenida Severo Dullius, 90.010 \",\"Avenida Severo Dullius, 90010\",\"BR-060, 360\",\"Rua dos Andradas, 1448\",\"Avenida Diário de Notícias, 300\",\"Lago Sul, S/N \",\"Lago Sul, S/N\",\"Lago Sul, -\",\"QS 01, Lote 40 , lote 40\",\"Setor Comercial Sul, SN\",\"SDN, CNB, SN\",\"Avenida Centenário, 2992\",\"Avenida Tancredo Neves, 148\"],[-23.57,-23.57,-23.56,-23.57,-23.57,-23.56,-23.55,-23.56,-23.55,-23.54,-23.6,-23.59,-23.59,-23.53,-23.6,-23.58,-23.51,-23.62,-23.52,-23.61,-23.63,-23.59,-23.62,-23.62,-23.54,-23.62,-23.56,-23.51,-23.63,-23.63,-23.68,-23.54,-23.68,-23.49,-23.57,-23.57,-23.65,-23.67,-23.54,-23.72,-23.44,-23.44,-23.44,-23.5,-23.2,-23.52,-23.17,-23.19,-24,-23.15,-23.98,-23.03,-23.09,-23.11,-23.01,-23.01,-23.54,-22.89,-22.9,-23.22,-22.85,-22.85,-22.57,-22.91,-22.33,-21.23,-21.21,-21.21,-22.93,-25.43,-25.42,-25.54,-25.44,-25.43,-22.76,-25.44,-25.44,-25.48,-23,-23,-22.88,-22.81,-22.81,-22.91,-22.9,-22.91,-26.3,-20.87,-26.86,-27.2,-19.96,-27.59,-19.95,-27.66,-19.63,-19.63,-29.92,-29.99,-29.99,-16.12,-30.03,-30.08,-15.87,-15.87,-15.87,-15.84,-15.8,-15.79,-13.01,-12.98],[-46.65,-46.65,-46.65,-46.64,-46.64,-46.66,-46.65,-46.66,-46.65,-46.66,-46.64,-46.69,-46.69,-46.68,-46.69,-46.59,-46.65,-46.63,-46.62,-46.69,-46.67,-46.72,-46.7,-46.7,-46.58,-46.7,-46.56,-46.72,-46.58,-46.74,-46.68,-46.77,-46.7,-46.55,-46.5,-46.5,-46.53,-46.53,-46.46,-46.54,-46.49,-46.49,-46.49,-46.85,-46.89,-46.18,-46.89,-46.93,-46.41,-46.96,-46.31,-46.75,-46.97,-47.01,-47.14,-47.14,-47.47,-47.03,-47.05,-45.89,-47.06,-47.06,-47.41,-45.32,-49.06,-47.84,-47.82,-47.82,-43.57,-49.21,-49.27,-49.17,-49.27,-49.28,-43.47,-49.29,-49.32,-49.29,-43.36,-43.35,-43.27,-43.24,-43.24,-43.18,-43.18,-43.17,-48.85,-49.41,-49.09,-48.61,-44.16,-48.52,-44.02,-48.53,-43.96,-43.96,-51.16,-51.17,-51.18,-48.4,-51.23,-51.25,-47.92,-47.92,-47.92,-48.04,-47.89,-47.88,-38.52,-38.46]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th> <\\/th>\\n      <th>index<\\/th>\\n      <th>name<\\/th>\\n      <th>street<\\/th>\\n      <th>lat<\\/th>\\n      <th>lng<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"index\":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109],\"name\":[\"Shopping Top Center\",\"Paulista 500\",\"Shopping Cidade São Paulo\",\"Shopping Patio Paulista\",\"Eliseu Guilherme\",\"Shopping Center 3\",\"Shopping Frei Caneca\",\"Haddock Lobo\",\"Mackenzie\",\"Shopping Higienopolis\",\"Shopping Metrô Santa Cruz\",\"SP Corporate Towers\",\"Gomes de Carvalho\",\"Bourbon Shopping\",\"Berrini\",\"Shopping Mooca\",\"Bráz Leme\",\"Shopping Plaza Sul\",\"Shopping Center Norte - Portaria\",\"Vivo Eco Berrini\",\"Aeroporto de Congonhas\",\"João Saad\",\"Shopping Market Place\",\"Shopping Morumbi Térreo\",\"Shopping Metrô Tatuapé\",\"Rochaverá Corporate Towers\",\"Shopping Anália Franco\",\"Tiete Plaza Shopping\",\"Shopping São Caetano\",\"Shopping Morumbi Town\",\"Shopping Interlagos\",\"Super Shopping Osasco\",\"Shopping SP Market\",\"Shopping Internacional de Guarulhos\",\"Shopping Aricanduva\",\"Shopping Aricanduva Quiosque\",\"Grand Plaza Shopping\",\"Shopping ABC\",\"Shopping Metro Itaquera\",\"Shopping São Bernardo Plaza\",\"Aeroporto GRU - Terminal 2 Nacional – Praça de Alimentação / Área Pública - ASA E\",\"Aeroporto GRU - Terminal 2 Internacional Embarque Área Restrita - Portão 268\",\"Aeroporto GRU -   Terminal 3 Internacional Área Restrita - Portão 306\",\"Iguatemi Alphaville\",\"Jundiaí Shopping\",\"Mogi Shopping\",\"Maxi Shopping Jundiaí\",\"Lago Azul km 58 (Sentido Interior)\",\"Litoral Plaza Shopping\",\"Lago Azul km 64\",\"Praia Mar Shopping\",\"Morro Azul\",\"Lago Azul Km 72 (Rodovia Anhanguera)\",\"Outlet Premium Itupeva\",\"Aeroporto Viracopos - Desembarque\",\"Aeroporto Viracopos - Embarque\",\"Iguatemi Esplanada Sorocaba\",\"Iguatemi Campinas\",\"Cambuí\",\"Shopping Vale Sul\",\"Dom Pedro Flores\",\"Dom Pedro Shopping Livraria\",\"Pátio Limeira\",\"Roseira Posto Arco-Íris\",\"Bauru Shopping\",\"Iguatemi Ribeirão\",\"Ribeirão Shopping - Quiosque\",\"Ribeirão Shopping - Loja\",\"ParkShopping Campo Grande\",\"Shopping Jockey Plaza\",\"Shopping Mueller - Curitiba\",\"Aeroporto de Curitiba – Airside\",\"Estação Curitiba\",\"Spot Compact Mall Batel\",\"Shopping Nova Iguaçu\",\"Pátio Batel\",\"Park Shopping Barigui\",\"Shopping Palladium\",\"Barra Shopping\",\"Shopping Village Mall\",\"Shopping Nova América\",\"Aeroporto Galeão - Mezanino Área Pública 1° Piso - Terminal 2\",\"Aeroporto Galeão - T2 Doméstico Embarque Restrito Portão 34\",\"Cinelândia\",\"Assembleia do Carmo\",\"Aeroporto Santos Dumont\",\"Shopping Mueller Joinville\",\"Shopping Iguatemi São José do Rio Preto\",\"Norte Shopping Blumenau\",\"Porto Belo Outlet\",\"Partage Betim Shopping\",\"Villa Romana Shopping\",\"Itaú Power\",\"Aeroporto de Florianópolis -  Boulevard\",\"Área restrita, sala de embarque - BH Aeroporto\",\"Piso 1, Check in - BH Aeroporto\",\"ParkShopping Canoas\",\"POA Airport Desembarque- área externa 1° piso\",\"POA Airport Embarque Restrito - próximo ao Portão 115\",\"Outlet Premium Brasilia\",\"Galeria Chaves\",\"Barra Shopping Sul\",\"Aeroporto Brasília  - Embarque 1° piso\",\"Aeroporto Brasília  -  Desembarque Térreo\",\"Aeroporto de Brasília - Portão 10 (Pier Norte)\",\"Taguatinga Shopping\",\"Shopping Venâncio\",\"Conjunto Nacional\",\"Shopping Barra\",\"Shopping da Bahia\"],\"street\":[\"Avenida Paulista, 854\",\"Avenida Paulista, 500\",\"Avenida Paulista, 1154\",\"Rua Treze de Maio, 1933\",\"Rua Desembargador Eliseu Guilherme, 200\",\"Avenida Paulista, 2064\",\"Rua Frei Caneca, 569\",\"Rua Haddock Lobo, 608\",\"Rua Maria Antônia, 293 - 403\",\"Avenida Higienópolis, 618\",\"Rua Domingos de Morais, 2564\",\"Avenida Presidente Juscelino Kubitschek, 1909\",\"Rua Gomes de Carvalho, 1740\",\"Rua Palestra Itália, 500\",\"Avenida Engenheiro Luís Carlos Berrini, 773\",\"Rua Capitão Pacheco e Chaves, 313\",\"Avenida Braz Leme, 1200\",\"Praça Leonor Kaupa, 100\",\"Travessa Casalbuono, 120\",\"Avenida Engenheiro Luís Carlos Berrini, 1376\",\"Avenida Washington Luís, S/N\",\"Avenida Jorge João Saad, 900\",\"Avenida das Nações Unidas, 13947\",\"Avenida Roque Petroni Júnior, 1089\",\"Rua Domingos Agostim, 91\",\"Avenida das Nações Unidas, 14171\",\"Avenida Regente Feijó, 1739\",\"Avenida Raimundo Pereira de Magalhães, 1465\",\"Alameda Terracota, 545\",\"Avenida Giovanni Gronchi, 5930\",\"Avenida Interlagos, 2255\",\"Avenida dos Autonomistas, 1768\",\"Avenida das Nações Unidas, 22540\",\"Rua Engenheiro Camilo Oliveti, 295\",\"Avenida Aricanduva, 5555\",\"Avenida Aricanduva, 5555\",\"Avenida Industrial, 600\",\"Avenida Pereira Barreto, 42\",\"Avenida José Pinheiro Borges, S/N\",\"Avenida Rotary, 624\",\"Rodovia Hélio Smidt, S/N\",\"Rodovia Hélio Smidt, S/N\",\"Rodovia Hélio Smidt, S/N\",\"Alameda Rio Negro, 111\",\"Avenida 9 de Julho, 3333\",\"Avenida Vereador Narciso Yague Guimarães, 1001\",\"Avenida Antonio Frederico Ozanam, 6000\",\"Rodovia dos Bandeirantes, S/n\",\"Avenida Ayrton Senna da Silva, 1511\",\"Rodovia dos Bandeirantes, S/N\",\"Rua Alexandre Martins, 80\",\"Rodovia Dom Pedro I, Km 95,5\",\"Avenida José Nicolau Estabile, S/N\",\"Rodovia dos Bandeirantes, Km 72\",\"Rodovia Santos Dumont, km 66\",\"Rodovia Santos Dumont, km 66\",\"Avenida Gisele Constantino, S/N\",\"Avenida Iguatemi, 777\",\"Rua Coronel Quirino, 1067\",\"Avenida Andrômeda, 227\",\"Avenida Guilherme Campos, 500\",\"Avenida Guilherme Campos, 500\",\"Rua Carlos Gomes, 1321\",\"Rodovia Presidente Dutra, Km 82 , km 82\",\"Rua Henrique Savi, 55\",\"Avenida Luiz Eduardo Toledo Prado, 900\",\"Avenida Coronel Fernando Ferreira Leite, 1540\",\"Avenida Coronel Fernando Ferreira Leite, 1540\",\"Estrada do Monteiro, 1200\",\"Avenida Victor Ferreira do Amaral, 2633\",\"Avenida Cândido de Abreu, 488\",\"Avenida Rocha Pombo, 2730\",\"Avenida Sete de Setembro, 2775\",\"Avenida Vicente Machado, 520\",\"Avenida Abílio Augusto Távora, 1111\",\"Avenida do Batel, 1868\",\"Rua Professor Pedro Viriato Parigot de Souza, 600\",\"Avenida Presidente Kennedy, 4121\",\"Avenida das Américas, 4666\",\"Avenida das Américas, 3900\",\"Avenida Pastor Martin Luther King Júnior, 126\",\"Avenida Vinte de Janeiro, S/N\",\"Avenida Vinte de Janeiro, S/N\",\"Praça Floriano, 7\",\"Rua do Carmo, 11\",\"Praça Senador Salgado Filho, S/N\",\"Rua Visconde de Taunay, 235 \",\"Avenida Presidente Juscelino K. de Oliveira, 5000\",\"BR-470, 3000\",\"BR-101, Km 159\",\"Rodovia Fernão Dias, 601\",\"Avenida Madre Benvenuta, 687\",\"Avenida General David Sarnoff, 5160\",\"Avenida Deputado Diomício Freitas, S/N\",\"LMG-800 Km 7,9 , S/N\",\"LMG-800, S/N\",\"Avenida Farroupilha, 4545\",\"Avenida Severo Dullius, 90.010 \",\"Avenida Severo Dullius, 90010\",\"BR-060, 360\",\"Rua dos Andradas, 1448\",\"Avenida Diário de Notícias, 300\",\"Lago Sul, S/N \",\"Lago Sul, S/N\",\"Lago Sul, -\",\"QS 01, Lote 40 , lote 40\",\"Setor Comercial Sul, SN\",\"SDN, CNB, SN\",\"Avenida Centenário, 2992\",\"Avenida Tancredo Neves, 148\"],\"lat\":[-23.5658059,-23.5678355,-23.5631043,-23.5704519,-23.5735072,-23.5578455,-23.554083,-23.5578647,-23.5462691,-23.5422471,-23.5990249,-23.5916617,-23.5949773,-23.5264048,-23.6037897,-23.5797475,-23.5075493,-23.6198179,-23.5155249,-23.6085754,-23.6291469,-23.5943227,-23.6210905,-23.6232391,-23.5417077,-23.622013,-23.5614014,-23.5065898,-23.6259357,-23.6318236,-23.6764565,-23.5357892,-23.6785695,-23.4881295,-23.5656417,-23.5656417,-23.648587,-23.6677966,-23.5380357,-23.7232218,-23.4397236,-23.4397236,-23.4397236,-23.5045434,-23.1996761,-23.516497,-23.1692949,-23.1893053,-23.9968234,-23.1506704,-23.9765819,-23.029075,-23.0935538,-23.1085718,-23.008205,-23.008205,-23.5419932,-22.8925231,-22.8985604,-23.2166646,-22.8481958,-22.8481958,-22.5709662,-22.9086762,-22.333694,-21.2256572,-21.2119833,-21.2119833,-22.9274502,-25.429149,-25.42339,-25.536314,-25.4381052,-25.4348889,-22.761785,-25.4430439,-25.4351398,-25.477753,-22.9976583,-22.9990216,-22.8778049,-22.814578,-22.814578,-22.9115509,-22.9044152,-22.9108627,-26.3034935,-20.8664455,-26.8636948,-27.2005951,-19.9625902,-27.5897538,-19.954683,-27.6633178,-19.632283,-19.632283,-29.9151684,-29.9911,-29.9900775,-16.1183523,-30.0297716,-30.0846697,-15.8697369,-15.8697369,-15.8697369,-15.8414099,-15.7961869,-15.791281,-13.0073567,-12.9817061],\"lng\":[-46.6508012,-46.6480931,-46.6543825,-46.6436174,-46.6438625,-46.6589521,-46.6526427,-46.6619304,-46.6511418,-46.6576357,-46.6371985,-46.6879693,-46.6891929,-46.6807842,-46.6918693,-46.5943652,-46.6485458,-46.6268084,-46.6183765,-46.6945653,-46.6664283,-46.7211188,-46.6992423,-46.6987281,-46.5766182,-46.7011737,-46.560424,-46.71854,-46.5795569,-46.7368627,-46.6765647,-46.7711861,-46.6985962,-46.5491937,-46.5049037,-46.5049037,-46.531976,-46.5335636,-46.4563422,-46.543195,-46.4943769,-46.4943769,-46.4943769,-46.8484465,-46.889651,-46.179363,-46.8917403,-46.9305805,-46.4090328,-46.9609439,-46.3101659,-46.748908,-46.9713498,-47.0084435,-47.1375685,-47.1375685,-47.4665576,-47.0274271,-47.0528094,-45.8920388,-47.0631872,-47.0631872,-47.4084298,-45.3164313,-49.056318,-47.8350124,-47.815878,-47.815878,-43.5748104,-49.2142792,-49.270162,-49.173249,-49.2665602,-49.2818261,-43.46548,-49.2908478,-49.3167883,-49.2909558,-43.3581268,-43.3511517,-43.2714867,-43.2435286,-43.2435286,-43.1758324,-43.1755798,-43.1682727,-48.8488585,-49.4144148,-49.0926064,-48.6149523,-44.1598636,-48.5152812,-44.017025,-48.5347161,-43.961765,-43.961765,-51.1647481,-51.174939,-51.1770782,-48.3991489,-51.2272536,-51.2458384,-47.9172348,-47.9172348,-47.9172348,-48.0439961,-47.891071,-47.883178,-38.5247216,-38.4646255],\"columnDefs\":[{\"className\":\"dt-right\",\"targets\":[1,4,5]},{\"orderable\":false,\"targets\":0},{\"name\":\" \",\"targets\":0},{\"name\":\"index\",\"targets\":1},{\"name\":\"name\",\"targets\":2},{\"name\":\"street\",\"targets\":3},{\"name\":\"lat\",\"targets\":4},{\"name\":\"lng\",\"targets\":5}],\"order\":[],\"autoWidth\":false,\"orderClasses\":false}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n\n\n\n## Map\n\nThe table above is already in a pretty satisfactory format. We can check the data by building a simple map.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(sf)\nlibrary(leaflet)\n\nstarbucks <- st_as_sf(clean_dat, coords = c(\"lng\", \"lat\"), crs = 4326, remove = FALSE)\n\nleaflet(starbucks) %>%\n  addTiles() %>%\n  addMarkers(label = ~name) %>%\n  addProviderTiles(\"CartoDB\") %>%\n  setView(lng = -46.65590, lat = -23.561197, zoom = 12)\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"leaflet html-widget html-fill-item\" id=\"htmlwidget-ad1935f6f3f01942b20d\" style=\"width:100%;height:464px;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-ad1935f6f3f01942b20d\">{\"x\":{\"options\":{\"crs\":{\"crsClass\":\"L.CRS.EPSG3857\",\"code\":null,\"proj4def\":null,\"projectedBounds\":null,\"options\":{}}},\"calls\":[{\"method\":\"addTiles\",\"args\":[\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\",null,null,{\"minZoom\":0,\"maxZoom\":18,\"tileSize\":256,\"subdomains\":\"abc\",\"errorTileUrl\":\"\",\"tms\":false,\"noWrap\":false,\"zoomOffset\":0,\"zoomReverse\":false,\"opacity\":1,\"zIndex\":1,\"detectRetina\":false,\"attribution\":\"&copy; <a href=\\\"https://openstreetmap.org/copyright/\\\">OpenStreetMap<\\/a>,  <a href=\\\"https://opendatacommons.org/licenses/odbl/\\\">ODbL<\\/a>\"}]},{\"method\":\"addMarkers\",\"args\":[[-23.5658059,-23.5678355,-23.5631043,-23.5704519,-23.5735072,-23.5578455,-23.554083,-23.5578647,-23.5462691,-23.5422471,-23.5990249,-23.5916617,-23.5949773,-23.5264048,-23.6037897,-23.5797475,-23.5075493,-23.6198179,-23.5155249,-23.6085754,-23.6291469,-23.5943227,-23.6210905,-23.6232391,-23.5417077,-23.622013,-23.5614014,-23.5065898,-23.6259357,-23.6318236,-23.6764565,-23.5357892,-23.6785695,-23.4881295,-23.5656417,-23.5656417,-23.648587,-23.6677966,-23.5380357,-23.7232218,-23.4397236,-23.4397236,-23.4397236,-23.5045434,-23.1996761,-23.516497,-23.1692949,-23.1893053,-23.9968234,-23.1506704,-23.9765819,-23.029075,-23.0935538,-23.1085718,-23.008205,-23.008205,-23.5419932,-22.8925231,-22.8985604,-23.2166646,-22.8481958,-22.8481958,-22.5709662,-22.9086762,-22.333694,-21.2256572,-21.2119833,-21.2119833,-22.9274502,-25.429149,-25.42339,-25.536314,-25.4381052,-25.4348889,-22.761785,-25.4430439,-25.4351398,-25.477753,-22.9976583,-22.9990216,-22.8778049,-22.814578,-22.814578,-22.9115509,-22.9044152,-22.9108627,-26.3034935,-20.8664455,-26.8636948,-27.2005951,-19.9625902,-27.5897538,-19.954683,-27.6633178,-19.632283,-19.632283,-29.9151684,-29.9911,-29.9900775,-16.1183523,-30.0297716,-30.0846697,-15.8697369,-15.8697369,-15.8697369,-15.8414099,-15.7961869,-15.791281,-13.0073567,-12.9817061],[-46.6508012,-46.6480931,-46.6543825,-46.6436174,-46.6438625,-46.6589521,-46.6526427,-46.6619304,-46.6511418,-46.6576357,-46.6371985,-46.6879693,-46.6891929,-46.6807842,-46.6918693,-46.5943652,-46.6485458,-46.6268084,-46.6183765,-46.6945653,-46.6664283,-46.7211188,-46.6992423,-46.6987281,-46.5766182,-46.7011737,-46.560424,-46.71854,-46.5795569,-46.7368627,-46.6765647,-46.7711861,-46.6985962,-46.5491937,-46.5049037,-46.5049037,-46.531976,-46.5335636,-46.4563422,-46.543195,-46.4943769,-46.4943769,-46.4943769,-46.8484465,-46.889651,-46.179363,-46.8917403,-46.9305805,-46.4090328,-46.9609439,-46.3101659,-46.748908,-46.9713498,-47.0084435,-47.1375685,-47.1375685,-47.4665576,-47.0274271,-47.0528094,-45.8920388,-47.0631872,-47.0631872,-47.4084298,-45.3164313,-49.056318,-47.8350124,-47.815878,-47.815878,-43.5748104,-49.2142792,-49.270162,-49.173249,-49.2665602,-49.2818261,-43.46548,-49.2908478,-49.3167883,-49.2909558,-43.3581268,-43.3511517,-43.2714867,-43.2435286,-43.2435286,-43.1758324,-43.1755798,-43.1682727,-48.8488585,-49.4144148,-49.0926064,-48.6149523,-44.1598636,-48.5152812,-44.017025,-48.5347161,-43.961765,-43.961765,-51.1647481,-51.174939,-51.1770782,-48.3991489,-51.2272536,-51.2458384,-47.9172348,-47.9172348,-47.9172348,-48.0439961,-47.891071,-47.883178,-38.5247216,-38.4646255],null,null,null,{\"interactive\":true,\"draggable\":false,\"keyboard\":true,\"title\":\"\",\"alt\":\"\",\"zIndexOffset\":0,\"opacity\":1,\"riseOnHover\":false,\"riseOffset\":250},null,null,null,null,[\"Shopping Top Center\",\"Paulista 500\",\"Shopping Cidade São Paulo\",\"Shopping Patio Paulista\",\"Eliseu Guilherme\",\"Shopping Center 3\",\"Shopping Frei Caneca\",\"Haddock Lobo\",\"Mackenzie\",\"Shopping Higienopolis\",\"Shopping Metrô Santa Cruz\",\"SP Corporate Towers\",\"Gomes de Carvalho\",\"Bourbon Shopping\",\"Berrini\",\"Shopping Mooca\",\"Bráz Leme\",\"Shopping Plaza Sul\",\"Shopping Center Norte - Portaria\",\"Vivo Eco Berrini\",\"Aeroporto de Congonhas\",\"João Saad\",\"Shopping Market Place\",\"Shopping Morumbi Térreo\",\"Shopping Metrô Tatuapé\",\"Rochaverá Corporate Towers\",\"Shopping Anália Franco\",\"Tiete Plaza Shopping\",\"Shopping São Caetano\",\"Shopping Morumbi Town\",\"Shopping Interlagos\",\"Super Shopping Osasco\",\"Shopping SP Market\",\"Shopping Internacional de Guarulhos\",\"Shopping Aricanduva\",\"Shopping Aricanduva Quiosque\",\"Grand Plaza Shopping\",\"Shopping ABC\",\"Shopping Metro Itaquera\",\"Shopping São Bernardo Plaza\",\"Aeroporto GRU - Terminal 2 Nacional – Praça de Alimentação / Área Pública - ASA E\",\"Aeroporto GRU - Terminal 2 Internacional Embarque Área Restrita - Portão 268\",\"Aeroporto GRU -   Terminal 3 Internacional Área Restrita - Portão 306\",\"Iguatemi Alphaville\",\"Jundiaí Shopping\",\"Mogi Shopping\",\"Maxi Shopping Jundiaí\",\"Lago Azul km 58 (Sentido Interior)\",\"Litoral Plaza Shopping\",\"Lago Azul km 64\",\"Praia Mar Shopping\",\"Morro Azul\",\"Lago Azul Km 72 (Rodovia Anhanguera)\",\"Outlet Premium Itupeva\",\"Aeroporto Viracopos - Desembarque\",\"Aeroporto Viracopos - Embarque\",\"Iguatemi Esplanada Sorocaba\",\"Iguatemi Campinas\",\"Cambuí\",\"Shopping Vale Sul\",\"Dom Pedro Flores\",\"Dom Pedro Shopping Livraria\",\"Pátio Limeira\",\"Roseira Posto Arco-Íris\",\"Bauru Shopping\",\"Iguatemi Ribeirão\",\"Ribeirão Shopping - Quiosque\",\"Ribeirão Shopping - Loja\",\"ParkShopping Campo Grande\",\"Shopping Jockey Plaza\",\"Shopping Mueller - Curitiba\",\"Aeroporto de Curitiba – Airside\",\"Estação Curitiba\",\"Spot Compact Mall Batel\",\"Shopping Nova Iguaçu\",\"Pátio Batel\",\"Park Shopping Barigui\",\"Shopping Palladium\",\"Barra Shopping\",\"Shopping Village Mall\",\"Shopping Nova América\",\"Aeroporto Galeão - Mezanino Área Pública 1° Piso - Terminal 2\",\"Aeroporto Galeão - T2 Doméstico Embarque Restrito Portão 34\",\"Cinelândia\",\"Assembleia do Carmo\",\"Aeroporto Santos Dumont\",\"Shopping Mueller Joinville\",\"Shopping Iguatemi São José do Rio Preto\",\"Norte Shopping Blumenau\",\"Porto Belo Outlet\",\"Partage Betim Shopping\",\"Villa Romana Shopping\",\"Itaú Power\",\"Aeroporto de Florianópolis -  Boulevard\",\"Área restrita, sala de embarque - BH Aeroporto\",\"Piso 1, Check in - BH Aeroporto\",\"ParkShopping Canoas\",\"POA Airport Desembarque- área externa 1° piso\",\"POA Airport Embarque Restrito - próximo ao Portão 115\",\"Outlet Premium Brasilia\",\"Galeria Chaves\",\"Barra Shopping Sul\",\"Aeroporto Brasília  - Embarque 1° piso\",\"Aeroporto Brasília  -  Desembarque Térreo\",\"Aeroporto de Brasília - Portão 10 (Pier Norte)\",\"Taguatinga Shopping\",\"Shopping Venâncio\",\"Conjunto Nacional\",\"Shopping Barra\",\"Shopping da Bahia\"],{\"interactive\":false,\"permanent\":false,\"direction\":\"auto\",\"opacity\":1,\"offset\":[0,0],\"textsize\":\"10px\",\"textOnly\":false,\"className\":\"\",\"sticky\":true},null]},{\"method\":\"addProviderTiles\",\"args\":[\"CartoDB\",null,null,{\"errorTileUrl\":\"\",\"noWrap\":false,\"detectRetina\":false}]}],\"limits\":{\"lat\":[-30.0846697,-12.9817061],\"lng\":[-51.2458384,-38.4646255]},\"setView\":[[-23.561197,-46.6559],12,[]]},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n\n\n\nIt's worth noting that data extracted via web scraping almost always contains some noise. In this case, the data seems relatively clean after a bit of processing. The addresses are not always very informative, like in the case of \"Rodovia Hélio Smidt, S/N,\" but this happens because many stores are located inside hospitals, shopping malls, or airports.\n\nWith this data, we can already perform interesting analyses. For example, we can find out that there are five Starbucks stores just on Avenida Paulista.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstarbucks %>%\n  filter(str_detect(street, \"Avenida Paulista\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSimple feature collection with 4 features and 5 fields\nGeometry type: POINT\nDimension:     XY\nBounding box:  xmin: -46.65895 ymin: -23.56784 xmax: -46.64809 ymax: -23.55785\nGeodetic CRS:  WGS 84\n# A tibble: 4 × 6\n  index name                      street                   lat   lng\n* <dbl> <chr>                     <chr>                  <dbl> <dbl>\n1     0 Shopping Top Center       Avenida Paulista, 854  -23.6 -46.7\n2     1 Paulista 500              Avenida Paulista, 500  -23.6 -46.6\n3     2 Shopping Cidade São Paulo Avenida Paulista, 1154 -23.6 -46.7\n4     5 Shopping Center 3         Avenida Paulista, 2064 -23.6 -46.7\n               geometry\n*           <POINT [°]>\n1  (-46.6508 -23.56581)\n2 (-46.64809 -23.56784)\n3  (-46.65438 -23.5631)\n4 (-46.65895 -23.55785)\n```\n\n\n:::\n:::\n\n\n\nWe can also count the number of stores in each airport. Apparently, there are eight stores at Guarulhos Airport, which seems like quite a high number to me.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstarbucks %>%\n  st_drop_geometry() %>%\n  filter(str_detect(name, \"Aeroporto\")) %>%\n  mutate(\n    name_airport = str_remove(name, \"de \"),\n    name_airport = str_extract(name_airport, \"(?<=Aeroporto )\\\\w+\"),\n    name_airport = if_else(is.na(name_airport), \"Confins\", name_airport),\n    .before = \"name\"\n  ) %>%\n  count(name_airport, sort = TRUE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 9 × 2\n  name_airport      n\n  <chr>         <int>\n1 Brasília          3\n2 GRU               3\n3 Confins           2\n4 Galeão            2\n5 Viracopos         2\n6 Congonhas         1\n7 Curitiba          1\n8 Florianópolis     1\n9 Santos            1\n```\n\n\n:::\n:::\n\n\n\nFinally, we can note that many Starbucks stores are located inside shopping malls. A simple calculation shows that around 75 stores are located inside malls, close to 50% of the total units[^2].\n\n[^2]: Here, we are assuming that the \"name\" tag always includes the word \"shopping\" if the store is located inside a mall. This number might eventually be underestimated if there are stores inside malls that don't have the word \"shopping\" in their name. Strictly speaking, we also haven't verified whether the \"shopping\" tag is always associated with an active shopping mall.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstarbucks %>%\n  st_drop_geometry() %>%\n  filter(str_detect(name, \"Shopping|shopping\")) %>%\n  nrow()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 58\n```\n\n\n:::\n:::\n\n\n\n# Building\n\n## Finding each city\n\nFrom this data, we can add more information. Using the `geobr` package, we can identify in which cities the stores are located.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndim_city <- geobr::read_municipality(showProgress = FALSE)\ndim_city <- st_transform(dim_city, crs = 4326)\nsf::sf_use_s2(FALSE)\n\nstarbucks <- starbucks %>%\n  st_join(dim_city) %>%\n  relocate(c(name_muni, abbrev_state), .before = lat)\n```\n:::\n\n\n\nNow we can see which cities have the most Starbucks locations. São Paulo alone has more the 40 units.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstarbucks %>%\n  st_drop_geometry() %>%\n  count(name_muni, abbrev_state, sort = TRUE) \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 38 × 3\n   name_muni      abbrev_state     n\n   <chr>          <chr>        <int>\n 1 São Paulo      SP              34\n 2 Rio De Janeiro RJ               9\n 3 Curitiba       PR               7\n 4 Brasília       DF               6\n 5 Campinas       SP               6\n 6 Guarulhos      SP               4\n 7 Jundiaí        SP               4\n 8 Porto Alegre   RS               4\n 9 Ribeirão Preto SP               3\n10 Confins        MG               2\n# ℹ 28 more rows\n```\n\n\n:::\n:::\n\n\n\n## Google Places\n\n### Adding information using Google Places API\n\nThe Google [Places API](https://developers.google.com/maps/documentation/places/web-service/overview) allows access to data from Google Maps. The `googleway` package integrates this data into `R` already in tidy format.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(googleway)\n```\n:::\n\n\n\nI'll create a simple search to return all Starbucks locations in Brazil. A full search across the entire country would take too long, so I will use the coordinates I found via web scraping as a starting point.\n\nThe function below searches for the term \"starbucks\" at all the points I provide. To simplify, the function returns only a few of the columns.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Function to grab starbucks info\nget_starbucks_info <- function(lat, lng) {\n  \n  # Search for 'Starbucks' using the provided latitude and longitude.\n  places = google_places(\n    search_string = \"starbucks\",   # Search term \"starbucks\"\n    location = c(lat, lng)         # Coordinates (lat and lng) for the search\n  )\n  \n  # Define the columns of interest to keep from the results\n  sel_cols = c(\n    \"name\",                        # Store name\n    \"formatted_address\",           # Store address\n    \"lat\",                         # Latitude\n    \"lng\",                         # Longitude\n    \"rating\",                      # Store rating\n    \"user_ratings_total\",          # Number of user ratings\n    \"business_status\"              # Business status (e.g., operational or closed)\n  )\n  \n  # Process the results and select the relevant columns\n  places$results %>%\n    tidyr::unnest(\"geometry\") %>%   # Extract the nested 'geometry' field\n    tidyr::unnest(\"location\") %>%   # Extract the nested 'location' field (lat and lng)\n    dplyr::select(dplyr::all_of(sel_cols))   # Select only the columns of interest\n}\n```\n:::\n\n\n\nThe code below uses `purrr` to iterate the `get_starbucks_info` function over the lat/lng pairs.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Remove geometry and keep only coordinates\ncoords_starbucks <- starbucks %>%\n  st_drop_geometry() %>%\n  as_tibble() %>%\n  select(index, name, lat, lng)\n\nstarbucks_info <- purrr::map2(\n  coords_starbucks$lat,\n  coords_starbucks$lng,\n  get_starbucks_info\n  )\n\ndat <- starbucks_info %>%\n  bind_rows(.id = \"search_id\") %>%\n  distinct()\n```\n:::\n\n\n\n\n\nTo clean the data, I will keep only the active stores that contain \"Starbucks\" in their name. Additionally, I will pair the data with my web scraping dataset using `st_nearest_feature(x, y)`. This function finds the nearest point in `y` for each point in `x`.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat <- dat |> \n  # Keep only stores with \"Starbucks\" in the name and that are operational\n  filter(str_detect(name, \"Starbucks\"), business_status == \"OPERATIONAL\") |> \n  # Arrange the results by address\n  arrange(formatted_address)\n\n# Convert to a spatial data frame using longitude and latitude\ngoogle_data <- dat %>%\n  # Set coordinate reference system to WGS 84 (EPSG:4326)\n  st_as_sf(coords = c(\"lng\", \"lat\"), crs = 4326)  \n\n# Find the nearest Starbucks locations from the web scraping data (starbucks)\n# for each point in google_data\ninds <- st_nearest_feature(google_data, starbucks)\n\n# Extract the metadata of the nearest points from the web scraping data and\n# convert to a tibble\nmetadata <- starbucks %>%\n  slice(inds) %>%\n  st_drop_geometry() %>%  # Remove spatial geometry\n  as_tibble()\n\n# Rename the columns in google_data and bind the metadata from the web scraping data\ngoogle_data <- google_data |> \n  rename(google_name = name, google_address = formatted_address) |> \n  bind_cols(metadata)  # Combine google_data with the corresponding metadata\n```\n:::\n\n\n\n### Final Map\n\nThe interactive map below shows **all Starbucks locations in São Paulo**. The color of each circle represents its rating, and the size of the circle represents the number of reviews.\n\nThe units along the Avenida Paulista corridor, for example, have high average ratings and a large number of reviews. One of the worst-rated units seems to be the one near Mackenzie University, which has a rating of 2.1 and 15 reviews. In the Eastern Zone, the store at Shopping Aricanduva also has a slightly lower rating, 3.9 with 158 reviews.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsp <- filter(google_data, name_muni == \"São Paulo\")\n\nsp <- sp |> \n  mutate(\n    rad = findInterval(user_ratings_total, c(25, 100, 1000, 2500, 5000)) * 2 + 5\n  )\n\npal <- colorNumeric(\"RdBu\", domain = sp$rating)\n\nlabels <- stringr::str_glue(\n  \"<b> {sp$name} </b> <br>\n   <b> Rating </b>: {sp$rating} <br>\n   <b> No Ratings </b> {sp$user_ratings_total}\"\n)\n\nlabels <- lapply(labels, htmltools::HTML)\n\nleaflet(sp) |> \n  addTiles() |> \n  addCircleMarkers(\n    radius = ~rad,\n    color = ~pal(rating),\n    label = labels,\n    stroke = FALSE,\n    fillOpacity = 0.5\n  ) |> \n  addLegend(pal = pal, values = ~rating) |> \n  addProviderTiles(\"CartoDB\")\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"leaflet html-widget html-fill-item\" id=\"htmlwidget-25f1e4580dc4bddd735f\" style=\"width:100%;height:464px;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-25f1e4580dc4bddd735f\">{\"x\":{\"options\":{\"crs\":{\"crsClass\":\"L.CRS.EPSG3857\",\"code\":null,\"proj4def\":null,\"projectedBounds\":null,\"options\":{}}},\"calls\":[{\"method\":\"addTiles\",\"args\":[\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\",null,null,{\"minZoom\":0,\"maxZoom\":18,\"tileSize\":256,\"subdomains\":\"abc\",\"errorTileUrl\":\"\",\"tms\":false,\"noWrap\":false,\"zoomOffset\":0,\"zoomReverse\":false,\"opacity\":1,\"zIndex\":1,\"detectRetina\":false,\"attribution\":\"&copy; <a href=\\\"https://openstreetmap.org/copyright/\\\">OpenStreetMap<\\/a>,  <a href=\\\"https://opendatacommons.org/licenses/odbl/\\\">ODbL<\\/a>\"}]},{\"method\":\"addCircleMarkers\",\"args\":[[-23.6258312,-23.6025987,-23.540494,-23.6001382,-23.5660792,-23.5077543,-23.6216876,-23.6037146,-23.6751922,-23.5939569,-23.6012749,-23.5623595,-23.557771,-23.5678371,-23.5921852,-23.5916352,-23.5067423,-23.5728474,-23.6231169,-23.5543597,-23.6796183,-23.5656276,-23.5615563,-23.5509155,-23.6085786,-23.6198309,-23.5733703,-23.5467961,-23.5267749,-23.6230715,-23.5804758,-23.5416758,-23.557903,-23.5668433,-23.5703331,-23.5996307,-23.5992279,-23.5641014,-23.554083,-23.6316949,-23.5426355,-23.5712699,-23.5150714],[-46.6609747,-46.6646925,-46.47097309999999,-46.7153149,-46.5054573,-46.648915,-46.699464,-46.6920752,-46.6771407,-46.72114819999999,-46.6980412,-46.6557082,-46.6588089,-46.6480323,-46.6882035,-46.6903479,-46.7177166,-46.6963698,-46.6986074,-46.6352104,-46.69973969999999,-46.6507967,-46.5598033,-46.7217457,-46.6945597,-46.6270094,-46.6439404,-46.65201380000001,-46.6803088,-46.7012391,-46.5941586,-46.5768715,-46.6618712,-46.6418146,-46.6611372,-46.7151228,-46.63721839999999,-46.652803,-46.6526427,-46.73697060000001,-46.6577249,-46.6436347,-46.6186055],[11,11,7,5,9,9,11,13,9,13,5,15,15,15,9,11,11,15,13,9,9,11,13,11,7,11,13,5,13,9,11,13,15,9,7,9,13,7,11,9,11,9,13],null,null,{\"interactive\":true,\"className\":\"\",\"stroke\":false,\"color\":[\"#75B0D3\",\"#347BB7\",\"#D4E6F1\",\"#053061\",\"#A8D0E4\",\"#75B0D3\",\"#266BAF\",\"#266BAF\",\"#579EC9\",\"#347BB7\",\"#F8B799\",\"#266BAF\",\"#347BB7\",\"#347BB7\",\"#75B0D3\",\"#266BAF\",\"#266BAF\",\"#266BAF\",\"#266BAF\",\"#266BAF\",\"#3F8CC0\",\"#347BB7\",\"#347BB7\",\"#347BB7\",\"#266BAF\",\"#347BB7\",\"#347BB7\",\"#67001F\",\"#347BB7\",\"#3F8CC0\",\"#347BB7\",\"#266BAF\",\"#266BAF\",\"#579EC9\",\"#75B0D3\",\"#3F8CC0\",\"#266BAF\",\"#75B0D3\",\"#347BB7\",\"#75B0D3\",\"#347BB7\",\"#3F8CC0\",\"#266BAF\"],\"weight\":5,\"opacity\":0.5,\"fill\":true,\"fillColor\":[\"#75B0D3\",\"#347BB7\",\"#D4E6F1\",\"#053061\",\"#A8D0E4\",\"#75B0D3\",\"#266BAF\",\"#266BAF\",\"#579EC9\",\"#347BB7\",\"#F8B799\",\"#266BAF\",\"#347BB7\",\"#347BB7\",\"#75B0D3\",\"#266BAF\",\"#266BAF\",\"#266BAF\",\"#266BAF\",\"#266BAF\",\"#3F8CC0\",\"#347BB7\",\"#347BB7\",\"#347BB7\",\"#266BAF\",\"#347BB7\",\"#347BB7\",\"#67001F\",\"#347BB7\",\"#3F8CC0\",\"#347BB7\",\"#266BAF\",\"#266BAF\",\"#579EC9\",\"#75B0D3\",\"#3F8CC0\",\"#266BAF\",\"#75B0D3\",\"#347BB7\",\"#75B0D3\",\"#347BB7\",\"#3F8CC0\",\"#266BAF\"],\"fillOpacity\":0.5},null,null,null,null,[\"<b> Aeroporto de Congonhas <\\/b> <br>\\n<b> Rating <\\/b>: 4.1 <br>\\n<b> No Ratings <\\/b> 1250\",\"<b> Gomes de Carvalho <\\/b> <br>\\n<b> Rating <\\/b>: 4.4 <br>\\n<b> No Ratings <\\/b> 2147\",\"<b> Shopping Metro Itaquera <\\/b> <br>\\n<b> Rating <\\/b>: 3.7 <br>\\n<b> No Ratings <\\/b> 91\",\"<b> João Saad <\\/b> <br>\\n<b> Rating <\\/b>: 4.8 <br>\\n<b> No Ratings <\\/b> 6\",\"<b> Shopping Aricanduva <\\/b> <br>\\n<b> Rating <\\/b>: 3.9 <br>\\n<b> No Ratings <\\/b> 158\",\"<b> Bráz Leme <\\/b> <br>\\n<b> Rating <\\/b>: 4.1 <br>\\n<b> No Ratings <\\/b> 551\",\"<b> Shopping Market Place <\\/b> <br>\\n<b> Rating <\\/b>: 4.5 <br>\\n<b> No Ratings <\\/b> 1850\",\"<b> Berrini <\\/b> <br>\\n<b> Rating <\\/b>: 4.5 <br>\\n<b> No Ratings <\\/b> 4206\",\"<b> Shopping Interlagos <\\/b> <br>\\n<b> Rating <\\/b>: 4.2 <br>\\n<b> No Ratings <\\/b> 197\",\"<b> João Saad <\\/b> <br>\\n<b> Rating <\\/b>: 4.4 <br>\\n<b> No Ratings <\\/b> 3109\",\"<b> Berrini <\\/b> <br>\\n<b> Rating <\\/b>: 3 <br>\\n<b> No Ratings <\\/b> 11\",\"<b> Shopping Cidade São Paulo <\\/b> <br>\\n<b> Rating <\\/b>: 4.5 <br>\\n<b> No Ratings <\\/b> 6118\",\"<b> Shopping Center 3 <\\/b> <br>\\n<b> Rating <\\/b>: 4.4 <br>\\n<b> No Ratings <\\/b> 8807\",\"<b> Paulista 500 <\\/b> <br>\\n<b> Rating <\\/b>: 4.4 <br>\\n<b> No Ratings <\\/b> 5672\",\"<b> SP Corporate Towers <\\/b> <br>\\n<b> Rating <\\/b>: 4.1 <br>\\n<b> No Ratings <\\/b> 118\",\"<b> SP Corporate Towers <\\/b> <br>\\n<b> Rating <\\/b>: 4.5 <br>\\n<b> No Ratings <\\/b> 2018\",\"<b> Tiete Plaza Shopping <\\/b> <br>\\n<b> Rating <\\/b>: 4.5 <br>\\n<b> No Ratings <\\/b> 2369\",\"<b> SP Corporate Towers <\\/b> <br>\\n<b> Rating <\\/b>: 4.5 <br>\\n<b> No Ratings <\\/b> 5396\",\"<b> Shopping Morumbi Térreo <\\/b> <br>\\n<b> Rating <\\/b>: 4.5 <br>\\n<b> No Ratings <\\/b> 4974\",\"<b> Shopping Frei Caneca <\\/b> <br>\\n<b> Rating <\\/b>: 4.5 <br>\\n<b> No Ratings <\\/b> 916\",\"<b> Shopping SP Market <\\/b> <br>\\n<b> Rating <\\/b>: 4.3 <br>\\n<b> No Ratings <\\/b> 409\",\"<b> Shopping Top Center <\\/b> <br>\\n<b> Rating <\\/b>: 4.4 <br>\\n<b> No Ratings <\\/b> 1433\",\"<b> Shopping Anália Franco <\\/b> <br>\\n<b> Rating <\\/b>: 4.4 <br>\\n<b> No Ratings <\\/b> 3460\",\"<b> João Saad <\\/b> <br>\\n<b> Rating <\\/b>: 4.4 <br>\\n<b> No Ratings <\\/b> 1033\",\"<b> Vivo Eco Berrini <\\/b> <br>\\n<b> Rating <\\/b>: 4.5 <br>\\n<b> No Ratings <\\/b> 31\",\"<b> Shopping Plaza Sul <\\/b> <br>\\n<b> Rating <\\/b>: 4.4 <br>\\n<b> No Ratings <\\/b> 1656\",\"<b> Eliseu Guilherme <\\/b> <br>\\n<b> Rating <\\/b>: 4.4 <br>\\n<b> No Ratings <\\/b> 3127\",\"<b> Mackenzie <\\/b> <br>\\n<b> Rating <\\/b>: 2.1 <br>\\n<b> No Ratings <\\/b> 15\",\"<b> Bourbon Shopping <\\/b> <br>\\n<b> Rating <\\/b>: 4.4 <br>\\n<b> No Ratings <\\/b> 2878\",\"<b> Rochaverá Corporate Towers <\\/b> <br>\\n<b> Rating <\\/b>: 4.3 <br>\\n<b> No Ratings <\\/b> 905\",\"<b> Shopping Mooca <\\/b> <br>\\n<b> Rating <\\/b>: 4.4 <br>\\n<b> No Ratings <\\/b> 1940\",\"<b> Shopping Metrô Tatuapé <\\/b> <br>\\n<b> Rating <\\/b>: 4.5 <br>\\n<b> No Ratings <\\/b> 3435\",\"<b> Haddock Lobo <\\/b> <br>\\n<b> Rating <\\/b>: 4.5 <br>\\n<b> No Ratings <\\/b> 6593\",\"<b> Shopping Patio Paulista <\\/b> <br>\\n<b> Rating <\\/b>: 4.2 <br>\\n<b> No Ratings <\\/b> 285\",\"<b> Shopping Cidade São Paulo <\\/b> <br>\\n<b> Rating <\\/b>: 4.1 <br>\\n<b> No Ratings <\\/b> 85\",\"<b> João Saad <\\/b> <br>\\n<b> Rating <\\/b>: 4.3 <br>\\n<b> No Ratings <\\/b> 112\",\"<b> Shopping Metrô Santa Cruz <\\/b> <br>\\n<b> Rating <\\/b>: 4.5 <br>\\n<b> No Ratings <\\/b> 3830\",\"<b> Shopping Cidade São Paulo <\\/b> <br>\\n<b> Rating <\\/b>: 4.1 <br>\\n<b> No Ratings <\\/b> 36\",\"<b> Shopping Frei Caneca <\\/b> <br>\\n<b> Rating <\\/b>: 4.4 <br>\\n<b> No Ratings <\\/b> 1901\",\"<b> Shopping Morumbi Town <\\/b> <br>\\n<b> Rating <\\/b>: 4.1 <br>\\n<b> No Ratings <\\/b> 327\",\"<b> Shopping Higienopolis <\\/b> <br>\\n<b> Rating <\\/b>: 4.4 <br>\\n<b> No Ratings <\\/b> 1621\",\"<b> Shopping Patio Paulista <\\/b> <br>\\n<b> Rating <\\/b>: 4.3 <br>\\n<b> No Ratings <\\/b> 895\",\"<b> Shopping Center Norte - Portaria <\\/b> <br>\\n<b> Rating <\\/b>: 4.5 <br>\\n<b> No Ratings <\\/b> 4103\"],{\"interactive\":false,\"permanent\":false,\"direction\":\"auto\",\"opacity\":1,\"offset\":[0,0],\"textsize\":\"10px\",\"textOnly\":false,\"className\":\"\",\"sticky\":true},null]},{\"method\":\"addLegend\",\"args\":[{\"colors\":[\"#67001F , #C4403B 14.8148148148148%, #F8B799 33.3333333333333%, #F0F4F6 51.8518518518518%, #8FC3DD 70.3703703703704%, #266BAF 88.8888888888889%, #053061 \"],\"labels\":[\"2.5\",\"3.0\",\"3.5\",\"4.0\",\"4.5\"],\"na_color\":null,\"na_label\":\"NA\",\"opacity\":0.5,\"position\":\"topright\",\"type\":\"numeric\",\"title\":\"rating\",\"extra\":{\"p_1\":0.1481481481481481,\"p_n\":0.888888888888889},\"layerId\":null,\"className\":\"info legend\",\"group\":null}]},{\"method\":\"addProviderTiles\",\"args\":[\"CartoDB\",null,null,{\"errorTileUrl\":\"\",\"noWrap\":false,\"detectRetina\":false}]}],\"limits\":{\"lat\":[-23.6796183,-23.5067423],\"lng\":[-46.73697060000001,-46.47097309999999]}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n\n\n\n# Conclusion\n\nWeb scraping is a popular data extraction technique that allows us to quickly **build interesting datasets that aren't readily available**. It's particularly useful in market studies.\n\nAfter gathering the addresses of all stores, we are able to **produce maps and visualize the spatial distribution of Starbucks' stores**. We can also enrich this data collecting more information from other sources such as the Google Maps API.\n\nWeb scraping can be very challenging, but in this case it was fairly simple.\n\n## Related posts\n\n-   [Finding coffee shop in Brazil](https://restateinsight.com/posts/general-posts/2024-07-finding-coffee-shops/)\n\n-   [Finding all The Coffee shops in Brazil](https://restateinsight.com/posts/general-posts/2024-06-finding-the-coffee/)\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../../site_libs/htmltools-fill-0.5.8.1/fill.css\" rel=\"stylesheet\" />\n<script src=\"../../../site_libs/htmlwidgets-1.6.4/htmlwidgets.js\"></script>\n<link href=\"../../../site_libs/datatables-css-0.0.0/datatables-crosstalk.css\" rel=\"stylesheet\" />\n<script src=\"../../../site_libs/datatables-binding-0.32/datatables.js\"></script>\n<script src=\"../../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js\"></script>\n<link href=\"../../../site_libs/dt-core-1.13.6/css/jquery.dataTables.min.css\" rel=\"stylesheet\" />\n<link href=\"../../../site_libs/dt-core-1.13.6/css/jquery.dataTables.extra.css\" rel=\"stylesheet\" />\n<script src=\"../../../site_libs/dt-core-1.13.6/js/jquery.dataTables.min.js\"></script>\n<link href=\"../../../site_libs/crosstalk-1.2.1/css/crosstalk.min.css\" rel=\"stylesheet\" />\n<script src=\"../../../site_libs/crosstalk-1.2.1/js/crosstalk.min.js\"></script>\n<link href=\"../../../site_libs/leaflet-1.3.1/leaflet.css\" rel=\"stylesheet\" />\n<script src=\"../../../site_libs/leaflet-1.3.1/leaflet.js\"></script>\n<link href=\"../../../site_libs/leafletfix-1.0.0/leafletfix.css\" rel=\"stylesheet\" />\n<script src=\"../../../site_libs/proj4-2.6.2/proj4.min.js\"></script>\n<script src=\"../../../site_libs/Proj4Leaflet-1.0.1/proj4leaflet.js\"></script>\n<link href=\"../../../site_libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css\" rel=\"stylesheet\" />\n<script src=\"../../../site_libs/leaflet-binding-2.2.2/leaflet.js\"></script>\n<script src=\"../../../site_libs/leaflet-providers-2.0.0/leaflet-providers_2.0.0.js\"></script>\n<script src=\"../../../site_libs/leaflet-providers-plugin-2.2.2/leaflet-providers-plugin.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}