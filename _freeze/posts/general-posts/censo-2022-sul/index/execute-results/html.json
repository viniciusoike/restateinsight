{
  "hash": "86d10a720ceddc14297f7fd5c573d8b0",
  "result": {
    "markdown": "---\ntitle: 'Censo 2022 e a Regi√£o Sul'\ndate: '2023-07-03'\ncategories: ['data-visualization', 'ggplot2', 'tutorial-R']\ndraft: true\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nknitr::opts_chunk$set(eval = FALSE)\n\nlibrary(sidrar)\nlibrary(dplyr)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'dplyr'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following objects are masked from 'package:stats':\n\n    filter, lag\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, setequal, union\n```\n:::\n\n```{.r .cell-code}\nlibrary(tidyr)\nlibrary(ggplot2)\nlibrary(geobr)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required namespace: sf\n```\n:::\n\n```{.r .cell-code}\nlibrary(sf)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nLinking to GEOS 3.11.0, GDAL 3.5.3, PROJ 9.1.0; sf_use_s2() is TRUE\n```\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npop2022 <- get_sidra(4709, geo = \"City\")\n\n\n\ninfo_sidra(4709)\n4712\n\n136\n4709\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncensus_pop <- get_sidra(\n  136,\n  period = \"1991-2010\",\n  variable = 93,\n  geo = \"City\",\n  classific = \"c86\",\n  category = list(0)\n  )\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncensus_pop <- census_pop %>%\n  janitor::clean_names() %>%\n  select(code_muni = municipio_codigo, year = ano, pop = valor) %>%\n  mutate(code_muni = as.numeric(code_muni)) %>%\n  group_by(code_muni) %>%\n  mutate(chg_abs = pop - lag(pop), chg = pop / lag(pop) - 1) %>%\n  ungroup()\n\nsouth <- census_pop %>%\n  mutate(code_region = as.numeric(substr(code_muni, 1, 1))) %>%\n  filter(code_region == 4)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsouth_cities <- south %>%\n  left_join(dim_city, by = c(\"code_muni\", \"code_region\")) %>%\n  filter(pop > 50000)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntbl_south <- south %>%\n  pivot_wider(\n    id_cols = \"code_muni\",\n    names_from = \"year\",\n    values_from = c(\"pop\", \"chg\")\n  )\n\npop_cities <- cities20 %>%\n  filter(code_region == 4) %>%\n  left_join(tbl_south, by = \"code_muni\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(pop_cities, aes(x = log(pop_2010), y = chg_2010)) +\n  geom_point(alpha = 0.5, aes(color = as.factor(abbrev_state)))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\npop_cities %>%\n  mutate(\n    group = ntile()\n  )\n\n\nggplot(pop_cities) +\n  geom_sf(aes(fill = chg_2010), size = 0.1) +\n  theme_void()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntop_cities <- tbl_south %>%\n  left_join(dim_city) %>%\n  group_by(code_state) %>%\n  slice_max(pop_2000, n = 10) %>%\n  ungroup() %>%\n  mutate(name_muni = factor(name_muni), name_muni = forcats::fct_reorder(name_muni, pop_2000))\n  \n\ntop_cities %>%\n  select(name_muni, abbrev_state, pop_1991:pop_2010) %>%\n  pivot_longer(pop_1991:pop_2010, names_sep = \"_\", names_to = c(\"var\", \"year\")) %>%\n  ggplot(aes(x = name_muni, y = value / 1000, fill = as.factor(year))) +\n  geom_col(position = position_dodge()) +\n  facet_wrap(vars(abbrev_state), scales = \"free\") +\n  scale_x_discrete(labels = \\(x) stringr::str_wrap(x, width = 8)) +\n  scale_y_continuous(labels = scales::label_number(big.mark = \".\")) +\n  scale_fill_manual(\n    name = \"Ano\",\n    values = rev(c(\"#0FA3B1\", \"#8CD3E8\", \"#B5E2FA\"))\n  ) +\n  coord_flip() +\n  labs(\n    x = NULL,\n    y = \"Populacao (1000)\"\n  ) +\n  theme_light() +\n  theme(\n    legend.background = element_rect(fill = \"#F9F7F3\", color = NA),\n    panel.background = element_rect(fill = \"#F9F7F3\", color = NA),\n    plot.background = element_rect(fill = \"#F9F7F3\", color = NA),\n    panel.grid.minor = element_blank(),\n    panel.grid.major.y = element_blank(),\n    legend.position = \"top\",\n    axis.text.y = element_text(hjust = 0.5)\n  )\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}