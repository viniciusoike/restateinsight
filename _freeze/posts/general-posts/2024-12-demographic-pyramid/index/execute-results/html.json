{
  "hash": "28ccbcef8102ac9950ef37afdb315588",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Demographic Pyramids in R\"\ndate: \"2024-12-29\"\ncategories: ['ggplot2', 'data-visualization', 'english', 'tutorial-R', 'demographics']\ndescription: \"Demographic pyramids are widely used in demographic analysis to visualize the structure of a population, providing valuable insights into trends like population growth, aging, and gender distribution. In this tutorial, we will demonstrate how to create demographic pyramids using R, leveraging the WPP 2024 dataset to analyze population structures in countries like Pakistan, Brazil, Japan, and Ireland.\"\nimage: \"/static/images/thumbnails/ggplot2_demographic_pyramid.png\"\nimage-alt: \"/static/images/thumbnails/ggplot2_demographic_pyramid.png\"\nexecute:\n  warning: false\n  message: false\n---\n\n\n\n\n\n\n# Demographic Pyramids\n\nA **demographic pyramid** is a graphical representation of the age and gender distribution of a population. It typically shows the population in horizontal bars, with males represented on the left and females on the right. Each bar represents a specific age group, and the length of the bar indicates the number of people in that group.\n\nDemographic pyramids are widely used in demographic analysis to visualize the structure of a population, providing valuable insights into trends like population growth, aging, and gender distribution.\n\nThese pyramids are crucial for understanding the socio-economic dynamics of a country, as they highlight the proportions of young versus older populations and reveal patterns related to fertility rates, life expectancy, and migration.\n\nBy analyzing demographic pyramids, policymakers, businesses, and researchers can make informed decisions related to healthcare, education, and workforce planning.\n\nIn this tutorial, we will demonstrate how to create demographic pyramids using R, leveraging the United Nations World Population Prospects (WPP) 2024 dataset to analyze population structures in countries like Pakistan, Brazil, Japan, and Ireland. The data is available through their [package on GitHub](https://github.com/PPgp/wpp2024).\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# Load the necessary packages\nlibrary(ggplot2)\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(stringr)\nlibrary(wpp2024)\nlibrary(showtext)\nlibrary(patchwork)\n\n# Optional for better plotting\nfont_add_google(\"Open Sans\", \"Open Sans\")\nshowtext_auto()\n\n# to install wpp2024\n# remotes::install_github(\"PPgp/wpp2024\")\n```\n:::\n\n\n\n## Simple age data\n\nThe simplest way that demographic data is presented is on a year-on-year basis. These estimates are available in the `popAge1dt` dataset. \n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndata(popAge1dt)\n\n# Brazil, Ireland, Pakistan, Japan\ncountries <- tibble(\n  country_code = c(392, 586, 372, 76),\n  name = c(\"Japan\", \"Pakistan\", \"Ireland\", \"Brazil\")\n)\n```\n:::\n\n\n\n### Preparing the data\n\nA population pyramid follows certain conventions. The data is presented in age-sex groups: males on the left, females on the right. Bars typically represent each group's share of total population, though sometimes they show shares within each sex separately.\n\nThe code below calculates population shares by age and sex, making male values negative to position them on the left side.\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npopage <- popAge1dt |> \n  filter(\n    country_code %in% countries$country_code,\n    year %in% seq(1950, 2020, 10)\n    )\n\npopage <- popage |> \n  select(country_code, name, year, age, popM, popF) |> \n    pivot_longer(\n    cols = popM:popF,\n    names_to = \"sex\",\n    values_to = \"population\"\n  )\n\npopage <- popage |> \n  mutate(\n    sex = if_else(sex == \"popM\", \"Male\", \"Female\"),\n    sex = factor(sex, levels = c(\"Male\", \"Female\")),\n  ) |> \n  group_by(country_code, name, year) |> \n  mutate(share = population / sum(population, na.rm = TRUE) * 100) |> \n  ungroup() |> \n  mutate(share = if_else(sex == \"Male\", -share, share))\n```\n:::\n\n\n\n### Minimal plot\n\nThe code below creates a basic population pyramid using Japan's 1950 demographic data. Each bar shows what percentage of the total population belongs to a specific age group and sex combination. For example, a bar might show that 1% of Japan's total population was males aged 10 years.\n\nThe visualization is called a \"pyramid\" because of its distinctive shape: wide at the bottom (many young people), gradually narrowing through the middle ages (fewer adults), and smallest at the top (very few elderly). This triangular shape was typical for most countries in the past and is still common in developing nations today. The shape reveals a population structure with high birth rates and shorter life expectancy.\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\njpn50 <- popage |> \n  filter(name == \"Japan\", year == 1950)\n\nggplot(jpn50, aes(x = age, y = share)) +\n  geom_col(aes(fill = sex, color = sex)) +\n  coord_flip() +\n  guides(fill = \"none\", color = \"none\") +\n  scale_x_continuous(\n    breaks = seq(0, 100, 10),\n    expand = c(0, 0)) +\n  scale_y_continuous(\n    breaks = seq(-1.5, 1.5, 0.5),\n    labels = c(\"1.5\", \"1\", \"0.5\", \"0\", \"0.5\", \"1\", \"1.5\")\n  ) +\n  labs(x = \"Age\", y = \"Share of Population (%)\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){fig-align='center' width=672}\n:::\n:::\n\n\n\n### Adding colors and text labels\n\nThe code below demonstrates how to enhance a population pyramid with colors and explanatory labels. These additions are essential as they make the visualization more informative and self-contained, allowing readers to understand the data without needing external explanations.\n\nRegarding color choices for gender representation, modern data visualization practices avoid traditional stereotypes (like blue for males and pink for females). [DataWrapper has an insightful discussion on this matter](https://www.datawrapper.de/blog/gendercolor) and recommends using green for men and purple for women.\n\nNote that while these specific colors (green and purple) work well, there's no strict rule - the key is to choose colors that are:\n\n* Clearly distinguishable\n* Accessible to colorblind viewers\n* Consistent with your overall design scheme\n* (Preferably) Free from gender stereotypes\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ncolors <- c(\"#1B9E77\", \"#7570B3\")\nfont <- \"Open Sans\"\n\np <- ggplot(jpn50, aes(x = age, y = share)) +\n  geom_col(aes(fill = sex, color = sex)) +\n  coord_flip() +\n  guides(fill = \"none\", color = \"none\") +\n  scale_x_continuous(\n    breaks = seq(0, 100, 10),\n    expand = c(0, 0)) +\n  scale_y_continuous(\n    breaks = seq(-1.5, 1.5, 0.5),\n    labels = c(\"1.5\", \"1\", \"0.5\", \"0\", \"0.5\", \"1\", \"1.5\")\n  ) +\n  labs(x = \"Age\", y = \"Share of Population (%)\")\n\np + \n  geom_hline(yintercept = 0) +\n  annotate(\n    \"label\",\n    x = 85,\n    y = -1.25,\n    label = \"Male\",\n    color = colors[1],\n    family = font,\n    size = 4\n  ) +\n    annotate(\n    \"label\",\n    x = 85,\n    y = 1.25,\n    label = \"Female\",\n    color = colors[2],\n    family = font,\n    size = 4\n  ) +\n  scale_color_manual(values = colors) +\n  scale_fill_manual(values = colors) +\n  theme_minimal(base_size = 12, base_family = font) +\n  theme(\n    panel.grid.minor = element_blank(),\n    panel.grid.major.x = element_line(linetype = 2)\n  )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-1.png){fig-align='center' width=672}\n:::\n:::\n\n\n\n### Comparisons\n\nThe code below shows how to make interesting comparisions using small facet plots.\n\nThe first example shows how to see the demographic evolution of a single country over the years.\n\nThe second example shows how to compare a cross-country selection across the same time period.\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\njpn <- popage |> \n  filter(name == \"Japan\", year %in% seq(1950, 2000, 10))\n\nbase_plot <- ggplot(jpn, aes(x = age, y = share)) +\n  geom_col(aes(fill = sex, color = sex)) +\n  coord_flip() +\n  guides(fill = \"none\", color = \"none\") +\n  scale_x_continuous(\n    breaks = seq(0, 100, 10),\n    expand = c(0, 0)) +\n  scale_y_continuous(\n    breaks = seq(-1.5, 1.5, 0.5),\n    labels = c(\"1.5\", \"1\", \"0.5\", \"0\", \"0.5\", \"1\", \"1.5\")\n  ) +\n  labs(x = \"Age\", y = \"Share of Population (%)\") +\n  scale_color_manual(values = colors) +\n  scale_fill_manual(values = colors) +\n  theme_minimal(base_size = 12, base_family = font) +\n  theme(\n    panel.grid.minor = element_blank(),\n    panel.grid.major.x = element_line(linetype = 2)\n  )\n\nbase_plot +\n  facet_wrap(~year) +\n  ggtitle(\"The demographic aging of Japan\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-1.png){fig-align='center' width=672}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ncountry_comp50 <- popage |> \n  filter(year == 1980)\n\nbase_plot <- ggplot(country_comp50, aes(x = age, y = share)) +\n  geom_col(aes(fill = sex, color = sex)) +\n  coord_flip() +\n  guides(fill = \"none\", color = \"none\") +\n  scale_x_continuous(\n    breaks = seq(0, 100, 10),\n    expand = c(0, 0)) +\n  scale_y_continuous(\n    breaks = seq(-1.5, 1.5, 0.5),\n    labels = c(\"1.5\", \"1\", \"0.5\", \"0\", \"0.5\", \"1\", \"1.5\")\n  ) +\n  labs(x = \"Age\", y = \"Share of Population (%)\") +\n  scale_color_manual(values = colors) +\n  scale_fill_manual(values = colors) +\n  theme_minimal(base_size = 12, base_family = font) +\n  theme(\n    panel.grid.minor = element_blank(),\n    panel.grid.major.x = element_line(linetype = 2)\n  )\n\nbase_plot +\n  facet_wrap(~name) +\n  ggtitle(\"Country comparison: 1980\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-8-1.png){fig-align='center' width=672}\n:::\n:::\n\n\n\n## Grouped age data\n\nDemographers typically work with grouped age data (usually in 5 or 10-year intervals) rather than single-year ages for two main reasons:\n\n* *Statistical Reliability*: Grouped data provides more precise estimates by reducing random variations that can occur in single-year measurements.\n\n* *Practical Analysis*: Broader age groups make it easier to identify and understand demographic patterns and trends. For instance, knowing the proportion of people aged 65-69 is often more useful for policy planning than specific single-year counts.\n\nThis data is available in the `popAge5dt` dataset.\n\nSome data manipulation is necessary since the age groups are interpreted as text/strings, and there is no obvious way to order this data. The code below converts this text data into a factor (a ordered string, 0-4, 5-9, ..., 80-84, 85+).\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndata(\"popAge5dt\")\n\npopage <- popAge5dt |> \n  filter(country_code %in% countries$country_code) |> \n  mutate(\n    age_trunc = if_else(\n      age %in% c(\"85-89\", \"90-94\", \"95-99\", \"100+\"), \"85-\", age\n      ),\n    age_min = as.integer(str_extract(age_trunc, \"[0-9]{1,2}(?=-)\")),\n    age_trunc = str_replace(age_trunc, \"85-\", \"85+\"),\n    age_trunc = factor(age_trunc),\n    age_trunc = forcats::fct_reorder(age_trunc, age_min)\n  ) |> \n  group_by(country_code, name, year, age_trunc) |> \n  summarise(\n    pop_male = sum(popM),\n    pop_female = sum(popF)\n  ) |> \n  ungroup()\n\npopage <- popage |> \n    select(country_code, name, year, age_trunc, pop_male, pop_female) |> \n    pivot_longer(\n    cols = starts_with(\"pop\"),\n    names_to = \"sex\",\n    values_to = \"population\"\n  )\n\npopage <- popage |> \n  mutate(\n    sex = if_else(sex == \"pop_male\", \"Male\", \"Female\"),\n    sex = factor(sex, levels = c(\"Male\", \"Female\")),\n  ) |> \n  group_by(country_code, name, year) |> \n  mutate(share = population / sum(population, na.rm = TRUE) * 100) |> \n  ungroup() |> \n  mutate(share = if_else(sex == \"Male\", -share, share))\n```\n:::\n\n\n\n### Simple plot\n\nThe code below shows how to make a simple plot following the conventions above. The data shows the demographic distribution of Brazil in 1990.\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndat <- filter(popage, name == \"Brazil\", year == 1990)\n\nbreaks_share <- seq(-6, 6, 1)\nlabels_share <- str_remove(as.character(breaks_share), \"-\")\n\nggplot(dat, aes(x = age_trunc, y = share)) +\n  geom_col(aes(fill = sex, color = sex)) +\n  coord_flip() +\n  guides(fill = \"none\", color = \"none\") +\n  scale_y_continuous(\n    breaks = breaks_share,\n    labels = labels_share\n  ) +\n  labs(x = \"Age\", y = \"Share of Population (%)\") +\n  scale_color_manual(values = colors) +\n  scale_fill_manual(values = colors) +\n  theme_minimal(base_size = 12, base_family = font) +\n  theme(\n    panel.grid.minor = element_blank(),\n    panel.grid.major.x = element_line(linetype = 2)\n  )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-10-1.png){fig-align='center' width=672}\n:::\n:::\n\n\n\n### Comparisons\n\nAside from side-by-side plots, we can make different kinds of visualizations to highlight demographic changes through time.\n\nThis first example uses a simple line to compare Brazil's demographic pyramid in 1970 and 2000.\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndat <- filter(popage, name == \"Brazil\")\n\nbreaks_share <- seq(-10, 10, 2)\nlabels_share <- str_remove(as.character(breaks_share), \"-\")\n\nggplot() +\n  geom_col(\n    data = filter(dat, year == 2000),\n    aes(age_trunc, share, fill = sex, color = sex)\n  ) +\n  geom_step(\n    data = filter(dat, year == 1970),\n    aes(age_trunc, share, group = sex),\n    color = \"black\",\n    alpha = 0.7\n  ) +\n  coord_flip() +\n  guides(fill = \"none\", color = \"none\") +\n  scale_y_continuous(\n    breaks = breaks_share,\n    labels = labels_share\n  ) +\n  labs(\n    title = \"Brazil: 1970 x 2000\",\n    x = \"Age\", y = \"Share of Population (%)\",\n    subtitle = \"Solid line shows the demographic pyramid in 1970. Colored bars show the same data in 2000.\") +\n  scale_color_manual(values = colors) +\n  scale_fill_manual(values = colors) +\n  theme_minimal(base_size = 12, base_family = font) +\n  theme(\n    panel.grid.minor = element_blank(),\n    panel.grid.major.x = element_line(linetype = 2)\n  )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-11-1.png){fig-align='center' width=672}\n:::\n:::\n\n\n\nThis second example is essentially the same but uses a connected line to contrast Brazil's demographic in 2000 and 2010.\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot() +\n  geom_col(\n    data = filter(dat, year == 2010),\n    aes(age_trunc, share, fill = sex, color = sex)\n  ) +\n  geom_line(\n    data = filter(dat, year == 2000),\n    aes(age_trunc, share, group = sex),\n    color = \"black\",\n    alpha = 0.7\n  ) +\n  geom_point(\n    data = filter(dat, year == 2000),\n    aes(age_trunc, share, group = sex),\n    color = \"black\",\n    alpha = 0.7\n  ) +\n  coord_flip() +\n  guides(fill = \"none\", color = \"none\") +\n  scale_y_continuous(\n    breaks = breaks_share,\n    labels = labels_share\n  ) +\n  labs(x = \"Age\", y = \"Share of Population (%)\") +\n  scale_color_manual(values = colors) +\n  scale_fill_manual(values = colors) +\n  theme_minimal(base_size = 12, base_family = font) +\n  theme(\n    panel.grid.minor = element_blank(),\n    panel.grid.major.x = element_line(linetype = 2)\n  )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-12-1.png){fig-align='center' width=672}\n:::\n:::\n\n\n\nThis final visualization demonstrates an innovative approach to population pyramids by comparing two time periods side-by-side within each age group. This design choice offers several advantages:\n\n1. Direct Comparison: Placing bars next to each other makes it easier to see how population structure changes over time for each age group.\n\n2. Enhanced Readability: The text labels are centered between the bars, creating a clean and balanced layout that guides the reader's eye naturally through the data.\n\n3. Efficient Legend: The color legend serves multiple purposes - it identifies time periods, explains the color coding, and provides context for the entire visualization. This eliminates the need for additional explanatory text.\n\nThis design represents a thoughtful evolution of the traditional population pyramid, maintaining its familiar elements while improving its comparative capabilities.\n\nMaking this plot, however, is a bit more complex and requires the `patchwork` package.\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\np1 <- ggplot(\n  data = filter(dat, sex == \"Male\", year %in% c(1970, 2000)),\n  aes(age_trunc, share, alpha = as.factor(year))) +\n  geom_col(position = position_dodge(),\n           fill = colors[1]) +\n  scale_alpha_manual(\n    name = \"\",\n    values = c(0.5, 1),\n    labels = c(\"Male (1970)\", \"Male (2000)\")) +\n  coord_flip() +\n  scale_y_continuous(\n    breaks = breaks_share,\n    labels = labels_share,\n    limits = c(-8, 0)\n  ) +\n  labs(x = NULL, y = NULL) +\n  scale_color_manual(values = colors) +\n  scale_fill_manual(values = colors) +\n  theme_minimal(base_size = 12, base_family = font) +\n  theme(\n    legend.position = \"bottom\",\n    panel.grid.minor = element_blank(),\n    panel.grid.major.x = element_line(linetype = 2),\n    axis.text.y = element_blank()\n  )\n\np2 <- ggplot(\n  data = filter(dat, sex == \"Female\", year %in% c(1970, 2000)),\n  aes(age_trunc, share, alpha = as.factor(year))) +\n  geom_col(position = position_dodge(),\n           fill = colors[2]) +\n  scale_alpha_manual(\n    name = \"\",\n    values = c(0.5, 1),\n    labels = c(\"Female (1970)\", \"Female (2000)\")) +\n  coord_flip() +\n  scale_y_continuous(\n    breaks = breaks_share,\n    labels = labels_share,\n    limits = c(0, 8)\n  ) +\n  labs(x = NULL, y = NULL) +\n  scale_color_manual(values = colors) +\n  scale_fill_manual(values = colors) +\n  theme_minimal(base_size = 12, base_family = font) +\n  theme(\n    legend.position = \"bottom\",\n    panel.grid.minor = element_blank(),\n    panel.grid.major.x = element_line(linetype = 2),\n    axis.text.y = element_text(hjust = 0.5)\n  )\n\npanel <- (p1 | p2) & theme(legend.position = \"bottom\")\npanel <- panel + plot_layout(guides = \"collect\")\n\npanel\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-13-1.png){fig-align='center' width=672}\n:::\n:::\n\n\n\n\n\n\n\n\n\n\n## Conclusion\n\nPopulation pyramids are powerful tools for visualizing demographic structure and change. Through the examples shown above, we've explored how to create increasingly sophisticated versions of these charts - from basic representations to comparative visualizations that reveal temporal changes.\n\nKey takeaways from this tutorial:\n\n* Start with a basic structure showing population shares by age and sex\nAdd clear labels and thoughtful color choices to make visualizations self-explanatory.\n* Use age groups rather than single years for more meaningful analysis.\n* Consider innovative layouts, like side-by-side comparisons, to enhance understanding.\n* While the traditional pyramid shape remains useful, modern visualization techniques and tools allow us to adapt this classic demographic tool to better serve our analytical needs. The final example, with its side-by-side comparison and centered labels, demonstrates how thoughtful design choices can significantly improve the communication of demographic data.\n\nRemember that the goal is always to make complex demographic information more accessible and understandable to your audience.\n\n# Useful links\n\n* [Do this not that: Population pyramid](https://infogram.com/blog/do-this-not-that-population-pyramid/)\n\n* [An alternative to pink & blue: Colors for gender data](https://blog.datawrapper.de/gendercolor/)",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}