{
  "hash": "32d6e37d55f3c9425a0b6ffb19cf9f7f",
  "result": {
    "markdown": "---\ntitle: \"\"\ndate: \"2024-04-04\"\ndescription: \"\"\ncategories: ['data-visualization', 'ggplot2', 'censo', 'brasil', 'demografia']\nexecute: \n  message: false\n  warning: false\n  eval: false\ndraft: true\n---\n\n\n# Razão de Dependência nos Estados do Brasil\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(sidrar)\nlibrary(sf)\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(stringr)\nlibrary(forcats)\nlibrary(ggplot2)\nlibrary(geobr)\n\nlibrary(showtext)\nfont_add_google(\"Lato\", \"Lato\")\nshowtext_auto()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nstate_border = read_state(showProgress = FALSE)\ndim_state = as_tibble(st_drop_geometry(state_border))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncodes = c(93070, 93084:93098, 49108, 49109, 60040, 60041, 6653)\n\ntab_population = get_sidra(\n  9514,\n  variable = 93,\n  geo = \"State\",\n  classific = \"c287\",\n  category = list(codes)\n  )\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\npop <- tab_population |> \n  janitor::clean_names() |> \n  as_tibble() |> \n  filter(sexo == \"Total\", forma_de_declaracao_da_idade == \"Total\") |> \n  select(\n    code_state = unidade_da_federacao_codigo,\n    age_group = idade,\n    count = valor\n    )\n\npop <- pop |> \n  mutate(\n    code_state = as.numeric(code_state),\n    age_min = as.numeric(str_extract(age_group, \"\\\\d+\")),\n    age_group = factor(age_group),\n    age_group = fct_reorder(age_group, age_min),\n    age_ibge = case_when(\n      age_min < 15 ~ \"young\",\n      age_min >= 15 & age_min < 65 ~ \"adult\",\n      age_min >= 65 ~ \"elder\"\n    ),\n    factor(age_ibge, levels = c(\"young\", \"adult\", \"elder\"))\n  )\n\npop_state <- pop %>%\n  summarise(\n    total = sum(count), .by = c(\"age_ibge\", \"code_state\")\n  ) %>%\n  pivot_wider(\n    id_cols = \"code_state\",\n    names_from = \"age_ibge\",\n    values_from = \"total\"\n    ) %>%\n  mutate(\n    dre = elder / adult,\n    dry = young / adult,\n    tdr = dre + dry\n  )\n\ntab_pop_state <- left_join(dim_state, pop_state, by = \"code_state\")\npop <- left_join(state_border, pop_state, by = \"code_state\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(biscale)\nlibrary(patchwork)\n\ndep_biclass <- bi_class(pop, dre, dry, dim = 3, style = \"quantile\")\n\np_map <- ggplot(dep_biclass) +\n  geom_sf(\n    aes(fill = bi_class),\n    color = \"white\",\n    lwd = 0.2,\n    show.legend = FALSE\n    ) +\n  coord_sf(xlim = c(NA, -35)) +\n  bi_scale_fill(pal = \"GrPink\", dim = 3) +\n  bi_theme()\n\np_legend <- bi_legend(\n  pal = \"GrPink\",\n  dim = 3,\n  xlab = \"Idoso (%)\",\n  ylab = \"Jovem (%)\",\n  size = 8\n  )\n\nmap_states <- p_map + inset_element(p_legend, 0, 0.1, 0.35, 0.45)\n\nmap_states + plot_annotation(\n  title = \"Razão de Dependência\",\n  subtitle = \"Razão de dependência jovem e idosa no Brasil (2022).\"\n) &\n  theme(\n    plot.title = element_text(size = 18, family = \"Lato\", hjust = 0.5),\n    plot.subtitle = element_text(family = \"Lato\", hjust = 0.5)\n  )\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(gt)\nlibrary(gtExtras)\n\ntab_pop_state\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}