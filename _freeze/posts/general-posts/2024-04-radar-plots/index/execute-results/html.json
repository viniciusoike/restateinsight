{
  "hash": "dfa8215ffc9eac007a2c89c62769a162",
  "result": {
    "markdown": "---\ntitle: \"Radar Plots\"\ndate: \"2024-04-15\"\ncategories: ['data-visualization', 'ggplot2', 'real-estate', 'english']\ndescription: \"Radar plots, or spider plots, are commonly used in dashboards and general data visualizations. In this post I present radar plots in R and discuss some of their shortcomings and finally present some alternatives.\"\nexecute: \n  message: false\n  warning: false\n  eval: true\n---\n\n\n\n\n# Radar plots\n\nRadar plots show a *static visualization of the numeric values of several different categories of a same entity*. These charts are also known as spider or web plots, since they *visually resemble a spider web*. The values of each variable are connected by a straight line and the resulting image is a polygon. These charts are commonly used to quickly access a collection of important variables and to make simple comparisons, and are frequently used in dashboards.\n\n\n::: {.cell fig-cap-location='bottom'}\n::: {.cell-output-display}\n![Example of a radar plot](index_files/figure-html/example-radar-plot-1.png){width=672}\n:::\n:::\n\n\nThe plot above shows 11 characteristics of a car (Datsun 710, from the `mtcars` dataset). The vertical distance of each dot from the center represents the magnitude of each variable. Since the overall axis is \"fixed\" this type of plot is ideal to represent scaled or indexed values. In more general cases, this means some data transformation is needed to achieve a better final result.\n\n# Into the wild\n\nThere are two options to build radar plots in `R` using `ggplot2`: `ggradar` and `fmsb`. The latter is not a data visualization package but rather a broader toolset to deal with medical statistics and demographic data. The former is a `ggplot2` extension created [specifically for radar plots](https://github.com/ricardo-bion/ggradar). To exemplify the use of both packages we will look at [Abrainc's Radar of economic conditions of the Brazilian real estate market](https://www.fipe.org.br/pt-br/indices/radar-abrainc/). This data can be imported easily with my helper package [`realestatebr`](https://github.com/viniciusoike/realestatebr).\n\nThe code below shows the packages used in this post.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Data manipulation\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(stringr)\nlibrary(realestatebr)\n\n# Visualization\nlibrary(ggplot2)\nlibrary(ggradar)\nlibrary(fmsb)\n# (optional) To import only the plotting function\nlibrary(fmsb, include.only = \"radarchart\")\n```\n:::\n\n\n## The data\n\nThe Abrainc Radar is a collection of 12 variables, structured into 4 subgroups, that aim to capture the overall condition of the real estate market. These groups are: (1) macroeconomic conditions; (2) real estate credit conditions; (3) real estate demand; (4) real estate conditions.\n\nVariables include real estate prices, input costs, and interest rates. All variables are scaled in the 0-10 range, where 10 represents more favorable conditions.\n\nThe code below grabs the most recent data and makes minor improvements to the labels of the variables.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Download the data\nradar <- get_abrainc_indicators(category = \"radar\")\n\n# Better labels for the plot\nradar_labels <- c(\n  \"Confidence\", \"Activity\", \"Interest Rate\", \"Financing Conditions\",\n  \"Real Concessions\", \"Atractivity\", \"Employment\", \"Wages\",\n  \"Real Estate Investing\", \"Input Costs\", \"New Launches\",\n  \"Real Estate Prices\")\n\nradar <- radar |> \n  mutate(\n    month = lubridate::month(date),\n    variable = factor(variable, levels = unique(variable)),\n    variable_label = factor(\n      variable,\n      levels = unique(variable),\n      labels = radar_labels)\n  )\n\n# Get data only from the most recent period\ncurrent_period <- radar |> \n  filter(date == max(date)) |> \n  pivot_wider(\n    id_cols = \"date\",\n    names_from = \"variable\",\n    values_from = \"value\"\n    )\n```\n:::\n\n\nOur data is two columns and all variables are scaled in the 0-10 range, where higher values indicate more favorable conditions.\n\n\n::: {.cell}\n::: {.cell-output-display}\n```{=html}\n<div id=\"awlxkpyfsf\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>@import url(\"https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap\");\n#awlxkpyfsf table {\n  font-family: Lato, system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#awlxkpyfsf thead, #awlxkpyfsf tbody, #awlxkpyfsf tfoot, #awlxkpyfsf tr, #awlxkpyfsf td, #awlxkpyfsf th {\n  border-style: none;\n}\n\n#awlxkpyfsf p {\n  margin: 0;\n  padding: 0;\n}\n\n#awlxkpyfsf .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #5F5F5F;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #5F5F5F;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#awlxkpyfsf .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#awlxkpyfsf .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#awlxkpyfsf .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#awlxkpyfsf .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#awlxkpyfsf .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #5F5F5F;\n}\n\n#awlxkpyfsf .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #5F5F5F;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #5F5F5F;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#awlxkpyfsf .gt_col_heading {\n  color: #FFFFFF;\n  background-color: #5F5F5F;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#awlxkpyfsf .gt_column_spanner_outer {\n  color: #FFFFFF;\n  background-color: #5F5F5F;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#awlxkpyfsf .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#awlxkpyfsf .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#awlxkpyfsf .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #5F5F5F;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#awlxkpyfsf .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#awlxkpyfsf .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #5F5F5F;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #5F5F5F;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#awlxkpyfsf .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #5F5F5F;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #5F5F5F;\n  vertical-align: middle;\n}\n\n#awlxkpyfsf .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#awlxkpyfsf .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#awlxkpyfsf .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: none;\n  border-top-width: 1px;\n  border-top-color: #D5D5D5;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D5D5D5;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D5D5D5;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#awlxkpyfsf .gt_stub {\n  color: #333333;\n  background-color: #D5D5D5;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D5D5D5;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#awlxkpyfsf .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#awlxkpyfsf .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#awlxkpyfsf .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#awlxkpyfsf .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#awlxkpyfsf .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #5F5F5F;\n}\n\n#awlxkpyfsf .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#awlxkpyfsf .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #5F5F5F;\n}\n\n#awlxkpyfsf .gt_grand_summary_row {\n  color: #333333;\n  background-color: #D5D5D5;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#awlxkpyfsf .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #5F5F5F;\n}\n\n#awlxkpyfsf .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #5F5F5F;\n}\n\n#awlxkpyfsf .gt_striped {\n  background-color: #F4F4F4;\n}\n\n#awlxkpyfsf .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #5F5F5F;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #5F5F5F;\n}\n\n#awlxkpyfsf .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#awlxkpyfsf .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#awlxkpyfsf .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#awlxkpyfsf .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#awlxkpyfsf .gt_left {\n  text-align: left;\n}\n\n#awlxkpyfsf .gt_center {\n  text-align: center;\n}\n\n#awlxkpyfsf .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#awlxkpyfsf .gt_font_normal {\n  font-weight: normal;\n}\n\n#awlxkpyfsf .gt_font_bold {\n  font-weight: bold;\n}\n\n#awlxkpyfsf .gt_font_italic {\n  font-style: italic;\n}\n\n#awlxkpyfsf .gt_super {\n  font-size: 65%;\n}\n\n#awlxkpyfsf .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#awlxkpyfsf .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#awlxkpyfsf .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#awlxkpyfsf .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#awlxkpyfsf .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#awlxkpyfsf .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#awlxkpyfsf .gt_indent_5 {\n  text-indent: 25px;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"NAME\">NAME</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"VALUE\">VALUE</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr class=\"gt_group_heading_row\">\n      <th colspan=\"2\" class=\"gt_group_heading\" scope=\"colgroup\" id=\"Macroeconomic\">Macroeconomic</th>\n    </tr>\n    <tr class=\"gt_row_group_first\"><td headers=\"Macroeconomic  name\" class=\"gt_row gt_left\">Confidence</td>\n<td headers=\"Macroeconomic  value\" class=\"gt_row gt_right\">5.97</td></tr>\n    <tr><td headers=\"Macroeconomic  name\" class=\"gt_row gt_left gt_striped\">Activity</td>\n<td headers=\"Macroeconomic  value\" class=\"gt_row gt_right gt_striped\">9.05</td></tr>\n    <tr><td headers=\"Macroeconomic  name\" class=\"gt_row gt_left\">Interest Rate</td>\n<td headers=\"Macroeconomic  value\" class=\"gt_row gt_right\">2.67</td></tr>\n    <tr class=\"gt_group_heading_row\">\n      <th colspan=\"2\" class=\"gt_group_heading\" scope=\"colgroup\" id=\"Real Estate Credit\">Real Estate Credit</th>\n    </tr>\n    <tr class=\"gt_row_group_first\"><td headers=\"Real Estate Credit  name\" class=\"gt_row gt_left gt_striped\">Financing Conditions</td>\n<td headers=\"Real Estate Credit  value\" class=\"gt_row gt_right gt_striped\">0.63</td></tr>\n    <tr><td headers=\"Real Estate Credit  name\" class=\"gt_row gt_left\">Real Concessions</td>\n<td headers=\"Real Estate Credit  value\" class=\"gt_row gt_right\">2.53</td></tr>\n    <tr><td headers=\"Real Estate Credit  name\" class=\"gt_row gt_left gt_striped\">Atractivity</td>\n<td headers=\"Real Estate Credit  value\" class=\"gt_row gt_right gt_striped\">4.74</td></tr>\n    <tr class=\"gt_group_heading_row\">\n      <th colspan=\"2\" class=\"gt_group_heading\" scope=\"colgroup\" id=\"Market Demand\">Market Demand</th>\n    </tr>\n    <tr class=\"gt_row_group_first\"><td headers=\"Market Demand  name\" class=\"gt_row gt_left\">Employment</td>\n<td headers=\"Market Demand  value\" class=\"gt_row gt_right\">8.51</td></tr>\n    <tr><td headers=\"Market Demand  name\" class=\"gt_row gt_left gt_striped\">Wages</td>\n<td headers=\"Market Demand  value\" class=\"gt_row gt_right gt_striped\">9.00</td></tr>\n    <tr><td headers=\"Market Demand  name\" class=\"gt_row gt_left\">Real Estate Investing</td>\n<td headers=\"Market Demand  value\" class=\"gt_row gt_right\">3.08</td></tr>\n    <tr class=\"gt_group_heading_row\">\n      <th colspan=\"2\" class=\"gt_group_heading\" scope=\"colgroup\" id=\"Real Estate\">Real Estate</th>\n    </tr>\n    <tr class=\"gt_row_group_first\"><td headers=\"Real Estate  name\" class=\"gt_row gt_left gt_striped\">Input Costs</td>\n<td headers=\"Real Estate  value\" class=\"gt_row gt_right gt_striped\">6.38</td></tr>\n    <tr><td headers=\"Real Estate  name\" class=\"gt_row gt_left\">New Launches</td>\n<td headers=\"Real Estate  value\" class=\"gt_row gt_right\">7.68</td></tr>\n    <tr><td headers=\"Real Estate  name\" class=\"gt_row gt_left gt_striped\">Real Estate Prices</td>\n<td headers=\"Real Estate  value\" class=\"gt_row gt_right gt_striped\">4.82</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n:::\n:::\n\n\nThe Abrainc Radar is a monthly longitudinal panel of data, i.e., a collection of time series. To visualize this data we will select first the most recent period available and compare it to (1) the equivalent period in the previous year; (2) the *best* equivalent period.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlatest_date <- max(radar$date)\nlast_year <- latest_date - lubridate::years(1)\n\nbest_year <- radar |> \n  filter(month == lubridate::month(latest_date)) |> \n  group_by(date) |> \n  summarise(total = sum(value)) |> \n  slice_max(total, n = 1) |> \n  pull(date)\n\ncompare_best <- radar |> \n  filter(date %in% c(latest_date, best_year)) |> \n  pivot_wider(\n    id_cols = \"year\",\n    names_from = \"variable\",\n    values_from = \"value\"\n    )\n\ncompare <- radar |> \n  filter(year >= lubridate::year(latest_date) - 1,\n         month == lubridate::month(latest_date)) |> \n  pivot_wider(\n    id_cols = \"year\",\n    names_from = \"variable\",\n    values_from = \"value\"\n    )\n```\n:::\n\n\n# Radar plots in R\n\nFirst we show the data using `ggradar`.\n\n## ggradar\n\nUsing default settings, a minimal radar plot requires specifying the scale of the grid and its units. By default, `ggradar` assumes that all the numeric data is in a 0-100 range. The `data.frame` input should be a $1\\times k$ table where $k$ is the number of variables. The function ignores non-numerical variables by default.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggradar(\n  current_period,\n  grid.min = 0,\n  grid.mid = 5,\n  grid.max = 10,\n  values.radar = c(\"0\", \"5\", \"10\"),\n  axis.label.size = 3\n  )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\nThere are several arguments to improve the visualization. Since we will make several radar plots it's convenient to create a function to do this.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\n# Line break the labels\nradar_labels <- str_wrap(radar_labels, width = 10)\n\nplot_ggradar <- function(.dat, colors, legend = FALSE) {\n  \n  p <- ggradar(\n    .dat,\n    # Define grid limits\n    grid.min = 0,\n    grid.mid = 5,\n    grid.max = 10,\n    # Define grid labels\n    values.radar = c(\"0\", \"5\", \"10\"),\n    grid.label.size = 5,\n    # Shade polygon\n    fill = TRUE,\n    fill.alpha = 0.3,\n    # Axis labels (outside the circle)\n    axis.labels = radar_labels,\n    axis.label.size = 3,\n    font.radar = \"Lato\",\n    # \"Size\" of the plot\n    plot.extent.x.sf = 1.5,\n    plot.extent.y.sf = 1.4,\n    # Color of the lines and circles\n    group.colours = colors,\n    # Size of the circles\n    group.point.size = 3,\n    # Width of the line connecting the points\n    group.line.width = 1\n    )\n  \n  if (legend | length(colors) > 1) {\n    p <- p + theme(legend.position = \"top\")\n  }\n  \n  return(p)\n  \n}\n```\n:::\n\n\nThe improved plot is shown below. From the radar plot, we see that the real economy seems to be in a favorable spot: the *activity* indicator is high and so are *wages* and *employment*. Credit conditions are not favorable as can be seen from the low values of *interest rate*, *financing conditions*, *atractivity*, and *real concessions*.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_ggradar(current_period, \"#264653\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\nWe can use radar plots to make simple comparisons. This radar plot compares the current period with the comparable period in the previous year. We can see that *wages* and *employment* improved considerably while *atractivity* and *real concessions* worsened.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_ggradar(compare, c(\"#e76f51\", \"#264653\"))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\nFinally, we can compare the current period with the \"best\" period. For this exercise, I defined \"best\" as the period we the highest cumulative score using equal weights for all indicators. Compared to the best period, the current period is worse in all indicators with exception of *wages* and *new launches*.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_ggradar(compare_best, c(\"#e76f51\", \"#264653\"))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n### Some Problems\n\nI'll discuss some general problems of radar plots below but is should be noted that `ggradar` produces \"circular\" plots instead of \"web\" plots. Indeed, a distinctive feature of the radar charts produced by `ggradar` is that the radar is circular which means the dots are positioned on a radial frame ([polar coordinate frame](https://en.wikipedia.org/wiki/Polar_coordinate_system)) instead of a conventional cartesian (rectangular) frame. This causes a slight visual distortion: connection dots with a straight line in a circle doesn't make much sense geometrically.\n\nThis distortion *is more visible when there are fewer categories*; conversly, the distortion is *less noticeable when there are many categories*. Looking at the documentation of `ggradar` this might be a conscious decision since the inspiration for the `ggradar` function is a code developed by [Paul Williamson](http://rstudio-pubs-static.s3.amazonaws.com/5795_e6e6411731bb4f1b9cc7eb49499c2082.html) that used radar plots to evaluate clusters defined by 44 different variables.\n\n\n::: {.cell layout-ncol=\"2\"}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-9-1.png){fig-pos='h' width=672}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-9-2.png){fig-pos='h' width=672}\n:::\n:::\n\n\n## fmsb\n\nThe `fmsb` package is a companion to the book \"Practices of Medical and Health Data Analysis using R\". It offers a multitude of functions and datasets. The main function we will use is the `radarchart` function. This function expects a wide dataset with atleast three rows. The first row should indicate the maximum value of each column (variable), the second row should indicate the minimum value of each column, and the third row should be the actual/current value of each column.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwide_dat <- pivot_wider(\n  filter(radar, date == max(date)),\n  id_cols = \"date\",\n  names_from = \"variable_label\",\n  values_from = \"value\"\n)\n\nwide_dat <- rbind(rep(10, 12), rep(0, 12), wide_dat[, 2:13])\n\nwide_dat\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 3 × 12\n  Confidence Activity `Interest Rate` `Financing Conditions` `Real Concessions`\n       <dbl>    <dbl>           <dbl>                  <dbl>              <dbl>\n1      10       10              10                    10                  10   \n2       0        0               0                     0                   0   \n3       5.97     9.05            2.67                  0.630               2.53\n  Atractivity Employment Wages `Real Estate Investing` `Input Costs`\n        <dbl>      <dbl> <dbl>                   <dbl>         <dbl>\n1       10         10    10                      10            10   \n2        0          0     0                       0             0   \n3        4.74       8.51  9.00                    3.08          6.38\n  `New Launches` `Real Estate Prices`\n           <dbl>                <dbl>\n1          10                   10   \n2           0                    0   \n3           7.68                 4.82\n```\n:::\n:::\n\n\nIt's fairly simple to produce a radar chart using this function.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nradarchart(wide_dat)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\nWe can customize the result to get a better visualization.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nradarchart(\n  wide_dat,\n  axistype = 1,\n  seg = 5,\n  \n  # Polygon\n  pcol = \"#023047\",\n  pfcol = alpha(\"#023047\", 0.3),\n  plwd = 4, \n\n  # Grid\n  cglcol = \"grey90\",\n  cglty = 1,\n  axislabcol = \"grey90\",\n  caxislabels = seq(0, 10, 2),\n  cglwd = 0.8,\n  # Labels\n  vlcex = 0.8)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\nNote that `radarchart` uses straight grid lines (instead of circular) so it doesn't cause the same visual distortion seen in the `ggradar` examples above. In this sense, `radarchart` produces radar plots that are more visually accurate.\n\nAgain, we can create a custom function to help make our radar plots.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nplot_radarchart <- function(.dat, colors = \"#023047\", legend = FALSE, labels = radar_labels) {\n  \n  radarchart(\n    .dat,\n    axistype = 1,\n    seg = 5,\n    # Polygon\n    pcol = colors,\n    pfcol = alpha(colors, 0.3),\n    plwd = 4,\n    # Grid\n    cglcol = \"grey90\",\n    cglty = 1,\n    axislabcol = \"grey90\",\n    caxislabels = seq(0, 10, 2),\n    cglwd = 0.8,\n    # Labels\n    vlabels = labels,\n    vlcex = 0.8\n    )\n  \n}\n```\n:::\n\n\nNow we can easily create new radar plots.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwide_compare <- rbind(rep(10, 12), rep(0, 12), compare[, 2:13])\n\nplot_radarchart(wide_compare, colors = c(\"#e76f51\", \"#264653\"))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nwide_best <- rbind(rep(10, 12), rep(0, 12), compare_best[, 2:13])\n\nplot_radarchart(wide_best, colors = c(\"#e76f51\", \"#264653\"))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n\n\n## Problems with radar plots\n\nDespite their growing prevalence in data visualization, radar charts are subject to several criticisms. To summarize the main issues, specialists argue that:\n\n1.  *The circular layout* makes it harder to interpret the data when compared to simple horizontal/vertical axis. This is essentially the same critique made to pie charts.\n2.  *Ranking and ordering*. The overall shape and interpretation of radar plots can vary substantially depending on the layout of the variables along the edges.\n3.  *Area distortion*. Since a radar plot shows a polygon, it's area scales quadratically instead of linearly. This can lead to biased interpretation of the data, leading one to over-estimate changes.\n4.  *Overplotting*. Radar plots are not very useful when comparing 4 groups or more.\n\n### Ranking distortion\n\nAll four plots below show the exact same data but the order of the variables is changed. This results in different shaped polygons and pottentialy different or even conflicting interpretations from the same underlying data.\n\n\n::: {.cell layout-ncol=\"2\"}\n::: {.cell-output-display}\n![](index_files/figure-html/ranking-distortion-1-1.png){fig-pos='h' width=100%}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/ranking-distortion-1-2.png){fig-pos='h' width=100%}\n:::\n:::\n\n::: {.cell layout-ncol=\"2\"}\n::: {.cell-output-display}\n![](index_files/figure-html/ranking-distortion-2-1.png){fig-pos='h' width=100%}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/ranking-distortion-2-2.png){fig-pos='h' width=100%}\n:::\n:::\n\n\n### Overplotting\n\nThe plot below compares 5 different periods. Radar charts suffer from overplotting and are generally not useful for comparing more than 3 groups at a time.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-16-1.png){width=672}\n:::\n:::\n\n\nFor a more in depth analysis on the shortcomings of radar charts see [The Radar Chart and Its Caveats](https://www.data-to-viz.com/caveat/spider.html).\n\n## The alternatives\n\nThere are three alternatives to radar plots.\n\n1.  Lollipop charts\n2.  Parallel trends charts\n3.  Barplots or Column charts\n\nIn essence, all of these alternatives simplify radar plots by making the underlying space horizontal/vertical instead of \"circular\".\n\n### Lollipop charts\n\nLollipop charts are good at showing the temporal change between the same group of variables. I featured this chart in my [ggplot2 tutorials (in Portuguese)](https://restateinsight.com/posts/ggplot2-tutorial/8-lollipop#expectativa-de-vida). The code below shows how to make a simple lollipop chart using this data.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nfont_add_google(\"IBM Plex Sans\", \"IBM Plex Sans\")\n\nlolli <- radar |> \n  mutate(month = lubridate::month(date)) |> \n  filter(year %in% c(2019, 2023), month == 6) |> \n  mutate(year = factor(year))\n\nggplot(lolli, aes(variable_label, ma6, color = year)) +\n  geom_line(aes(group = variable_label), color = \"gray30\") +\n  geom_point(size = 3) +\n  coord_flip() +\n  scale_y_continuous(breaks = seq(0, 10, 2), limits = c(0, 10)) +\n  scale_color_manual(name = \"\", values = c(\"#023047\", \"#fb8500\")) +\n  labs(\n    title = \"Pre and Post-pandemic Market Conditions\",\n    subtitle = \"Real estate average market conditions in the first semester of selected years.\",\n    caption = \"Source: Abrainc/Fipe (2024)\",\n    x = NULL,\n    y = \"Index (10 = most favorable)\"\n  ) +\n  theme_light(base_family = \"IBM Plex Sans\") +\n  theme(\n    legend.position = \"top\"\n  )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/lollipop-1.png){width=672}\n:::\n:::\n\n\nThe chart shows the average values of all 12 indicators in the first semester of 2019 and 2023. When the dots are close, very little has changed; conversely, when the dots are far apart there has been considerable evolution. The colors help guide the visualization.\n\nWe can easily see that *real estate prices* and *new launches* are on the rise in 2023. Similarly, the job market and overall economy seems stronger as *wages*, *employment*, and the *level of activity* have all increased. Credit conditions, on the other hand, have deteriorated, and the overall actractivity of *real estate investment* has worsened. The fall in *financing conditions* and *interest rate* reflects both the increase in the SELIC rate as well as the increase in all real estate credit lines.\n\n### Parallel Trends\n\nA parallel trends chart is quite literally a line plot. In a way, it's a simplification of radar plots since it connects the numerical values of different categories along a simple rectangular frame. These charts can be adapted to encompass many comparison groups simultaneously so they can be used to overcome one of the shortcomings of radar plots. I'm not the greatest fan of parallel trends chart as they can become very messy.\n\nThe code below shows how to build a simple parallel trends chart.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nfont_add_google(\"Roboto Condensed\", \"Roboto Condensed\")\n\ncompare <- radar |> \n  mutate(\n    month = lubridate::month(date)\n  ) |> \n  filter(month == 6, year %in% c(2012, 2017, 2019, 2023)) |> \n  mutate(year = factor(year))\n\nggplot(compare, aes(variable_label, ma6, color = year, group = year)) +\n  geom_line() +\n  geom_point() +\n  geom_hline(yintercept = c(0, 10)) +\n  scale_x_discrete(labels = \\(x) str_wrap(x, 10)) +\n  scale_y_continuous(breaks = seq(0, 10, 2), limits = c(0, 10)) +\n  scale_color_manual(name = \"\", values = c(\"#023047\", \"#219ebc\", \"#8ecae6\", \"#fb8500\")) +\n  labs(\n    x = NULL, y = \"Index (10 = most favorable)\",\n    title = \"Real Estate Market Conditions\",\n    subtitle = \"Real estate average market conditions in the first semester of selected years.\",\n    caption = \"Source: Abrainc/Fipe (2024)\"\n  ) +\n  theme_ipsum(base_family = \"Roboto Condensed\") +\n  theme(\n    legend.position = \"top\",\n    panel.grid.minor = element_blank(),\n    axis.text.x = element_text(size = 8)\n    )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/parallel-trend-1.png){width=100%}\n:::\n:::\n\n\nIn the visualization above we compare four different years: 2012, 2017, 2019, and 2023. The first of these years is a \"boom\" year, the economy was still riding the end of the commodity cycle and interest rates were at historically low values; the labor market was also doing well, with record low unemployment rates. The indices reflect these facts: the darkblue line is usually at the top of the chart. The \"midblue\" line, represents 2017, the last year of the recession started in 2015: almost all indicators are low but notably input costs are very favorable, most likely due to the decreased construction demand. Finally, 2019 is a pre-pandemic benchmark and 2023 is the most recent available data.\n\nThis visualization would look very cluttered on a radar chart but works well as a parallel trend chart. We can easily see how the current period (2023) is different form the 2012 boom: while the real economy and labor markets are similar, credit conditions are much worse; input costs are comparable, while new launches are currently higher and prices lower.\n\n### Barplots\n\nA final alternative is to use a simple bar chart combined will small multiples. The code below shows how to make a simple version of this visulization.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\ndat = radar |> \n  mutate(\n    month = lubridate::month(date),\n    variable_label = forcats::fct_rev(variable_label)\n    ) |> \n  filter(year >= 2021, month == 6)\n\nggplot(dat, aes(variable_label, ma6)) +\n  geom_col(fill = \"#023047\") +\n  geom_hline(yintercept = 0) +\n  coord_flip() +\n  scale_y_continuous(breaks = seq(0, 10, 2)) +\n  facet_wrap(vars(year)) +\n  labs(\n    x = NULL, y = \"Index (10 = most favorable)\",\n    title = \"Real Estate Market Conditions\",\n    subtitle = \"Real estate average market conditions in the first semester of selected years.\",\n    caption = \"Source: Abrainc/Fipe (2024)\"\n  )  +\n  theme_bw(base_family = \"IBM Plex Sans\") +\n  theme(panel.grid.minor = element_blank())\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/barplot-facet-1.png){width=672}\n:::\n:::\n\n\nThis graphic allows for both a vertical analysis, comparing the different index values within the same year, as well as a horizontal analysis, comparing the same index across different time periods. It can also be enhanced using specific colors to highlight key indicators or text labels to make the values more precise. We could, for instance, highlight indicators that show how overall credit conditions have worsened in the past years.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\ncols_credit <- c(\"interest\", \"finance_condition\", \"real_concession\")\n\ndat <- dat |> \n  mutate(\n    is_credit = factor(if_else(variable %in% cols_credit, 1L, 0L))\n  )\n\nggplot(dat, aes(variable_label, ma6, fill = is_credit)) +\n  geom_col() +\n  geom_text(\n    data = filter(dat, is_credit == 1),\n    aes(y = ma6 + 0.8, label = round(ma6, 1)),\n    family = \"IBM Plex Sans\"\n  ) +\n  geom_hline(yintercept = 0) +\n  coord_flip() +\n  scale_y_continuous(breaks = seq(0, 10, 2)) +\n  facet_wrap(vars(year)) +\n  scale_fill_manual(name = \"\", values = c(\"#8ecae6\", \"#023047\")) +\n  guides(fill = \"none\") +\n  labs(\n    x = NULL, y = \"Index (10 = most favorable)\",\n    title = \"Deterioration of real estate credit conditions\",\n    subtitle = \"Real estate average market conditions in the first semester of selected years.\",\n    caption = \"Source: Abrainc/Fipe (2024)\"\n  )  +\n  theme_bw(base_family = \"IBM Plex Sans\") +\n  theme(panel.grid.minor = element_blank())\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-17-1.png){width=100%}\n:::\n:::\n\n\n# Concluding Remarks\n\nRadar plots are a simple visualization to quickly understand the numeric values of several characteristics of a same entity. While these plots allow for only simple comparisons, this can actually be an advantage as it forces the analyst to seek for simple and meaningful comparisons.\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}