<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>Vinicius Oike</title>
<link>https:://www.restateinsight.com/blog.html</link>
<atom:link href="https:://www.restateinsight.com/blog.xml" rel="self" type="application/rss+xml"/>
<description>A blog on economics and cities</description>
<generator>quarto-1.3.450</generator>
<lastBuildDate>Thu, 19 Oct 2023 03:00:00 GMT</lastBuildDate>
<item>
  <title>Importando arquivos, visualizando linhas</title>
  <dc:creator>Vinicius Oike</dc:creator>
  <link>https:://www.restateinsight.com/posts/general-posts/2023-09-comandos-simples/index.html</link>
  <description><![CDATA[ 




<section id="o-problema" class="level1">
<h1>O problema</h1>
<p>Uma das minhas maiores dificuldades quando comecei a mexer com <code>R</code> era conseguir importar a minha base de dados. Em geral, eu tinha um ou vários arquivos <code>.csv</code> ou planilhas <code>.xlsx</code> que precisavam ser importador para o <code>R</code>. Eu tinha três dificuldades</p>
<ol type="1">
<li>Saber qual a função que eu precisava usar.</li>
<li>Escrever o caminho até o arquivo específico (qualquer errinho e já não funcionava!).</li>
<li>Calibrar os argumentos na hora de importar.</li>
</ol>
<p>Depois de muito esforço eu conseguia importar os dados, mas logo surgia ourto problema: o nome das variáveis vinha num formato muito ruim para trabalhar. No <code>R</code>, idealmente as variáveis são todas:</p>
<ol type="1">
<li>Minúsculas</li>
<li>Não tem acento nem caracteres especiais como <code>$</code>, <code>%</code>, etc.</li>
<li>Não tem espaços</li>
<li>Não começa com números</li>
</ol>
<p>Isso evita inúmeros problemas e facilita muito na hora de escrever o código.</p>
<p>Por fim, eu tinha bastante dificuldade de “enxergar os dados” mesmo depois de ter importado eles. No caso de uma planilha de Excel eu poderia simplesmente abrir ela e explorar um pouco. Já se a base de dados fosse em formato <code>dta</code> ou <code>sav</code> isso já não era tão simples, pois eu não tinha Stata e nem SPSS no meu computador.</p>
<p>Tudo isso me desanimava quando comecei a mexer com <code>R</code> e vejo que isso é um daqueles obstáculos idiotas que acabam segurando muita gente de fazer a transição para o <code>R</code>. É o tipo de problema (que parece) simples, mas que na verdade é difícil de resolver e que faz com que você se sinta burro e fique frustrado.</p>
<p>Neste post vou te dar algumas dicas de como lidar com todos estes passos. É o post que eu gostaria de poder enviar para mim mesmo no passado.</p>
</section>
<section id="a-solução-simples" class="level1">
<h1>A solução simples</h1>
<p>O roteiro de como melhorar a sua vida no <code>R</code>:</p>
<ol type="1">
<li>Importar usando <code>rio::import()</code></li>
<li>Escrever paths relativos usando <code>here::here()</code></li>
<li>Corrigir os nomes das colunas usando <code>janitor::clean_names()</code></li>
<li>Visualizar usando <code>View()</code>, <code>dplyr::glimpse()</code>, <code>skimr::skim()</code> ou <code>show_in_excel()</code> (ver abaixo)</li>
<li>Exportar usando <code>rio::export()</code></li>
</ol>
<p>Agora, vamos aos detalhes.</p>
</section>
<section id="importando-arquivos" class="level1">
<h1>Importando arquivos</h1>
<p>Lembrando os problemas de importar arquivos:</p>
<ol type="1">
<li>Saber qual a função usar.</li>
<li>Escrever o caminho até o arquivo específico (qualquer errinho dá erro!).</li>
<li>Calibrar os argumentos na hora de importar.</li>
<li>Às vezes é preciso importar vários arquivos de uma mesma pasta e juntá-los todos num único objeto.</li>
</ol>
<p>Este problema era tão chato de se resolver que eu acabava dependendo de uma facilidade do RStudio, que ajuda a importar uma base de dados, o botão Import Dataset. Eu fazia os comandos clicando e depois copiava o comando que aparecia no console no meu código.</p>
<p>Isto não era uma solução prática e eu queria a solução “correta”: queria escrever o código certo para importar os dados.</p>
<p>A solução para os problemas acima:</p>
<ol type="1">
<li>Aprender todas as funções para importar arquivos (leva tempo…)</li>
<li>Escrever <em>paths</em> relativos e usar a tecla <code>tab</code> dentro do RStudio (funciona com autocomplete!)</li>
<li>Aprender todas os argumentos das funções para importar arquivos (mais tempo ainda…).</li>
<li>Ver abaixo</li>
</ol>
<p>Ainda que no longo prazo acho que seja importante saber todas as funções, o propósito aqui é te ajudar um pouco então vamos com duas soluções.</p>
<section id="a-solução-correta" class="level2">
<h2 class="anchored" data-anchor-id="a-solução-correta">A solução correta</h2>
<p>A tabela abaixo resume as principais funções que você provavelmente vai ter que usar.</p>
<table class="table">
<colgroup>
<col style="width: 21%">
<col style="width: 31%">
<col style="width: 23%">
<col style="width: 23%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Formato</th>
<th style="text-align: center;">Extensao</th>
<th style="text-align: center;">Importar</th>
<th style="text-align: center;">Exportar</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Excel</td>
<td style="text-align: center;"><code>xls</code>, <code>xlsx</code></td>
<td style="text-align: center;"><code>readxl::read_excel()</code></td>
<td style="text-align: center;"><code>xlsx::write.xlsx()</code></td>
</tr>
<tr class="even">
<td style="text-align: center;">Separados</td>
<td style="text-align: center;"><code>csv</code>, <code>tsv</code>, <code>psv</code>, <code>csvy</code></td>
<td style="text-align: center;"><code>data.table::fread()</code></td>
<td style="text-align: center;"><code>data.table::fwrite()</code></td>
</tr>
<tr class="odd">
<td style="text-align: center;">Stata</td>
<td style="text-align: center;"><code>dta</code></td>
<td style="text-align: center;"><code>haven::read_dta()</code></td>
<td style="text-align: center;"><code>haven::write_dta()</code></td>
</tr>
<tr class="even">
<td style="text-align: center;">SPSS</td>
<td style="text-align: center;"><code>sav</code></td>
<td style="text-align: center;"><code>haven::read_sav()</code></td>
<td style="text-align: center;"><code>haven::write_sav()</code></td>
</tr>
<tr class="odd">
<td style="text-align: center;">Shapefiles</td>
<td style="text-align: center;"><code>shp</code>, <code>geosjon</code>, <code>gpkg</code>, etc.</td>
<td style="text-align: center;"><code>sf::st_read()</code></td>
<td style="text-align: center;"><code>sf::st_write()</code></td>
</tr>
</tbody>
</table>
<p>OBS: Caso não esteja familiarizado com esta sintaxe, aqui <code>readxl</code> é o nome do pacote, <code>read_excel()</code> é a funcão e o <code>::</code> indica que eu quero a função <code>read_excel</code> do pacote <code>readxl</code>. Em geral, é comum omitir a parte do <code>nomepacote::</code> porque acaba sendo desnecessário (exceto no caso de conflitos de funções que têm o mesmo nome).</p>
<section id="sobre-csvs" class="level3">
<h3 class="anchored" data-anchor-id="sobre-csvs">Sobre csvs</h3>
<p>Vale uma nota: existem várias alternativas para importar arquivos <code>csv</code>, várias alternativas mesmo. Eu recomendo evitar as funções base e usar as funções equivalentes do <code>readr</code>. Então, por exemplo, ao invés de usar <code>read.csv</code> use <code>readr::read_csv</code>. Esta é uma boa decisão por três motivos:</p>
<ol type="1">
<li>As funções do <code>readr</code> são consideravelmente mais rápidas e versáteis do que as funções base equivalentes.</li>
<li>As funções <code>read_*</code> compartilham uma sintaxe padronizada e costumam ter argumentos muito similares. Assim as funções do <code>readr</code> são muito parecidas com as funções do pacote <code>readxl</code> e <code>haven</code>. O combo <code>readr</code> + <code>readxl</code> + <code>haven</code> resolve o problema em 95% dos casos.</li>
<li>Todos estes pacotes e funções já estão bem integrados ao universo tidyverse<sup>1</sup>.</li>
</ol>
<p>Se velocidade começar a ser um problema, pode-se experimentar também com o pacote <code>vroom</code> que permite importar arquivos <code>csv</code> mais rapidamente. A função <code>vroom::vroom</code> também compartilha da sintaxe das funções <code>read_*</code>.</p>
<p>Um típico problema com arquivos <code>csv</code> é que os delimitadores e separadores variam de país para país. Arquivos <code>csv</code> de fontes brasileiras costumam ser separadas por <code>;</code> e usam a <code>,</code> como quebra de decimal, ao contrário dos <code>csv</code> de fontes dos EUA que usam a <code>,</code> como separador e <code>.</code> como quebra de decimal. Os arquivos no padrão EUA devem ser lidos com <code>read_csv</code> enquanto os arquivos no padrão brasileiro devem ser lidos com <code>read_csv2</code><sup>2</sup>.</p>
<p>Apesar de todas as vantagens listadas acima, ainda vale recomendar o <code>data.table::fread()</code><sup>3</sup> na hora de importar qualquer arquivo “separado” (<code>csv</code>, <code>tsv</code>, <code>psv</code>, etc.). Esta função é extremamente rápida, aloca os dados na memória de maneira eficiente e simplesmente funciona. Mesmo sem nenhum argumento adicional ela é muito boa na hora de adivinhar o tipo de separador utilizado e o tipo de dado em cada coluna.</p>
<p>Por fim, apesar de ter recomendado o <code>data.table::fwrite</code> na tabela acima, vale notar que funções como <code>readr::write_excel_csv2()</code> podem ser muito úteis caso seu objetivo seja exportar um csv que vai ser consumido por um usuário brasileiro numa planilha de Excel.</p>
</section>
<section id="mais-controle" class="level3">
<h3 class="anchored" data-anchor-id="mais-controle">Mais controle</h3>
<p>A prática faz a perfeição na hora de importar arquivos problemáticos. Como comentei acima, uma das vantagens de se ater ao combo <code>readr</code> + <code>readxl</code> + <code>haven</code> é que os argumentos adicionais destas funções seguem o mesmo padrão.</p>
<ul>
<li><p><code>skip = k</code>: Pula as primeiras k linhas.</p></li>
<li><p><code>na</code>: Define quais valores devem ser interpretados como valores ausentes.</p></li>
<li><p><code>col_types</code>: Permite que se declare explicitamente qual o tipo de dado (numérico, data, texto) que está armazenado em cada coluna.</p></li>
<li><p><code>col_names</code> ou <code>name_repair</code>: O primeiro permite que se declare explicitamente o nome que cada coluna vai ter dentro do <code>R</code> enquanto o segundo permite que se use uma função que renomeia as colunas.</p></li>
<li><p><code>locale</code>: Permite selecionar diferentes tipos de padrão de local. Em geral, usa-se <code>locale = locale("pt")</code>.</p></li>
<li><p><code>range</code>: Este argumento só vale no caso de planilhas de Excel e permite que se importe uma seleção específica da planilha (e.g.&nbsp;“D4:H115”)</p></li>
</ul>
<p>O código abaixo mostra como importar um csv bastante sujo. Veremos detalhes sobre a função <code>janitor::clean_names</code> mais adiante.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Input de um csv sujo</span></span>
<span id="cb1-2">dados <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb1-3"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Data; Valor (R$/m2)</span></span>
<span id="cb1-4"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"01-maio-2020";22,3</span></span>
<span id="cb1-5"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"01-junho-2020";21,5</span></span>
<span id="cb1-6"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"06-julho-2021";X</span></span>
<span id="cb1-7"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"07-novembro-2022";22'</span></span>
<span id="cb1-8"></span>
<span id="cb1-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Lendo o arquivo</span></span>
<span id="cb1-10">df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_delim</span>(</span>
<span id="cb1-11">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Substitua esta linha pelo 'path' até o csv</span></span>
<span id="cb1-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">I</span>(dados),</span>
<span id="cb1-13">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">delim =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">";"</span>,</span>
<span id="cb1-14">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Usa , como separador decimal; lê meses em português (e.g. maio, junho, etc.)</span></span>
<span id="cb1-15">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">locale =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">locale</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">decimal_mark =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">","</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">date_names =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pt"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">date_format =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%d-%B-%Y"</span>),</span>
<span id="cb1-16">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Interpreta X como valores ausentes (NA)</span></span>
<span id="cb1-17">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"X"</span>,</span>
<span id="cb1-18">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Renomeia as colunas</span></span>
<span id="cb1-19">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name_repair =</span> janitor<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>clean_names</span>
<span id="cb1-20">  )</span></code></pre></div>
</div>
</section>
</section>
<section id="importando-arquivos-o-atalho" class="level2">
<h2 class="anchored" data-anchor-id="importando-arquivos-o-atalho">Importando arquivos: o atalho</h2>
<p>Uma função muito prática que inicialmente contorna todos estes problemas é a <code>rio::import()</code>.</p>
<p>A função <code>rio::import()</code> simplesmente importa seus dados e funciona com boa parte das extensões mais populares. Na prática, ela é uma função “facilitadora”. Por baixo dos panos, ela está chamando a função correta para o caso específico.</p>
<p><a href="https://cran.r-project.org/web/packages/rio/vignettes/rio.html">Este site</a> mostra exatamente qual função de qual pacote ele utiliza para importar os dados. A lista é bem completa e inclui bases do Minitab, Matlab, EViews, etc. Spoiler: <code>data.table::fread()</code> é utilizada para importar arquivos <code>csv</code>, <code>psv</code> e <code>tsv</code>.</p>
<p>O par da função <code>rio::import</code> é a <code>rio::export</code> e serve justamente para exportar bases de dados do <code>R</code> para o formato desejado.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> rio<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">import</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data/meus_dados.dta"</span>)</span>
<span id="cb2-2"></span>
<span id="cb2-3">rio<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">export</span>(mtcars, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data/mtcars.csv"</span>)</span></code></pre></div>
</div>
<p>O único problema desta função é quando seus arquivos não estão num formato muito bacana e argumentos adicionais são necessários. É possível fornecer estes argumentos à função, mas é difícil saber quais são os argumentos, já que não se sabe qual função está sendo chamada. Assim, é preciso consultar a documentação (<code>?rio::import)</code> para verificar qual função está sendo utilizada e aí consultar a documentação desta função.</p>
</section>
<section id="escrevendo-paths-relativos-com-here" class="level2">
<h2 class="anchored" data-anchor-id="escrevendo-paths-relativos-com-here">Escrevendo paths relativos com here</h2>
<p>Um problema bem sério que eu enfrentava nos meus códigos era escrever o path até os arquivos externos. Primeiro, eu achava muito trabalhoso escrever ele inteiro. Depois, quando eu mandava meu código para outra pessoa, ou quando eu mesmo ia executar o meu código em outro computador, nada funcionava!</p>
<p>O primeiro passo para lidar com isso é trabalhar com projetos do RStudio. O melhor workflow é sempre começar seu trabalho num projeto novo e deixar todos os arquivos necessários neste mesmo diretório. Isso facilita na hora de escrever paths relativos.</p>
<p>Paths relativos, ao contrário de paths absolutos, começam no seu diretório da seguinte forma: <code>"data/subpasta/meus_dados.xlsx"</code>.</p>
<p>É bem diferente de um path absoluto: <code>/Users/nome_do_usuario/Documentos/meus_projetos/Projeto 1/data/subpasta/meus_dados.xlsx</code>.</p>
<p>Usar paths absolutos no seu código é garantir que a única pessoa que conseguirá reproduzir ele com sucesso será você, e unicamente no computador em que você escreveu ele (isso se você não formatar ele!).</p>
<p>Aqui entra o pacote <code>here</code>, um pacotinho muito simples, centrado em uma única função homônima.</p>
<p>A função <code>here</code> funciona de duas maneiras bastante simples</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(here)</span>
<span id="cb3-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(haven)</span>
<span id="cb3-3"></span>
<span id="cb3-4">meus_dados <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_dta</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">here</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data/subpasta/minha_base.dta"</span>))</span>
<span id="cb3-5">meus_dados <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_dta</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">here</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"subpasta"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"minha_base.dta"</span>))</span></code></pre></div>
</div>
<p>A segunda forma de sintaxe é muito útil na hora de criar paths. Isto será muito conveniente depois, quando formos importar vários arquivos de uma mesma pasta.</p>
<p>A seguinte ilustração que serve de capa do projeto do <code>here</code> resume muito bem a sua utilidade.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="https:://www.restateinsight.com/static/images/here.png" class="img-fluid" width="1386"></p>
</div>
</div>
<p>Existe um mal hábito dissemeniado de incluir uma linha com <code>setwd("insira_seu_diretorio")</code> no início de todo código. Eu garanto que todo tipo de problema imaginável e inimaginável acontece com pessoas que fazem isso.</p>
<p>O <code>here</code> simplesmente funciona e funciona com tudo. Ele é especialmente útil na hora de escrever scripts em RMarkdown e Quarto. O pacote <code>here</code> é talvez o único que esteja presente em todos os meus projetos e em todos os meus códigos.</p>
<p>Outra dica boa para manter seus projetos organizados é de evitar colocar espaços ou caracteres especiais no nome das suas pastas. Em geral, o <code>R</code> consegue lidar bem com isso, mas volta e meia este mau hábito pode gerar problemas inesperados.</p>
</section>
<section id="importando-todos-os-arquivos-de-uma-pasta" class="level2">
<h2 class="anchored" data-anchor-id="importando-todos-os-arquivos-de-uma-pasta">Importando todos os arquivos de uma pasta</h2>
<p>Este é um problema bastante recorrente e que é fácil de resolver usando <code>here</code> e funções base.</p>
<p>Imagine que você tem vários arquivos <code>.csv</code> numa pasta e os arquivos estão na seguinte estrutura: <code>Dados/inflacao/2012/</code> e aí cada <code>csv</code> individual é um arquivo mensal (com nomes potencialmente fora de padrão) com os dados de inflação mensal por produto. Algo como <code>2012_jan.csv</code>, <code>2012fevereiro.csv</code>, etc.</p>
<p>A estrutura do código para importar tudo isso no <code>R</code> é bastante simples.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(here)</span>
<span id="cb4-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Define o diretório</span></span>
<span id="cb4-3">dir <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">here</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dados/inflacao/2012"</span>)</span>
<span id="cb4-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Encontra o nome de todos os arquivos com extensão csv nesta pasta</span></span>
<span id="cb4-5">filenames <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list.files</span>(dir, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pattern =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">.csv$"</span>)</span>
<span id="cb4-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Define o path até cada um dos arquivos</span></span>
<span id="cb4-7">pathfiles <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">here</span>(dir, filenames)</span>
<span id="cb4-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Importa todos os csv usando fread</span></span>
<span id="cb4-9">data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lapply</span>(pathfiles, data.table<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>fread)</span>
<span id="cb4-10"></span>
<span id="cb4-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Opcionalmente, empilha todos os resultados e cria uma coluna que identifica</span></span>
<span id="cb4-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># de qual o arquivo a observação pertence</span></span>
<span id="cb4-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(data) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">basename</span>(pathfiles)</span>
<span id="cb4-14">empilhado <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data.table<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbindlist</span>(data, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">idcol =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"nome_arquivo"</span>)</span></code></pre></div>
</div>
<p>Uma maneira ainda mais sucinta de escrever o código seria omitindo os objetos intermediários e simplesmente empilhando o resultado final. Note que, para que as bases de dados sejam empilhadas é necessário que o nome e o tipo das colunas seja compatível. Isto pode ser melhor controlado declarando o tipo das colunas na função <code>fread</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Define o path até cada um dos arquivos</span></span>
<span id="cb5-2">pathfiles <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list.files</span>(</span>
<span id="cb5-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">here</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dados/inflacao/2012"</span>),</span>
<span id="cb5-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pattern =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">.csv$"</span>,</span>
<span id="cb5-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">full.names =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span></span>
<span id="cb5-6">  )</span>
<span id="cb5-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Importa todos os csv usando fread</span></span>
<span id="cb5-8">files <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lapply</span>(pathfiles, data.table<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>fread)</span>
<span id="cb5-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Empilha todos os resultados</span></span>
<span id="cb5-10">dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data.table<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbindlist</span>(files)</span></code></pre></div>
</div>
</section>
</section>
<section id="corrigindo-nomes-de-variáveis" class="level1">
<h1>Corrigindo nomes de variáveis</h1>
<p>O nome das colunas da nossa base de dados é muito importante, pois no <code>R</code> acabamos usando elas com muita frequência. Tanto para quem usa <code>data.table</code> como para os adeptos do <code>tidyverse</code>, o nome das colunas, na prática, acaba sendo usando como um objeto dentro das funções, então é importante que esse nome seja fácil de digitar.</p>
<p>Lembrando que, idealmente, os nomes das colunas e também dos objetos que criamos devem ser:</p>
<ol type="1">
<li>Minúsculos</li>
<li>Sem acento e nem caracteres especiais como <code>$</code>, <code>%</code>, etc.</li>
<li>Sem espaços</li>
<li>Sem números no começo</li>
</ol>
<p>Outro ponto, um pouco óbvio, é que há nomes que devemos evitar na hora de nomear nossas colunas como: <code>FALSE</code>, <code>if</code>, <code>TRUE</code>, <code>for</code>, <code>Inf</code>, etc<sup>4</sup>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Bons nomes</span></span>
<span id="cb6-2">nm <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"inflacao"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pib"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cambio"</span>)</span>
<span id="cb6-3">nm <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"inflacao_percentual"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pib_reais_correntes"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cambio_mensal"</span>)</span>
<span id="cb6-4"></span>
<span id="cb6-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Nomes ruins</span></span>
<span id="cb6-6">nmRuIm <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Inflação (%)"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Produto Interno Bruto (R$)"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Câmbio (Mensal)"</span>)</span>
<span id="cb6-7">nmRuIm <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"INFLAÇÃO"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PIB"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CÂMBIO (MÊS)"</span>)</span></code></pre></div>
</div>
<p>A função <code>janitor::clean_names()</code> segue os princípios elencados acima e pode ser aplicada diretamente num <code>data.frame</code>. O resultado é uma base com nomes “limpos”. Considere o exemplo abaixo de um arquivo csv com nomes muito ruins.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">csv <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb7-2"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">AnoMesDia;Inflação (%);Produto Interno Bruto;DESEMPREGO</span></span>
<span id="cb7-3"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">2023-01-01;0.055;0.75;0.1132</span></span>
<span id="cb7-4"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">2023-04-01;0.045;0.50;0.1051</span></span>
<span id="cb7-5"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">2023-07-01;0.065;0.68;0.1000</span></span>
<span id="cb7-6"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">2023-10-01;0.050;1.12;0.9512</span></span>
<span id="cb7-7"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb7-8"></span>
<span id="cb7-9">data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data.table<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fread</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">I</span>(csv))</span>
<span id="cb7-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(data)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    AnoMesDia Inflação (%) Produto Interno Bruto DESEMPREGO
1: 2023-01-01        0.055                  0.75     0.1132
2: 2023-04-01        0.045                  0.50     0.1051
3: 2023-07-01        0.065                  0.68     0.1000
4: 2023-10-01        0.050                  1.12     0.9512</code></pre>
</div>
</div>
<p>Note que selecionar uma coluna se torna bem inconveniente e somos forçados a cercar o nome com esse <em>apostrophe</em>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Inflação (%)</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.055 0.045 0.065 0.050</code></pre>
</div>
</div>
<p>Normalmente, seria necessário usar uma série de funções para, primeiro remover os acentos, depois tirar os parêntesis, depois converter os caracteres para minúsculos e aí substituir os espaços por subscrito.</p>
<p>A função <code>janitor::clean_names</code> faz tudo isso numa única linha de código. Além disso, como o argumento da função é um <code>data.frame</code>, ela pode ser usada diretamente no início do seu pipe</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1">clean_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> janitor<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">clean_names</span>(data)</span>
<span id="cb11-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(clean_data)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   ano_mes_dia inflacao_percent produto_interno_bruto desemprego
1:  2023-01-01            0.055                  0.75     0.1132
2:  2023-04-01            0.045                  0.50     0.1051
3:  2023-07-01            0.065                  0.68     0.1000
4:  2023-10-01            0.050                  1.12     0.9512</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb13-2"></span>
<span id="cb13-3">data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb13-4">  janitor<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">clean_names</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb13-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(inflacao_percent <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.06</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   ano_mes_dia inflacao_percent produto_interno_bruto desemprego
1:  2023-01-01            0.055                  0.75     0.1132
2:  2023-04-01            0.045                  0.50     0.1051
3:  2023-10-01            0.050                  1.12     0.9512</code></pre>
</div>
</div>
</section>
<section id="enxergando-os-dados" class="level1">
<h1>Enxergando os dados</h1>
<p>Por fim, vamos discutir rapidamente algumas formas de rapidamente olhar seus dados. Aqui, temos várias opções. A maneira mais simples seria usar a função <code>head()</code> que mostra as primeiras dez linhas da base de dados. Se a base não for muito grande, podemos usar a função <code>View()</code>. Quando usada dentro do RStudio funciona quase como um Excel, permite enxergar todas as linhas, ordenar por colunas, etc.</p>
<p>Há pacotes que oferecem soluções simples para enxergar rapidamente uma base de dados. Da mais simples para a mais complexa, temos: <code>dplyr::glimpse()</code>, <code>summarytools::descr()</code> e <code>skmir::skim()</code></p>
<p>Abaixo mostro a saída dessas três funções na base de dados <code>iris</code>. A primeira saída é bastante simples, mostra a dimensão da base (número de linhas e colunas), o nome e o tipo das colunas, e as primeiras linhas de cada coluna.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1">dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glimpse</span>(iris)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 150
Columns: 5
$ Sepal.Length &lt;dbl&gt; 5.1, 4.9, 4.7, 4.6, 5.0, 5.4, 4.6, 5.0, 4.4, 4.9, 5.4, 4.…
$ Sepal.Width  &lt;dbl&gt; 3.5, 3.0, 3.2, 3.1, 3.6, 3.9, 3.4, 3.4, 2.9, 3.1, 3.7, 3.…
$ Petal.Length &lt;dbl&gt; 1.4, 1.4, 1.3, 1.5, 1.4, 1.7, 1.4, 1.5, 1.4, 1.5, 1.5, 1.…
$ Petal.Width  &lt;dbl&gt; 0.2, 0.2, 0.2, 0.2, 0.2, 0.4, 0.3, 0.2, 0.2, 0.1, 0.2, 0.…
$ Species      &lt;fct&gt; setosa, setosa, setosa, setosa, setosa, setosa, setosa, s…</code></pre>
</div>
</div>
<p>A função <code>summarytools::descr</code> traz várias estatísticas descritivas (ignorando colunas não-numéricas). Cada um destes valores traz bastante informação, mas sua interpretação depende também de conhecimento técnico. Essencialmente, a saída traz algumas medidas de “tendência central” (média, mediana), dispersão (desvio padrão, MAD, IQR), assimetria e curtose. As últimas duas linhas também informam sobre a presença de observações ausentes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1">summarytools<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">descr</span>(iris)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Non-numerical variable(s) ignored: Species</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Descriptive Statistics  
iris  
N: 150  

                    Petal.Length   Petal.Width   Sepal.Length   Sepal.Width
----------------- -------------- ------------- -------------- -------------
             Mean           3.76          1.20           5.84          3.06
          Std.Dev           1.77          0.76           0.83          0.44
              Min           1.00          0.10           4.30          2.00
               Q1           1.60          0.30           5.10          2.80
           Median           4.35          1.30           5.80          3.00
               Q3           5.10          1.80           6.40          3.30
              Max           6.90          2.50           7.90          4.40
              MAD           1.85          1.04           1.04          0.44
              IQR           3.50          1.50           1.30          0.50
               CV           0.47          0.64           0.14          0.14
         Skewness          -0.27         -0.10           0.31          0.31
      SE.Skewness           0.20          0.20           0.20          0.20
         Kurtosis          -1.42         -1.36          -0.61          0.14
          N.Valid         150.00        150.00         150.00        150.00
        Pct.Valid         100.00        100.00         100.00        100.00</code></pre>
</div>
</div>
<p>Por fim, a saída da função <code>skimr::skim</code> é a mais completa e inclui até mini gráficos de histogramas das variáveis numéricas. Vale notar que, diferentemente da <code>descr</code> acima, esta função traz informações também sobre as colunas não numéricas</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1">skimr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">skim</span>(iris)</span></code></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>Data summary</caption>
<tbody>
<tr class="odd">
<td style="text-align: left;">Name</td>
<td style="text-align: left;">iris</td>
</tr>
<tr class="even">
<td style="text-align: left;">Number of rows</td>
<td style="text-align: left;">150</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Number of columns</td>
<td style="text-align: left;">5</td>
</tr>
<tr class="even">
<td style="text-align: left;">_______________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Column type frequency:</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">factor</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">4</td>
</tr>
<tr class="even">
<td style="text-align: left;">________________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Group variables</td>
<td style="text-align: left;">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: factor</strong></p>
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 17%">
<col style="width: 12%">
<col style="width: 17%">
<col style="width: 9%">
<col style="width: 11%">
<col style="width: 32%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: left;">ordered</th>
<th style="text-align: right;">n_unique</th>
<th style="text-align: left;">top_counts</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Species</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">set: 50, ver: 50, vir: 50</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 18%">
<col style="width: 13%">
<col style="width: 18%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 6%">
<col style="width: 5%">
<col style="width: 6%">
<col style="width: 7%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">p0</th>
<th style="text-align: right;">p25</th>
<th style="text-align: right;">p50</th>
<th style="text-align: right;">p75</th>
<th style="text-align: right;">p100</th>
<th style="text-align: left;">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Sepal.Length</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5.84</td>
<td style="text-align: right;">0.83</td>
<td style="text-align: right;">4.3</td>
<td style="text-align: right;">5.1</td>
<td style="text-align: right;">5.80</td>
<td style="text-align: right;">6.4</td>
<td style="text-align: right;">7.9</td>
<td style="text-align: left;">▆▇▇▅▂</td>
</tr>
<tr class="even">
<td style="text-align: left;">Sepal.Width</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.06</td>
<td style="text-align: right;">0.44</td>
<td style="text-align: right;">2.0</td>
<td style="text-align: right;">2.8</td>
<td style="text-align: right;">3.00</td>
<td style="text-align: right;">3.3</td>
<td style="text-align: right;">4.4</td>
<td style="text-align: left;">▁▆▇▂▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Petal.Length</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.76</td>
<td style="text-align: right;">1.77</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">1.6</td>
<td style="text-align: right;">4.35</td>
<td style="text-align: right;">5.1</td>
<td style="text-align: right;">6.9</td>
<td style="text-align: left;">▇▁▆▇▂</td>
</tr>
<tr class="even">
<td style="text-align: left;">Petal.Width</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1.20</td>
<td style="text-align: right;">0.76</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: right;">0.3</td>
<td style="text-align: right;">1.30</td>
<td style="text-align: right;">1.8</td>
<td style="text-align: right;">2.5</td>
<td style="text-align: left;">▇▁▇▅▃</td>
</tr>
</tbody>
</table>
</div>
</div>
<section id="olhando-seus-dados-no-excel" class="level2">
<h2 class="anchored" data-anchor-id="olhando-seus-dados-no-excel">Olhando seus dados no Excel</h2>
<p>Por fim, vou deixar uma função customizada bem divertida, que permite você rapidamente dar uma espiada nos seus dados no bom e velho Excel. A função abaixo cria um arquivo temporário a partir da sua base de dados no <code>R</code> e abre isso no Excel.</p>
<p>Evidentemente, é preciso ter o Excel instalado para que o código funcione.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1">show_in_excel <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(.data) {</span>
<span id="cb21-2">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">interactive</span>()) {</span>
<span id="cb21-3">    tmp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tempfile</span>(), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".xlsx"</span>)</span>
<span id="cb21-4">    writexl<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write_xlsx</span>(.data, tmp)</span>
<span id="cb21-5">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">browseURL</span>(tmp)</span>
<span id="cb21-6">  }</span>
<span id="cb21-7">  .data</span>
<span id="cb21-8">}</span>
<span id="cb21-9"></span>
<span id="cb21-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">show_in_excel</span>(mtcars)</span></code></pre></div>
</div>
<p>A figura abaixo mostra o resultado do código</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/static/images/excel.png" class="img-fluid figure-img" width="402"></p>
</figure>
</div>
</div>
</div>
<p>Novamente, como a função aceita um <code>data.frame</code> como argumento é bem fácil de colocá-la no final de um pipe. Esta função é bastante útil quando você precisa rapidamente compartilhar algum resultado ou tabela com alguém.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1">mtcars <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb22-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(cyl <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb22-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(cyl) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb22-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">peso_medio =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(wt)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb22-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">show_in_excel</span>()</span></code></pre></div>
</div>
</section>
</section>
<section id="resumo" class="level1">
<h1>Resumo</h1>
<p>Concluindo, toda boa análise de dados passa por tarefas de rotina: importar dados, trocar nomes de colunas, remover observações vazias, etc. Por que não facilitar a sua vida e tornar essas tarefas simples?</p>
<p>Pessoalmente, quase todo código que escrevo utiliza <code>here</code> e <code>janitor::clean_names()</code>. Depois de muito sofirmento, aprendi quase todas as funções de importar e exportar, e só depois disso descobri o <code>rio::import</code> que teria me poupado muito estresse. Como comentei acima o <code>rio::import</code> é um atalho simples, mas no longo prazo vale a pena aprender com calma todas as funções <code>read_*</code>.</p>
<p>Uso com frequência o <code>View()</code> no final de um pipe para checar se as coisas estão indo da maneira esperada. E também comecei a criar o hábito de começar a minha exploração de dados com o <code>skim()</code>.</p>
<p>No fim, este post mostra como organizar seus arquivos, como importar seus dados e como “dar uma checada” para ver se está tudo certo: nomes e tipos de colunas; e também como fazer ajustes rápidos nos dados.</p>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Para saber mais sobre o tidyverse consulte o meu <a href="https://restateinsight.com/posts/general-posts/2023-09-tidyverse/">post sobre A Filosofia do Tidyverse</a>.↩︎</p></li>
<li id="fn2"><p>Alternativamente, pode-se usar a função <code>read_delim</code>, que é mais geral e permite especificar quais símbolos são usados como delimitador e separador de números.↩︎</p></li>
<li id="fn3"><p>Disclaimer importante: depois de revisar este texto eu já não recomendo tão fortemente o <code>data.table::fread</code> por um movito bobo e simples. Atualmente, o <code>data.table</code> tem uma classe própria para datas chamada <code>IDate</code>. Esta classe é útil se você pretende fazer todas as suas análises usando as funções do <code>data.table</code> como <code>shift</code>, <code>hour</code>, etc. Contudo, se você pretende usar outros pacotes comuns de séries de tempo será necessário converter para <code>Date</code> todas as vezes. Além disso, como eu já estou bastante habituado a usar o pacote <code>lubridate</code> para manipular datas, não vejo muita vantagem em utilizar as funções do <code>data.table</code>.↩︎</p></li>
<li id="fn4"><p>Estas palavras são “nomes reservados” dentro do <code>R</code> e jamais devem ser utilizados na hora de definir um objeto ou o nome de uma coluna. Para consultar a lista de nomes reservados, veja <code>help("Reserved")</code>.↩︎</p></li>
</ol>
</section></div> ]]></description>
  <category>tutorial-R</category>
  <category>data-science</category>
  <guid>https:://www.restateinsight.com/posts/general-posts/2023-09-comandos-simples/index.html</guid>
  <pubDate>Thu, 19 Oct 2023 03:00:00 GMT</pubDate>
</item>
<item>
  <title>Cidades Brasil</title>
  <dc:creator>Vinicius Oike</dc:creator>
  <link>https:://www.restateinsight.com/posts/general-posts/2023-10-mapas-altitude/index.html</link>
  <description><![CDATA[ 




<section id="o-objetivo" class="level1">
<h1>O objetivo</h1>
<p>O objetivo deste post é conseguir gerar o gráfico abaixo com uma única linha de código. Isto será possível, pois todo o processamento dos dados será feito por funções auxiliares. A inspiração do mapa vem diretamente de <a href="https://www.blakerobertmills.com/my-work/visualizations">BlakeRMills</a>, criador do pacote <a href="https://github.com/BlakeRMills/MetBrewer">{MetBrewer}</a>.</p>
<p>Abaixo segue a lista de todos os pacotes utilizados neste post. Não é necessário chamar todos eles com <code>library</code> mas é preciso ter todos eles instalados<sup>1</sup>. Com exceção dos três primeiros, usaremos somente uma ou duas funções de cada um dos pacotes.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Principais pacotes</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(sf)</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(osmdata)</span>
<span id="cb1-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(elevatr)</span>
<span id="cb1-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(raster)</span>
<span id="cb1-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(geobr)</span>
<span id="cb1-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Pacotes auxiliares</span></span>
<span id="cb1-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(purrr)</span>
<span id="cb1-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(furrr)</span>
<span id="cb1-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(rvest)</span>
<span id="cb1-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(xml2)</span>
<span id="cb1-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(BAMMtools)</span>
<span id="cb1-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(stringr)</span>
<span id="cb1-16"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(janitor)</span>
<span id="cb1-17"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggthemes)</span>
<span id="cb1-18"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(viridis)</span>
<span id="cb1-19"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(showtext)</span></code></pre></div>
</div>
</section>
<section id="recife" class="level1">
<h1>Recife</h1>
<p>Para ganhar intuição sobre o processo vamos fazer o passo a passo de Recife. Escolho a cidade de Recife, pois ela é uma cidade relativamente pequena em termos de área física.</p>
<section id="baixando-os-dados" class="level2">
<h2 class="anchored" data-anchor-id="baixando-os-dados">Baixando os dados</h2>
<p>O objetivo é gerar o mapa de altitude das principais cidades do Brasil. Ao invés de ranquear as cidades por área, eu prefiro ordená-las por tamanho de população. Uma maneira fácil de conseguir esta informação é buscando ela diretamente na Wikipedia. No link temos uma tabela com código do IBGE, nome do município, nome do estado e população total em 2022.</p>
<p>É bastante simples importar esta tabela no R. O código abaixo, interpreta a página com base na url, encontra todas as tabelas<sup>2</sup> e escolhe especificamente a tabela principal.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">url <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://pt.wikipedia.org/wiki/Lista_de_municípios_do_Brasil_por_população"</span></span>
<span id="cb2-2"></span>
<span id="cb2-3">tab <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> xml2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_html</span>(url) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb2-4">  rvest<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">html_table</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb2-5">  purrr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pluck</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb2-6"></span>
<span id="cb2-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(tab)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
  Posição `Código IBGE` Município      `Unidade federativa` População 
  &lt;chr&gt;   &lt;chr&gt;         &lt;chr&gt;          &lt;chr&gt;                &lt;chr&gt;     
1 1º      3550308       São Paulo      São Paulo            11&nbsp;451&nbsp;245
2 2º      3304557       Rio de Janeiro Rio de Janeiro       6&nbsp;211&nbsp;423 
3 3º      5300108       Brasília       Distrito Federal     2&nbsp;817&nbsp;068 
4 4º      2304400       Fortaleza      Ceará                2&nbsp;428&nbsp;678 
5 5º      2927408       Salvador       Bahia                2&nbsp;418&nbsp;005 
6 6º      3106200       Belo Horizonte Minas Gerais         2&nbsp;315&nbsp;560 </code></pre>
</div>
</div>
<p>Este dado está um pouco sujo então eu limpo a tabela para facilitar nosso trabalho. Após limpar os dados, eu seleciono as 200 cidades mais populosas.</p>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">as_numeric_char <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Vectorize</span>(<span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) {</span>
<span id="cb4-2">  ls <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> stringr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_extract_all</span>(x, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"[[:digit:]]"</span>)</span>
<span id="cb4-3">  y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(ls[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">collapse =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span>
<span id="cb4-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(y)</span>
<span id="cb4-5">})</span>
<span id="cb4-6"></span>
<span id="cb4-7">clean_tab <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> tab <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb4-8">  janitor<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">clean_names</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb4-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename</span>(</span>
<span id="cb4-10">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">code_muni =</span> codigo_ibge,</span>
<span id="cb4-11">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name_muni =</span> municipio,</span>
<span id="cb4-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rank =</span> posicao,</span>
<span id="cb4-13">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name_state =</span> unidade_federativa,</span>
<span id="cb4-14">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pop =</span> populacao</span>
<span id="cb4-15">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb4-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(name_muni <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Brasil"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb4-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb4-18">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">code_muni =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(code_muni),</span>
<span id="cb4-19">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pop =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as_numeric_char</span>(pop),</span>
<span id="cb4-20">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rank =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rank</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>pop),</span>
<span id="cb4-21">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name_muni =</span> stringr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_to_title</span>(name_muni)</span>
<span id="cb4-22">  )</span>
<span id="cb4-23"></span>
<span id="cb4-24">top200 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">slice_max</span>(clean_tab, pop, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>)</span></code></pre></div>
</details>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">

<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-ab21fed1cce348ef14ee" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-ab21fed1cce348ef14ee">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","171","172","173","174","175","176","177","178","179","180","181","182","183","184","185","186","187","188","189","190","191","192","193","194","195","196","197","198","199","200"],[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200],[3550308,3304557,5300108,2304400,2927408,3106200,1302603,4106902,2611606,5208707,4314902,1501402,3518800,3509502,2111300,2704302,5002704,3304904,2211001,2507507,3548708,3301702,3303500,2408102,3547809,3534401,3552205,3170206,3543402,3549904,5103403,2607901,3118601,4209102,2910800,2800308,4113700,3136702,4205407,5201405,3205002,3301009,3300456,3303302,3549805,1500800,3205200,4305108,1100205,3530607,3525904,1600303,3305109,3538709,2504009,3548500,3529401,3143302,1400100,3106705,4115200,5201108,3513801,3510609,2611101,3506003,2604106,2933307,3523107,1200401,4202404,4119905,2303709,3201308,3516200,2609600,3541000,4104808,4304606,2610707,3170107,1506807,3551009,3154606,4125506,4314407,3205309,3505708,3554102,3552502,1721000,2905701,5108402,3526902,3518701,2307304,4108304,3552403,3303906,4316907,3513009,3552809,2105302,4216602,1504208,1505536,4309209,2408003,4208203,3306305,3127701,3520509,3548906,4204202,2403251,3515004,3302403,5107602,2111201,5003702,3503208,3524402,3529005,3501608,3519071,2918407,2700300,2307650,3522505,4105805,3122306,3302502,4313409,3131307,3167202,3541406,5218805,5200258,3301900,4323002,4211900,3300704,3157807,4318705,4204608,5212501,4314100,2919207,2602902,2312908,3543907,3502804,5221858,3302700,5107909,2804805,1502400,4315602,3303401,4300604,2914802,3201209,3545803,4208906,4109401,3515707,2913606,3507605,2112209,1702109,3129806,3300407,3523909,2925303,3300100,3302858,3203205,3548807,3538006,3516309,3305802,4209300,3151800,2207702,2903201,3148004,2918001,3504107,3522208,1500107,3522307,2103000,3304524,5220454,3547304,3530706,3152501,4101804,2900702,4127700],["São Paulo","Rio De Janeiro","Brasília","Fortaleza","Salvador","Belo Horizonte","Manaus","Curitiba","Recife","Goiânia","Porto Alegre","Belém","Guarulhos","Campinas","São Luís","Maceió","Campo Grande","São Gonçalo","Teresina","João Pessoa","São Bernardo Do Campo","Duque De Caxias","Nova Iguaçu","Natal","Santo André","Osasco","Sorocaba","Uberlândia","Ribeirão Preto","São José Dos Campos","Cuiabá","Jaboatão Dos Guararapes","Contagem","Joinville","Feira De Santana","Aracaju","Londrina","Juiz De Fora","Florianópolis","Aparecida De Goiânia","Serra","Campos Dos Goytacazes","Belford Roxo","Niterói","São José Do Rio Preto","Ananindeua","Vila Velha","Caxias Do Sul","Porto Velho","Mogi Das Cruzes","Jundiaí","Macapá","São João De Meriti","Piracicaba","Campina Grande","Santos","Mauá","Montes Claros","Boa Vista","Betim","Maringá","Anápolis","Diadema","Carapicuíba","Petrolina","Bauru","Caruaru","Vitória Da Conquista","Itaquaquecetuba","Rio Branco","Blumenau","Ponta Grossa","Caucaia","Cariacica","Franca","Olinda","Praia Grande","Cascavel","Canoas","Paulista","Uberaba","Santarém","São Vicente","Ribeirão Das Neves","São José Dos Pinhais","Pelotas","Vitória","Barueri","Taubaté","Suzano","Palmas","Camaçari","Várzea Grande","Limeira","Guarujá","Juazeiro Do Norte","Foz Do Iguaçu","Sumaré","Petrópolis","Santa Maria","Cotia","Taboão Da Serra","Imperatriz","São José","Marabá","Parauapebas","Gravataí","Mossoró","Itajaí","Volta Redonda","Governador Valadares","Indaiatuba","São Carlos","Chapecó","Parnamirim","Embu Das Artes","Macaé","Rondonópolis","São José De Ribamar","Dourados","Araraquara","Jacareí","Marília","Americana","Hortolândia","Juazeiro","Arapiraca","Maracanaú","Itapevi","Colombo","Divinópolis","Magé","Novo Hamburgo","Ipatinga","Sete Lagoas","Presidente Prudente","Rio Verde","Águas Lindas De Goiás","Itaboraí","Viamão","Palhoça","Cabo Frio","Santa Luzia","São Leopoldo","Criciúma","Luziânia","Passo Fundo","Lauro De Freitas","Cabo De Santo Agostinho","Sobral","Rio Claro","Araçatuba","Valparaíso De Goiás","Maricá","Sinop","Nossa Senhora Do Socorro","Castanhal","Rio Grande","Nova Friburgo","Alvorada","Itabuna","Cachoeiro De Itapemirim","Santa Bárbara D'oeste","Jaraguá Do Sul","Guarapuava","Ferraz De Vasconcelos","Ilhéus","Bragança Paulista","Timon","Araguaína","Ibirité","Barra Mansa","Itu","Porto Seguro","Angra Dos Reis","Mesquita","Linhares","São Caetano Do Sul","Pindamonhangaba","Francisco Morato","Teresópolis","Lages","Poços De Caldas","Parnaíba","Barreiras","Patos De Minas","Jequié","Atibaia","Itapecerica Da Serra","Abaetetuba","Itapetininga","Caxias","Rio Das Ostras","Senador Canedo","Santana De Parnaíba","Mogi Guaçu","Pouso Alegre","Araucária","Alagoinhas","Toledo"],["São Paulo","Rio de Janeiro","Distrito Federal","Ceará","Bahia","Minas Gerais","Amazonas","Paraná","Pernambuco","Goiás","Rio Grande do Sul","Pará","São Paulo","São Paulo","Maranhão","Alagoas","Mato Grosso do Sul","Rio de Janeiro","Piauí","Paraíba","São Paulo","Rio de Janeiro","Rio de Janeiro","Rio Grande do Norte","São Paulo","São Paulo","São Paulo","Minas Gerais","São Paulo","São Paulo","Mato Grosso","Pernambuco","Minas Gerais","Santa Catarina","Bahia","Sergipe","Paraná","Minas Gerais","Santa Catarina","Goiás","Espírito Santo","Rio de Janeiro","Rio de Janeiro","Rio de Janeiro","São Paulo","Pará","Espírito Santo","Rio Grande do Sul","Rondônia","São Paulo","São Paulo","Amapá","Rio de Janeiro","São Paulo","Paraíba","São Paulo","São Paulo","Minas Gerais","Roraima","Minas Gerais","Paraná","Goiás","São Paulo","São Paulo","Pernambuco","São Paulo","Pernambuco","Bahia","São Paulo","Acre","Santa Catarina","Paraná","Ceará","Espírito Santo","São Paulo","Pernambuco","São Paulo","Paraná","Rio Grande do Sul","Pernambuco","Minas Gerais","Pará","São Paulo","Minas Gerais","Paraná","Rio Grande do Sul","Espírito Santo","São Paulo","São Paulo","São Paulo","Tocantins","Bahia","Mato Grosso","São Paulo","São Paulo","Ceará","Paraná","São Paulo","Rio de Janeiro","Rio Grande do Sul","São Paulo","São Paulo","Maranhão","Santa Catarina","Pará","Pará","Rio Grande do Sul","Rio Grande do Norte","Santa Catarina","Rio de Janeiro","Minas Gerais","São Paulo","São Paulo","Santa Catarina","Rio Grande do Norte","São Paulo","Rio de Janeiro","Mato Grosso","Maranhão","Mato Grosso do Sul","São Paulo","São Paulo","São Paulo","São Paulo","São Paulo","Bahia","Alagoas","Ceará","São Paulo","Paraná","Minas Gerais","Rio de Janeiro","Rio Grande do Sul","Minas Gerais","Minas Gerais","São Paulo","Goiás","Goiás","Rio de Janeiro","Rio Grande do Sul","Santa Catarina","Rio de Janeiro","Minas Gerais","Rio Grande do Sul","Santa Catarina","Goiás","Rio Grande do Sul","Bahia","Pernambuco","Ceará","São Paulo","São Paulo","Goiás","Rio de Janeiro","Mato Grosso","Sergipe","Pará","Rio Grande do Sul","Rio de Janeiro","Rio Grande do Sul","Bahia","Espírito Santo","São Paulo","Santa Catarina","Paraná","São Paulo","Bahia","São Paulo","Maranhão","Tocantins","Minas Gerais","Rio de Janeiro","São Paulo","Bahia","Rio de Janeiro","Rio de Janeiro","Espírito Santo","São Paulo","São Paulo","São Paulo","Rio de Janeiro","Santa Catarina","Minas Gerais","Piauí","Bahia","Minas Gerais","Bahia","São Paulo","São Paulo","Pará","São Paulo","Maranhão","Rio de Janeiro","Goiás","São Paulo","São Paulo","Minas Gerais","Paraná","Bahia","Paraná"],[11451245,6211423,2817068,2428678,2418005,2315560,2063547,1773733,1488920,1437237,1332570,1303309,1291784,1138309,1037775,957916,897938,896744,866300,833932,810729,808252,785882,751300,748919,743432,723574,713232,698259,697428,650912,643759,621865,616323,616279,602757,555937,540756,537213,527550,520649,483551,483087,481758,480439,478778,467722,463338,460413,449955,443116,442933,440962,423323,419379,418608,418261,414240,413486,411859,409657,398817,393237,387121,386786,379146,378052,370868,369275,364756,361261,358367,355679,353510,352537,349976,349935,348051,347657,342167,337846,331937,329844,329794,329222,325689,322869,316473,310739,307364,302692,299579,299472,291869,287634,286120,285415,279546,278881,277205,273640,273542,273110,270295,266536,266424,265070,264577,264054,261584,257172,255739,254822,254781,252716,250720,246391,244897,244579,243368,242228,240275,237629,237247,236641,235816,234696,234392,232513,232056,231091,228127,227732,227731,227360,225868,225696,225671,224267,224116,222598,221987,218805,217410,214493,208725,206224,203334,203216,203023,201418,200124,198861,197300,196067,192330,192262,191900,189937,187315,186708,185784,183347,182660,182093,179205,178703,176811,174465,171301,170387,169899,168240,167955,167418,167128,166786,165655,165428,165139,165123,164981,163742,162159,159743,159235,158812,158640,158522,158188,157790,156970,156491,155635,154105,153661,152212,151166,151065,150470]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>rank<\/th>\n      <th>code_muni<\/th>\n      <th>name_muni<\/th>\n      <th>name_state<\/th>\n      <th>pop<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,5]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="shape-da-cidade" class="level2">
<h2 class="anchored" data-anchor-id="shape-da-cidade">Shape da cidade</h2>
<p>Agora que temos uma lista de cidades podemos importar o shapefile com os limites territoriais do município do Recife. Graças ao pacote <code>{geobr}</code> isto é muito simples. A função <code>read_municipality</code> faz justamente isto e precisa apenas do código de 7 dígitos do IBGE.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Encontra o código do IBGE de Recife</span></span>
<span id="cb5-2">code_muni <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> top200 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb5-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(name_muni <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Recife"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb5-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pull</span>(code_muni)</span>
<span id="cb5-5"></span>
<span id="cb5-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Importa o shape dos limites do município</span></span>
<span id="cb5-7">border <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> geobr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_municipality</span>(code_muni, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">showProgress =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb5-8"></span>
<span id="cb5-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Um mapa simples para checar o resultado</span></span>
<span id="cb5-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(border) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_sf</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Limites do município"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/2023-10-mapas-altitude/index_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="principais-vias" class="level2">
<h2 class="anchored" data-anchor-id="principais-vias">Principais vias</h2>
<p>O segundo passo é importar o shape das principais vias da cidade. Aqui, uso o pacote <code>{osmdata}</code>. O código abaixo importa as vias como “linhas” e depois usa os limites do município para remover os segmentos de linhas que estão fora da cidade.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Define os "limites" da busca. Monta um bounding box em torno do Recife</span></span>
<span id="cb6-2">rec <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">opq</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bbox =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getbb</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Recife, Pernambuco, Brazil"</span>))</span>
<span id="cb6-3"></span>
<span id="cb6-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Pega as principais vias</span></span>
<span id="cb6-5">streets <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_osm_feature</span>(</span>
<span id="cb6-6">  rec,</span>
<span id="cb6-7">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">key =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"highway"</span>,</span>
<span id="cb6-8">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">value =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"primary"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"secondary"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tertiary"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"residential"</span>)</span>
<span id="cb6-9">  )</span>
<span id="cb6-10"></span>
<span id="cb6-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Converte o objeto para sf (LINESTRING)</span></span>
<span id="cb6-12">streets <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">osmdata_sf</span>(streets)</span>
<span id="cb6-13">streets <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> streets<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>osm_lines</span>
<span id="cb6-14">streets <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(streets, osm_id, name)</span>
<span id="cb6-15">streets <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_transform</span>(streets, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">crs =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4674</span>)</span>
<span id="cb6-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Encontra a intersecção entre as vias e os limites do município</span></span>
<span id="cb6-17">streets_border <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_intersection</span>(streets, border)</span></code></pre></div>
</div>
<p>Para tornar mais evidente o que está acontecendo mostro primeiro o resultado geral, com todas as vias.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(streets) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb7-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_sf</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.15</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_void</span>()</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/2023-10-mapas-altitude/index_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>E agora o resultado após a intersecção entre as vias e os limites do município.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_sf</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> border, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_sf</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> streets_border, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.15</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray20"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_void</span>()</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/2023-10-mapas-altitude/index_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="altitude" class="level2">
<h2 class="anchored" data-anchor-id="altitude">Altitude</h2>
<p>O terceiro passo é importar os dados de altitude da cidade. Isto é feito com o pacote <code>{elevatr}</code>. Como os dados de altitude são armazenados como raster preciso convertê-los para dados em formato de vetor<sup>3</sup>. Novamente eu faço a intersecção destes dados com os limites do município para ficar somente com os valores que nos interessam.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Importa os dados de altitude</span></span>
<span id="cb9-2">altitude <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> elevatr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_elev_raster</span>(border, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">z =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">clip =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bbox"</span>)</span>
<span id="cb9-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Converte para 'vector'</span></span>
<span id="cb9-4">rec_alti <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> raster<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rasterToPolygons</span>(altitude)</span>
<span id="cb9-5">rec_alti <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> sf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_as_sf</span>(rec_alti)</span>
<span id="cb9-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(rec_alti)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"elevation"</span></span>
<span id="cb9-7"></span>
<span id="cb9-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Converte o CRS e intersecta com os limites do município</span></span>
<span id="cb9-9">rec_alti <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> rec_alti <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb9-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_transform</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">crs =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4674</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb9-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_intersection</span>(border) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb9-12">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Remove geometrias inválidas</span></span>
<span id="cb9-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_is_valid</span>(.))</span></code></pre></div>
</div>
<p>O gráfico abaixo mostra o resultado final.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Mapa</span></span>
<span id="cb10-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(rec_alti) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_sf</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> elevation)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_viridis_c</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Altitude"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">option =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"inferno"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_void</span>()</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/2023-10-mapas-altitude/index_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<section id="classificando-a-altitude" class="level3">
<h3 class="anchored" data-anchor-id="classificando-a-altitude">Classificando a altitude</h3>
<p>Para facilitar a visualização dos dados, classifica-se eles em grupos. Eu uso o <a href="https://en.wikipedia.org/wiki/Jenks_natural_breaks_optimization">algoritmo de Jenks</a> para classificar os dados de elevação em 7 grupos distintos. O algoritmo de Jenks, também conhecido como “quebras naturais”, é bastante utilizado com dados espaciais.</p>
<p>Como todo algoritmo de clustering, o algoritmo de Jenks busca minimizar a distância intraclasse enquanto tenta maximizar a distância entre as classes; isto é, ele busca observações parecidas e juntas elas em um grupo e busca separar os grupos o máximo possível.</p>
<p>A medida de distância/dissemelhança que o algoritmo usa é a soma do quadrado dos desvios (em relação à média do grupo). O algortimo busca minimizar esta “variância” em cada um dos grupos para encontrar os grupos mais “parecidos” possíveis. O número de grupos é arbitrário e precisa ser selecionado manualmente<sup>4</sup>. Eu costumo escolher algum número entre 3 e 9.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1">jbreaks <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> BAMMtools<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getJenksBreaks</span>(rec_alti<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>elevation, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">k =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>)</span>
<span id="cb11-2">jbreaks <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(jbreaks, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb11-3"></span>
<span id="cb11-4">rec_alti <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> rec_alti <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb11-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb11-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">jenks_group =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cut</span>(elevation, jbreaks)</span>
<span id="cb11-7">  )</span></code></pre></div>
</div>
<p>O resultado do agrupamento pode ser visto no histograma abaixo, onde as linhas verticais representam as quebras entre os grupos.</p>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(rec_alti, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> elevation)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb12-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_histogram</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bins =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb12-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_hline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yintercept =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb12-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_vline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xintercept =</span> jbreaks) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb12-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb12-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(</span>
<span id="cb12-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Distribuição da altitude em Recife"</span>,</span>
<span id="cb12-8">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">subtitle =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Linhas verticais mostram o agrupamento do algoritmo de Jenks"</span></span>
<span id="cb12-9">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb12-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_light</span>()</span></code></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/2023-10-mapas-altitude/index_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>O mapa abaixo mostra o formato dos dados de altitude. Temos um grid retangular que mostram a altura, em metros, da cidade do Recife.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Mapa</span></span>
<span id="cb13-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(rec_alti) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb13-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_sf</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> jenks_group)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb13-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_viridis_d</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">option =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"inferno"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb13-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_void</span>()</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/2023-10-mapas-altitude/index_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="juntando-as-partes" class="level2">
<h2 class="anchored" data-anchor-id="juntando-as-partes">Juntando as partes</h2>
<p>A próxima etapa é um pouco mais complexa então vamos proceder em passos curtos. Os dados de altitude estão agrupados em grupos, definidos pelo algoritmo de jenks. Nosso objetivo é encontrar todas as ruas que pertencem a cada um destes grupos de altitude.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">levels</span>(rec_alti<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>jenks_group)</span>
<span id="cb14-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; [1] "(-40,20]" "(20,30]"  "(30,50]"  "(50,70]"  "(70,90]"  "(90,120]"</span></span>
<span id="cb14-3"></span>
<span id="cb14-4">jgroups <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">levels</span>(rec_alti<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>jenks_group)</span></code></pre></div>
</div>
<p>O mapa abaixo mostra todos as áreas com altitude dentro do grupo 6 (90, 120].</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1">jgroups <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">levels</span>(rec_alti<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>jenks_group)</span>
<span id="cb15-2"></span>
<span id="cb15-3"></span>
<span id="cb15-4">sub <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> rec_alti <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb15-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(jenks_group <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> jgroups[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>]) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb15-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_union</span>(.) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb15-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_as_sf</span>()</span>
<span id="cb15-8"></span>
<span id="cb15-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(sub) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_sf</span>()</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/2023-10-mapas-altitude/index_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Fazendo a intereseção entre este subconjunto do grid de altitude com o shape das ruas, encontra-se somente as vias que estão neste grupo de altitude.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1">substreet <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> streets <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb16-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_intersection</span>(sub) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb16-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_is_valid</span>(.))</span>
<span id="cb16-4"></span>
<span id="cb16-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb16-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_sf</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> substreet, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb16-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_sf</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> sub, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/2023-10-mapas-altitude/index_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Juntando as duas etapas num mesmo bloco de código temos as linhas abaixo. Primeiro, encontra-se o subconjunto do grid de altitude dentro de um grupo. Depois, faz-se a interseção deste grupo com as vias da cidade.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1">poly <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> rec_alti <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb17-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(jenks_group <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> jgroups[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>]) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb17-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_union</span>(.) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb17-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_as_sf</span>()</span>
<span id="cb17-5"></span>
<span id="cb17-6">joined <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> streets <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb17-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_intersection</span>(poly) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb17-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_is_valid</span>(.))</span>
<span id="cb17-9"></span>
<span id="cb17-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(joined) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_sf</span>()</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/2023-10-mapas-altitude/index_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Para repetir o código acima em todos os grupos, faz-se um loop simples. Os resultados são gravados numa lista chamada <code>streets_altitude</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Cria uma lista para gravar os resultados</span></span>
<span id="cb18-2">streets_altitude <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>()</span>
<span id="cb18-3"></span>
<span id="cb18-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; For-loop em todos os elementos de jgroups</span></span>
<span id="cb18-5"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq_along</span>(jgroups)) {</span>
<span id="cb18-6"></span>
<span id="cb18-7">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Seleciona um nível do grupo em particular  </span></span>
<span id="cb18-8">  group <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">levels</span>(rec_alti<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>jenks_group)[[i]]</span>
<span id="cb18-9">  </span>
<span id="cb18-10">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Encontra o subconjunto de do grid de altitude que corresponde a este grupo</span></span>
<span id="cb18-11">  poly <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> rec_alti <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb18-12">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(jenks_group <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> group) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb18-13">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_union</span>(.) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb18-14">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_as_sf</span>()</span>
<span id="cb18-15">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Faz a interseção deste subconjunto com as vias da cidade</span></span>
<span id="cb18-16">  joined <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> streets <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb18-17">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_intersection</span>(poly) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb18-18">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_is_valid</span>(.)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb18-19">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">level =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(i))</span>
<span id="cb18-20">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Grava o resultado como elemento da lista streets_altitude</span></span>
<span id="cb18-21">  streets_altitude[[i]] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> joined</span>
<span id="cb18-22">  </span>
<span id="cb18-23">}</span></code></pre></div>
</div>
<p>Feito isto, pode-se verificar visualmente o resultado.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1">rec_streets_altitude <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>(streets_altitude)</span>
<span id="cb19-2"></span>
<span id="cb19-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(rec_streets_altitude) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb19-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_sf</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> level, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> level), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb19-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_viridis_d</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Altitude"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">option =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"inferno"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb19-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_viridis_d</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Altitude"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">option =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"inferno"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb19-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_void</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb19-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb19-9">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>,</span>
<span id="cb19-10">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_rect</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray75"</span>)</span>
<span id="cb19-11">  )</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/2023-10-mapas-altitude/index_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="mapa-final" class="level2">
<h2 class="anchored" data-anchor-id="mapa-final">Mapa final</h2>
<p>Para montar a versão finalizada do mapa, adiciona-se alguns elementos temáticos. Para saber mais sobre elementos temáticos e a função theme, consulte meu <a href="https://restateinsight.com/posts/ggplot2-tutorial/7-themes-fonts">post</a>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1">cores <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(</span>
<span id="cb20-2">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#0D0887FF"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#5402A3FF"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#8B0AA5FF"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#B93289FF"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#DB5C68FF"</span>, </span>
<span id="cb20-3">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#F48849FF"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#FEBC2AFF"</span></span>
<span id="cb20-4">  )</span>
<span id="cb20-5"></span>
<span id="cb20-6">jlabels <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(jbreaks, jbreaks[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"–"</span>)</span>
<span id="cb20-7">jlabels[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(jbreaks[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]))</span>
<span id="cb20-8">jlabels[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(jlabels)] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&gt;"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(jbreaks))</span>
<span id="cb20-9"></span>
<span id="cb20-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> rec_streets_altitude) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb20-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_sf</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> level, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> level), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb20-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Altitude"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> cores, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> jlabels) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb20-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Altitude"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> cores, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> jlabels) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb20-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guides</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guide_legend</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guide_legend</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb20-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Recife"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb20-16">  ggthemes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_map</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb20-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_sf</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb20-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb20-19">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>),</span>
<span id="cb20-20">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"top"</span>,</span>
<span id="cb20-21">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.direction =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"horizontal"</span>,</span>
<span id="cb20-22">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>),</span>
<span id="cb20-23">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_rect</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#f6eee3"</span>),</span>
<span id="cb20-24">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_rect</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#f6eee3"</span>),</span>
<span id="cb20-25">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_rect</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#f6eee3"</span>)</span>
<span id="cb20-26">  )</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/2023-10-mapas-altitude/index_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="programação-funcional" class="level1">
<h1>Programação funcional</h1>
<p>A ideia geral da programação funcional é de transformar um código em funções. Todo o código acima é feito de comandos: encontre a tabela com a população dos municípios neste link e importe os dados; aplique o algoritmo de Jenks neste vetor numérico e guarde o resultado no objeto chamado <code>jgroups</code> e assim por diante.</p>
<p>Nosso objetivo agora é transformar o passo-a-passo acima em funções distintas, cada uma executando uma tarefa específica. Por fim, vamos criar uma função que chama todas estas funções individuais e que vai criar o mesmo mapa acima em uma única linha.</p>
<p>Antes de seguir no tutorial, vale revisar um pouco sobre como funcionam funções no R.</p>
<section id="o-básico-de-funções" class="level2">
<h2 class="anchored" data-anchor-id="o-básico-de-funções">O básico de funções</h2>
<p>Uma função transforma um <em>input</em> num <em>output</em> seguindo uma série de comandos. Uma função no R é composta de três elementos: (1) <em>formals</em>; (2) <em>body</em>; e (3) <em>environment</em>. O primeiro elemento corresponde aos <em>argumentos</em> da função e o segundo elemento corresponde à função, propriamente dita. Tomando um exemplo da matemática considere a função abaixo</p>
<p><img src="https://latex.codecogs.com/png.latex?%0Af(x)%20=%20x%5E2%20+%201%0A"></p>
<p>Neste caso, o <em>formals</em> seria simplesmente <img src="https://latex.codecogs.com/png.latex?x"> e o <em>body</em> seria <img src="https://latex.codecogs.com/png.latex?x%5E2%20+%201"> . Podemos ver como isto ocorre dentro do R.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1">f <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) {</span>
<span id="cb21-2">  x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb21-3">}</span>
<span id="cb21-4"></span>
<span id="cb21-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">formals</span>(f)</span>
<span id="cb21-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; $x</span></span>
<span id="cb21-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">body</span>(f)</span>
<span id="cb21-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; {</span></span>
<span id="cb21-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;    x^2 + 1</span></span>
<span id="cb21-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; }</span></span>
<span id="cb21-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">environment</span>(f)</span>
<span id="cb21-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; &lt;environment: R_GlobalEnv&gt;</span></span></code></pre></div>
</div>
<p>O <em>environment</em> é o ambiente onde a função existe; geralmente, o environment é simplesmente <code>R_GlobalEnv</code>, o ambiente “global” onde habitam todos os objetos que você cria como, por exemplo, <code>x &lt;- 1:5</code>. Este aspecto é um pouco mais técnico, mas é o que permite que funções habitem dentro de funções.</p>
<p>O exemplo abaixo é adaptado do livro <a href="http://adv-r.had.co.nz/Functions.html">Advanced R</a> e ilustra como funcionam diferentes environments quando se tem funções dentro de funções.</p>
<p>Funções compartimentalizam o seu ambiente de trabalho. <strong>O que acontece dentro da função, fica dentro da função</strong>. Assim, a linha <code>y &lt;- 2</code> abaixo “existe” apenas dentro do contexto da função <code>j</code>. Os objetos definidos dentro de funções não interferem com objetos criados fora da função.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">environment</span>())</span>
<span id="cb22-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; &lt;environment: R_GlobalEnv&gt;</span></span>
<span id="cb22-3">j <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) {</span>
<span id="cb22-4">  y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb22-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">environment</span>())</span>
<span id="cb22-6">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; &lt;environment: 0x16eaa2320&gt;</span></span>
<span id="cb22-7">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>() {</span>
<span id="cb22-8">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">environment</span>())</span>
<span id="cb22-9">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; &lt;environment: 0x16e9f8d40&gt;</span></span>
<span id="cb22-10">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(x, y)</span>
<span id="cb22-11">  }</span>
<span id="cb22-12">}</span>
<span id="cb22-13">k <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">j</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb22-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">k</span>()</span>
<span id="cb22-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; [1] 1 2</span></span>
<span id="cb22-16"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(y)</span>
<span id="cb22-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Error in print(y) : object 'y' not found</span></span></code></pre></div>
</div>
<p>Uma função executa um conjunto de ações sobre seus <em>inputs</em> dentro de um “ambiente controlado” e devolve apenas o resultado final, <em>output</em>, para a sessão ativa do R. Assim, funções permitem <em>isolar partes do código</em> e dispensar resultados intermediários.</p>
<p>O próximo exemplo mostra como filtrar linhas de um <code>data.frame</code>. No fundo, esta função simplesmente chama <code>dplyr::filter</code> e fornece argumentos numa determinada maneira. Note que declaro o nome do pacote <code>dplyr</code> o que evita a necessidade de chamar <code>library(dplyr)</code> e torna a função <code>filtrar_linhas</code> portátil<sup>5</sup>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1">dados <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb23-2">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">grupo =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"B"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C"</span>),</span>
<span id="cb23-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb23-4">)</span>
<span id="cb23-5"></span>
<span id="cb23-6"></span>
<span id="cb23-7">filtrar_linhas <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(df, filter_val) {</span>
<span id="cb23-8">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(df, grupo <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> filter_val)</span>
<span id="cb23-9">}</span>
<span id="cb23-10"></span>
<span id="cb23-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filtrar_linhas</span>(dados, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"B"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  grupo y
1     B 4</code></pre>
</div>
</div>
<p>Este é um ponto importante: em geral, nossas funções simplesmente chamam outras funções prontas numa ordem específica e com argumentos específicos.</p>
<p>O próximo é exemplo é um pouco mais sofisticado. Agora temos uma função que calcula a média geométrica de um vetor numérico. Neste caso há uma estrutura de <code>if</code>/<code>else</code> dentro do corpo da função que verifica o input antes de executar os cálculos. Especificamente, como a média geométrica é definida apenas para números positivos faz-se um teste para verificar se o <em>input</em> contém apenas números positivos.</p>
<p>Note que as funções <code>exp</code>, <code>mean</code> e <code>log</code> são utilizadas sem o sinal <code>::</code> pois estas funções do base-R. Isto é, são funções básicas, que permitem que o R funcione enquanto linguagem de programação, e estão sempre disponíveis.</p>
<p>Além disso, desta vez uso <code>return</code> para explicitamente declarar qual objeto a função deve retornar. Vale reforçar que o objeto <code>z &lt;- exp(mean(log(x)))</code> passa a existir somente dentro da função. Ou seja, ele não interfere com algum objeto <code>z</code> que exista ou que possa vir a existir no ambiente global.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1">geometric_mean <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) {</span>
<span id="cb25-2">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Verifica o input</span></span>
<span id="cb25-3">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.numeric</span>(x) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;&amp;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">all</span>(x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)) {</span>
<span id="cb25-4">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Calcula a média geométrica</span></span>
<span id="cb25-5">    z <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(x)))</span>
<span id="cb25-6">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Retorna o vetor z</span></span>
<span id="cb25-7">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(z)</span>
<span id="cb25-8">    </span>
<span id="cb25-9">  } <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> {</span>
<span id="cb25-10">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Retorna um erro</span></span>
<span id="cb25-11">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stop</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Non-positive values found in x."</span>)</span>
<span id="cb25-12">    </span>
<span id="cb25-13">  }</span>
<span id="cb25-14">  </span>
<span id="cb25-15">}</span>
<span id="cb25-16"></span>
<span id="cb25-17">y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>)</span>
<span id="cb25-18"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geometric_mean</span>(y)</span>
<span id="cb25-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; [1] 5.119318</span></span>
<span id="cb25-20">z <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>)</span>
<span id="cb25-21"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geometric_mean</span>(z)</span>
<span id="cb25-22"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Error in geometric_mean(z) : Non-positive values found in x.</span></span></code></pre></div>
</div>
<p>Na sua essência, a programação funcional enfatiza modularidade e previsibilidade. Quebra-se uma tarefa complexa em partes menores. Cada uma destas partes menores vira uma função individual com input e output bem estabelecidos. Códigos escritos desta maneira também funcionam melhor com processamento paralelo, ou seja, há também um ganho de eficiência.</p>
<p>Vamos reconstruir todos os passos acima usando funções.</p>
</section>
</section>
<section id="o-mapa-em-funções" class="level1">
<h1>O mapa em funções</h1>
<section id="shape-da-cidade-1" class="level2">
<h2 class="anchored" data-anchor-id="shape-da-cidade-1">Shape da cidade</h2>
<p>Por conveniência, eu repito abaixo o código que se usou para chegar no shape dos limites territoriais do Recife. Note o que acontece: (1) o primeiro passo filtra um <code>data.frame</code> para encontrar o código do IBGE do respectivo município; (2) usando o código, a função <code>geobr::read_municipality()</code> importa o shape.</p>
<p>Há dois objetos importantes nesta função: a tabela que contém as informações de ‘nome da cidade’ e ‘código do ibge’; e o string com o ‘nome da cidade’.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1">code_muni <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> top200 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb26-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(name_muni <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Recife"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb26-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pull</span>(code_muni)</span>
<span id="cb26-4"></span>
<span id="cb26-5">border <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> geobr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_municipality</span>(code_muni)</span></code></pre></div>
</div>
<p>Para transformar o código acima numa função, basta incluir estes objetos como argumentos. Como a tabela usada é sempre a mesma coloca-se o objeto <code>top200</code> dentro da função<sup>6</sup>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1">get_border <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(city) {</span>
<span id="cb27-2">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Filtra a tabela top200 e encontra o código do município</span></span>
<span id="cb27-3">  code_muni <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> top200 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb27-4">    dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(name_muni <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> city) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb27-5">    dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pull</span>(code_muni)</span>
<span id="cb27-6">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Importa o shape do município</span></span>
<span id="cb27-7">  border <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> geobr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_municipality</span>(code_muni, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">showProgress =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb27-8">  </span>
<span id="cb27-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(border)</span>
<span id="cb27-10">  </span>
<span id="cb27-11">}</span></code></pre></div>
</div>
<p>A função <code>get_border</code>, definida acima, possui um único argumento <code>city</code>, o nome da cidade, e retorna um único objeto, <code>border</code>, um spatial <code>data.frame</code> que contém o shapefile com os limites territoriais do município.</p>
</section>
<section id="principais-vias-1" class="level2">
<h2 class="anchored" data-anchor-id="principais-vias-1">Principais vias</h2>
<p>O processo de transformar o código numa função consiste em entender quais são os elementos essenciais e circustanciais. No código abaixo o nome da cidade <code>"Recife, Pernambuco, Brazil"</code> é um elemento mutável enquanto <code>opq(bbox = getbb(…))</code> é a parte essencial. Similarmente, todos os comandos abaixo de <code>streets</code> são essenciais, mas o nome do objeto <code>rec</code> é inteiramente acidental.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Define os "limites" da busca. Monta um bounding box em torno do Recife</span></span>
<span id="cb28-2">rec <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">opq</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bbox =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getbb</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Recife, Pernambuco, Brazil"</span>))</span>
<span id="cb28-3"></span>
<span id="cb28-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Pega as principais vias</span></span>
<span id="cb28-5">streets <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_osm_feature</span>(</span>
<span id="cb28-6">  rec,</span>
<span id="cb28-7">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">key =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"highway"</span>,</span>
<span id="cb28-8">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">value =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"primary"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"secondary"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tertiary"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"residential"</span>)</span>
<span id="cb28-9">  )</span>
<span id="cb28-10"></span>
<span id="cb28-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Converte o objeto para sf (LINESTRING)</span></span>
<span id="cb28-12">streets <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">osmdata_sf</span>(streets)</span>
<span id="cb28-13">streets <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> streets<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>osm_lines</span>
<span id="cb28-14">streets <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(streets, osm_id, name)</span>
<span id="cb28-15">streets <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_transform</span>(streets, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">crs =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4674</span>)</span>
<span id="cb28-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Encontra a intersecção entre as vias e os limites do município</span></span>
<span id="cb28-17">streets_border <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_intersection</span>(streets, border)</span></code></pre></div>
</div>
<p>Vamos dividir o código acima em duas etapas. Na primeira, vamos usar o nome da cidade para encontrar o nome do estado do município. Na segunda, vamos encontrar todas as ruas da cidade selecionada.</p>
<p>A função <code>get_state</code> é bastante simples: ela filtra a tabela que contém as informações das cidades e encontra o nome do estado do município selecionado.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1">get_state <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(city) {</span>
<span id="cb29-2">  top200 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb29-3">    dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(name_muni <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> city) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb29-4">    dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pull</span>(name_state)</span>
<span id="cb29-5">}</span>
<span id="cb29-6"></span>
<span id="cb29-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_state</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Recife"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Pernambuco"</code></pre>
</div>
</div>
<p>A função <code>get_streets</code> usa o nome da cidade e o shape dos limites territoriais (gerado pela função <code>get_border()</code>) para encontrar todas as vias contidas dentro da cidade. Note como a função <code>get_streets</code> chama a função <code>get_state</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1">get_streets <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(city, border) {</span>
<span id="cb31-2">  </span>
<span id="cb31-3">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Encontra o nome da Unidade Federativa</span></span>
<span id="cb31-4">  nome_uf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_state</span>(city)</span>
<span id="cb31-5">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Monta o nome do local</span></span>
<span id="cb31-6">  name_place <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> stringr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_glue</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"{city}, {nome_uf}, Brazil"</span>)</span>
<span id="cb31-7">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Monta a query</span></span>
<span id="cb31-8">  place <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> osmdata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">opq</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bbox =</span> osmdata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getbb</span>(name_place))</span>
<span id="cb31-9">  </span>
<span id="cb31-10">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Importa todas as principais vias da cidade</span></span>
<span id="cb31-11">  streets <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> osmdata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_osm_feature</span>(</span>
<span id="cb31-12">    place,</span>
<span id="cb31-13">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">key =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"highway"</span>,</span>
<span id="cb31-14">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">value =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"primary"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"secondary"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tertiary"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"residential"</span>)</span>
<span id="cb31-15">    )</span>
<span id="cb31-16">  </span>
<span id="cb31-17">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Converte o dado</span></span>
<span id="cb31-18">  streets <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> streets <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb31-19">    osmdata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">osmdata_sf</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb31-20">    .<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>osm_lines <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb31-21">    dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(osm_id, name) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb31-22">    sf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_transform</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">crs =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4674</span>)</span>
<span id="cb31-23">  </span>
<span id="cb31-24">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Enconrtra a intersecção entre as estradas e o limites do município</span></span>
<span id="cb31-25">  streets_border <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> sf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_intersection</span>(streets, border)</span>
<span id="cb31-26">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Retorna o objeto streets_border</span></span>
<span id="cb31-27">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(streets_border)</span>
<span id="cb31-28">  </span>
<span id="cb31-29">}</span></code></pre></div>
</div>
</section>
<section id="altitude-1" class="level2">
<h2 class="anchored" data-anchor-id="altitude-1">Altitude</h2>
<p>O código que encontra a altitude da cidade é muito similar ao código que encontra as principais vias. Neste caso, contudo, pode ser interessante manter controle sobre o argumento <code>z</code> da função <code>get_elev_raster</code>. Este argumento controla o nível de resolução da imagem de altitude que se importa.</p>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Importa os dados de altitude</span></span>
<span id="cb32-2">altitude <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> elevatr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_elev_raster</span>(border, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">z =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">clip =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bbox"</span>)</span>
<span id="cb32-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Converte para 'vector'</span></span>
<span id="cb32-4">rec_alti <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> raster<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rasterToPolygons</span>(altitude)</span>
<span id="cb32-5">rec_alti <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> sf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_as_sf</span>(rec_alti)</span>
<span id="cb32-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(rec_alti)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"elevation"</span></span>
<span id="cb32-7"></span>
<span id="cb32-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Converte o CRS e intersecta com os limites do município</span></span>
<span id="cb32-9">rec_alti <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> rec_alti <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb32-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_transform</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">crs =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4674</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb32-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_intersection</span>(border) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb32-12">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Remove geometrias inválidas</span></span>
<span id="cb32-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_is_valid</span>(.))</span></code></pre></div>
</details>
</div>
<p>A função <code>get_elevation</code> utiliza o shape dos limites do município e retorna um spatial <code>data.frame</code> com o grid retangular que contém os dados de altitude do município. O argumento <code>z</code> controla o nível de resolução e varia de 1 a 14. Quanto maior, maior será a resolução (o “zoom” da imagem), ou seja, mais detalhado (e mais pesado) será o resultado.</p>
<p>Na definição da função, deixa-se o valor padrão pré-definido em <code>z = 9</code>. Isto significa que o argumento pode ser omitido pelo usuário.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb33" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1">get_elevation <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(border, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">z =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>) {</span>
<span id="cb33-2">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Importa os dados de altitude</span></span>
<span id="cb33-3">  altitude <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> elevatr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_elev_raster</span>(border, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">z =</span> z, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">clip =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bbox"</span>)</span>
<span id="cb33-4">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Converte para 'vector'</span></span>
<span id="cb33-5">  altitude <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> raster<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rasterToPolygons</span>(altitude)</span>
<span id="cb33-6">  altitude <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> sf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_as_sf</span>(altitude)</span>
<span id="cb33-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(altitude)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"elevation"</span></span>
<span id="cb33-8">  </span>
<span id="cb33-9">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Converte o CRS e intersecta com os limites do município</span></span>
<span id="cb33-10">  altitude <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> sf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_transform</span>(altitude, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">crs =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4674</span>)</span>
<span id="cb33-11">  altitude <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">suppressWarnings</span>(sf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_intersection</span>(altitude, border))</span>
<span id="cb33-12">  altitude <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(altitude, sf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_is_valid</span>(altitude))</span>
<span id="cb33-13">  </span>
<span id="cb33-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(altitude)</span>
<span id="cb33-15">  </span>
<span id="cb33-16">}</span></code></pre></div>
</div>
<section id="classificando" class="level3">
<h3 class="anchored" data-anchor-id="classificando">Classificando</h3>
<p>Para classificar os dados utiliza-se o algoritmo de Jenks. As duas funções abaixo retornam esse agrupamento tomando um spatial <code>data.frame</code> como argumento principal. Eu adicionei alguns argumento adicionais que facilitam a escolha do número dos grupos e (opcionalmente) permite os limites dos grupos sejam arredondados para gerar número mais bonitos.</p>
<p>A função <code>add_jenks_breaks</code> retorna uma lista com dois elementos: o primeiro elemento é o spatial <code>data.frame</code>, acrescido de uma coluna com o argupamento; o segundo elemento é um vetor <code>character</code> com a “legenda” do grupo, i.e., <code>"&gt;50", "50-100", …</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb34" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1">add_jenks_breaks <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(shp, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">k =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">round =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>) {</span>
<span id="cb34-2">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Classifica os dados de altitude em k grupos segundo o algo. de Jenks</span></span>
<span id="cb34-3">  jbreaks <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> BAMMtools<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getJenksBreaks</span>(shp<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>elevation, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">k =</span> k)</span>
<span id="cb34-4">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Arredonda os números para chegar numa legenda menos quebrada</span></span>
<span id="cb34-5">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (round) {</span>
<span id="cb34-6">    jbreaks[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">floor</span>(jbreaks[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>])</span>
<span id="cb34-7">    jbreaks[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(jbreaks)] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ceiling</span>(jbreaks)</span>
<span id="cb34-8">    jbreaks[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(jbreaks) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(jbreaks)</span>
<span id="cb34-9">  }</span>
<span id="cb34-10">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Cria a coluna 'jenks_group' que classifica cada valor num grupo</span></span>
<span id="cb34-11">  shp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> shp <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb34-12">    dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb34-13">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">jenks_group =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">findInterval</span>(elevation, jbreaks, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rightmost.closed =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>),</span>
<span id="cb34-14">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">jenks_group =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(jenks_group, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_jenks_labels</span>(jbreaks))</span>
<span id="cb34-15">    )</span>
<span id="cb34-16">  </span>
<span id="cb34-17">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Verifica se todas as observações tem um grupo</span></span>
<span id="cb34-18">  check <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">any</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(shp<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>jenks_group))</span>
<span id="cb34-19">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (check) {</span>
<span id="cb34-20">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">warning</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Some observations have failed to be grouped"</span>)</span>
<span id="cb34-21">  }</span>
<span id="cb34-22">  </span>
<span id="cb34-23">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Transforma os groups em legendas</span></span>
<span id="cb34-24">  labels <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_jenks_labels</span>(jbreaks)</span>
<span id="cb34-25">  </span>
<span id="cb34-26">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Retorna o output numa lista</span></span>
<span id="cb34-27">  out <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shp =</span> shp, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> labels)</span>
<span id="cb34-28">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(out)</span>
<span id="cb34-29">  </span>
<span id="cb34-30">}</span>
<span id="cb34-31"></span>
<span id="cb34-32">get_jenks_labels <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) {</span>
<span id="cb34-33">  labels <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(x, x[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"–"</span>)</span>
<span id="cb34-34">  labels[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;"</span>, x[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>])</span>
<span id="cb34-35">  labels <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> labels[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(labels) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)]</span>
<span id="cb34-36">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(labels)</span>
<span id="cb34-37">}</span></code></pre></div>
</div>
</section>
</section>
<section id="juntando-as-partes-1" class="level2">
<h2 class="anchored" data-anchor-id="juntando-as-partes-1">Juntando as partes</h2>
<p>O código que junta o grid de altitude com as ruas usava um <code>for-loop</code> em cada um dos grupos. Costuma ser relativamente simples substituir loops por funções. Transforma-se a essência do loop numa função e aplica-se a esta função no objeto usando alguma função <code>map_*</code> ou <code>lapply</code>. No exemplo abaixo, a parte essencial é o código que filtra o grid de alitutude e faz a sua intersecção com o shape das ruas.</p>
<p>Funções têm algumas vantanges sobre loops. Para rodar um loop quase sempre é necessário criar objetos temporários, que vão armazenar os resultados parciais do loop. Além disso, loops costumam ser mais lentos do que funções rodando em paralelo<sup>7</sup>. Loops mal construídos, em particular, podem ser bastante ineficientes.</p>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Cria uma lista para gravar os resultados</span></span>
<span id="cb35-2">streets_altitude <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>()</span>
<span id="cb35-3"></span>
<span id="cb35-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; For-loop em todos os elementos de jgroups</span></span>
<span id="cb35-5"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq_along</span>(jgroups)) {</span>
<span id="cb35-6"></span>
<span id="cb35-7">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Seleciona um nível do grupo em particular  </span></span>
<span id="cb35-8">  group <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">levels</span>(rec_alti<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>jenks_group)[[i]]</span>
<span id="cb35-9">  </span>
<span id="cb35-10">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Encontra o subconjunto de do grid de altitude que corresponde a este grupo</span></span>
<span id="cb35-11">  poly <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> rec_alti <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb35-12">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(jenks_group <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> group) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb35-13">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_union</span>(.) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb35-14">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_as_sf</span>()</span>
<span id="cb35-15">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Faz a interseção deste subconjunto com as vias da cidade</span></span>
<span id="cb35-16">  joined <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> streets <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb35-17">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_intersection</span>(poly) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb35-18">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_is_valid</span>(.)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb35-19">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">level =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(i))</span>
<span id="cb35-20">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Grava o resultado como elemento da lista streets_altitude</span></span>
<span id="cb35-21">  streets_altitude[[i]] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> joined</span>
<span id="cb35-22">  </span>
<span id="cb35-23">}</span>
<span id="cb35-24"></span>
<span id="cb35-25">rec_streets_altitude <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>(streets_altitude)</span></code></pre></div>
</details>
</div>
<p>A função <code>get_street_altitude</code> abaixo pega o grid de altitude da cidade e o shape das principais vias e retorna um spatial <code>data.frame</code> único que contém as ruas da cidade agrupadas pela sua altura.</p>
<p>Nesta função, define-se uma função “auxiliar” <code>join_streets</code> que existe somente dentro do contexto da função <code>get_streets_altitude</code>. Aplica-se esta função em paralelo usando <code>furrr::future_map</code><sup>8</sup>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb36" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1">get_streets_altitude <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(altitude, streets) {</span>
<span id="cb36-2">  </span>
<span id="cb36-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stopifnot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">any</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(altitude) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"jenks_group"</span>))</span>
<span id="cb36-4">  </span>
<span id="cb36-5">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Encontra todos os grupos</span></span>
<span id="cb36-6">  groups <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">levels</span>(altitude<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>jenks_group)</span>
<span id="cb36-7">  </span>
<span id="cb36-8">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Define uma função auxiliar</span></span>
<span id="cb36-9"></span>
<span id="cb36-10">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Esta função filtra o grid de altitude e faz a sua interseção</span></span>
<span id="cb36-11">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; com o shape das princiapis vias</span></span>
<span id="cb36-12">  join_streets <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(group) {</span>
<span id="cb36-13">    </span>
<span id="cb36-14">    poly <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> altitude <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb36-15">      dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(jenks_group <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> group) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb36-16">      sf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_union</span>(.) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb36-17">      sf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_as_sf</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb36-18">      sf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_make_valid</span>()</span>
<span id="cb36-19">    </span>
<span id="cb36-20">    joined <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">suppressWarnings</span>(sf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_intersection</span>(streets, poly))</span>
<span id="cb36-21">    </span>
<span id="cb36-22">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(joined)</span>
<span id="cb36-23">    </span>
<span id="cb36-24">  }</span>
<span id="cb36-25">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Aplica a função acima em todos os grupos em paralelo</span></span>
<span id="cb36-26">  street_levels <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> furrr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">future_map</span>(groups, join_streets)</span>
<span id="cb36-27">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; "Empilha" o objeto num único spatial data.frame</span></span>
<span id="cb36-28">  out <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>(street_levels, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.id =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"level"</span>)</span>
<span id="cb36-29">  </span>
<span id="cb36-30">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(out)</span>
<span id="cb36-31">  </span>
<span id="cb36-32">}</span></code></pre></div>
</div>
</section>
<section id="mapa" class="level2">
<h2 class="anchored" data-anchor-id="mapa">Mapa</h2>
<p>Transformar o mapa final numa função é bastante simples já que quase todos os argumentos das funções vão continuar exatamente iguais. A única diferença importante a se notar é na escolha da paleta de cores. Como o número de grupos de altitude pode mudar, faz sentido que a paleta de cores também se altere. Além disso, adiciono também uma opção de usar a fonte Roboto Condensed com o pacote showtext.</p>
<p>Note que suprimo o uso de <code>ggplot2::</code> para deixar o código menos carregado.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb37" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1">map_plot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(shp, labels, title, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">showtext =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) {</span>
<span id="cb37-2">  </span>
<span id="cb37-3">  cores <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> viridis<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plasma</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(labels) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb37-4">  cores <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> cores[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(cores)]</span>
<span id="cb37-5">  </span>
<span id="cb37-6">  font <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(showtext <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Roboto Condensed"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sans"</span>)</span>
<span id="cb37-7">  </span>
<span id="cb37-8">  plot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span></span>
<span id="cb37-9">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> shp) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb37-10">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_sf</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> level, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> level), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb37-11">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_manual</span>(</span>
<span id="cb37-12">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Altitude"</span>,</span>
<span id="cb37-13">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> labels,</span>
<span id="cb37-14">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> cores</span>
<span id="cb37-15">      ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb37-16">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_manual</span>(</span>
<span id="cb37-17">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Altitude"</span>,</span>
<span id="cb37-18">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> labels,</span>
<span id="cb37-19">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> cores</span>
<span id="cb37-20">      ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb37-21">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guides</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guide_legend</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guide_legend</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb37-22">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggtitle</span>(title) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb37-23">    ggthemes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_map</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb37-24">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_sf</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb37-25">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb37-26">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(</span>
<span id="cb37-27">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>,</span>
<span id="cb37-28">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,</span>
<span id="cb37-29">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> font</span>
<span id="cb37-30">        ),</span>
<span id="cb37-31">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(</span>
<span id="cb37-32">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>,</span>
<span id="cb37-33">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> font,</span>
<span id="cb37-34">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray10"</span></span>
<span id="cb37-35">      ),</span>
<span id="cb37-36">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(</span>
<span id="cb37-37">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>,</span>
<span id="cb37-38">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> font,</span>
<span id="cb37-39">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray10"</span></span>
<span id="cb37-40">        ),</span>
<span id="cb37-41">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"top"</span>,</span>
<span id="cb37-42">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.direction =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"horizontal"</span>,</span>
<span id="cb37-43">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_rect</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#f6eee3"</span>),</span>
<span id="cb37-44">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_rect</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#f6eee3"</span>),</span>
<span id="cb37-45">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_rect</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#f6eee3"</span>)</span>
<span id="cb37-46">    )</span>
<span id="cb37-47">  </span>
<span id="cb37-48">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(plot)</span>
<span id="cb37-49">  </span>
<span id="cb37-50">}</span>
<span id="cb37-51"></span>
<span id="cb37-52"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Para adicionar a fonte</span></span>
<span id="cb37-53"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># sysfonts::font_add_google("Roboto Condensed", "Roboto Condensed")</span></span>
<span id="cb37-54"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># showtext::showtext_auto()</span></span></code></pre></div>
</div>
</section>
<section id="uma-função-final" class="level2">
<h2 class="anchored" data-anchor-id="uma-função-final">Uma função final</h2>
<p>Agora que temos funções para cada uma das principais tarefas, podemos criar uma última função que vai executar estas funções na ordem apropriada.</p>
<p>A função <code>map_altitude</code> utiliza apenas o nome da cidade para gerar o mapa de altitude. Opcionalmente, pode-se alterar os argumentos <code>k</code>, que altera o número de grupos e <code>z</code> que aumenta/diminui a resolução do mapa de altura.</p>
<p>Como esta função executa vários passos intermediários, e alguns destes podem ser bastante demorados, eu incluo algumas mensagens que informam sobre o andamento da função. O resultado final é armazenado numa lista, que retorna alguns dos objetos intermediários como o shape de altitude.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb38" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1">map_altitude <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(city, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">k =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">z =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>) {</span>
<span id="cb38-2">  </span>
<span id="cb38-3">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Importa o shape do limite do município</span></span>
<span id="cb38-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">message</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Importando os limites do município: "</span>, city)</span>
<span id="cb38-5">  city_border <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_border</span>(city)</span>
<span id="cb38-6">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Importa as principais vias da cidade e junta com o limite do muni</span></span>
<span id="cb38-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">message</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Importando as vias."</span>)</span>
<span id="cb38-8">  city_street <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_streets</span>(city, city_border)</span>
<span id="cb38-9">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Importa a altitude da cidade</span></span>
<span id="cb38-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">message</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Importando a altitude."</span>)</span>
<span id="cb38-11">  city_elevation <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">suppressMessages</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_elevation</span>(city_border, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">z =</span> z))</span>
<span id="cb38-12">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Classifica a altitude em grupos</span></span>
<span id="cb38-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">message</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Classificando e juntando os shapefiles."</span>)</span>
<span id="cb38-14">  jenks <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_jenks_breaks</span>(city_elevation, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">k =</span> k)</span>
<span id="cb38-15">  city_elevation <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> jenks[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"shp"</span>]]</span>
<span id="cb38-16">  labels <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> jenks[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"labels"</span>]]</span>
<span id="cb38-17">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Junta a altitude (agrupada) com as vias</span></span>
<span id="cb38-18">  city_street_elevation <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_streets_altitude</span>(city_elevation, city_street)</span>
<span id="cb38-19">  </span>
<span id="cb38-20">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Monta o mapa final</span></span>
<span id="cb38-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">message</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gerando o mapa final."</span>)</span>
<span id="cb38-22">  plot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map_plot</span>(city_street_elevation, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> labels, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> city)</span>
<span id="cb38-23">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">message</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Feito."</span>)</span>
<span id="cb38-24">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Retorna o output numa lista</span></span>
<span id="cb38-25">  out <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb38-26">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shp =</span> city_street_elevation,</span>
<span id="cb38-27">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">streets =</span> city_street,</span>
<span id="cb38-28">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">elevation =</span> city_elevation,</span>
<span id="cb38-29">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot =</span> plot</span>
<span id="cb38-30">    )</span>
<span id="cb38-31">  </span>
<span id="cb38-32">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(out)</span>
<span id="cb38-33">  </span>
<span id="cb38-34">}</span></code></pre></div>
</div>
</section>
<section id="testando-a-função" class="level2">
<h2 class="anchored" data-anchor-id="testando-a-função">Testando a função</h2>
<p>Feito tudo isto. Agora podemos testar a função com outras cidades.</p>
<section id="são-caetano-do-sul" class="level3">
<h3 class="anchored" data-anchor-id="são-caetano-do-sul">São Caetano do Sul</h3>
<p>São Caetano do Sul é uma boa cidade teste, porque ela é bem pequena então os resultados não demoram tanto para carregar.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb39" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1">scs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map_altitude</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"São Caetano Do Sul"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">k =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">z =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>)</span>
<span id="cb39-2">scs<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>plot</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/2023-10-mapas-altitude/index_files/figure-html/unnamed-chunk-38-1.png" style="width:100.0%;height:100.0%" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Os demais mapas gerados foram feitos em resolução bastante elevada, então os códigos podem demorar várias horas para executar. Recomendo começar testando com valores menores de <code>z</code>. Mesmo em alta resolução, há melhorias possíveis nos gráficos como mudanças no “enquadramento” do mapa e também na escolha das quebras da legenda. Ainda assim, o resultado é muito bom.</p>
</section>
<section id="fortaleza" class="level3">
<h3 class="anchored" data-anchor-id="fortaleza">Fortaleza</h3>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb40" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1">fortaleza <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map_altitude</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fortaleza"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">z =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span>)</span>
<span id="cb40-2">fortaleza<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>plot</span></code></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/static/maps/elevation_xx_fortaleza.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</section>
<section id="osasco" class="level3">
<h3 class="anchored" data-anchor-id="osasco">Osasco</h3>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb41" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1">osa <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map_altitude</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Osasco"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">k =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">z =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>)</span>
<span id="cb41-2">osa<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>plot</span></code></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/static/maps/elevation_xx_osasco.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</section>
<section id="belo-horizonte" class="level3">
<h3 class="anchored" data-anchor-id="belo-horizonte">Belo Horizonte</h3>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb42" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map_altitude</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Belo Horizonte"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">k =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">z =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>plot</span></code></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/static/maps/elevation_xx_belo_horizonte.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</section>
<section id="porto-alegre" class="level3">
<h3 class="anchored" data-anchor-id="porto-alegre">Porto Alegre</h3>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb43" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map_altitude</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Porto Alegre"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">k =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">z =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span>)</span></code></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/static/maps/elevation_xx_porto_alegre.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</section>
<section id="curitiba" class="level3">
<h3 class="anchored" data-anchor-id="curitiba">Curitiba</h3>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb44" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map_altitude</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Curitiba"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">k =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">z =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>)</span></code></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/static/maps/elevation_xx_curitiba.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</section>
<section id="brasília" class="level3">
<h3 class="anchored" data-anchor-id="brasília">Brasília</h3>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb45" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map_altitude</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Brasília"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">k =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">z =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>)</span></code></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/2023-09-brasilia/images/elevation_brasilia.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</section>
</section>
</section>
<section id="concluindo" class="level1">
<h1>Concluindo</h1>
<p>Funções são elementos fundamentais na linguagem <code>R</code>. De fato, <em>pacotes</em> nada mais são do que <em>famílias de funções</em>, que dividem algum objetivo em comum. E o <code>R</code>, grosso modo, é um grande repositório de pacotes, que são chamados para executar alguma tarefa. Pode levar algum tempo para se acostumar a pensar e a escrever código desta maneira, mas os ganhos são tremendos.</p>
<p>Funções permitem <strong>escalar e automatizar o seu trabalho</strong>, diminuem a quantidade de erros no seu código e facilitam a sua vida no longo prazo. Não se enfatizou muito os ganhos de eficiência de usar processamento paralelo neste post; contudo, depois que se cria funções é relativamente simples implementar elas com <strong>processamento paralelo</strong>.</p>
<p>Boas funções são modulares: pode-se <strong>reutilizar elas em outros projetos ou mesmo em novos pacotes</strong>. A reutilização destas funções, naturalmente, vai expondo as suas fragilidades e fomenta um <em>mindset</em> de melhorias incrementais. No post, criamos uma função que gera um mapa com a altitude das vias numa cidade. Esta função pode ser melhorada de diversas maneiras:</p>
<ol type="1">
<li>Permitir que se crie o mapa de qualquer cidade do Brasil.</li>
<li>Permitir que se troque a paleta de cores.</li>
<li>Permitir que se defina as quebras dos grupos manualmente.</li>
<li>Permitir que se faça um “zoom” de certa área numa cidade.</li>
</ol>
<p>Vale notar, por fim, que <strong>funções costumam ser abstrações de um código previamente construído</strong>. Não é fácil simplesmente começar a escrever uma função que importa e limpa uma base de dados, sem antes explorar esta base, por tentativa e erro. É importante ganhar intuição, da mesma maneira como fizemos neste post, mapeando somente uma cidade em particular. Assim, é melhor começar resolvendo um, dois ou até três casos particulares antes de tentar generalizar o processo numa função.</p>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Chamar muitos pacotes numa mesma sessão pode levar a muitos conflitos entre funções com o mesmo nome. Isto não é um problema muito sério já que sempre é possível especificar <code>nome_pacote::nome_funcao</code>.↩︎</p></li>
<li id="fn2"><p>Na verdade, o código encontra todos os elementos com a classe <code>table</code> na página.↩︎</p></li>
<li id="fn3"><p>Para uma introdução aos tipos de objetos espaciais (<em>raster</em> e <em>vector</em>) veja <a href="https://r.geocompx.org/spatial-class">Lovelace (2023)</a>.↩︎</p></li>
<li id="fn4"><p>Existem alguns métodos que ajudam a escolher um número “ótimo” de clusters, como o “elbow method” mas vale lembrar que clustering é muito mais arte do que ciência. Clustering envolve agrupar dados semelhantes em um número finito de grupos, mas há inúmeras maneiras de definir “semelhante”; além disso, o algoritmo de clustering sempre chega num agrupamento, qualquer que seja a escolha do número de grupos. Assim, é importante frisar que estes resultados são mais explortatórios, por assim dizer.↩︎</p></li>
<li id="fn5"><p>Declarar explicitamente o pacote utilizado é a melhor maneira de escrever novas funções. Isto garante que a função vai funcionar em qualquer contexto onde o pacote estiver instalado. A longo prazo, isto também permite que se use a mesma função em outro projeto ou até mesmo dentro de um novo pacote. Vale notar que algumas funções base como <code>mean</code>, <code>round</code>, <code>findInterval</code>, etc. não precisam ser declaradas pois elas fazem parte do base-R.↩︎</p></li>
<li id="fn6"><p>Note que isto torna a função limitada, pois temos dados somente das 200 cidades mais populosas do Brasil. Outro fator importante é que estamos usando o nome da cidade como input. Se a tabela fosse expandida para incluir todas as cidades do Brasil seria necessário alterar o argumento pois há cidades com nome duplicado.<br>
Este tipo de generalização está fora do escopo deste post.↩︎</p></li>
<li id="fn7"><p>Em geral, desde que o loop seja bem feito ele não será muito lento. Para consultar boas práticas de como fazer bons loops consulte <a href="https://bookdown.org/content/d1e53ac9-28ce-472f-bc2c-f499f18264a3/loops.html">Best Coding Practices for R</a>. Uma comparação recente da velocidade de loops no R está disponível em <a href="https://jmsallan.netlify.app/blog/2021-03-05-on-the-performance-of-for-loops-in-r/">On the performance of for loops in R</a>.↩︎</p></li>
<li id="fn8"><p>Alternativamente, pode-se usar <code>parallel::mclapply</code>, mas esta função, infelizmente só funciona em sistemas MacOs e Linux.↩︎</p></li>
</ol>
</section></div> ]]></description>
  <category>tutorial-R</category>
  <category>mapas</category>
  <category>ggplot-2</category>
  <guid>https:://www.restateinsight.com/posts/general-posts/2023-10-mapas-altitude/index.html</guid>
  <pubDate>Sun, 15 Oct 2023 03:00:00 GMT</pubDate>
  <media:content url="https:://www.restateinsight.com/static/maps/elevation_xx_fortaleza.svg" medium="image" type="image/svg+xml"/>
</item>
<item>
  <title>Weekly Viz: Nascimentos no Brasil</title>
  <dc:creator>Vinicius Oike</dc:creator>
  <link>https:://www.restateinsight.com/posts/general-posts/2023-10-wv-nascimentos-brasil/index.html</link>
  <description><![CDATA[ 




<section id="nascimentos-no-brasil" class="level1">
<h1>Nascimentos no Brasil</h1>
<p>Tende-se a pensar que a data de nascimento de um indivíduo é algo completamente aleatório. Afinal, ninguém escolhe precisamente quando vai nascer. Alguns atribuem significado profundo à data de nascimento: a depender do horário, dia e mês a pessoa terá tendências a ser mais de uma forma do que outra. Nascer no mês impróprio pode ser um mal negócio para a vida toda.</p>
<p>Já na cultura popular é comum especular que os nascimentos seguem alguns ciclos da vida. As estações do ano regulam as safras de comida, a temperatura, a disposição para sair de casa e, muito acreditam, o desejo sexual. Os feriados, as festividades, o carnaval, as vitórias no campeonato de futebol, tudo isso - imagina-se - tem algum efeito sobre a natalidade no país, nove meses no futuro.</p>
<p>No campo da economia, pode-se especular que os ciclos de crescimento econômico e, sobretudo, os ciclos de desemprego devem ter algum efeito sobre os nascimentos.</p>
<section id="o-mês-de-nascimento" class="level2">
<h2 class="anchored" data-anchor-id="o-mês-de-nascimento">O mês de nascimento</h2>
<p>Usando dados do IBGE, mais especificamente das Estatísticas do Registro Civil, pode-se calcular o número total de nascimentos em cada mês desde 2003. Grosso modo, nos últimos vinte anos, março, abril e maio foram os três meses com maior número de nascimentos (27,23%). Já os meses do final do ano, outubro, novembro e dezembro foram os meses com menor número de nascimentos (22,95%).</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/2023-10-wv-nascimentos-brasil/index_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
<p>Olhando para a série mensal do nascimentos fica mais fácil de ver o padrão dos dados. De 2003 a 2015, o número de nascidos permaneceu estável entre 230 e 240 mil. A recessão econômica de 2015-17 parece ter tido um efeito severo sobre a natalidade: a série cai do seu pico, acima de 260 mil, para o menor valor registrado até agora, abaixo de 200 mil. Após o término da recessão, a série se recupera parcialmente, mas registra tendência de queda desde a metade de 2018.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/2023-10-wv-nascimentos-brasil/index_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
<p>Não há muita diferença entre o gráfico abaixo, que mostra o número absoluto de nascimentos a cada mês, e o primeiro. Uma distinção é que fica mais fácil perceber como os números de 2020 e 2021 são menores que os demais da série histórica.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/2023-10-wv-nascimentos-brasil/index_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>


</section>
</section>

 ]]></description>
  <category>ggplot2</category>
  <category>data-visualization</category>
  <category>brasil</category>
  <category>weekly-viz</category>
  <guid>https:://www.restateinsight.com/posts/general-posts/2023-10-wv-nascimentos-brasil/index.html</guid>
  <pubDate>Fri, 13 Oct 2023 03:00:00 GMT</pubDate>
  <media:content url="https:://www.restateinsight.com/static/images/wv_nascimentos_brasil.png" medium="image" type="image/png" height="89" width="144"/>
</item>
<item>
  <title>A filosofia do Tidyverse</title>
  <dc:creator>Vinicius Oike</dc:creator>
  <link>https:://www.restateinsight.com/posts/general-posts/2023-09-tidyverse/index.html</link>
  <description><![CDATA[ 




<section id="tidyverse" class="level1">
<h1>Tidyverse</h1>
<p>O <a href="https://tidyverse.tidyverse.org">tidyverse</a> é um metapacote, ou conjunto de pacotes. Pode-se pensar no tidyverse como uma família de pacotes, unidos por uma filosofia comum; grosso modo, os pacotes que compõem o tidyverse tem o mesmo objetivo: facilitar a manipulação de dados. Estes pacotes criaram uma nova forma de se escrever código, que substitui boa parte ou mesmo todas as funções base do R. Atualmente, o tidyverse parece estar se consolidando como a variante dominante do R. De fato, a maior parte dos pacotes do tidyverse consta na lista dos mais baixados no repositório CRAN.</p>
<p>O tidyverse é intimamente ligado com o estatístico <a href="https://hadley.nz">Hadley Wickham</a>, criador ou co-criador da maioria dos seus pacotes, e autor do <a href="https://vita.had.co.nz/papers/tidy-data.pdf">influente artigo</a> em que ele define o que é “tidy” data. Ele também é autor de diversos livros didáticos como <a href="https://r4ds.hadley.nz">R for Data Science</a> e <a href="https://ggplot2-book.org">ggplot2: Elegant graphics for Data Analysis</a>, que ajudaram a popularizar o tidyverse.</p>
<p>Wickham também tem posição de liderança dentro da Posit (antigamente conhecida como RStudio), que mantém o GUI mais popular de R e que patrocina inúmeras <a href="https://posit.co/resources/">atividades vinculadas com o aprendizado de R</a>, que costumam enfatizar os pacotes do tidyverse. De fato, tornou-se lugar comum começar a se ensinar R pelo tidyverse como se vê pela prevalência de cursos no <a href="https://www.coursera.org/specializations/tidyverse-data-science-r">Coursera</a> ou <a href="https://www.datacamp.com/courses/introduction-to-the-tidyverse">Datacamp</a>.</p>
<p>Quando se olha para a curta história do tidyverse é difícil explicar o porquê do seu enorme sucesso, mas é fato que este conjunto de pacotes se tornou um dialeto dominante dentro da comunidade do R. As funções do tidyverse tem algumas vantagens importantes sobre o base-R.</p>
<section id="consistência-e-qualidade" class="level3">
<h3 class="anchored" data-anchor-id="consistência-e-qualidade">Consistência e qualidade</h3>
<p>As funções do tidyverse possuem uma característica ausente na maior parte das funções base do R: consistência. As funções do tidyverse oferecem consistência sintática: o nome da funções segue certas convenções e a ordem dos argumentos segue regras previsíveis.</p>
<p>Um exemplo imediato é o pacote <code>stringr</code>, que serve para manipulação de strings. Todas as funções deste pacote começam com prefixo <code>str_</code> e seus argumentos seguem a lógica: <code>string</code> e <code>pattern</code> como em <code>str_detect(string, pattern)</code><sup>1</sup>. Além disso, as funções são mais otimizadas em relação às funções base do R.</p>
<p>O <code>purrr</code> faz algo similar, ao simplificar a família de funções <code>apply</code> em diversas funções <code>map_*</code>. Neste caso, além da consistência sintática, as funções <code>map_*</code> também garantem a consistência do output, em termos da classe do objeto que é retornado como resultado da função. Isto é uma grande vantagem, especialmente quando comparado com a função <code>sapply</code> que “simplifica” o output de maneiras às vezes imprevisíveis.</p>
<p>Em termos de eficiência, o tidyverse costuma ganhar das funções equivalentes em base-R. O <code>dplyr</code>/<code>tidyr</code>, de maneira geral, garante manipulações de dados muito mais velozes<sup>2</sup>, assim como o <code>readr</code> importa dados mais rapidamente<sup>3</sup>. As funções <code>map</code> também tem paralelos simples na família <code>future_</code> do pacote <code>furrr</code>, que permite usar processamento paralelo no R.</p>
</section>
<section id="material-de-apoio" class="level3">
<h3 class="anchored" data-anchor-id="material-de-apoio">Material de apoio</h3>
<p>Há muito material de apoio para tidyverse: livros, materiais didáticos, posts em blogs, respostas em fóruns, etc. Como citado acima, o próprio Posit produz inúmeros materiais didáticos e livros que ajudam a aprender e a ensinar tidyverse. Na medida em que o tidyverse consolida-se como o dialeto dominante isto tende a se tornar um ciclo virtuoso.</p>
<p>O R é uma linguagem bastante versátil, que reúne pesquisadores de campos distintos. Recentemente, parece haver uma convergência para o tidyverse. O campo de séries de tempo, por exemplo, agora tem o <code>tidyquant</code>, <code>fable</code> e <code>modeltime</code> que utilizam os princípios do <code>tidyverse</code>. Com o tempo, deve-se observar movimentos similares de outros campos.</p>
</section>
<section id="tudo-em-um" class="level3">
<h3 class="anchored" data-anchor-id="tudo-em-um">Tudo em um</h3>
<p>O tidyverse oferece funções que se aplicam a cada uma das etapas de uma análise de dados. Neste sentido, ele vai de ponta-a-ponta, cobrindo importação, limpeza, modelagem e visualização de dados. A natureza autocontida do tidyverse é bastante atraente pois oferece um caminho seguro para novatos no R, especialmente para quem tem interesse em ciência de dados.</p>
</section>
<section id="escalabilidade" class="level3">
<h3 class="anchored" data-anchor-id="escalabilidade">Escalabilidade</h3>
<p>O conhecimento no R muitas vezes é bastante horizontal. Cada pacote novo traz funções diferentes, que funcionam de novas maneiras e este conhecimento adquirido nem sempre se traduz para outras tarefas. Já sintaxe do <code>dplyr</code> é bastante geral, pode ser utilizada em vários contextos. O <code>dbplyr</code>, por exemplo, é um backend para databases (como BigQuery, PostgreSQL, etc.) que usa a sintaxe do <code>dplyr</code> como frontend. O mesmo acontece com <code>dtplyr</code>/<code>tidytable</code> que permite usar a sintaxe do <code>dplyr</code> junto com a eficiência do <code>data.table</code>. Até para dados complexos já existe o pacote <code>srvyr</code> que usa o <code>survey</code> como backend.</p>
</section>
<section id="facilidade-de-uso" class="level3">
<h3 class="anchored" data-anchor-id="facilidade-de-uso">Facilidade de uso</h3>
<p>Este último ponto é bastante mais contencioso. Eu acredito que o <code>tidyverse</code> é mais fácil do que base-R. Eu tenho um conhecimento razoável de base-R e avançado tanto de <code>tidyverse</code> como de <code>data.table</code>. Na minha opinião, a lógica do tidyverse de usar o nome das colunas de um <code>data.frame</code> como objetos é muito poderosa e intuitiva. Não só torna o código mais legível como também evita uma sintaxe carregada com operadores estranhos como <code>$</code>.</p>
<p>A integração com pipes também simplifica muito o workflow da análise de dados. Com o tempo, a leitura de um código em pipes torna-se natural. Por fim, fazer funções com tidyverse também é muito fácil. Especialmente no caso de funções simples, a sintaxe <code>{{x}}</code> e <code>!!x</code> facilita bastante e, de maneira geral, considero mais simples programar usando princípios “tidy” do que programar usando base-R.</p>
</section>
</section>
<section id="explorando-o-tidyverse" class="level1">
<h1>Explorando o tidyverse</h1>
<p>O “núcleo duro”, por assim dizer, do tidyverse é composto por 8 pacotes:</p>
<ul>
<li><p><code>dplyr</code></p></li>
<li><p><code>tidyr</code></p></li>
<li><p><code>tibble</code></p></li>
<li><p><code>readr</code></p></li>
<li><p><code>stringr</code></p></li>
<li><p><code>lubridate</code></p></li>
<li><p><code>forcats</code></p></li>
<li><p><code>purrr</code></p></li>
<li><p><code>ggplot2</code></p></li>
</ul>
<p>Pessoalmente, gosto muito de todos estes pacotes, a ponto de ter listado todos no meu post de <a href="https://restateinsight.com/posts/general-posts/pacotes-essenciais-r/">pacotes essenciais de R</a>. Cada um destes pacotes resolve algum problema central na análise de dados. O pacote <code>readr</code> importa os dados; o <code>tibble</code> é a plataforma que contém os dados; <code>dplyr</code> e <code>tidyr</code> limpam os dados; e, finalmente, <code>ggplot2</code> visualiza os dados. Os pacotes <code>lubridate</code>, <code>forcats</code> e <code>stringr</code> lidam com as três classes importantes de dados: datas, factors e texto. Por fim, o pacote <code>purrr</code> amarra todo este ecossistema de pacotes numa abordagem de programação funcional que é elegante e eficiente.</p>
<p>Além dos pacotes core, o tidyverse traz junto consigo outros pacotes importantes como <code>rvest</code>/<code>xml2</code>/<code>httr</code>, para webscrapping, <code>jsonlite</code>/<code>readxl</code>/<code>haven</code>/<code>feather</code>, para importação de outros tipos de arquivos de dados e <code>modelr</code>/<code>broom</code> para modelagem de dados e apresentação de resultados.</p>
<section id="o-tidyverse-em-números" class="level2">
<h2 class="anchored" data-anchor-id="o-tidyverse-em-números">O tidyverse em números</h2>
<p>Olhando para as estatísticas do CRAN, vê-se que os pacotes do tidyverse são muito relevantes dentro do ecossistema. Os dados compilados abaixo mostram o retrato dos pacotes do CRAN em 05 de setembro de 2023, quando havia cerca de 19.800 pacotes ativos.</p>
<p>Atualmente, cerca de um terço dos pacotes no CRAN dependem de algum dos pacotes core do tidyverse. O crescimento desta razão tem sido crescente: de todos os pacotes ativos em 2023, 40% dependem diretamente do tidyverse. Note que no gráfico abaixo, o ano de publicação reflete o ano da versão mais recente de cada pacote. Assim, pacotes ativos cuja última atualização foi anterior a 2016 dificilmente vão possuir alguma dependência com os pacotes do tidyverse já que a maioria deles não existia nesta época.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/2023-09-tidyverse/index_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
<p>Vale lembrar que há três tipos de “dependência” entre pacotes no R: <strong>imports</strong>, <strong>depends</strong> e <strong>suggests</strong>. Tipicamente, se um pacote A usa algumas funções de outro pacote B, então o pacote A importa (<strong>imports</strong>) o pacote B. Isto é, ele assume que o usuário tenha o pacote B instalado. Já a relação <strong>depends</strong> é mais estrita: se um pacote A <strong>depends</strong> de um pacote C então os pacotes são carregados conjuntamente quando se chama <code>library()</code><sup>4</sup>. Por fim se um pacote A usa um pacote D, em algum contexto específico, mas não requer que o usuário tenha o pacote D instalado, então o pacote A <strong>suggests</strong> o pacote D<sup>5</sup>.</p>
<p>Olhando os dados por pacote vê-se que o ggplot2 e dplyr são os mais populares.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/2023-09-tidyverse/index_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="a-filosofia-do-tidyverse" class="level2">
<h2 class="anchored" data-anchor-id="a-filosofia-do-tidyverse">A filosofia do <code>tidyverse</code></h2>
<p>A filosofia geral do <code>tidyverse</code> toma muito emprestado da gramática. As funções têm nomes de verbos que costumam ser intuitivos e são encadeados via “pipes”<sup>6</sup> que funcionam como conectivos numa frase. Em tese, isto torna o código mais legível e até mais didático. A tarefa de renomear colunas, criar variáveis e calcular uma média nos grupos torna-se “linear” no mesmo sentido em que uma frase com sujeito-verbo-objeto é linear.</p>
<section id="pipes" class="level3">
<h3 class="anchored" data-anchor-id="pipes">Pipes</h3>
<p>O pipe, essencialmente, carrega o resultado de uma função adiante numa cadeia de comandos: <code>objeto |&gt; função1 |&gt; função2 |&gt; função3</code>. Isto tem duas vantagens: primeiro, evita que você use funções compostas que são lidas “de dentro para fora” como <code>exp(mean(log(x)))</code>; e, segundo, dispensa a criação de objetos intermediários “inúteis” que estão ali somente para segurar um valor que não vai ser utilizado mais adiante.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1">model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(AirPassengers) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">time</span>(AirPassengers))</span>
<span id="cb1-2"></span>
<span id="cb1-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Função composta</span></span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fitted</span>(model)))</span>
<span id="cb1-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Usando pipes</span></span>
<span id="cb1-6">model <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fitted</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>()</span>
<span id="cb1-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Usando objetos intermediários</span></span>
<span id="cb1-8">x1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fitted</span>(model)</span>
<span id="cb1-9">x2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(x1)</span>
<span id="cb1-10">x3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(x2)</span></code></pre></div>
</div>
<p>Num contexto de manipulação de dados pode-se ter algo como o código abaixo.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">tab_vendas_cidade <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dados <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb2-2">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Renomeia colunas</span></span>
<span id="cb2-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">date =</span> data, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">city =</span> cidade, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">variable =</span> vendas, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">value =</span> valor) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb2-4">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Transforma colunas</span></span>
<span id="cb2-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb2-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">value =</span> value <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>,</span>
<span id="cb2-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">date =</span> readr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">parse_date</span>(date, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">format =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%Y-%b%-d"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">locale =</span> readr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">locale</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pt"</span>)),</span>
<span id="cb2-8">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">year =</span> lubridate<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">year</span>(date)</span>
<span id="cb2-9">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb2-10">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Agrupa pela coluna year e calcula algumas estatísticas</span></span>
<span id="cb2-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(year) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb2-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(</span>
<span id="cb2-13">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">total =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(value),</span>
<span id="cb2-14">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">count =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n</span>()</span>
<span id="cb2-15">  )</span></code></pre></div>
</div>
<p>Em base-R o mesmo código ficaria algo como o descrito abaixo.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(dados) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"date"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"city"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"variable"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"value"</span>)</span>
<span id="cb3-2"></span>
<span id="cb3-3">dados<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>value <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dados<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>value <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span></span>
<span id="cb3-4">dados<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>date <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> readr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">parse_date</span>(</span>
<span id="cb3-5">  dados<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>date, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">format =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%Y-%b%-d"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">locale =</span> readr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">locale</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pt"</span>)</span>
<span id="cb3-6">  )</span>
<span id="cb3-7">dados<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>year <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> lubridate<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">year</span>(dados<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>date)</span>
<span id="cb3-8"></span>
<span id="cb3-9">tab_vendas_cidade <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tapply</span>(</span>
<span id="cb3-10">  dados<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>value,</span>
<span id="cb3-11">  dados<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>city,</span>
<span id="cb3-12">  \(x) {<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">total =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(x), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">count =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(x))}</span>
<span id="cb3-13">  )</span></code></pre></div>
</div>
<p>Há um tempo atrás argumentava-se contra o uso de “pipes”, pois estes dificultavam a tarefa de encontrar bugs no código. Isto continua sendo parcialmente verdade, mas as funções do <code>tidyvserse</code> atualmente têm mensagens de erro bastante ricas e permitem encontrar a fonte do erro com relativa facilidade. Ainda assim, não se recomenda encadear funções em excesso, i.e., pipes com 10 funções ou mais<sup>7</sup>.</p>
</section>
<section id="funções" class="level3">
<h3 class="anchored" data-anchor-id="funções">Funções</h3>
<p>Outra filosofia do <code>tidyverse</code> é de que tarefas rotineiras devem ser transformadas em funções específicas. Neste sentido, os pacotes <code>dplyr</code>, <code>tidyr</code> e afins são recheados de funções, às vezes com nomes muito semelhantes e com usos redundantes. As funções <code>starts_with</code> e <code>ends_with</code>, por exemplo, são casos específicos da função <code>matches</code>. Há funções que permitem até duas formas de grafia como <code>summarise</code> e <code>summarize</code>. Outras como <code>slice_min</code> e <code>slice_max</code> são convenientes mas são literalmente: <code>arrange + slice</code>.</p>
<p>Somando somente os dois principais pacotes, <code>dplyr</code> e <code>tidyr</code>, há 360 funções disponíveis. Contraste isto com o <code>data.table</code> que permite fazer 95% das transformações de dados somente com <code>dt[i, j, by = c(), .SDcols = cols]</code>.</p>
<p>Mesmo as funções base do <code>R</code> costumam ser mais sucintas do que códigos em <code>tidyverse</code>. No exemplo abaixo, a função <code>tapply</code> consegue o mesmo resultado que o código mais extenso feito com <code>dplyr</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tapply</span>(mtcars<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>mpg, mtcars<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>cyl, mean)</span>
<span id="cb4-2"></span>
<span id="cb4-3">mtcars <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb4-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(cyl) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb4-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">avg =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(cyl))</span></code></pre></div>
</div>
<p>As vantagens do <code>tidyverse</code> se tornam mais evidentes com o tempo. De fato, o pacote permite abstrações muito poderosas, e eventualmente, pode-se fazer um código centenas de vezes mais sucinto combinando as suas funções. Em outros casos, as funções do tidyverse são simplesmente muito convenientes.</p>
<p>Tome a <code>starts_with</code>, por exemplo, que seleciona as colunas que começam de uma certa forma. Suponha uma tabela simples em que há múltiplas colunas cujos nomes começam com a letra “x”. O código em tidyverse é muito mais limpo que o código em base-R.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> df <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb5-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(date, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">starts_with</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>))</span>
<span id="cb5-3"></span>
<span id="cb5-4">df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> df[, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"date"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(df)[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^x"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(df))])]</span>
<span id="cb5-5">df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> df[, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"date"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(df)[stringr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_detect</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(df), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^x"</span>)])]</span></code></pre></div>
</div>
<p>O exemplo abaixo é inspirado <a href="https://www.r-bloggers.com/2023/03/unlocking-the-power-of-purrr-how-to-create-multiple-lags-like-a-pro-in-r/">neste post</a>, que mostra como calcular lags de uma série de tempo que esteja em um <code>data.frame</code>. Calcular defasagens de uma série de tempo é uma tarefa um pouco árdua quando se usa somente funções base. O código abaixo mostra não somente a elegância do tidyverse mas também a facilidade em se criar funções a partir do tidyverse.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">calculate_lags <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(df, var, lags) {</span>
<span id="cb6-2">  </span>
<span id="cb6-3"> map_lag <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> lags <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">partial</span>(lag, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> .x))</span>
<span id="cb6-4"> out <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> df <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb6-5">   <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb6-6">     <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.cols =</span> {{var}},</span>
<span id="cb6-7">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.fns =</span> map_lag,</span>
<span id="cb6-8">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.names =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"{.col}_lag{lags}"</span>)</span>
<span id="cb6-9">     )</span>
<span id="cb6-10"> </span>
<span id="cb6-11"> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(out)</span>
<span id="cb6-12">}</span>
<span id="cb6-13"></span>
<span id="cb6-14">df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb6-15">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">date =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">time</span>(AirPassengers),</span>
<span id="cb6-16">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">value =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(AirPassengers)</span>
<span id="cb6-17">)</span>
<span id="cb6-18"></span>
<span id="cb6-19">df <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">calculate_lags</span>(value, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>()</span>
<span id="cb6-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#       date value value_lag1 value_lag2 value_lag3</span></span>
<span id="cb6-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1 1949.000   112         NA         NA         NA</span></span>
<span id="cb6-22"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 2 1949.083   118        112         NA         NA</span></span>
<span id="cb6-23"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 3 1949.167   132        118        112         NA</span></span>
<span id="cb6-24"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 4 1949.250   129        132        118        112</span></span>
<span id="cb6-25"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 5 1949.333   121        129        132        118</span></span>
<span id="cb6-26"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 6 1949.417   135        121        129        132</span></span></code></pre></div>
</div>
</section>
<section id="desvantagens" class="level3">
<h3 class="anchored" data-anchor-id="desvantagens">Desvantagens</h3>
<p>O lado negativo da abordagem “gramatical” é que para não-falantes de inglês muitas destas vantagens são despercebidas<sup>8</sup> e o resultado é somente um código “verborrágico”, cheio de funções. Além disso, pode-se argumentar que há ambiguidades inerentes na linguagem. A função <code>filter</code>, por exemplo, é utilizada para <em>filtrar</em> as linhas de um <code>data.frame</code>, mas podia, igualmente, chamar-se <code>select</code>, que <em>selecionaria</em> as linhas de um <code>data.frame</code>. A função <code>select</code>, contudo, é usada para <em>selecionar</em> as colunas de um <code>data.frame</code>.</p>
<p>Um fato particularmente irritante do <code>tidyverse</code> é a frequência com que os pacotes mudam. Na maior parte das vezes, as mudanças são positivas, mas isto faz com que o código escrito em <code>tidyverse</code> não seja sustentável ao longo do tempo.</p>
<p>Eu demorei um bom tempo para entender as funções <code>tidyr::gather</code> e <code>tidyr::spread</code> e, atualmente, ambas foram descontinuadas e substituídas pelas funções <code>pivot_longer</code> e <code>pivot_wider</code><sup>9</sup>. As funções <code>mutate_if</code>, <code>mutate_at</code> e similares do <code>dplyr</code> foram todas suprimidas pela sinataxe mais geral do <code>across</code>. A função <code>tidyr::separate</code> agora está sendo substituída por <code>separate_wider_position</code> e <code>separate_wider_delim</code>.</p>
<p>Mesmo um código bem escrito há poucos anos atrás tem grandes chances de não funcionar mais porque as funções foram alteradas ou descontinuadas. Em 2021, Wickham discutiu este problema abertamente <a href="https://posit.co/resources/videos/maintaining-the-house-the-tidyverse-built/">numa palestra</a>. Desde então, o tidyverse tem melhorado a sua política de <a href="https://lifecycle.r-lib.org/articles/stages.html">manutenção de funções</a>.</p>
<p>A velocidade e eficiência das funções do tidyverse pode ser um problema, mas atualmente existem diversas boas soluções como o já citado <code>tidytable</code>. Particularmente, são raras as situações em que a velocidade do tidyverse me incomoda.</p>
<p>Atualmente, parece haver um consenso crescente de que a melhor forma de começar a aprender R é começando pelo <code>tidyverse</code>; esta visão não é livre de críticos como de <a href="https://matloff.wordpress.com/2022/04/02/greatly-revised-edition-of-tidyverse-skeptic/">Norm Matloff, professor de estatística da UC Davis</a>. Essencialmente, Matloff considera que o <code>tidyverse</code> é muito complexo para iniciantes: há muitas funções para se aprender e o incentivo à programação funcional torna o código muito abstrato. O tidyverse também esconde o uso do base-R e não ensina operadores básicos como <code>[[</code> e <code>$</code>. Matloff também considera que “pipes” prejudicam o aprendizado pois dificultam a tarefa de encontrar a fonte dos erros no código.</p>
</section>
</section>
</section>
<section id="à-força-de-uma-conclusão" class="level1">
<h1>À força de uma conclusão</h1>
<p>O <code>tidyverse</code> é um conjunto de pacotes muito úteis que atualmente dominam o ecossistema do R. Pessoalmente, acredito que a melhor forma de aprender R é começando pelo <code>tidyverse</code>. As suas vantagens mais do que compensam as suas falhas. Além disso, o fato dele ser o dialeto dominante de R é, por si só, um bom motivo para aprendê-lo.</p>
<p>A crítica de Matloff é válida em um ponto importante: em grande parte, o tidyverse substitui o base-R e dispensa o seu aprendizado. Isto cria uma lacuna importante que eventualmente vai causar prejuízos. Neste sentido, recomendo dois livros para aprender base-R e os princípios mais gerais da linguagem:</p>
<ul>
<li><p><a href="https://rstudio-education.github.io/hopr/">Grolemund, G. Hands-on programming with R</a></p></li>
<li><p><a href="http://adv-r.had.co.nz">Wickham, H. Advanced R. 1a ed.</a> - É importante notar a edição. A edição mais recente deste livro omite bastante do base-R.</p></li>
</ul>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>As funções base <code>gsub</code>, <code>grep</code> e <code>grepl</code>, por exemplo seguem o padrão <code>pattern</code>, <code>string</code>. Já a função <code>strsub</code> usa o padrão <code>string</code>, <code>pattern</code>. Para mais diferenças entre as funções base para manipulação de texto e o <code>stringr</code> <a href="https://stringr.tidyverse.org/articles/from-base.html">consulte este material</a>.↩︎</p></li>
<li id="fn2"><p>Existem diversos benchmarks que atestam os ganhos do <code>dplyr</code> em relação ao base-R. Veja, por exemplo, este <a href="https://www.r-bloggers.com/2022/10/efficiency-comparison-of-dplyr-and-tidyr-functions-vs-base-r/">comparativo</a>. Apesar disto, o <code>dplyr</code> é menos eficiente que seu concorrente <code>data.table</code>. Existem algumas alternativas como <a href="https://dtplyr.tidyverse.org">dtplyr</a> e, mais recentemente, <a href="https://markfairbanks.github.io/tidytable/">tidytable</a>, que fornecem a velocidade do data.table com a sintaxe do <code>dplyr</code>.↩︎</p></li>
<li id="fn3"><p>Similarmente ao <code>dplyr</code>, o <code>readr</code> também perde para seu concorrente <code>data.table::fread</code>. Contudo, o pacote <code>vroom</code> oferece uma alternativa mais veloz ao <code>readr</code> dentro do universo tidyverse.↩︎</p></li>
<li id="fn4"><p>O pacote <code>ggforce</code>, por exemplo, <em>depends</em> do <code>ggplot2</code>. Isto significa que <code>library(ggforce)</code> automaticamente carrega o pacote <code>ggplot2</code>.↩︎</p></li>
<li id="fn5"><p>Em geral, os pacotes sugeridos (<strong>suggests</strong>) são listados para os desenvolvedores do pacote ou utilizados para testes e exemplos. Você provavelmente já deve ter visto algum exemplo que começa com: <code>if (require("pacote")) { … }</code>. O pacote <code>nnet</code>, por exemplo, não depende nem importa outros pacotes, mas utiliza o pacote <code>MASS</code> em seus exemplos; assim, o pacote <code>nnet</code> suggests o pacote <code>MASS</code>. Também existem casos onde um pacote tem mais capacidades ou melhor performance quando os pacotes sugeridos estão instalados; nestes casos, recomenda-se instalar o pacote com <code>install.packages(dependencies = TRUE)</code>`.↩︎</p></li>
<li id="fn6"><p>Para saber mais sobre pipes e a diferença entre o novo pipe nativo <code>|&gt;</code> e o pipe <code>|&gt;</code> do <code>magrittr</code> veja meu post sobre o assunto.↩︎</p></li>
<li id="fn7"><p>Para mais sobre pipes consulte o <a href="https://restateinsight.com/posts/general-posts/2023-09-pipes-in-r/">meu post sobre o assunto</a>.↩︎</p></li>
<li id="fn8"><p>No fundo, isto é ainda mais um incentivo para aprender inglês.↩︎</p></li>
<li id="fn9"><p>Tecnicamente, elas foram “superseded”, ou suplatandas. Isto significa que elas continuam existindo exatamente da forma como sempre existiram e que não receberão mais atualizações.↩︎</p></li>
</ol>
</section></div> ]]></description>
  <category>tidyverse</category>
  <category>data-science</category>
  <category>R</category>
  <guid>https:://www.restateinsight.com/posts/general-posts/2023-09-tidyverse/index.html</guid>
  <pubDate>Mon, 09 Oct 2023 03:00:00 GMT</pubDate>
</item>
<item>
  <title>Life Satisfaction and GDP per capita</title>
  <dc:creator>Vinicius Oike</dc:creator>
  <link>https:://www.restateinsight.com/posts/general-posts/2023-09-happiness/index.html</link>
  <description><![CDATA[ 




<section id="replicating-the-plot" class="level1">
<h1>Replicating the plot</h1>
<p>In this tutorial post I will replicate this graph, from OurWorldInData (OWID) using <code>ggplot2</code>. The original graph is available at <a href="https://ourworldindata.org/happiness-and-life-satisfaction#the-link-between-happiness-and-income">OWID website</a>. The plot shows the correlation between GDP per capita and self-reported happiness. The income data comes from the <a href="https://data.worldbank.org/indicator/NY.GDP.PCAP.PP.KD">World Bank</a> and is in 2017 constant PPP dollars: this ensures the data is comparable across countries since it accounts for both inflation and different costs of living. The happiness data comes from the <a href="https://worldhappiness.report">World Happiness Report</a>.</p>
<p><img src="https:://www.restateinsight.com/static/images/owid_happiness.png" class="img-fluid"></p>
<p>This plot has several attractive features including how colors are used to represent continents and how size is used to show the population of each country.</p>
<p>To follow this tutorial make sure all of the packages below are installed.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Packages needed to replicate the code</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggrepel)</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(showtext)</span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(readr)</span>
<span id="cb1-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb1-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(janitor)</span></code></pre></div>
</div>
<section id="the-data" class="level2">
<h2 class="anchored" data-anchor-id="the-data">The Data</h2>
<p>The first step is acquiring the data. Luckily, the csv data is readily available at the OWID website. For convenience I stored a smaller version of the dataset in my Github. The code below imports the data directly into the R session.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">owid <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> readr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_csv</span>(</span>
<span id="cb2-2">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://github.com/viniciusoike/restateinsight/raw/main/static/data/gdp-vs-happiness.csv"</span></span>
<span id="cb2-3">  )</span></code></pre></div>
</div>
<p>The data shows both the GDP per capita and the Happiness Indicator for several countries across many years. The code below selects only the most recent that is available for each country.</p>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> owid <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb3-2">  janitor<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">clean_names</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb3-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename</span>(</span>
<span id="cb3-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">life_satisfaction =</span> cantril_ladder_score,</span>
<span id="cb3-5">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gdppc =</span> gdp_per_capita_ppp_constant_2017_international,</span>
<span id="cb3-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pop =</span> population_historical_estimates</span>
<span id="cb3-7">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb3-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(gdppc), <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(life_satisfaction)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb3-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gdppc =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log10</span>(gdppc)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb3-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(entity) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb3-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(year <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(year)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb3-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ungroup</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb3-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(entity, pop, gdppc, life_satisfaction)</span>
<span id="cb3-14"></span>
<span id="cb3-15">dim_continent <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> owid <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb3-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(entity, continent) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb3-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(continent), <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(entity)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb3-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">distinct</span>()</span>
<span id="cb3-19"></span>
<span id="cb3-20">dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(dat, dim_continent, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"entity"</span>)</span></code></pre></div>
</details>
</div>
</section>
</section>
<section id="the-plot" class="level1">
<h1>The Plot</h1>
<section id="bubbles" class="level2">
<h2 class="anchored" data-anchor-id="bubbles">Bubbles</h2>
<p>The most essential aspect of this plot is summarized in the code below. The plot shows each country as <em>bubble</em>, where the size of the bubble is proportional to its population. The position of each bubble shows the country’s GDP per capita (on the horizontal axis) and average life satisfaction (on the vertical axis). Finally, the color of each bubble corresponds to the continent of the country. Since many of the observations overlap the original plot uses a bit of transparency.</p>
<p>Note that I use <code>shape = 21</code> to get a special circle with two colors. The <code>color</code> argument controls the circle’s border while the <code>fill</code> argument controls the circle’s interior color.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(dat, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> gdppc, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> life_satisfaction)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(</span>
<span id="cb4-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> continent, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> pop),</span>
<span id="cb4-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#A5A9A9"</span>,</span>
<span id="cb4-5">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>,</span>
<span id="cb4-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span></span>
<span id="cb4-7">    )</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/2023-09-happiness/index_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="highlighting-the-countries" class="level2">
<h2 class="anchored" data-anchor-id="highlighting-the-countries">Highlighting the countries</h2>
<p>This part is mostly manual labor. I create a simple vector with the names of all countries highlighted in the original plot. This vector allows me to create a dummy variable that indicates whether the name of the country should be plotted or not. For increased flexibility I store this as an auxiliar <code>tibble</code> called <code>dftext</code>. In the end, this didn’t make much of a difference but it can be helpful in cases where one needs finer control over the text that is plotted.</p>
<p>I <code>ggrepel</code> to avoid overlapping the text labels.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Countries to highlight</span></span>
<span id="cb5-2">sel_countries <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(</span>
<span id="cb5-3">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Ireland"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Qatar"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Hong Kong"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Switzerland"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"United States"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"France"</span>,</span>
<span id="cb5-4">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Japan"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Costa Rica"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Russia"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Turkey"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"China"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Brazil"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Indonesia"</span>,</span>
<span id="cb5-5">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Iran"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Egypt"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Botswana"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Lebanon"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Philippines"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Bolivia"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Pakistan"</span>,</span>
<span id="cb5-6">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Bangladesh"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Nepal"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Senegal"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Burkina Faso"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Ethiopia"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Tanzania"</span>,</span>
<span id="cb5-7">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Democratic Republic of Congo"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mozambique"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" Somalia"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Chad"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Malawi"</span>,</span>
<span id="cb5-8">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Burundi"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"India"</span>)</span>
<span id="cb5-9"></span>
<span id="cb5-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Auxiliar tibble with names of countries to highlight</span></span>
<span id="cb5-11">dftext <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb5-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">highlight =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">if_else</span>(entity <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> sel_countries, entity, <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>))</span>
<span id="cb5-13"></span>
<span id="cb5-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Creates a base plot with the bubbles plus the text labels</span></span>
<span id="cb5-15">base_plot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(dat, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> gdppc, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> life_satisfaction)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(</span>
<span id="cb5-17">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> continent, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> pop),</span>
<span id="cb5-18">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#A5A9A9"</span>,</span>
<span id="cb5-19">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>,</span>
<span id="cb5-20">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span></span>
<span id="cb5-21">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-22">  ggrepel<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text_repel</span>(</span>
<span id="cb5-23">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> dftext,</span>
<span id="cb5-24">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> gdppc, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> life_satisfaction, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> highlight, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> continent),</span>
<span id="cb5-25">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span></span>
<span id="cb5-26">    )</span>
<span id="cb5-27"></span>
<span id="cb5-28">base_plot</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/2023-09-happiness/index_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="scales-and-colors" class="level2">
<h2 class="anchored" data-anchor-id="scales-and-colors">Scales and colors</h2>
<p>The x-axis of the original plot is in a logarithmic scale and its labels highlight specific values (1000, 2000, 5000, …, 100000). The numbers are formatted with a comma and dollar sign. The y-axis is much more straightforward since the numbers are simple integers ranging from 3 to 7.</p>
<p>The default size of the bubbles in <code>ggplot</code> is small so I use <code>scale_size_continuous</code> to increase them. I have no idea how to emulate the original size legend (the circle within a circle) so I omit it.</p>
<p>Both the interior color of the bubbles and the text follow a particular color scheme. I got the exact colors of the original plot by exporting it to SVG. By default, the legend key inherits its colors. So the legend shows slightly transparent round circles. To get solid colored squares I override this default behavior.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">xbreaks <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.3</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.7</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span>
<span id="cb6-2">xlabels <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2000</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5000</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20000</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100000</span>)</span>
<span id="cb6-3">xlabels <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"$"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">format</span>(xlabels, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">big.mark =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">","</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scientific =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>))</span>
<span id="cb6-4"></span>
<span id="cb6-5">colors <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#A2559C"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#00847E"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#4C6A9C"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#E56E5A"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#9A5129"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#883039"</span>)</span>
<span id="cb6-6"></span>
<span id="cb6-7">base_plot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> base_plot <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-8">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Adds labels to the log scale</span></span>
<span id="cb6-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks =</span> xbreaks, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> xlabels) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-10">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Adds labels to the y-axis scale</span></span>
<span id="cb6-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-12">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Increases the size of the bubbles</span></span>
<span id="cb6-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_size_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">range =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-14">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Adds colors to the bubbles and text labels</span></span>
<span id="cb6-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> colors) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> colors) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-17">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Removes the size and color legend</span></span>
<span id="cb6-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guides</span>(</span>
<span id="cb6-19">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>,</span>
<span id="cb6-20">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>,</span>
<span id="cb6-21">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Override default behaviour to get solid colors</span></span>
<span id="cb6-22">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guide_legend</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">override.aes =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">22</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span>
<span id="cb6-23">    )</span>
<span id="cb6-24"></span>
<span id="cb6-25">base_plot</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/2023-09-happiness/index_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="text-elements" class="level2">
<h2 class="anchored" data-anchor-id="text-elements">Text elements</h2>
<p>The code below inserts the other textual elements of the plot.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Caption</span></span>
<span id="cb7-2">caption <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Source: World Happiness Report (2023), Data compiled from multiple sources by World Bank</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">Note: GDP per capita is expressed in international-$ at 2017 prices.</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">OurWorldInData.org/happiness-and-life-satisfacation/"</span></span>
<span id="cb7-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Subtitle</span></span>
<span id="cb7-4">subtitle <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Self-reported life satisfaction is measured on a scale ranging from 0-10, where 10 is the highest possible life</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">satisfaction. GDP per capita is adjusted for inflation and differences in the cost of living between countries."</span></span>
<span id="cb7-5"></span>
<span id="cb7-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Adds textual elements to base plot</span></span>
<span id="cb7-7">base_plot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> base_plot <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(</span>
<span id="cb7-9">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Self-reported life satisfaction vs. GDP per capita, 2022"</span>,</span>
<span id="cb7-10">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">subtitle =</span> subtitle,</span>
<span id="cb7-11">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GDP per capita"</span>,</span>
<span id="cb7-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Life satisfaction (country average; 0-10)"</span>,</span>
<span id="cb7-13">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">caption =</span> caption</span>
<span id="cb7-14">    )</span>
<span id="cb7-15"></span>
<span id="cb7-16">base_plot</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/2023-09-happiness/index_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="font" class="level2">
<h2 class="anchored" data-anchor-id="font">Font</h2>
<p>Looking at the source code of the page it seems that most of the text is displayed in <a href="https://fonts.google.com/specimen/Lato?query=lato">Lato</a> while the titles are displayed in <a href="https://fonts.google.com/specimen/Playfair+Display">Playfair Display</a>. I import both fonts using <code>font_add_google</code> and load them using <code>showtext</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">font_add_google</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Playfair Display"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Playfair Display"</span>)</span>
<span id="cb8-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">font_add_google</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Lato"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Lato"</span>)</span>
<span id="cb8-3"></span>
<span id="cb8-4">showtext<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">showtext_auto</span>()</span></code></pre></div>
</div>
</section>
<section id="theme" class="level2">
<h2 class="anchored" data-anchor-id="theme">Theme</h2>
<p>This step really does the magic.</p>
<p>For the theme, I use <code>theme_minimal</code> as a template, since its fairly similar to the OWID graphic. I start by removing the minor panel grids from the background and changing the major panel grids. Then, I alter the textual elements of the graphic and make minor tweaks to the legend and plot margins.</p>
<p>All of the text is in different shades of gray with exception of the title, the axis titles, and the legend text which are all in plain black. Figuring out the sizes of the text is mostly a trial and error process. Almost all of the text is small except the main title and the text on the axes.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">base_plot <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb9-4">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Background grid</span></span>
<span id="cb9-5">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid.minor =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb9-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid.major =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#DDDDDD"</span>),</span>
<span id="cb9-7">    </span>
<span id="cb9-8">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Text elements (change font)</span></span>
<span id="cb9-9">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Lato"</span>),</span>
<span id="cb9-10">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Lato"</span>),</span>
<span id="cb9-11">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Caption, title, and subtitle</span></span>
<span id="cb9-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.caption =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#777777"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>),</span>
<span id="cb9-13">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(</span>
<span id="cb9-14">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#444444"</span>,</span>
<span id="cb9-15">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Playfair Display"</span>,</span>
<span id="cb9-16">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>),</span>
<span id="cb9-17">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.subtitle =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#666666"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>),</span>
<span id="cb9-18">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Axis text</span></span>
<span id="cb9-19">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#000000"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>),</span>
<span id="cb9-20">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#666666"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>),</span>
<span id="cb9-21">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Legend</span></span>
<span id="cb9-22">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.key.size =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pt"</span>),</span>
<span id="cb9-23">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"right"</span>,</span>
<span id="cb9-24">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>),</span>
<span id="cb9-25">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Margin</span></span>
<span id="cb9-26">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.margin =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">margin</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>))</span>
<span id="cb9-27">  )</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/2023-09-happiness/index_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="final-result" class="level1">
<h1>Final result</h1>
<p>The graphic below is the final version. For convenience I collect all of the code needed to reproduce this graphic into two chunks. I also change <code>geom_text_repel</code> for <code>geom_label_repel</code> to insert a small white background on the names of the countries to improve readability.</p>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Theme</span></span>
<span id="cb10-2">theme_owid <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb10-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid.minor =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb10-5">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid.major =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#DDDDDD"</span>),</span>
<span id="cb10-6">    </span>
<span id="cb10-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Lato"</span>),</span>
<span id="cb10-8">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Lato"</span>),</span>
<span id="cb10-9">    </span>
<span id="cb10-10">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.caption =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#777777"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>),</span>
<span id="cb10-11">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(</span>
<span id="cb10-12">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#444444"</span>,</span>
<span id="cb10-13">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Playfair Display"</span>,</span>
<span id="cb10-14">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>),</span>
<span id="cb10-15">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.subtitle =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#666666"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>),</span>
<span id="cb10-16">    </span>
<span id="cb10-17">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#000000"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>),</span>
<span id="cb10-18">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#666666"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>),</span>
<span id="cb10-19">    </span>
<span id="cb10-20">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.key.size =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pt"</span>),</span>
<span id="cb10-21">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"right"</span>,</span>
<span id="cb10-22">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>),</span>
<span id="cb10-23">    </span>
<span id="cb10-24">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.margin =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">margin</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>))</span>
<span id="cb10-25">  )</span>
<span id="cb10-26"></span>
<span id="cb10-27"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Countries to highlight</span></span>
<span id="cb10-28">sel_countries <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(</span>
<span id="cb10-29">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Ireland"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Qatar"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Hong Kong"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Switzerland"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"United States"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"France"</span>,</span>
<span id="cb10-30">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Japan"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Costa Rica"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Russia"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Turkey"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"China"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Brazil"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Indonesia"</span>,</span>
<span id="cb10-31">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Iran"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Egypt"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Botswana"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Lebanon"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Philippines"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Bolivia"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Pakistan"</span>,</span>
<span id="cb10-32">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Bangladesh"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Nepal"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Senegal"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Burkina Faso"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Ethiopia"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Tanzania"</span>,</span>
<span id="cb10-33">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Democratic Republic of Congo"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mozambique"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" Somalia"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Chad"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Malawi"</span>,</span>
<span id="cb10-34">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Burundi"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"India"</span>)</span>
<span id="cb10-35"></span>
<span id="cb10-36">dftext <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb10-37">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">highlight =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">if_else</span>(entity <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> sel_countries, entity, <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>))</span>
<span id="cb10-38"></span>
<span id="cb10-39"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; x-axis labels</span></span>
<span id="cb10-40">xbreaks <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.3</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.7</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span>
<span id="cb10-41">xlabels <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2000</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5000</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20000</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100000</span>)</span>
<span id="cb10-42">xlabels <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"$"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">format</span>(xlabels, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">big.mark =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">","</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scientific =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>))</span>
<span id="cb10-43"></span>
<span id="cb10-44"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Colors</span></span>
<span id="cb10-45">colors <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#A2559C"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#00847E"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#4C6A9C"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#E56E5A"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#9A5129"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#883039"</span>)</span></code></pre></div>
</details>
</div>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(dat, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> gdppc, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> life_satisfaction)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(</span>
<span id="cb11-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> continent, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> pop),</span>
<span id="cb11-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#A5A9A9"</span>,</span>
<span id="cb11-5">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>,</span>
<span id="cb11-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span></span>
<span id="cb11-7">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-8">  ggrepel<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_label_repel</span>(</span>
<span id="cb11-9">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> dftext,</span>
<span id="cb11-10">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> gdppc, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> life_satisfaction, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> highlight, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> continent),</span>
<span id="cb11-11">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,</span>
<span id="cb11-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">force =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,</span>
<span id="cb11-13">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Lato"</span>,</span>
<span id="cb11-14">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label.padding =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lines"</span>),</span>
<span id="cb11-15">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label.size =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span></span>
<span id="cb11-16">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks =</span> xbreaks, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> xlabels) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_size_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">range =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> colors) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> colors) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guides</span>(</span>
<span id="cb11-23">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>,</span>
<span id="cb11-24">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>,</span>
<span id="cb11-25">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guide_legend</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">override.aes =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">22</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span>
<span id="cb11-26">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-27">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(</span>
<span id="cb11-28">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Self-reported life satisfaction vs. GDP per capita, 2022"</span>,</span>
<span id="cb11-29">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">subtitle =</span> subtitle,</span>
<span id="cb11-30">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GDP per capita"</span>,</span>
<span id="cb11-31">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Life satisfaction (country average; 0-10)"</span>,</span>
<span id="cb11-32">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">caption =</span> caption</span>
<span id="cb11-33">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-34">  theme_owid</span></code></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/2023-09-happiness/index_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>


<!-- -->

</section>

 ]]></description>
  <category>data-visualization</category>
  <category>tutorial-R</category>
  <category>ggplot2</category>
  <category>english</category>
  <guid>https:://www.restateinsight.com/posts/general-posts/2023-09-happiness/index.html</guid>
  <pubDate>Fri, 22 Sep 2023 03:00:00 GMT</pubDate>
</item>
<item>
  <title>Pipes</title>
  <dc:creator>Vinicius Oike</dc:creator>
  <link>https:://www.restateinsight.com/posts/general-posts/2023-09-pipes-in-r/index.html</link>
  <description><![CDATA[ 




<section id="pipes" class="level1">
<h1>Pipes</h1>
<section id="introdução" class="level2">
<h2 class="anchored" data-anchor-id="introdução">Introdução</h2>
<p>A partir da versão 4.1.0, o <code>R</code> passou a oferecer o operador <code>|&gt;</code> chamado de pipe (literalmente, <em>cano</em>). Este operador foi fortemente inspirado no operador homônimo <code>%&gt;%</code> do popular pacote <code>magrittr</code>. Neste post, explico como utilizar o pipe nativo e como ele difere do pipe do <code>magrittr</code>.</p>
<p>O operador pipe (em ambos os casos), essencialmente, ordena uma função composta.</p>
<p>Lembrando um pouco sobre funções compostas: a expressão abaixo mostra a aplicação de três funções onde primeiro aplica-se a função <code>f</code> sobre x, depois a função <code>g</code> e, por fim, a função <code>h</code>. Lê-se a função de dentro para fora.</p>
<p><img src="https://latex.codecogs.com/png.latex?%0Ah(g(f(x)))%20=%20%5Cdots%0A"></p>
<p>Para tornar o exemplo mais concreto considere o exemplo abaixo onde calcula-se a média geométrica de uma sequência de números aleatórios.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1">x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span>
<span id="cb1-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Calcula a média geométrica</span></span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(x)))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 10.00694</code></pre>
</div>
</div>
<p>Usando a mesma notação acima, aplica-se primeiro a função <code>mean</code> (f), depois a função <code>log</code> (g) e, por fim, a função <code>exp</code> (h). Usando o operador pipe, pode-se reescrever a expressão da seguinte forma.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 10.00694</code></pre>
</div>
</div>
<p>Note que o resultado da função vai sendo “carregado” da esquerda para a direita sucessivamente. Para muitos usuários, a segunda sintaxe é mais intuitiva e/ou fácil de ler. No segundo código a ordem em que o nome das funções aparecem coincide com a ordem da sua aplicação.</p>
<p>Por fim, note que o uso de várias funções numa mesma linha de código também nos poupa de ter de criar objetos intermediários como no exemplo abaixo.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">media_x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(x)</span>
<span id="cb5-2">log_media <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(media_x)</span>
<span id="cb5-3">media_geometrica_x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(log_media)</span>
<span id="cb5-4"></span>
<span id="cb5-5">media_geometrica_x</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 10.00694</code></pre>
</div>
</div>
<p>Os exemplos acima funcionaram sem problemas porque usou-se o operador pipe para “abrir” uma função composta. O argumento de cada função subsequente é o resultado da função antecedente: funciona como uma linha de montagem, em que cada nova etapa soma-se ao resultado da etapa anterior.</p>
<p>Quando o resultado da função anterior não vai diretamente no primeiro argumento da função subsequente, precisa-se usar o operador <code>_</code> (underline). Este operador serve como um <em>placeholder</em>: indica onde que o resultado da etapa anterior deve entrar. No exemplo abaixo, uso o placeholder para colocar a base de dados filtrada no argumento <code>data</code> dentro da função <code>lm</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">carros_4 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">subset</span>(mtcars, cyl <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>)</span>
<span id="cb7-2">fit <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(mpg <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> wt, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> carros_4)</span>
<span id="cb7-3"></span>
<span id="cb7-4">mtcars <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb7-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">subset</span>(cyl <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb7-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(mpg <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> wt, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> _)</span></code></pre></div>
</div>
<p>Por fim, temos o caso das funções anônimas. Uma função anônima é simplesmente uma função sem nome que é chamada uma única vez. Infelizmente, a sintaxe de um pipe com uma função anônima é bastante carregada.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">objeto <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> (\(...) {define função})()</span></code></pre></div>
</div>
<p>O exemplo repete o código acima, mas agora usa uma função anônima para pegar o R2 ajustado da regressão.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">mtcars <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb9-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">subset</span>(cyl <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb9-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(mpg <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> wt, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> _) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb9-4">  (\(x) {<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(x)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>adj.r.squared})()</span></code></pre></div>
</div>
</section>
<section id="limitações" class="level2">
<h2 class="anchored" data-anchor-id="limitações">Limitações</h2>
<p>Imagine agora que se quer calcular o erro absoluto médio de uma regressão. Lembre-se que o EAM é dado por</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Ctext%7BEAM%7D%20=%20%5Cfrac%7B1%7D%7BN%7D%5Csum_%7Bi%20=%201%7D%5E%7BN%7D%7Ce_%7Bi%7D%7C%0A"></p>
<p>onde <img src="https://latex.codecogs.com/png.latex?e_%7Bi%7D"> é o resíduo da regressão. O código abaixo mostra como fazer isto usando pipes.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Estima uma regressão qualquer</span></span>
<span id="cb10-2">fit <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(mpg <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> wt, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> mtcars)</span>
<span id="cb10-3"></span>
<span id="cb10-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Calcula o erro absoluto médio</span></span>
<span id="cb10-5">fit <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">residuals</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.340642</code></pre>
</div>
</div>
<p>Note, contudo, que a situação fica um pouco mais complicada no caso em que se quer calcular a raiz do erro quadrado médio.</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Ctext%7BREQM%7D%20=%20%5Csqrt%7B%5Cfrac%7B1%7D%7BN%7D%5Csum_%7Bi%20=%201%7D%5E%7BN%7D(e_%7Bi%7D)%5E2%7D%0A"></p>
<p>Na sintaxe convencional temos</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">residuals</span>(fit)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.949163</code></pre>
</div>
</div>
<p>O problema é que a exponenciação acontece via um operador e não uma função. Nenhuma dos exemplos abaixo funciona.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1">fit <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">residuals</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>()</span></code></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error: &lt;text&gt;:1:23: unexpected '^'
1: fit |&gt; residuals() |&gt; ^
                          ^</code></pre>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1">fit <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">residuals</span>()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>()</span></code></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error: function '^' not supported in RHS call of a pipe</code></pre>
</div>
</div>
<p>Para chegar no mesmo resultado, novamente precisa-se usar uma sintaxe bastante esotérica que envolve passar o resultado de <code>residuals</code> para uma função anônima.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1">fit <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">residuals</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> (\(y) {<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(y<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))})()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.949163</code></pre>
</div>
</div>
</section>
<section id="resumo" class="level2">
<h2 class="anchored" data-anchor-id="resumo">Resumo</h2>
<p>Assim, apesar de muito útil, o operador pipe tem suas limitações. O operador sempre espera encontrar uma função à sua direita; a única maneira de seguir <code>|&gt;</code> com um operador é criando uma função anônima, cuja sintaxe é um pouco carregada. Pode-se resumir os principais fatos sobre o operador pipe:</p>
<ol type="1">
<li><em>Simplifica funções compostas</em>. Na expressão <code>x |&gt; f |&gt; g</code> o operador <code>|&gt;</code> aplica a função <code>f</code> sobre o objeto <code>x</code> usando <code>x</code> como argumento de <code>f</code>. Depois, aplica a função <code>g</code> sobre o resultado de <code>f(x)</code>. Isto é equivalente a <code>g(f(x))</code>.</li>
<li><em>Evita a definição de objetos intermediários</em>. O uso de pipes evita que você precise “salvar” cada passo intermediário da aplicação de funções. Isto deixa seu espaço de trabalho mais limpo e também consome menos memória.</li>
<li><em>Placeholder</em>. Quando o objeto anterior não serve como o primeiro argumento da função subsequente, usa-se o placeholder para indicar onde ele deve ser inserido. <code>x |&gt; f(y = 2, data = _)</code>.</li>
<li><em>Função anônima</em>. Em casos mais complexos, é necessário montar uma função anônima usando <code>x |&gt; (\(y) {funcao})()</code>.</li>
</ol>
</section>
<section id="aplicações-comuns" class="level2">
<h2 class="anchored" data-anchor-id="aplicações-comuns">Aplicações comuns</h2>
<section id="tidyverse" class="level3">
<h3 class="anchored" data-anchor-id="tidyverse">tidyverse</h3>
<p>O uso mais comum de pipes é junto com funções do <code>tidyverse</code>, que foram desenvolvidas com este intuito.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span></code></pre></div>
</div>
<p>As funções do tidyverse (quase) sempre recebem um <code>data.frame</code> como primeiro argumento; isto facilita a construção de código usando pipe, pois basta encadear as funções em sequência.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1">filtered_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(mtcars, wt <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb21-2">grouped_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(filtered_df, cyl)</span>
<span id="cb21-3">tbl <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(grouped_df, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">avg =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(mpg), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">count =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n</span>())</span>
<span id="cb21-4"></span>
<span id="cb21-5">mtcars <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb21-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(wt <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb21-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(cyl) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb21-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">avg =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(mpg))</span></code></pre></div>
</div>
<p>A leitura do código fica mais “gramatical”: pegue o objeto <code>mtcars</code> filtre as linhas onde <code>wt &gt; 2</code> depois agrupe pela variável <code>cyl</code> e, por fim, tire uma média de <code>mpg</code>.</p>
<p>Pode-se terminar um pipe com uma chamada para um plot em <code>ggplot2</code> para uma rápida visualização dos resultados</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1">mtcars <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb22-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(wt <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb22-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(cyl) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb22-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">avg =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(mpg)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb22-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.factor</span>(cyl), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> avg)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb22-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_col</span>()</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/2023-09-pipes-in-r/index_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" style="width:70.0%"></p>
</figure>
</div>
</div>
</div>
<p>Não se recomenda fazer longas sequências de pipes, pois o código pode acabar muito confuso para quem está lendo. O exemplo abaixo mostra justamente isto.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(realestatebr)</span>
<span id="cb23-2"></span>
<span id="cb23-3">abecip <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_abecip_indicators</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cached =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb23-4"></span>
<span id="cb23-5">abecip<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>units <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb23-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>date) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb23-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yq =</span> lubridate<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">floor_date</span>(date, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">unit =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"quarter"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb23-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(yq, name) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb23-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">total =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(value)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb23-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">separate</span>(name, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">into =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"category"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"type"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb23-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(category <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"units"</span>, type <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"total"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb23-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> yq, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> total, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> type)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_area</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_brewer</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_light</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"top"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/2023-09-pipes-in-r/index_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" style="width:70.0%"></p>
</figure>
</div>
</div>
</div>
<p>O código abaixo mostra um exemplo de como quebrar o código acima em passos distintos. Além de ficar mais organizado, o código salva objetos úteis como a tabela agrupada por trimestre, antes de se aplicar o filtro de unidades. A tabela final também fica salva num objeto, permitindo que se faça outros gráficos e análises com estes dados.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1">units <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> abecip<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>units</span>
<span id="cb24-2"></span>
<span id="cb24-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Converte em long e agrega os dados por trimestre</span></span>
<span id="cb24-4">tab_quarter <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> units <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb24-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>date) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb24-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yq =</span> lubridate<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">floor_date</span>(date, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">unit =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"quarter"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb24-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(yq, name) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb24-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">total =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(value)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb24-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">separate</span>(name, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">into =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"category"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"type"</span>)) </span>
<span id="cb24-10"></span>
<span id="cb24-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Filtra apenas dados de unidades e retira o 'total'</span></span>
<span id="cb24-12">tab_units <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> tab_quarter <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb24-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(category <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"units"</span>, type <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"total"</span>)</span>
<span id="cb24-14"></span>
<span id="cb24-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Faz o gráfico</span></span>
<span id="cb24-16"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(tab_units, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> yq, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> total, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> type)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb24-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_area</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb24-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_brewer</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb24-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_light</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb24-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"top"</span>)</span></code></pre></div>
</div>
</section>
<section id="sf" class="level3">
<h3 class="anchored" data-anchor-id="sf">sf</h3>
<p>O pacote <code>sf</code> também funciona bem com pipes pois há vários casos em que se quer aplicar múltiplas funções num mesmo objeto.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Transforma um data.frame num objeto espacial (pontos)</span></span>
<span id="cb25-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># depois faz a interseção dos pontos num polígono e</span></span>
<span id="cb25-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># por fim limpa as geometrias</span></span>
<span id="cb25-4"></span>
<span id="cb25-5">dat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb25-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_as_sf</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">coords =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lng"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lat"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">crs =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4326</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb25-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_join</span>(poly) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb25-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(gid)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb25-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_make_valid</span>()</span></code></pre></div>
</div>
<p>O exemplo abaixo é emprestado do pacote <code>censobr</code> e mostra como combinar a manipulação de dados do <code>dplyr</code> com objetos espaciais manipulados via <code>sf</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(censobr)</span>
<span id="cb26-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(geobr)</span>
<span id="cb26-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(sf)</span>
<span id="cb26-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(mapview)</span>
<span id="cb26-5"></span>
<span id="cb26-6">pop <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_population</span>(</span>
<span id="cb26-7">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">year =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2010</span>,</span>
<span id="cb26-8">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">columns =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"code_weighting"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"abbrev_state"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V0010"</span>)</span>
<span id="cb26-9">  )</span>
<span id="cb26-10"></span>
<span id="cb26-11">df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> pop <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb26-12">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(abbrev_state <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RJ"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb26-13">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(code_weighting) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb26-14">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">total_pop =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(V0010)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb26-15">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">collect</span>()</span>
<span id="cb26-16"></span>
<span id="cb26-17">areas <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_weighting_area</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3304557</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">showProgress =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb26-18"></span>
<span id="cb26-19">areas <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb26-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_transform</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">crs =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4326</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb26-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_make_valid</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb26-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(df, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"code_weighting"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb26-23">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mapview</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">zcol =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"total_pop"</span>)</span></code></pre></div>
<div class="cell-output-display">

<div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-666a1747a099a026561a" style="width:70%;height:355.968px;"></div>
<script type="application/json" data-for="htmlwidget-666a1747a099a026561a">{"x":{"options":{"minZoom":1,"maxZoom":52,"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"preferCanvas":false,"bounceAtZoomLimits":false,"maxBounds":[[[-90,-370]],[[90,370]]]},"calls":[{"method":"addProviderTiles","args":["CartoDB.Positron","CartoDB.Positron","CartoDB.Positron",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["CartoDB.DarkMatter","CartoDB.DarkMatter","CartoDB.DarkMatter",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenStreetMap","OpenStreetMap","OpenStreetMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery","Esri.WorldImagery","Esri.WorldImagery",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenTopoMap","OpenTopoMap","OpenTopoMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"createMapPane","args":["polygon",420]},{"method":"addPolygons","args":[[[[{"lng":[-43.349439,-43.34273589999999,-43.3414169,-43.3387556,-43.3375894,-43.3350759,-43.3348641,-43.3349755,-43.3344846,-43.333635,-43.3300604,-43.3307188,-43.327836,-43.32895879999999,-43.33575990000001,-43.3411198,-43.3426494,-43.3425605,-43.3466033,-43.3468847,-43.3479012,-43.34823509999999,-43.3495953,-43.349439],"lat":[-22.8841886,-22.8838356,-22.8804727,-22.8797577,-22.8822734,-22.8803402,-22.8803495,-22.88184649999999,-22.88222889999999,-22.8798026,-22.8800556,-22.8785016,-22.8763385,-22.8749956,-22.8742541,-22.8671948,-22.8687117,-22.8713121,-22.8740076,-22.877836,-22.8776129,-22.8810136,-22.8820645,-22.8841886]}]],[[{"lng":[-43.3504222,-43.347314,-43.3480567,-43.3434011,-43.3391898,-43.3393897,-43.33410699999999,-43.3242581,-43.320562,-43.32281589999999,-43.3238992,-43.325087,-43.3262314,-43.32941710000001,-43.33435699999999,-43.3371028,-43.3494574,-43.3504222],"lat":[-22.8610203,-22.86340999999999,-22.8652218,-22.8690921,-22.8667804,-22.86433479999999,-22.8590917,-22.8646284,-22.8643511,-22.8615727,-22.8552635,-22.8556482,-22.8534169,-22.85476289999999,-22.85381479999999,-22.856004,-22.85922189999999,-22.8610203]}]],[[{"lng":[-43.3411198,-43.33432080000001,-43.33143309999999,-43.3317752,-43.3256173,-43.3241965,-43.3251499,-43.3242581,-43.33240120000001,-43.33410699999999,-43.3393897,-43.3387017,-43.3411198],"lat":[-22.8671948,-22.874808,-22.8749364,-22.8727941,-22.8707399,-22.8689782,-22.8668905,-22.8646284,-22.8594275,-22.8590917,-22.86433479999999,-22.86543259999999,-22.8671948]}]],[[{"lng":[-43.3628977,-43.3573727,-43.3513761,-43.3527316,-43.3509063,-43.352875,-43.35041030000001,-43.35085850000001,-43.3549732,-43.3601903,-43.3579037,-43.3603949,-43.3576533,-43.3605391,-43.3620457,-43.3628977],"lat":[-22.855212,-22.8566034,-22.8555154,-22.8539925,-22.85340039999999,-22.8486288,-22.8437545,-22.8386822,-22.8397509,-22.8359277,-22.843633,-22.8467773,-22.8491701,-22.8498962,-22.8532965,-22.855212]}]],[[{"lng":[-43.3371028,-43.3365718,-43.33889499999999,-43.3428638,-43.3439656,-43.3428936,-43.3445644,-43.3481903,-43.34991520000001,-43.35104409999999,-43.3521604,-43.352875,-43.35096619999999,-43.3527316,-43.3513761,-43.35368889999999,-43.3513038,-43.3494574,-43.3371028],"lat":[-22.856004,-22.846836,-22.8453367,-22.8476921,-22.8427419,-22.841681,-22.8399555,-22.8397856,-22.838409,-22.846139,-22.8458964,-22.8486288,-22.8539018,-22.8539925,-22.8555154,-22.8570014,-22.8599531,-22.85922189999999,-22.856004]}]],[[{"lng":[-43.3565553,-43.3585408,-43.3572271,-43.3524979,-43.3457877,-43.3397233,-43.33983810000001,-43.3420249,-43.34273589999999,-43.349439,-43.3466033,-43.34199590000001,-43.3480567,-43.347314,-43.3515486,-43.3534768,-43.3525612,-43.3542678,-43.3527338,-43.35664440000001,-43.35704330000001,-43.3565553],"lat":[-22.88000229999999,-22.8804747,-22.8830032,-22.8843499,-22.8890077,-22.8898421,-22.8850935,-22.8827815,-22.8838356,-22.8841886,-22.8740076,-22.8697929,-22.8652218,-22.86340999999999,-22.8594553,-22.8626948,-22.8648735,-22.8650096,-22.86761,-22.8706402,-22.8735964,-22.88000229999999]}]],[[{"lng":[-43.24955130000001,-43.2439046,-43.2412918,-43.24261449999999,-43.2411481,-43.24263759999999,-43.2421561,-43.2411098,-43.2359805,-43.22401929999999,-43.226281,-43.22860439999999,-43.2314315,-43.2324162,-43.2330576,-43.23569759999999,-43.23475550000001,-43.2364368,-43.2335857,-43.2328038,-43.2326254,-43.2338472,-43.23051789999999,-43.2387003,-43.2475327,-43.2498958,-43.2529118,-43.24955130000001],"lat":[-22.8877643,-22.8975155,-22.8961777,-22.8975035,-22.9043738,-22.9062739,-22.9061397,-22.9045843,-22.9094617,-22.9098203,-22.909273,-22.9065418,-22.9084127,-22.9016618,-22.9006136,-22.9008629,-22.8997298,-22.8978773,-22.8975623,-22.8953236,-22.89132799999999,-22.8896583,-22.8865246,-22.888931,-22.8887245,-22.8824753,-22.8846707,-22.8877643]}]],[[{"lng":[-43.3826262,-43.37478369999999,-43.3759293,-43.3777906,-43.3785076,-43.3734756,-43.3677019,-43.3699754,-43.36867419999999,-43.3702962,-43.366172,-43.3671367,-43.3622307,-43.363164,-43.3605391,-43.3576533,-43.3603949,-43.3631819,-43.36823810000001,-43.3750535,-43.37899110000001,-43.37761589999999,-43.3800737,-43.3826262],"lat":[-22.8557486,-22.8591307,-22.8613686,-22.860746,-22.8636452,-22.8768572,-22.8777085,-22.87173989999999,-22.8696035,-22.8692492,-22.8669573,-22.863732,-22.8555439,-22.854314,-22.8498962,-22.8491701,-22.8467773,-22.8468045,-22.8475785,-22.8507325,-22.8502131,-22.8540326,-22.8548075,-22.8557486]}]],[[{"lng":[-43.3677019,-43.3600557,-43.3565553,-43.35719239999999,-43.3527338,-43.3542678,-43.352429,-43.3534768,-43.3518436,-43.3536897,-43.36254309999999,-43.3671367,-43.366172,-43.3702962,-43.36867419999999,-43.3694186,-43.3677019],"lat":[-22.8777085,-22.878288,-22.88000229999999,-22.8716524,-22.86761,-22.8650096,-22.8645948,-22.8626948,-22.8595951,-22.8566949,-22.8556237,-22.863732,-22.8669573,-22.8692492,-22.8696035,-22.871917,-22.8777085]}]],[[{"lng":[-43.1731088,-43.1757145,-43.1756346,-43.1745551,-43.1731088],"lat":[-22.8381671,-22.83658239999999,-22.8375878,-22.8389715,-22.8381671]}],[{"lng":[-43.16069520000001,-43.1617371,-43.1649854,-43.16482559999999,-43.1618724,-43.16069520000001],"lat":[-22.8144454,-22.8114274,-22.812051,-22.8138167,-22.8151082,-22.8144454]}],[{"lng":[-43.1671704,-43.1671932,-43.16760379999999,-43.1673865,-43.1671704],"lat":[-22.82932529999999,-22.8291319,-22.8292448,-22.8293458,-22.82932529999999]}],[{"lng":[-43.1625218,-43.1628741,-43.1631496,-43.16279100000001,-43.1625218],"lat":[-22.8197296,-22.8194644,-22.8199995,-22.8201017,-22.8197296]}],[{"lng":[-43.18777089999999,-43.1897762,-43.1849061,-43.1844085,-43.1757389,-43.1767747,-43.1754965,-43.1727199,-43.1730171,-43.1746833,-43.1737116,-43.1701857,-43.1682547,-43.1637375,-43.16558200000001,-43.169704,-43.174868,-43.1764609,-43.1748234,-43.1772326,-43.1783996,-43.1752184,-43.17742579999999,-43.1805776,-43.1829059,-43.1837019,-43.1826091,-43.18370609999999,-43.18461829999999,-43.1918641,-43.187361,-43.18942550000001,-43.19234909999999,-43.1896748,-43.18777089999999],"lat":[-22.8274849,-22.8284765,-22.8299309,-22.8335532,-22.8271543,-22.8251049,-22.8238929,-22.8253694,-22.828738,-22.8294427,-22.8312091,-22.83138539999999,-22.8248171,-22.8227844,-22.8200176,-22.8215986,-22.8197364,-22.8151428,-22.8125266,-22.8106256,-22.80238169999999,-22.8011786,-22.79954369999999,-22.7991985,-22.8004536,-22.8063326,-22.8068636,-22.8063902,-22.810104,-22.8115437,-22.8162347,-22.8196967,-22.8197229,-22.8219801,-22.8274849]}]],[[{"lng":[-43.32281589999999,-43.320562,-43.315147,-43.3144302,-43.3074233,-43.3074006,-43.3028675,-43.304037,-43.30284020000001,-43.29807979999999,-43.29353369999999,-43.3012738,-43.30085039999999,-43.3026106,-43.3089565,-43.3107029,-43.3140653,-43.3155099,-43.31759349999999,-43.32381890000001,-43.32281589999999],"lat":[-22.8615727,-22.8643511,-22.8633554,-22.8613399,-22.8628241,-22.8617083,-22.859274,-22.8592093,-22.8575665,-22.85904369999999,-22.8549214,-22.85172799999999,-22.8491665,-22.8460297,-22.8503708,-22.8482761,-22.8499592,-22.8523138,-22.850922,-22.8555971,-22.8615727]}]],[[{"lng":[-43.3156226,-43.3155116,-43.31466200000001,-43.3140653,-43.3107029,-43.3089565,-43.3048736,-43.30655369999999,-43.3011285,-43.3033055,-43.3045254,-43.3073697,-43.31076609999999,-43.3125815,-43.3173109,-43.3174857,-43.3156226],"lat":[-22.84567849999999,-22.848922,-22.8484633,-22.8499592,-22.8482761,-22.8503708,-22.8472352,-22.8446918,-22.8415724,-22.8392506,-22.8401177,-22.8361842,-22.8390858,-22.8385075,-22.8409928,-22.8444369,-22.84567849999999]}]],[[{"lng":[-43.33485049999999,-43.33461620000001,-43.3308463,-43.32737030000001,-43.3300126,-43.3278215,-43.3261645,-43.3250076,-43.3199427,-43.3251654,-43.3270919,-43.33131209999999,-43.330442,-43.3322812,-43.3326039,-43.3346813,-43.3343851,-43.34084319999999,-43.340264,-43.3422045,-43.34060379999999,-43.3353762,-43.33485049999999],"lat":[-22.8330687,-22.8342643,-22.8324088,-22.8339987,-22.8388165,-22.8364571,-22.8358774,-22.8371498,-22.83504139999999,-22.8244216,-22.8225739,-22.8239325,-22.8209923,-22.8208478,-22.8179834,-22.8182525,-22.8249403,-22.82728969999999,-22.8297046,-22.8321501,-22.834006,-22.8345277,-22.8330687]}]],[[{"lng":[-43.3270919,-43.3251654,-43.3199427,-43.3186703,-43.319081,-43.3155896,-43.31018079999999,-43.3082065,-43.3129423,-43.31663759999999,-43.3308853,-43.3328316,-43.3322812,-43.330442,-43.33131209999999,-43.3270919],"lat":[-22.8225739,-22.8244216,-22.83504139999999,-22.8346987,-22.8333553,-22.8324575,-22.8334148,-22.8323196,-22.8302681,-22.8195327,-22.81266889999999,-22.818023,-22.8208478,-22.8209923,-22.8239325,-22.8225739]}]],[[{"lng":[-43.3371028,-43.33435699999999,-43.32941710000001,-43.3266756,-43.3250293,-43.3175681,-43.3231923,-43.3248317,-43.3271632,-43.3312819,-43.33404950000001,-43.3365362,-43.3371955,-43.3371028],"lat":[-22.856004,-22.85381479999999,-22.85476289999999,-22.8534206,-22.8556492,-22.8508458,-22.8444005,-22.8462123,-22.843022,-22.843957,-22.8485311,-22.8465848,-22.8519764,-22.856004]}]],[[{"lng":[-43.33052699999999,-43.3271632,-43.3265502,-43.32446939999999,-43.3231923,-43.3155099,-43.3138957,-43.31466200000001,-43.3155116,-43.3160284,-43.3175126,-43.31740599999999,-43.312525,-43.3175455,-43.3188551,-43.3250076,-43.32608389999999,-43.3325478,-43.33166,-43.33052699999999],"lat":[-22.8442415,-22.843022,-22.8452322,-22.8463013,-22.8444005,-22.8523138,-22.8502621,-22.8484633,-22.848922,-22.8450436,-22.8453451,-22.8411491,-22.8384546,-22.8372967,-22.8348354,-22.8371498,-22.8363742,-22.84232639999999,-22.8430653,-22.8442415]}]],[[{"lng":[-43.3380139,-43.3388575,-43.3367151,-43.330359,-43.32872459999999,-43.3230847,-43.325042,-43.3265726,-43.32172629999999,-43.3170373,-43.3168982,-43.31463409999999,-43.31005800000001,-43.31183639999999,-43.3145385,-43.31679759999999,-43.32141869999999,-43.3270943,-43.3267981,-43.3294222,-43.3284863,-43.33252,-43.3380139],"lat":[-22.8962085,-22.9000399,-22.9036503,-22.907674,-22.9127887,-22.9107195,-22.9094906,-22.9056174,-22.8995178,-22.8971188,-22.8935848,-22.892528,-22.8841276,-22.8805781,-22.8786632,-22.87975,-22.885414,-22.8890365,-22.8902889,-22.889747,-22.8915026,-22.8942205,-22.8962085]}]],[[{"lng":[-43.3428936,-43.3439656,-43.3428638,-43.3382786,-43.33404950000001,-43.3307324,-43.3325478,-43.3259418,-43.3302936,-43.3275942,-43.32737030000001,-43.328969,-43.3308463,-43.33461620000001,-43.33485049999999,-43.3353762,-43.34060379999999,-43.3419372,-43.3411167,-43.3462256,-43.3428936],"lat":[-22.841681,-22.8427419,-22.8476921,-22.8453393,-22.8485311,-22.8438146,-22.84232639999999,-22.8362464,-22.8387607,-22.8355018,-22.8339987,-22.8328643,-22.8324088,-22.8342643,-22.8330687,-22.8345277,-22.834006,-22.8322775,-22.8361089,-22.8392662,-22.841681]}]],[[{"lng":[-43.33143309999999,-43.32820359999999,-43.32904480000001,-43.3263775,-43.3260309,-43.32367989999999,-43.31888009999999,-43.3153138,-43.3137493,-43.3110213,-43.3116484,-43.3089595,-43.3110097,-43.3090329,-43.30876780000001,-43.315147,-43.3222927,-43.3251212,-43.3240522,-43.3256173,-43.3293308,-43.3317102,-43.33143309999999],"lat":[-22.8749364,-22.8753402,-22.8779534,-22.8777618,-22.88029209999999,-22.8782904,-22.881911,-22.8788085,-22.8795024,-22.8780817,-22.8762982,-22.87342899999999,-22.8716007,-22.8721858,-22.8699831,-22.8633554,-22.8642721,-22.8655184,-22.86834219999999,-22.8707399,-22.8715225,-22.8738109,-22.8749364]}]],[[{"lng":[-43.33983810000001,-43.3399484,-43.3380139,-43.33473069999999,-43.3284863,-43.3292862,-43.3267981,-43.3270943,-43.32141869999999,-43.31888009999999,-43.32367989999999,-43.3260309,-43.3256342,-43.3275193,-43.3303023,-43.3308436,-43.333635,-43.3344846,-43.3348641,-43.3375894,-43.3387556,-43.34091129999999,-43.341867,-43.33983810000001],"lat":[-22.8850935,-22.8925384,-22.8962085,-22.895695,-22.8915026,-22.8896648,-22.8902889,-22.8890365,-22.885414,-22.881911,-22.8782904,-22.88029209999999,-22.8788556,-22.8778071,-22.8780243,-22.8806788,-22.8798026,-22.88222889999999,-22.8803495,-22.8822734,-22.8797577,-22.8800663,-22.8829638,-22.8850935]}]],[[{"lng":[-43.41380579999999,-43.41130829999999,-43.40842049999999,-43.406614,-43.4033394,-43.40209160000001,-43.3979946,-43.3972054,-43.3952185,-43.39565229999999,-43.40238919999999,-43.4047556,-43.4066335,-43.4095473,-43.41776289999999,-43.4218019,-43.4240879,-43.42566619999999,-43.4351425,-43.43380670000001,-43.4260405,-43.41380579999999],"lat":[-22.8381191,-22.8408589,-22.8375872,-22.8392226,-22.8366449,-22.8380646,-22.8364678,-22.837868,-22.8353049,-22.8321591,-22.8251946,-22.8302331,-22.8306129,-22.8347496,-22.8262412,-22.8324645,-22.8324645,-22.8359349,-22.8408009,-22.8438281,-22.8469803,-22.8381191]}]],[[{"lng":[-43.3549732,-43.34991520000001,-43.34699539999999,-43.34101029999999,-43.34238670000001,-43.340264,-43.34084319999999,-43.345963,-43.3518124,-43.3569037,-43.3600642,-43.3549732],"lat":[-22.8397509,-22.838409,-22.8396984,-22.8359139,-22.8326723,-22.8297046,-22.82728969999999,-22.8291729,-22.8228877,-22.8260459,-22.8354799,-22.8397509]}]],[[{"lng":[-43.4065658,-43.4036856,-43.396561,-43.3979503,-43.3959025,-43.3877371,-43.3838017,-43.3889045,-43.39182,-43.3924799,-43.3961535,-43.3952185,-43.3972054,-43.3979946,-43.40209160000001,-43.4033394,-43.406614,-43.40842049999999,-43.4110078,-43.4065658],"lat":[-22.8465118,-22.8447705,-22.84533080000001,-22.8401607,-22.8404829,-22.8374546,-22.8327251,-22.8273117,-22.8267032,-22.8292758,-22.83145889999999,-22.8353049,-22.837868,-22.8364678,-22.8380646,-22.8366449,-22.8392226,-22.8375872,-22.8406281,-22.8465118]}]],[[{"lng":[-43.36782160000001,-43.3659725,-43.3638925,-43.3603949,-43.3579166,-43.360255,-43.3570774,-43.3599024,-43.3629368,-43.36278979999999,-43.3657957,-43.3681674,-43.3690106,-43.37010310000001,-43.3750377,-43.379351,-43.36782160000001],"lat":[-22.8392994,-22.83811739999999,-22.8398517,-22.8467773,-22.8438785,-22.8364166,-22.8264867,-22.8258432,-22.8226492,-22.8206568,-22.8207537,-22.8190243,-22.8163305,-22.820401,-22.8197184,-22.825144,-22.8392994]}]],[[{"lng":[-43.345963,-43.3343851,-43.3346813,-43.3328316,-43.3308853,-43.3398711,-43.3409566,-43.34529200000001,-43.3472868,-43.34715809999999,-43.3515381,-43.3512077,-43.345963],"lat":[-22.8291729,-22.8249403,-22.8182525,-22.818023,-22.81266889999999,-22.8077406,-22.8087712,-22.8086109,-22.8113932,-22.8177252,-22.8198714,-22.8227033,-22.8291729]}]],[[{"lng":[-43.3657957,-43.36278979999999,-43.362494,-43.35796499999999,-43.3512077,-43.3524578,-43.3571887,-43.3634344,-43.3674711,-43.3655045,-43.3705508,-43.36759430000001,-43.3657957],"lat":[-22.8207537,-22.8206568,-22.82319649999999,-22.8264204,-22.8227033,-22.8201644,-22.8190946,-22.8070832,-22.8049638,-22.8079011,-22.8140768,-22.8190992,-22.8207537]}]],[[{"lng":[-43.3634344,-43.3571887,-43.3519124,-43.34715809999999,-43.3472868,-43.34529200000001,-43.3409566,-43.3398711,-43.3308853,-43.3313777,-43.32759049999999,-43.34846479999999,-43.3576143,-43.36163469999999,-43.3674711,-43.3658768,-43.3634344],"lat":[-22.8070832,-22.8190946,-22.8206855,-22.8177252,-22.8113932,-22.8086109,-22.8087712,-22.8077406,-22.81266889999999,-22.8089047,-22.8025094,-22.8037693,-22.8026196,-22.8044318,-22.8049638,-22.8059075,-22.8070832]}]],[[{"lng":[-43.34077259999999,-43.3341892,-43.3368098,-43.33731640000001,-43.33619849999999,-43.34226690000001,-43.34077259999999],"lat":[-22.9807479,-22.97749439999999,-22.9715455,-22.9723518,-22.974697,-22.9779083,-22.9807479]}]],[[{"lng":[-43.3904532,-43.379351,-43.3750377,-43.37010310000001,-43.3702899,-43.36566310000001,-43.3678113,-43.37024199999999,-43.3757655,-43.3768401,-43.3796062,-43.3873815,-43.3904532],"lat":[-22.8137689,-22.825144,-22.8197184,-22.820401,-22.8130914,-22.80673729999999,-22.8050443,-22.805367,-22.8084997,-22.8108166,-22.810629,-22.8147028,-22.8137689]}]],[[{"lng":[-43.3341457,-43.32884739999999,-43.3340773,-43.3351283,-43.3321577,-43.33569610000001,-43.3341457],"lat":[-22.9775856,-22.9733586,-22.9693103,-22.972068,-22.9717988,-22.9745033,-22.9775856]}]],[[{"lng":[-43.21031430000001,-43.2102041,-43.2070088,-43.2036813,-43.1969602,-43.1904489,-43.187361,-43.1979684,-43.2040768,-43.212745,-43.214369,-43.21031430000001],"lat":[-22.8157174,-22.8182295,-22.8183617,-22.820301,-22.8188906,-22.819925,-22.8162347,-22.8067236,-22.8041534,-22.8063611,-22.8177888,-22.8157174]}]],[[{"lng":[-43.1495361,-43.14862129999999,-43.15106829999999,-43.1508484,-43.1495361],"lat":[-22.78770309999999,-22.7870148,-22.7869195,-22.7881184,-22.78770309999999]}],[{"lng":[-43.13747909999999,-43.1371592,-43.1383831,-43.1379118,-43.13747909999999],"lat":[-22.7833016,-22.7829363,-22.7827958,-22.7833617,-22.7833016]}],[{"lng":[-43.13958760000001,-43.1416397,-43.1415857,-43.1399108,-43.13958760000001],"lat":[-22.7760588,-22.7760837,-22.7766054,-22.777229,-22.7760588]}],[{"lng":[-43.16787629999999,-43.1691777,-43.169272,-43.1680586,-43.16787629999999],"lat":[-22.767645,-22.7666517,-22.7674577,-22.7690864,-22.767645]}],[{"lng":[-43.1531142,-43.15197140000001,-43.15279830000001,-43.1531905,-43.15347079999999,-43.1558565,-43.1587375,-43.1611898,-43.1623181,-43.1603012,-43.1606589,-43.1582988,-43.1531142],"lat":[-22.7750722,-22.7739103,-22.7716769,-22.7719445,-22.7729987,-22.7732745,-22.7705608,-22.7703766,-22.7715915,-22.7717717,-22.7746955,-22.7759807,-22.7750722]}],[{"lng":[-43.1685741,-43.1693732,-43.1694383,-43.16924559999999,-43.1685741],"lat":[-22.7998059,-22.800044,-22.8004627,-22.8006988,-22.7998059]}],[{"lng":[-43.15732269999999,-43.1576907,-43.1578494,-43.1575944,-43.15732269999999],"lat":[-22.8001637,-22.799851,-22.8002628,-22.800359,-22.8001637]}],[{"lng":[-43.15483589999999,-43.15575619999999,-43.15580659999999,-43.15554149999999,-43.15483589999999],"lat":[-22.7940231,-22.7933926,-22.7943343,-22.7945601,-22.7940231]}],[{"lng":[-43.1521787,-43.152218,-43.1523118,-43.1522983,-43.1521787],"lat":[-22.7902796,-22.7901728,-22.7902429,-22.7903912,-22.7902796]}],[{"lng":[-43.151226,-43.15139500000001,-43.15192769999999,-43.15183589999999,-43.151226],"lat":[-22.7896911,-22.789273,-22.7901683,-22.790723,-22.7896911]}],[{"lng":[-43.1485891,-43.1486051,-43.14949420000001,-43.1493026,-43.1485891],"lat":[-22.789456,-22.789101,-22.7889136,-22.7895102,-22.789456]}],[{"lng":[-43.1811985,-43.1817635,-43.1790609,-43.1782376,-43.18047600000001,-43.1752184,-43.16955340000001,-43.1562653,-43.15624649999999,-43.16558200000001,-43.16934639999999,-43.16811910000001,-43.170438,-43.1731511,-43.1712904,-43.1722208,-43.1749664,-43.178892,-43.1817965,-43.1829311,-43.1859264,-43.1894157,-43.19028309999999,-43.1870461,-43.18367029999999,-43.1811985],"lat":[-22.79345949999999,-22.7950382,-22.7953109,-22.79787379999999,-22.7993063,-22.8011786,-22.7934603,-22.78617629999999,-22.77960759999999,-22.7769349,-22.7808686,-22.7823002,-22.7828637,-22.779179,-22.7770007,-22.7755484,-22.7767057,-22.78315,-22.7833543,-22.7813574,-22.7846704,-22.7831248,-22.7880287,-22.7886491,-22.7913956,-22.79345949999999]}]],[[{"lng":[-43.19355150000001,-43.19020219999999,-43.1889145,-43.1900754,-43.1865016,-43.1837019,-43.1829059,-43.1782376,-43.1790609,-43.1817635,-43.1811985,-43.1824722,-43.1884733,-43.18885349999999,-43.1928411,-43.1927008,-43.1941502,-43.19760040000001,-43.1963629,-43.19355150000001],"lat":[-22.8002388,-22.8005792,-22.802001,-22.8044365,-22.8036139,-22.8063326,-22.8004536,-22.79787379999999,-22.7953109,-22.7950382,-22.79345949999999,-22.7921842,-22.7884633,-22.7948588,-22.7963777,-22.7976285,-22.79689249999999,-22.7999218,-22.8016609,-22.8002388]}]],[[{"lng":[-43.2042977,-43.1979684,-43.19183080000001,-43.1894382,-43.18461829999999,-43.18370609999999,-43.1826091,-43.1865016,-43.1900754,-43.1889145,-43.19020219999999,-43.19355150000001,-43.1963629,-43.19761150000001,-43.2012811,-43.2042977],"lat":[-22.8039503,-22.8067236,-22.8120623,-22.8105212,-22.810104,-22.8063902,-22.8068636,-22.8036139,-22.8044365,-22.802001,-22.8005792,-22.8002388,-22.8016609,-22.8000185,-22.8006506,-22.8039503]}]],[[{"lng":[-43.20408099999999,-43.2009496,-43.1975477,-43.1941502,-43.1927008,-43.1912361,-43.1933691,-43.1941406,-43.1994505,-43.2057109,-43.21027340000001,-43.2109288,-43.2094745,-43.2106263,-43.2096082,-43.2090317,-43.2123997,-43.20408099999999],"lat":[-22.80446,-22.8003111,-22.8001024,-22.79689249999999,-22.7976285,-22.79474530000001,-22.7940646,-22.7953807,-22.7935811,-22.7953926,-22.7920686,-22.794974,-22.796499,-22.7994533,-22.7991077,-22.8050295,-22.806369,-22.80446]}],[{"lng":[-43.2269824,-43.2286791,-43.228913,-43.2280869,-43.2269824],"lat":[-22.7876725,-22.7836994,-22.7879961,-22.788713,-22.7876725]}]],[[{"lng":[-43.216069,-43.2146088,-43.2138762,-43.2149614,-43.2167249,-43.2179777,-43.2189767,-43.2142018,-43.2085316,-43.2082061,-43.2123832,-43.2151785,-43.2178643,-43.2242149,-43.2278482,-43.2323517,-43.2309681,-43.2245654,-43.22236789999999,-43.22423990000001,-43.2212556,-43.21965489999999,-43.2235616,-43.225732,-43.2274955,-43.23133319999999,-43.2324809,-43.2362329,-43.2424523,-43.24315979999999,-43.2400567,-43.2410876,-43.23659309999999,-43.23606849999999,-43.2325688,-43.23154290000001,-43.2260469,-43.22160829999999,-43.2203587,-43.216069],"lat":[-22.8705351,-22.8702197,-22.8678594,-22.8635729,-22.86142959999999,-22.8632737,-22.8614839,-22.8599103,-22.8603987,-22.8582554,-22.85839379999999,-22.8569532,-22.8586895,-22.8578516,-22.8549184,-22.8471321,-22.8437951,-22.8416247,-22.8436866,-22.8465624,-22.8478646,-22.8449617,-22.8392916,-22.839183,-22.8367413,-22.8360981,-22.8384857,-22.8389856,-22.8369691,-22.8398501,-22.842303,-22.8465895,-22.85390749999999,-22.8618365,-22.8634372,-22.86653,-22.8679279,-22.8673711,-22.869166,-22.8705351]}],[{"lng":[-43.2576729,-43.257653,-43.2600038,-43.25922690000001,-43.2576729],"lat":[-22.8263747,-22.8247094,-22.82512879999999,-22.8266539,-22.8263747]}],[{"lng":[-43.2548003,-43.2553777,-43.2554992,-43.2547128,-43.2548003],"lat":[-22.8244491,-22.824229,-22.8245576,-22.8253247,-22.8244491]}],[{"lng":[-43.2658663,-43.2656922,-43.2582242,-43.2524482,-43.25161079999999,-43.24627799999999,-43.2394026,-43.2271503,-43.2166608,-43.2147877,-43.21267599999999,-43.2090317,-43.2096082,-43.2106263,-43.2094745,-43.2109288,-43.21027340000001,-43.219555,-43.22840910000001,-43.2269824,-43.2280869,-43.22987949999999,-43.2352347,-43.2406252,-43.24746529999999,-43.2523118,-43.25684750000001,-43.2610738,-43.2658663],"lat":[-22.8113042,-22.8131096,-22.8200064,-22.8229233,-22.8282562,-22.8318041,-22.83383139999999,-22.8209841,-22.817282,-22.81777779999999,-22.8058052,-22.8050295,-22.7991077,-22.7994533,-22.796499,-22.794974,-22.7920686,-22.7850334,-22.7834152,-22.7876725,-22.788713,-22.7881875,-22.7915685,-22.7911551,-22.7930662,-22.7972725,-22.7976694,-22.80376709999999,-22.8113042]}]],[[{"lng":[-43.3870037,-43.38620660000001,-43.38289220000001,-43.3789911,-43.3750535,-43.36823810000001,-43.3604949,-43.3638925,-43.3659725,-43.36782160000001,-43.3794766,-43.3850901,-43.387204,-43.3838017,-43.38535359999999,-43.3870037],"lat":[-22.8365524,-22.8375531,-22.8372553,-22.8502135,-22.8507325,-22.8475785,-22.8470575,-22.8398517,-22.83811739999999,-22.8392994,-22.82573309999999,-22.8255449,-22.8291022,-22.8327251,-22.8349319,-22.8365524]}]],[[{"lng":[-43.1222454,-43.1225634,-43.12425580000001,-43.1237648,-43.1222454],"lat":[-22.8049313,-22.8044531,-22.8059782,-22.80712,-22.8049313]}],[{"lng":[-43.10832819999999,-43.1088846,-43.1116657,-43.11172270000001,-43.10832819999999],"lat":[-22.8010994,-22.8000351,-22.8016682,-22.8032372,-22.8010994]}],[{"lng":[-43.1227153,-43.12330919999999,-43.1239241,-43.12373329999999,-43.1227153],"lat":[-22.7990135,-22.7978241,-22.7984052,-22.7992982,-22.7990135]}],[{"lng":[-43.1169553,-43.1192066,-43.11961420000001,-43.1178632,-43.1169553],"lat":[-22.8025874,-22.8028097,-22.8038473,-22.804431,-22.8025874]}],[{"lng":[-43.1112731,-43.1116755,-43.1137744,-43.11343859999999,-43.1112731],"lat":[-22.7966236,-22.7957002,-22.796395,-22.7973117,-22.7966236]}],[{"lng":[-43.1211414,-43.1211983,-43.12275289999999,-43.1224202,-43.1211414],"lat":[-22.7965014,-22.7956994,-22.7963569,-22.7971408,-22.7965014]}],[{"lng":[-43.1045825,-43.10387799999999,-43.1050245,-43.104574,-43.1045825],"lat":[-22.7912739,-22.79066209999999,-22.790926,-22.7920373,-22.7912739]}],[{"lng":[-43.1048636,-43.1049063,-43.1065882,-43.1062059,-43.1048636],"lat":[-22.7905525,-22.7901803,-22.7913038,-22.791753,-22.7905525]}],[{"lng":[-43.1011984,-43.100933,-43.1018655,-43.101753,-43.1011984],"lat":[-22.7898478,-22.7893576,-22.789937,-22.7901426,-22.7898478]}],[{"lng":[-43.0996671,-43.09904849999999,-43.1004781,-43.1003092,-43.0996671],"lat":[-22.7887429,-22.7886082,-22.7886026,-22.7893182,-22.7887429]}],[{"lng":[-43.1050482,-43.1060367,-43.1069973,-43.1061966,-43.1050482],"lat":[-22.7775854,-22.7765041,-22.7769363,-22.7777672,-22.7775854]}],[{"lng":[-43.1154637,-43.1155135,-43.1158702,-43.11567360000001,-43.1154637],"lat":[-22.77016,-22.7700063,-22.7700947,-22.770314,-22.77016]}],[{"lng":[-43.11654779999999,-43.1166286,-43.1174112,-43.1172124,-43.11654779999999],"lat":[-22.7692256,-22.7688724,-22.7691532,-22.7696043,-22.7692256]}],[{"lng":[-43.1015606,-43.10175840000001,-43.1023021,-43.1020503,-43.1015606],"lat":[-22.7628912,-22.7624939,-22.7628834,-22.7632679,-22.7628912]}],[{"lng":[-43.1145563,-43.11437530000001,-43.11504310000001,-43.1147296,-43.1145563],"lat":[-22.7696579,-22.7696426,-22.769663,-22.7698338,-22.7696579]}],[{"lng":[-43.1112403,-43.1106008,-43.1144273,-43.1081215,-43.1024496,-43.1027779,-43.1069724,-43.1084668,-43.1069667,-43.1021666,-43.1024326,-43.1042613,-43.10586850000001,-43.1093007,-43.109263,-43.1128311,-43.1099533,-43.1112403],"lat":[-22.7608911,-22.7661952,-22.7674066,-22.7699085,-22.7650914,-22.763348,-22.7631272,-22.7575402,-22.754993,-22.75245709999999,-22.7506853,-22.7509646,-22.7488702,-22.74908499999999,-22.751918,-22.75405899999999,-22.7585533,-22.7608911]}],[{"lng":[-43.1271207,-43.1290054,-43.12845169999999,-43.12650560000001,-43.12453410000001,-43.1271207],"lat":[-22.7460214,-22.7468462,-22.7483396,-22.7474587,-22.7486665,-22.7460214]}],[{"lng":[-43.11453849999999,-43.1180572,-43.12097780000001,-43.1186003,-43.11453849999999],"lat":[-22.7563221,-22.7535426,-22.7573305,-22.7586059,-22.7563221]}]],[[{"lng":[-43.4054023,-43.403854,-43.40049129999999,-43.3994962,-43.39852399999999,-43.39513830000001,-43.3942616,-43.3941336,-43.3924799,-43.39182,-43.3889045,-43.3869879,-43.3850901,-43.3794766,-43.3904532,-43.4007079,-43.40661939999999,-43.4061799,-43.4054023],"lat":[-22.8203188,-22.8226239,-22.8224907,-22.8263479,-22.8257231,-22.8287701,-22.8271694,-22.829787,-22.8292758,-22.8267032,-22.8273117,-22.8296191,-22.8255449,-22.82573309999999,-22.8137689,-22.8173897,-22.82057319999999,-22.8209568,-22.8203188]}]],[[{"lng":[-43.4095473,-43.4066335,-43.4047556,-43.4030758,-43.3961535,-43.3941336,-43.3942616,-43.39513830000001,-43.39852399999999,-43.3994962,-43.40049129999999,-43.403854,-43.4054023,-43.4148602,-43.4176744,-43.4095473],"lat":[-22.8347496,-22.8306129,-22.8302331,-22.8253699,-22.83145889999999,-22.829787,-22.8271694,-22.8287701,-22.8257231,-22.8263479,-22.8224907,-22.8226239,-22.8203188,-22.821221,-22.8263194,-22.8347496]}]],[[{"lng":[-43.3716569,-43.3717532,-43.37072089999999,-43.3680584,-43.3677939,-43.36289369999999,-43.3615387,-43.36535240000001,-43.3646822,-43.3622858,-43.36196489999999,-43.35902060000001,-43.3641947,-43.364788,-43.3629101,-43.36446479999999,-43.37386920000001,-43.373576,-43.3716569],"lat":[-22.9363275,-22.9477371,-22.9414104,-22.9418234,-22.9438641,-22.9439709,-22.9379282,-22.9365848,-22.933125,-22.9314864,-22.9288375,-22.9272894,-22.9256967,-22.9216832,-22.9189231,-22.91825489999999,-22.9232348,-22.9271181,-22.9363275]}]],[[{"lng":[-43.4190236,-43.4155767,-43.41731730000001,-43.4149039,-43.41533839999999,-43.4120509,-43.409558,-43.4086633,-43.4069635,-43.406644,-43.4048501,-43.40483890000001,-43.402334,-43.39847049999999,-43.3989467,-43.3960368,-43.3920286,-43.3919396,-43.3795297,-43.3767344,-43.37386920000001,-43.3648231,-43.3722723,-43.3715053,-43.3738401,-43.3717528,-43.37283679999999,-43.3740803,-43.375026,-43.3803616,-43.3805208,-43.37813360000001,-43.3786042,-43.3865212,-43.409169,-43.41047210000001,-43.40969630000001,-43.4110168,-43.4123359,-43.41103089999999,-43.41550420000001,-43.418886,-43.4190236],"lat":[-22.91015489999999,-22.9116964,-22.9143109,-22.9154637,-22.9169844,-22.9176501,-22.9207052,-22.9191233,-22.9191136,-22.9213766,-22.9203668,-22.9182731,-22.917462,-22.9178678,-22.9193605,-22.9178899,-22.9205183,-22.9196339,-22.9182502,-22.9222892,-22.9232348,-22.9182763,-22.9192671,-22.9172076,-22.91795189999999,-22.9164709,-22.9144706,-22.9153955,-22.9142416,-22.9145915,-22.9130675,-22.91136909999999,-22.9080861,-22.9025732,-22.9056403,-22.9034727,-22.90257129999999,-22.9022682,-22.9032733,-22.9060418,-22.9064122,-22.9087783,-22.91015489999999]}]],[[{"lng":[-43.3929959,-43.3859068,-43.38563930000001,-43.3851757,-43.3833992,-43.382588,-43.3849879,-43.384619,-43.38059330000001,-43.378227,-43.3782986,-43.3752732,-43.3720936,-43.3716569,-43.37386920000001,-43.3767344,-43.37876259999999,-43.3919396,-43.3906271,-43.39263749999999,-43.3916249,-43.3928782,-43.3929959],"lat":[-22.9322302,-22.93515219999999,-22.932647,-22.9340228,-22.9340144,-22.93591289999999,-22.939203,-22.9418081,-22.937371,-22.9398481,-22.9434822,-22.9475479,-22.9477064,-22.9363275,-22.9232348,-22.9222892,-22.9185483,-22.9196339,-22.9250909,-22.9261241,-22.926624,-22.9287475,-22.9322302]}]],[[{"lng":[-43.3686642,-43.3660364,-43.36641939999999,-43.3620543,-43.3618817,-43.3594495,-43.3583346,-43.3585142,-43.3591084,-43.3563872,-43.3548182,-43.35006499999999,-43.34234290000001,-43.34312600000001,-43.34583839999999,-43.34370759999999,-43.35921009999999,-43.36190139999999,-43.3621914,-43.3687069,-43.3686642],"lat":[-22.9017074,-22.9029373,-22.9064695,-22.9101349,-22.9122529,-22.91261,-22.91152199999999,-22.9121293,-22.9126905,-22.912714,-22.9108004,-22.9105757,-22.9075773,-22.9060004,-22.9068107,-22.9028099,-22.8911045,-22.893614,-22.8958857,-22.8978857,-22.9017074]}]],[[{"lng":[-43.375026,-43.3740803,-43.37283679999999,-43.3717528,-43.3738401,-43.3715053,-43.3722723,-43.3630846,-43.364788,-43.36457100000001,-43.3598849,-43.35875069999999,-43.3594477,-43.3530828,-43.3514207,-43.34707329999999,-43.3429992,-43.3441396,-43.3430998,-43.3357355,-43.3329733,-43.3355417,-43.3404349,-43.3437063,-43.35006499999999,-43.3548182,-43.3583904,-43.3583346,-43.3594495,-43.3618817,-43.3620543,-43.36625960000001,-43.3660364,-43.3694748,-43.3738555,-43.3740382,-43.3797898,-43.37813360000001,-43.3805208,-43.3803616,-43.375026],"lat":[-22.9142416,-22.9153955,-22.9144706,-22.9164709,-22.91795189999999,-22.9172076,-22.9192671,-22.918735,-22.9216832,-22.9248454,-22.9272269,-22.9266915,-22.9241317,-22.9202564,-22.92122449999999,-22.9193815,-22.9220542,-22.9180371,-22.9155642,-22.9122073,-22.9057578,-22.9042729,-22.9073932,-22.9074572,-22.9105757,-22.9108004,-22.9129654,-22.91152199999999,-22.91261,-22.9122529,-22.9101349,-22.9067443,-22.9029373,-22.9028275,-22.9006272,-22.903488,-22.9073233,-22.91136909999999,-22.9130675,-22.9145915,-22.9142416]}]],[[{"lng":[-43.3748718,-43.37749209999999,-43.37491929999999,-43.3746891,-43.3730905,-43.3674107,-43.36898920000001,-43.36848730000001,-43.3621914,-43.36190139999999,-43.35921009999999,-43.3587612,-43.3576427,-43.35423099999999,-43.3581405,-43.35724920000001,-43.3582994,-43.3736774,-43.3751035,-43.3748718],"lat":[-22.8889075,-22.8949797,-22.898173,-22.9011723,-22.9005224,-22.9027438,-22.9002546,-22.8974663,-22.8958857,-22.893614,-22.8911045,-22.8920945,-22.8914902,-22.8868792,-22.8815588,-22.8794054,-22.8787495,-22.8767052,-22.8804149,-22.8889075]}]],[[{"lng":[-43.3553565,-43.34370759999999,-43.34576879999999,-43.34312600000001,-43.3434339,-43.3404349,-43.3355417,-43.3388575,-43.3380139,-43.3399484,-43.3397233,-43.3457877,-43.3468458,-43.35631999999999,-43.35423099999999,-43.3573566,-43.3553565],"lat":[-22.8942791,-22.9028099,-22.9069257,-22.9060004,-22.907055,-22.9073932,-22.9042729,-22.9000399,-22.8962085,-22.8925384,-22.8898421,-22.8890077,-22.8873632,-22.8832376,-22.8868792,-22.89103,-22.8942791]}]],[[{"lng":[-43.43832039999999,-43.4427116,-43.4381195,-43.4372681,-43.4334047,-43.43407149999999,-43.43302449999999,-43.43167500000001,-43.4327237,-43.4243733,-43.4186005,-43.4156526,-43.41202819999999,-43.4126874,-43.40382340000001,-43.403323,-43.40007819999999,-43.3988289,-43.3959232,-43.39346580000001,-43.3903889,-43.3894936,-43.3760544,-43.3740655,-43.36952970000001,-43.3660602,-43.3660644,-43.3690718,-43.4112644,-43.4371108,-43.436451,-43.4389221,-43.43832039999999],"lat":[-23.01096279999999,-23.0115433,-23.01728689999999,-23.0142546,-23.0133022,-23.0147622,-23.0155254,-23.0139649,-23.01306109999999,-23.0109109,-23.0108834,-23.007609,-23.0066914,-23.0021311,-23.0015212,-23.0035993,-23.0035265,-23.0067187,-23.0072501,-23.0036987,-23.00366739999999,-23.0067784,-23.0060302,-23.0081188,-23.0050905,-23.0053215,-23.0029111,-23.0001689,-22.99995669999999,-23.0066474,-23.0074111,-23.0086812,-23.01096279999999]}]],[[{"lng":[-43.3450533,-43.3473983,-43.3545972,-43.3569355,-43.3654261,-43.3655882,-43.3641288,-43.3618682,-43.3593727,-43.3505461,-43.3461294,-43.3511935,-43.35240679999999,-43.3581196,-43.3602072,-43.3570182,-43.3231583,-43.32145209999999,-43.3166306,-43.3147545,-43.31292539999999,-43.3058815,-43.30437190000001,-43.3013976,-43.29967140000001,-43.2954486,-43.2846894,-43.28498320000001,-43.28270679999999,-43.2927269,-43.2970056,-43.2932372,-43.295153,-43.2970199,-43.2958732,-43.2998986,-43.30134799999999,-43.3036279,-43.3046921,-43.3118285,-43.3288105,-43.3419016,-43.3450533],"lat":[-22.9817069,-22.978783,-22.978538,-22.9754368,-22.9766358,-22.9811179,-22.9791005,-22.9791973,-22.9852892,-22.9871338,-22.9917443,-22.99461669999999,-22.9915961,-22.9904379,-22.9933432,-22.9956598,-22.9964336,-23.0013109,-23.0011685,-23.0026423,-23.0003603,-23.0006641,-23.00565,-23.0051621,-23.0004878,-22.9977261,-22.997452,-22.9924502,-22.98794149999999,-22.9794815,-22.9794784,-22.9748297,-22.9765072,-22.9751835,-22.9740661,-22.9749591,-22.96530689999999,-22.9665672,-22.96952,-22.9735549,-22.9732923,-22.9817033,-22.9817069]}]],[[{"lng":[-43.4179637,-43.4101236,-43.3690718,-43.3661912,-43.3629474,-43.3381266,-43.32942509999999,-43.3156064,-43.3047267,-43.30416549999999,-43.3058815,-43.31292539999999,-43.3147545,-43.3166306,-43.32145209999999,-43.3231583,-43.3570182,-43.3602072,-43.3581196,-43.35240679999999,-43.3511935,-43.3461294,-43.3505461,-43.3593727,-43.3618682,-43.3641288,-43.3655882,-43.3649767,-43.3710521,-43.3742479,-43.3793379,-43.3803131,-43.3855727,-43.3852772,-43.39436329999999,-43.3969015,-43.40314970000001,-43.40545280000001,-43.4087511,-43.4111846,-43.4163378,-43.4111903,-43.4139823,-43.4173024,-43.41441400000001,-43.4149075,-43.42075029999999,-43.42442370000001,-43.4368625,-43.4179637],"lat":[-23.0010265,-22.9999091,-23.0001689,-23.0029124,-23.0000243,-23.0003528,-23.0011646,-23.0064201,-23.007397,-23.0056273,-23.0006641,-23.0003603,-23.0026423,-23.0011685,-23.0013109,-22.9964336,-22.9956598,-22.9933432,-22.9904379,-22.9915961,-22.99461669999999,-22.9917443,-22.9871338,-22.9852892,-22.9791973,-22.9791005,-22.9811179,-22.9758724,-22.9758622,-22.9775146,-22.9738495,-22.9705285,-22.9710072,-22.9729463,-22.9709832,-22.9724133,-22.9725663,-22.9749844,-22.9730641,-22.9739459,-22.9781436,-22.982258,-22.9805668,-22.9842346,-22.9864889,-22.9875212,-22.9911126,-22.9963434,-23.0067277,-23.0010265]}]],[[{"lng":[-43.4091057,-43.40545280000001,-43.40314970000001,-43.3969015,-43.39436329999999,-43.3852772,-43.3855727,-43.3803131,-43.3830244,-43.37575879999999,-43.37616859999999,-43.3720936,-43.3752732,-43.37849959999999,-43.37868279999999,-43.3764941,-43.3809931,-43.4118619,-43.4147681,-43.4133198,-43.4091057],"lat":[-22.9731094,-22.9749844,-22.9725663,-22.9724133,-22.9709832,-22.9729463,-22.9710072,-22.9705285,-22.9628155,-22.9576979,-22.9544352,-22.9477064,-22.9475479,-22.95013669999999,-22.9532417,-22.95466349999999,-22.9580074,-22.9664144,-22.9746947,-22.9756712,-22.9731094]}]],[[{"lng":[-43.3742479,-43.3694734,-43.3569355,-43.3545972,-43.3473983,-43.34380499999999,-43.34077259999999,-43.3422981,-43.33619849999999,-43.3373671,-43.3357657,-43.3321577,-43.3351283,-43.33437149999999,-43.32884739999999,-43.3114589,-43.3046921,-43.3036279,-43.30134799999999,-43.2994657,-43.2910658,-43.2854758,-43.28646639999999,-43.2801136,-43.2785496,-43.2787483,-43.2857641,-43.29150980000001,-43.3009329,-43.3107136,-43.3165851,-43.32085900000001,-43.3266256,-43.3256577,-43.322466,-43.32420459999999,-43.3276496,-43.3246984,-43.3245739,-43.3265032,-43.33159879999999,-43.3308134,-43.3269163,-43.3310073,-43.3303385,-43.33157260000001,-43.3357287,-43.3345122,-43.3379318,-43.3394452,-43.3440178,-43.3465544,-43.34601889999999,-43.347989,-43.3458518,-43.35687670000001,-43.3536527,-43.3566314,-43.3551012,-43.3575902,-43.3654939,-43.3685474,-43.3718827,-43.3720936,-43.37616859999999,-43.37575879999999,-43.3831654,-43.378829,-43.3742479],"lat":[-22.9775146,-22.9756203,-22.9754368,-22.978538,-22.978783,-22.9817236,-22.9807479,-22.9777204,-22.974697,-22.9714982,-22.9743567,-22.9717988,-22.972068,-22.9693851,-22.9733586,-22.973369,-22.96952,-22.9665672,-22.96530689999999,-22.949526,-22.9445676,-22.9430759,-22.9358906,-22.9312998,-22.9280287,-22.92125739999999,-22.9192308,-22.9219461,-22.9210096,-22.9164977,-22.9178997,-22.9171534,-22.9229481,-22.9275957,-22.930825,-22.9308227,-22.9342791,-22.9363959,-22.9383852,-22.9406402,-22.9419855,-22.94663079999999,-22.9541446,-22.95614609999999,-22.95759859999999,-22.9588077,-22.9573039,-22.9646712,-22.9668136,-22.9706737,-22.9719664,-22.9707105,-22.9679774,-22.96680529999999,-22.963676,-22.9627375,-22.9583763,-22.9584087,-22.9535218,-22.9540907,-22.9516104,-22.9480617,-22.9486599,-22.9477064,-22.9544352,-22.9576979,-22.9632776,-22.9733531,-22.9775146]}]],[[{"lng":[-43.3536527,-43.35687670000001,-43.3458518,-43.347989,-43.34601889999999,-43.3468066,-43.3456481,-43.3398853,-43.3379318,-43.3345122,-43.3357287,-43.33157260000001,-43.3303385,-43.3310073,-43.3269163,-43.3308134,-43.3311499,-43.3347914,-43.3390277,-43.3421178,-43.340862,-43.3418524,-43.345733,-43.34768,-43.34925390000001,-43.3535336,-43.3526226,-43.3551012,-43.3564307,-43.3536527],"lat":[-22.9583763,-22.9627375,-22.963676,-22.96680529999999,-22.9679774,-22.9699603,-22.9714788,-22.9710935,-22.9668136,-22.9646712,-22.9573039,-22.9588077,-22.95759859999999,-22.95614609999999,-22.9541446,-22.94663079999999,-22.9433042,-22.94364819999999,-22.94729269999999,-22.9466624,-22.94821929999999,-22.9502585,-22.9532247,-22.9517341,-22.95450599999999,-22.9531825,-22.9555693,-22.9535218,-22.95842,-22.9583763]}]],[[{"lng":[-43.4443843,-43.4370591,-43.436664,-43.4284024,-43.42568,-43.4257359,-43.42097389999999,-43.4176301,-43.4147681,-43.4125023,-43.40343929999999,-43.4052972,-43.40388069999999,-43.39582610000001,-43.3915867,-43.38980359999999,-43.384522,-43.3849879,-43.3825869,-43.3833992,-43.3851757,-43.38517399999999,-43.3859068,-43.3929959,-43.39279030000001,-43.3916249,-43.39263749999999,-43.39071939999999,-43.3918391,-43.3960368,-43.3989467,-43.39926,-43.4030672,-43.406644,-43.4069635,-43.4086633,-43.409558,-43.4120509,-43.41533839999999,-43.4149039,-43.41731730000001,-43.4155537,-43.418234,-43.4208595,-43.4253136,-43.4312312,-43.437875,-43.4551665,-43.46455750000001,-43.46870879999999,-43.46916809999999,-43.467519,-43.4723479,-43.47284519999999,-43.4712975,-43.4697157,-43.4645541,-43.46436790000001,-43.4665899,-43.4559063,-43.4443843],"lat":[-22.94521719999999,-22.947533,-22.9558877,-22.9570809,-22.9646699,-22.9695896,-22.97349,-22.9731859,-22.9746947,-22.9669987,-22.9633118,-22.9608349,-22.9569395,-22.9579103,-22.954595,-22.9465002,-22.9424866,-22.939203,-22.9357899,-22.9340144,-22.9340228,-22.9325996,-22.93515219999999,-22.9322302,-22.9275841,-22.926624,-22.9261241,-22.92412789999999,-22.9203688,-22.9178899,-22.9193605,-22.9174334,-22.9176253,-22.9213766,-22.9191136,-22.9191233,-22.9207052,-22.9176501,-22.9169844,-22.9154637,-22.9143109,-22.91184269999999,-22.91349169999999,-22.9110711,-22.9118198,-22.907819,-22.9086492,-22.9147398,-22.9151959,-22.9171547,-22.9199926,-22.9231981,-22.9279293,-22.9317931,-22.9319965,-22.9363126,-22.9416755,-22.9438842,-22.9463007,-22.9477396,-22.94521719999999]}]],[[{"lng":[-43.3720899,-43.3685474,-43.3654939,-43.3575902,-43.35310329999999,-43.35332990000001,-43.3587141,-43.3588301,-43.36100039999999,-43.361568,-43.3641917,-43.36508229999999,-43.3681739,-43.3680584,-43.37072089999999,-43.3715027,-43.3720899],"lat":[-22.9485994,-22.9480617,-22.9516104,-22.9540907,-22.951898,-22.949856,-22.9477695,-22.9439571,-22.9433987,-22.9412183,-22.9446624,-22.9433854,-22.9436756,-22.9418234,-22.9414104,-22.9469713,-22.9485994]}]],[[{"lng":[-43.2170987,-43.2142807,-43.21830990000001,-43.21910589999999,-43.2178544,-43.21411149999999,-43.210463,-43.19827230000001,-43.196381,-43.1996468,-43.2033303,-43.204989,-43.20487790000001,-43.2085792,-43.2089639,-43.2062483,-43.20684389999999,-43.2089336,-43.2025422,-43.19842200000001,-43.19906249999999,-43.1954983,-43.1940635,-43.1980085,-43.1945309,-43.1936857,-43.1860842,-43.1846124,-43.1813144,-43.18242319999999,-43.1801176,-43.1805782,-43.17761120000001,-43.17798579999999,-43.18016779999999,-43.1824817,-43.18758270000001,-43.1877225,-43.1888718,-43.1891143,-43.1944396,-43.1956073,-43.1930626,-43.1952097,-43.1949139,-43.19812659999999,-43.19807269999999,-43.1962415,-43.19766289999999,-43.1969146,-43.1992638,-43.2009295,-43.2027508,-43.20418309999999,-43.2051035,-43.20637230000001,-43.20487560000001,-43.2054856,-43.20871040000001,-43.21048349999999,-43.2161792,-43.2170987],"lat":[-22.9355301,-22.9333883,-22.9344082,-22.9403793,-22.9467313,-22.9520036,-22.9521413,-22.947164,-22.94503389999999,-22.9433132,-22.9466541,-22.946226,-22.9444683,-22.9458635,-22.9432615,-22.942134,-22.9403928,-22.939769,-22.93844349999999,-22.9396393,-22.9363386,-22.936292,-22.9334866,-22.9342658,-22.9322821,-22.9293152,-22.9263431,-22.9242408,-22.9238765,-22.9232443,-22.92284799999999,-22.9199365,-22.9187773,-22.916598,-22.9138463,-22.914131,-22.915142,-22.9180378,-22.9180127,-22.9149562,-22.9117426,-22.9129877,-22.920592,-22.9211291,-22.9236874,-22.9259031,-22.9272259,-22.9274507,-22.92923799999999,-22.9307689,-22.9315592,-22.93411099999999,-22.9301714,-22.9313436,-22.9303734,-22.9312911,-22.9321591,-22.9371478,-22.9383664,-22.9373875,-22.9378465,-22.9355301]}]],[[{"lng":[-43.3517995,-43.3499164,-43.3448678,-43.3412947,-43.339636,-43.3347914,-43.3310276,-43.33159879999999,-43.3260362,-43.32456519999999,-43.3276496,-43.32420459999999,-43.322466,-43.3256577,-43.3266256,-43.320531,-43.32308380000001,-43.32872459999999,-43.330359,-43.332973,-43.3357355,-43.3430998,-43.3441396,-43.3426832,-43.3445093,-43.3427025,-43.34898099999999,-43.3478905,-43.34955850000001,-43.35027400000001,-43.3517995],"lat":[-22.93633449999999,-22.9379018,-22.938759,-22.9413002,-22.9474173,-22.94364819999999,-22.94288209999999,-22.9419855,-22.9403818,-22.9365749,-22.9342791,-22.9308227,-22.930825,-22.9275957,-22.9229481,-22.9170852,-22.9107194,-22.9127887,-22.907674,-22.9057574,-22.9122073,-22.9155642,-22.9180371,-22.9209982,-22.9256218,-22.9273636,-22.9322052,-22.9346038,-22.9335551,-22.9349427,-22.93633449999999]}]],[[{"lng":[-43.3811387,-43.3764941,-43.37868279999999,-43.3786259,-43.3757179,-43.3752868,-43.3782681,-43.3781595,-43.3802989,-43.38980359999999,-43.3917848,-43.391167,-43.3950925,-43.4040369,-43.4052972,-43.40343929999999,-43.3811387],"lat":[-22.9580721,-22.95466349999999,-22.9532417,-22.9504145,-22.9489726,-22.9473071,-22.9435537,-22.9400083,-22.9375905,-22.9465002,-22.9523324,-22.9539997,-22.9575903,-22.95707879999999,-22.9608349,-22.9633118,-22.9580721]}]],[[{"lng":[-43.36535240000001,-43.3615387,-43.3609215,-43.3557928,-43.3501381,-43.3478905,-43.34898099999999,-43.3427025,-43.3445093,-43.3433509,-43.34707329999999,-43.3514207,-43.3530828,-43.3579744,-43.3594918,-43.3590961,-43.3621917,-43.3651436,-43.36535240000001],"lat":[-22.9365848,-22.9379282,-22.9419326,-22.94016019999999,-22.9337268,-22.9346038,-22.9322052,-22.9273636,-22.9256218,-22.9219704,-22.9193815,-22.92122449999999,-22.9202564,-22.9226486,-22.924271,-22.9274726,-22.9291348,-22.93571409999999,-22.9365848]}]],[[{"lng":[-43.3588301,-43.3587141,-43.35332990000001,-43.35310329999999,-43.3555904,-43.35414039999999,-43.3526226,-43.3531594,-43.3535336,-43.34925390000001,-43.34768,-43.345733,-43.3418524,-43.340862,-43.3421178,-43.339636,-43.3412947,-43.3517995,-43.3609553,-43.3588301],"lat":[-22.9439571,-22.9477695,-22.949856,-22.951898,-22.9534207,-22.9532153,-22.9555693,-22.9533079,-22.9531825,-22.95450599999999,-22.9517341,-22.9532247,-22.9502585,-22.94821929999999,-22.9466624,-22.9474173,-22.9413002,-22.93633449999999,-22.9427365,-22.9439571]}]],[[{"lng":[-43.4183718,-43.4204279,-43.42020590000001,-43.4159716,-43.4131015,-43.4087164,-43.4073891,-43.4050827,-43.40825359999999,-43.4079449,-43.4086942,-43.41269509999999,-43.4091324,-43.4114058,-43.419213,-43.4195913,-43.4183718],"lat":[-22.8757401,-22.8767647,-22.8779595,-22.8786476,-22.8817185,-22.8826918,-22.876774,-22.8765469,-22.8727508,-22.8710693,-22.8717236,-22.8677424,-22.8659865,-22.8620366,-22.8647416,-22.8727568,-22.8757401]}]],[[{"lng":[-43.4430997,-43.4232614,-43.4183718,-43.4197405,-43.41924360000001,-43.43408279999999,-43.4352712,-43.4385747,-43.4429644,-43.4418015,-43.4415456,-43.44555889999999,-43.4430997],"lat":[-22.8787081,-22.8787545,-22.8757401,-22.8733102,-22.8661413,-22.8690331,-22.8664652,-22.8661626,-22.8681093,-22.86896819999999,-22.8747564,-22.8751972,-22.8787081]}]],[[{"lng":[-43.4486294,-43.4464449,-43.44564469999999,-43.4477279,-43.4435587,-43.43798209999999,-43.4352712,-43.43408279999999,-43.4263063,-43.4225648,-43.41924360000001,-43.419213,-43.414841,-43.4162857,-43.4192587,-43.43380670000001,-43.4351425,-43.4579833,-43.44898320000001,-43.4486294],"lat":[-22.86068869999999,-22.8608397,-22.8632379,-22.8651686,-22.8682245,-22.8659947,-22.8664652,-22.8690331,-22.8680728,-22.86598099999999,-22.8661413,-22.8647416,-22.8634178,-22.8554171,-22.8502468,-22.8438281,-22.8408009,-22.8489851,-22.856236,-22.86068869999999]}]],[[{"lng":[-43.4551665,-43.4399718,-43.4312312,-43.4253136,-43.4208595,-43.417098,-43.4160921,-43.4177518,-43.41711650000001,-43.4197473,-43.41550420000001,-43.4150325,-43.41751989999999,-43.4092867,-43.4059774,-43.41325329999999,-43.4181344,-43.4212735,-43.4235398,-43.4256662,-43.4299478,-43.43112989999999,-43.43787349999999,-43.43883530000001,-43.4411176,-43.4435979,-43.4465377,-43.4454915,-43.4496356,-43.4513336,-43.462762,-43.4700357,-43.4676318,-43.4551665],"lat":[-22.9147398,-22.9091291,-22.907819,-22.9118198,-22.9110711,-22.9134627,-22.9117582,-22.9123354,-22.9108624,-22.9093809,-22.9064122,-22.9036714,-22.9007652,-22.8935176,-22.8845218,-22.8876543,-22.892736,-22.8907278,-22.8924146,-22.8904645,-22.893828,-22.89255949999999,-22.8975073,-22.8967004,-22.8981765,-22.89582829999999,-22.8994567,-22.8960254,-22.8954762,-22.8983114,-22.9054951,-22.9144713,-22.9163322,-22.9147398]}]],[[{"lng":[-43.4300719,-43.4256662,-43.4235398,-43.421755,-43.4274276,-43.4288,-43.4305921,-43.4309008,-43.4287647,-43.4231369,-43.44291049999999,-43.4300719],"lat":[-22.8938135,-22.8904645,-22.8924146,-22.8910903,-22.8847381,-22.8837879,-22.8851306,-22.8840022,-22.8811812,-22.87865979999999,-22.878644,-22.8938135]}]],[[{"lng":[-43.4164099,-43.4155767,-43.41711650000001,-43.41753550000001,-43.4164099],"lat":[-22.9116756,-22.9116964,-22.9108624,-22.9123457,-22.9116756]}],[{"lng":[-43.4288,-43.421755,-43.4181344,-43.41325329999999,-43.4058376,-43.4131015,-43.4159716,-43.4203437,-43.4287647,-43.4305921,-43.4288],"lat":[-22.8837879,-22.8910903,-22.892736,-22.8876543,-22.8842955,-22.8817185,-22.8786476,-22.8776037,-22.8811812,-22.8851306,-22.8837879]}]],[[{"lng":[-43.4496356,-43.4454915,-43.4465377,-43.4435979,-43.4411176,-43.43883530000001,-43.43787349999999,-43.43112989999999,-43.4400345,-43.439457,-43.4412939,-43.4398576,-43.4477779,-43.4496356],"lat":[-22.8954762,-22.8960254,-22.8994567,-22.89582829999999,-22.8981765,-22.8967004,-22.8975073,-22.89255949999999,-22.8820315,-22.8833056,-22.8840592,-22.8859619,-22.8934915,-22.8954762]}]],[[{"lng":[-43.4513336,-43.44636609999999,-43.4398576,-43.4412939,-43.439457,-43.4400345,-43.44555889999999,-43.455701,-43.45596270000001,-43.45232470000001,-43.4515709,-43.4562694,-43.4541412,-43.45424339999999,-43.4614891,-43.4513336],"lat":[-22.8983114,-22.8916669,-22.8859619,-22.8840592,-22.8833056,-22.8820315,-22.8751972,-22.8752498,-22.8827873,-22.882443,-22.8847107,-22.8855712,-22.8875745,-22.8923957,-22.9042268,-22.8983114]}]],[[{"lng":[-43.4413822,-43.4418015,-43.4477279,-43.44564469999999,-43.4463903,-43.4486294,-43.44898320000001,-43.4508167,-43.4550163,-43.45416229999999,-43.45611509999999,-43.45381669999999,-43.4549488,-43.4494244,-43.455451,-43.45521910000001,-43.4413822],"lat":[-22.8744889,-22.86896819999999,-22.8651686,-22.8632379,-22.8609686,-22.86068869999999,-22.856236,-22.8557863,-22.85686849999999,-22.858144,-22.8587028,-22.8605225,-22.8630775,-22.8714905,-22.8716226,-22.8752554,-22.8744889]}]],[[{"lng":[-43.4929874,-43.48343990000001,-43.4797519,-43.47796810000001,-43.4726775,-43.4718612,-43.4825574,-43.4873917,-43.49344899999999,-43.4967355,-43.4963039,-43.4929874],"lat":[-22.8626768,-22.8618984,-22.8604047,-22.8577213,-22.8585396,-22.8573626,-22.8539153,-22.8487328,-22.8496604,-22.8512712,-22.8525811,-22.8626768]}]],[[{"lng":[-43.3024189,-43.3040888,-43.30686059999999,-43.30725380000001,-43.3024189],"lat":[-23.0378963,-23.0365347,-23.037481,-23.0389678,-23.0378963]}],[{"lng":[-43.2984908,-43.2995266,-43.3013971,-43.2986963,-43.2984908],"lat":[-23.0314228,-23.0312076,-23.0332789,-23.0342184,-23.0314228]}],[{"lng":[-43.32255669999999,-43.3082608,-43.29792859999999,-43.2944919,-43.2902347,-43.287355,-43.28657279999999,-43.28548290000001,-43.2868754,-43.2817891,-43.2769414,-43.2752444,-43.2847839,-43.2846894,-43.2934573,-43.29952099999999,-43.300729,-43.30416549999999,-43.3047267,-43.3165941,-43.3214502,-43.3217962,-43.32255669999999],"lat":[-23.0129973,-23.0163196,-23.0154354,-23.0170532,-23.0147612,-23.0149906,-23.0166146,-23.0148278,-23.0099994,-23.0065757,-23.0056468,-23.0019152,-23.0011528,-22.997452,-22.99722879999999,-23.0003171,-23.0043713,-23.0056273,-23.007397,-23.0062228,-23.0080179,-23.0097578,-23.0129973]}]],[[{"lng":[-43.4471148,-43.409352,-43.3768356,-43.3440372,-43.32255669999999,-43.3214502,-43.3540569,-43.3598826,-43.3602809,-43.3643318,-43.36952970000001,-43.3740655,-43.3760544,-43.3894936,-43.3903889,-43.39346580000001,-43.3959232,-43.3988289,-43.40007819999999,-43.403323,-43.40382340000001,-43.4097926,-43.4126874,-43.41202819999999,-43.4156526,-43.4186005,-43.4243733,-43.4327237,-43.43167500000001,-43.43302449999999,-43.43407149999999,-43.4334047,-43.4372681,-43.4381195,-43.4423891,-43.444754,-43.4488274,-43.4482164,-43.45003779999999,-43.449875,-43.447384,-43.4471148],"lat":[-23.0232341,-23.0159166,-23.0121638,-23.0110858,-23.0129973,-23.0080179,-23.004708,-23.0070326,-23.0055984,-23.0063177,-23.0050905,-23.0081188,-23.0060302,-23.0067784,-23.00366739999999,-23.0036987,-23.0072501,-23.0067187,-23.0035265,-23.0035993,-23.0015212,-23.0017415,-23.0021311,-23.0066914,-23.007609,-23.0108834,-23.0109109,-23.01306109999999,-23.0139649,-23.0155254,-23.0147622,-23.0133022,-23.0142546,-23.01728689999999,-23.01259809999999,-23.0133961,-23.0169409,-23.0179323,-23.0180977,-23.0206661,-23.0217355,-23.0232341]}]],[[{"lng":[-43.1769656,-43.174816,-43.17567009999999,-43.17352169999999,-43.1765193,-43.17625109999999,-43.1742519,-43.1685147,-43.1709548,-43.1687559,-43.17637799999999,-43.1772329,-43.1769656],"lat":[-22.9332493,-22.9351101,-22.9368055,-22.9386455,-22.9410936,-22.9440225,-22.9442546,-22.9385028,-22.9324315,-22.9246513,-22.92516909999999,-22.9298083,-22.9332493]}]],[[{"lng":[-43.36073659999999,-43.3591416,-43.3567791,-43.3530242,-43.3218302,-43.3165941,-43.3310876,-43.3606462,-43.3629474,-43.3660644,-43.3660602,-43.3643318,-43.36073659999999],"lat":[-23.0055209,-23.0069692,-23.0050611,-23.0047344,-23.0080581,-23.0062228,-23.0008208,-22.9999373,-23.0000243,-23.0029111,-23.0053215,-23.0063177,-23.0055209]}]],[[{"lng":[-43.5216286,-43.5201459,-43.5187557,-43.5180932,-43.5075223,-43.5079657,-43.5067548,-43.50472489999999,-43.5049523,-43.50232030000001,-43.5020032,-43.5006146,-43.49624859999999,-43.4930308,-43.49401959999999,-43.48404840000001,-43.47805729999999,-43.4763935,-43.46980399999999,-43.4617344,-43.45344979999999,-43.44654240000001,-43.43848300000001,-43.4334712,-43.4288928,-43.42075029999999,-43.4149075,-43.41441400000001,-43.4173024,-43.4139823,-43.4111903,-43.4163133,-43.4133198,-43.4152343,-43.4207919,-43.4257359,-43.42568,-43.4284024,-43.436664,-43.4366349,-43.4428094,-43.4559063,-43.4665899,-43.4641927,-43.4723307,-43.4792749,-43.4829,-43.48450639999999,-43.4929818,-43.4952698,-43.5013996,-43.5064546,-43.5119759,-43.51746600000001,-43.5187858,-43.51764900000001,-43.52082399999999,-43.516315,-43.5193133,-43.5208738,-43.5192658,-43.5220837,-43.5209277,-43.5231416,-43.5217125,-43.5216286],"lat":[-23.0104491,-23.0114724,-23.0105456,-23.015109,-23.0185849,-23.0175341,-23.01725639999999,-23.0194098,-23.0185942,-23.019016,-23.0175958,-23.02000659999999,-23.0207868,-23.01979979999999,-22.999097,-22.9979536,-22.993993,-22.9912209,-22.9891476,-22.9938564,-22.9959383,-22.9939464,-22.9951426,-22.994463,-22.9918461,-22.9911126,-22.9875212,-22.9864889,-22.9842346,-22.9805668,-22.982258,-22.97833,-22.9756712,-22.9739878,-22.97356869999999,-22.9695896,-22.9646699,-22.9570809,-22.9558877,-22.9478338,-22.9452649,-22.9477396,-22.9463007,-22.9425905,-22.9316465,-22.93451529999999,-22.9343018,-22.9361937,-22.9390305,-22.9414761,-22.942745,-22.9497364,-22.9521758,-22.9526673,-22.957055,-22.9640547,-22.9677925,-22.9741741,-22.9774374,-22.9883096,-22.9920027,-22.9946838,-22.9986667,-23.0020131,-23.0067961,-23.0104491]}]],[[{"lng":[-43.1765193,-43.17352169999999,-43.17746229999999,-43.1789773,-43.1782631,-43.1808965,-43.1765193],"lat":[-22.9410936,-22.9386455,-22.9325063,-22.9327453,-22.9353961,-22.93921289999999,-22.9410936]}]],[[{"lng":[-43.46714050000001,-43.4471148,-43.447384,-43.44993909999999,-43.4500204,-43.4482164,-43.4488274,-43.4423891,-43.4424376,-43.43832039999999,-43.4390653,-43.43663189999999,-43.4616115,-43.46018459999999,-43.46332379999999,-43.46366799999999,-43.4656502,-43.4687916,-43.4707882,-43.47203549999999,-43.47006340000001,-43.46714050000001],"lat":[-23.0296848,-23.0232341,-23.0217355,-23.0205643,-23.01806779999999,-23.0179323,-23.0169409,-23.01259809999999,-23.01131,-23.01096279999999,-23.0086775,-23.0071323,-23.0132184,-23.0169265,-23.017688,-23.0222542,-23.0221559,-23.0278162,-23.0275508,-23.0305447,-23.032853,-23.0296848]}],[{"lng":[-43.46685499999999,-43.46523860000001,-43.4643348,-43.4670083,-43.4665549,-43.46685499999999],"lat":[-23.0203435,-23.0206468,-23.0165641,-23.0169846,-23.0185131,-23.0203435]}]],[[{"lng":[-43.4823199,-43.4823815,-43.48453370000001,-43.48483259999999,-43.4823199],"lat":[-23.0258163,-23.025551,-23.0258817,-23.0265371,-23.0258163]}],[{"lng":[-43.5080021,-43.5110241,-43.5108274,-43.5130677,-43.5125194,-43.5145066,-43.51237659999999,-43.5080021],"lat":[-23.0650018,-23.0629519,-23.0614153,-23.0620561,-23.063721,-23.0650773,-23.0659761,-23.0650018]}],[{"lng":[-43.5078126,-43.5078606,-43.50925760000001,-43.5093161,-43.5078126],"lat":[-23.0535539,-23.0527675,-23.0528912,-23.0541865,-23.0535539]}],[{"lng":[-43.54865209999999,-43.552191,-43.5511179,-43.5474877,-43.549496,-43.536734,-43.5347704,-43.535731,-43.5263684,-43.5085232,-43.5069614,-43.506071,-43.5003216,-43.4983208,-43.4933859,-43.4922429,-43.4927955,-43.4863432,-43.4856539,-43.4815136,-43.4833257,-43.4371108,-43.420342,-43.4288928,-43.4319042,-43.4378713,-43.44654240000001,-43.45344979999999,-43.4617344,-43.4693716,-43.4725546,-43.4765541,-43.47805729999999,-43.48404840000001,-43.49401959999999,-43.4930308,-43.49624859999999,-43.5006146,-43.5020032,-43.50232030000001,-43.5049523,-43.50472489999999,-43.5067548,-43.5079657,-43.5075223,-43.5180932,-43.5187557,-43.5213597,-43.52203009999999,-43.5267862,-43.5276179,-43.5303723,-43.53211389999999,-43.53210960000001,-43.53905390000001,-43.5394602,-43.54258979999999,-43.5431111,-43.5477308,-43.5485121,-43.5473826,-43.54971639999999,-43.5495203,-43.5523557,-43.55649469999999,-43.5585674,-43.5519872,-43.5540822,-43.5533326,-43.54865209999999],"lat":[-23.0732515,-23.0709455,-23.0673838,-23.0647353,-23.06253539999999,-23.0562191,-23.0539816,-23.0516295,-23.0492554,-23.0480456,-23.0467439,-23.0420863,-23.0413813,-23.0376569,-23.0362619,-23.0334059,-23.0209443,-23.026517,-23.0259026,-23.024908,-23.0187851,-23.0066474,-22.9915785,-22.9918461,-22.9940947,-22.9951245,-22.9939464,-22.9959383,-22.9938564,-22.9891674,-22.9895563,-22.9913333,-22.993993,-22.9979536,-22.999097,-23.01979979999999,-23.0207868,-23.02000659999999,-23.0175958,-23.019016,-23.0185942,-23.0194098,-23.01725639999999,-23.0175341,-23.0185849,-23.015109,-23.0105456,-23.0109496,-23.0078,-23.0112961,-23.015046,-23.0170028,-23.0208071,-23.022995,-23.0289451,-23.0322484,-23.0339549,-23.03864799999999,-23.0417508,-23.0438849,-23.0473139,-23.0501906,-23.0537165,-23.0578936,-23.0603614,-23.0686115,-23.0735283,-23.0759097,-23.0766534,-23.0732515]}]],[[{"lng":[-43.414841,-43.4114058,-43.4091324,-43.41269509999999,-43.4086942,-43.4079449,-43.40825359999999,-43.4050827,-43.4073891,-43.4092466,-43.4058376,-43.408756,-43.41751989999999,-43.4150325,-43.41550420000001,-43.41103089999999,-43.4123359,-43.4110168,-43.40969630000001,-43.41047210000001,-43.409169,-43.3865212,-43.3795654,-43.3740382,-43.37491929999999,-43.3775687,-43.3748718,-43.3746134,-43.37294550000001,-43.3780949,-43.3774741,-43.3785076,-43.3777906,-43.3759293,-43.37478369999999,-43.3826262,-43.37761589999999,-43.38289220000001,-43.38620660000001,-43.3869072,-43.3959025,-43.3978206,-43.396561,-43.4036856,-43.4065658,-43.41380579999999,-43.4258011,-43.4240925,-43.4192587,-43.4162857,-43.4154516,-43.414841],"lat":[-22.8634178,-22.8620366,-22.8659865,-22.8677424,-22.8717236,-22.8710693,-22.8727508,-22.8765469,-22.876774,-22.8826798,-22.8842955,-22.8926853,-22.9007652,-22.9036714,-22.9064122,-22.9060418,-22.9032733,-22.9022682,-22.90257129999999,-22.9034727,-22.9056403,-22.9025732,-22.9070005,-22.903488,-22.898173,-22.89468,-22.8889075,-22.8771095,-22.8759096,-22.8669526,-22.8641308,-22.8636452,-22.860746,-22.8613686,-22.8591307,-22.8557486,-22.8540326,-22.8372553,-22.8375531,-22.8365268,-22.8404829,-22.8400943,-22.84533080000001,-22.8447705,-22.8465118,-22.8381191,-22.8461231,-22.8483713,-22.8502468,-22.8554171,-22.862365,-22.8634178]}]],[[{"lng":[-43.4933859,-43.47915769999999,-43.47372749999999,-43.47144979999999,-43.4716521,-43.4683102,-43.46723290000001,-43.47203549999999,-43.4707882,-43.4687916,-43.4656502,-43.46366799999999,-43.46332379999999,-43.46018459999999,-43.4616115,-43.4833257,-43.4815136,-43.4856539,-43.4860523,-43.4927955,-43.4922429,-43.4933859],"lat":[-23.0362619,-23.0323517,-23.0321472,-23.0335939,-23.0379693,-23.0380262,-23.03667189999999,-23.0305447,-23.0275508,-23.0278162,-23.0221559,-23.0222542,-23.017688,-23.0169265,-23.0132184,-23.0187851,-23.024908,-23.0259026,-23.02657019999999,-23.0209443,-23.0334059,-23.0362619]},{"lng":[-43.4643348,-43.46523860000001,-43.46685499999999,-43.4670083,-43.4643348],"lat":[-23.0165641,-23.0206468,-23.0203435,-23.0169846,-23.0165641]},{"lng":[-43.48483259999999,-43.4850455,-43.4825223,-43.4823199,-43.48483259999999],"lat":[-23.0265371,-23.02616,-23.0253689,-23.0258163,-23.0265371]}]],[[{"lng":[-43.5614291,-43.5525737,-43.538541,-43.51746600000001,-43.5123542,-43.5064546,-43.5013996,-43.4952698,-43.4929818,-43.48450639999999,-43.4829,-43.4792749,-43.47284519999999,-43.482874,-43.48759270000001,-43.49554120000001,-43.4965096,-43.4933167,-43.4943471,-43.4980459,-43.4992463,-43.5023646,-43.5081022,-43.5128341,-43.52352399999999,-43.5255967,-43.5267616,-43.53084270000001,-43.5284447,-43.5290506,-43.527234,-43.5291649,-43.5251409,-43.5320684,-43.53212559999999,-43.5334484,-43.5342343,-43.5395583,-43.5436114,-43.54388509999999,-43.55051189999999,-43.55205530000001,-43.5578761,-43.562166,-43.5606747,-43.5614291],"lat":[-22.9496886,-22.94923,-22.9422908,-22.9526673,-22.9522496,-22.9497364,-22.942745,-22.9414761,-22.9390305,-22.9361937,-22.9343018,-22.93451529999999,-22.9317931,-22.9255648,-22.9270337,-22.9226179,-22.9171523,-22.91339109999999,-22.9091918,-22.9077602,-22.9042485,-22.9049775,-22.8991003,-22.8975424,-22.89760039999999,-22.8994826,-22.904925,-22.9083355,-22.9078563,-22.9098044,-22.9098677,-22.911657,-22.9227269,-22.9205232,-22.9223583,-22.9221662,-22.9196391,-22.9187018,-22.918363,-22.9201026,-22.9170798,-22.9251188,-22.9366913,-22.9413754,-22.9489208,-22.9496886]}]],[[{"lng":[-43.5533265,-43.5499208,-43.55051189999999,-43.5459828,-43.54388509999999,-43.5436114,-43.5395583,-43.5342343,-43.5334484,-43.53212559999999,-43.5320684,-43.5251409,-43.5291649,-43.527234,-43.5290506,-43.5284447,-43.5308002,-43.5295139,-43.5333049,-43.5410209,-43.5567405,-43.5608705,-43.55812110000001,-43.5533265],"lat":[-22.9151717,-22.9144142,-22.9170798,-22.9195813,-22.9201026,-22.918363,-22.9187018,-22.9196391,-22.9221662,-22.9223583,-22.9205232,-22.9227269,-22.911657,-22.9098677,-22.9098044,-22.9078563,-22.9089551,-22.9043263,-22.9052068,-22.9141005,-22.904989,-22.9067221,-22.9113906,-22.9151717]}]],[[{"lng":[-43.5792259,-43.5799222,-43.5841593,-43.5812997,-43.5813755,-43.5771374,-43.5719346,-43.5678008,-43.5640271,-43.56968930000001,-43.57337030000001,-43.5759161,-43.5786299,-43.58223539999999,-43.5857083,-43.587384,-43.58358139999999,-43.5792259],"lat":[-22.88601599999999,-22.8911649,-22.89334909999999,-22.8940639,-22.8959998,-22.8958035,-22.9009742,-22.9023233,-22.8968419,-22.884322,-22.8813343,-22.8722623,-22.8737837,-22.8693692,-22.8681193,-22.8704798,-22.8745322,-22.88601599999999]}]],[[{"lng":[-43.6176226,-43.6067753,-43.5997578,-43.59752220000001,-43.5946915,-43.5914911,-43.5911467,-43.58850959999999,-43.5843508,-43.5813755,-43.5812997,-43.5841593,-43.5800727,-43.5794029,-43.5804261,-43.5845696,-43.5851172,-43.5950049,-43.59785549999999,-43.59654129999999,-43.59771550000001,-43.6009853,-43.61231710000001,-43.6200097,-43.6213596,-43.6193955,-43.6176226],"lat":[-22.8860542,-22.8847647,-22.8863876,-22.8870487,-22.8903616,-22.8901407,-22.8917002,-22.8915838,-22.8952267,-22.8959998,-22.8940639,-22.89334909999999,-22.8913073,-22.8891872,-22.8812937,-22.8725756,-22.8769368,-22.87514659999999,-22.8782339,-22.8786383,-22.8829501,-22.882401,-22.8762926,-22.8793855,-22.8844232,-22.8849795,-22.8860542]}]],[[{"lng":[-43.5586,-43.5524821,-43.5539036,-43.5502316,-43.5500991,-43.54718949999999,-43.54844629999999,-43.54701499999999,-43.5426804,-43.5393091,-43.5322087,-43.53126229999999,-43.5363001,-43.5354038,-43.5412565,-43.5415654,-43.54813350000001,-43.5535513,-43.5545918,-43.55309870000001,-43.5548095,-43.5570352,-43.55985099999999,-43.5586],"lat":[-22.8970514,-22.8982619,-22.8961482,-22.8948084,-22.8924205,-22.892664,-22.8917479,-22.8899811,-22.8885681,-22.88556489999999,-22.885088,-22.8827941,-22.872596,-22.8671486,-22.8658216,-22.8624672,-22.8641314,-22.8673045,-22.8706656,-22.8734886,-22.8753507,-22.8850576,-22.889126,-22.8970514]}]],[[{"lng":[-43.5759161,-43.5756378,-43.5731686,-43.5696058,-43.5673202,-43.56226090000001,-43.5599292,-43.554907,-43.5548095,-43.55309870000001,-43.5545918,-43.5535513,-43.54813350000001,-43.54118829999999,-43.54102529999999,-43.564167,-43.5673665,-43.5748773,-43.5746394,-43.5759161],"lat":[-22.8722623,-22.8753947,-22.8815738,-22.8844891,-22.8835532,-22.8843897,-22.8885118,-22.8796669,-22.8753507,-22.8734886,-22.8706656,-22.8673045,-22.8641314,-22.8630335,-22.8614893,-22.8636603,-22.8686255,-22.8699173,-22.8722116,-22.8722623]}]],[[{"lng":[-43.5779039,-43.57880859999999,-43.57708919999999,-43.5726865,-43.56793,-43.5698402,-43.5700964,-43.5725249,-43.5720742,-43.5756601,-43.5767488,-43.5736568,-43.5709418,-43.5617739,-43.5584849,-43.5552158,-43.5587195,-43.5608705,-43.5645842,-43.573332,-43.5774179,-43.57990100000001,-43.5808425,-43.583294,-43.5811739,-43.5818375,-43.58925929999999,-43.5921989,-43.5918484,-43.5991951,-43.6000611,-43.603767,-43.5924471,-43.5864819,-43.5792363,-43.5779039],"lat":[-22.9318996,-22.9377439,-22.9474192,-22.9464206,-22.9395372,-22.9396284,-22.9410761,-22.9407554,-22.9417671,-22.9412583,-22.9387385,-22.9288972,-22.9254852,-22.9200826,-22.9149411,-22.9136342,-22.9107628,-22.9067221,-22.9077769,-22.90672,-22.9079255,-22.9105804,-22.9095594,-22.9105284,-22.9114387,-22.9192238,-22.9234551,-22.9237254,-22.92567829999999,-22.9291961,-22.9320331,-22.9339548,-22.9355901,-22.9322429,-22.9316802,-22.9318996]}]],[[{"lng":[-43.5890948,-43.58553370000001,-43.57922019999999,-43.5780396,-43.5439611,-43.5462228,-43.54553600000001,-43.5468099,-43.5484057,-43.5475907,-43.5500991,-43.55141589999999,-43.5517446,-43.5535888,-43.5524821,-43.5586,-43.56180309999999,-43.5673202,-43.5696058,-43.5640271,-43.5678008,-43.5719346,-43.5771374,-43.5834935,-43.5887727,-43.5904076,-43.5902985,-43.5890948],"lat":[-22.8978416,-22.8968687,-22.8991802,-22.905688,-22.8988827,-22.8968341,-22.8932234,-22.891015,-22.8915954,-22.8929933,-22.8924205,-22.8957688,-22.8949103,-22.8956944,-22.8982619,-22.8970514,-22.8847426,-22.8835532,-22.8844891,-22.8968419,-22.9023233,-22.9009742,-22.8958035,-22.8956415,-22.8914803,-22.8919235,-22.8957525,-22.8978416]}]],[[{"lng":[-43.5774179,-43.5737418,-43.5640848,-43.5567405,-43.5410209,-43.53499410000001,-43.5400101,-43.54334459999999,-43.54357599999999,-43.5420994,-43.54449090000001,-43.5803564,-43.5806011,-43.582539,-43.583294,-43.5808425,-43.57990100000001,-43.5774179],"lat":[-22.9079255,-22.9068045,-22.9077749,-22.904989,-22.9141005,-22.9072217,-22.9041703,-22.9047302,-22.9030573,-22.9028369,-22.8991184,-22.906138,-22.908082,-22.90797939999999,-22.9105284,-22.9095594,-22.9105804,-22.9079255]}]],[[{"lng":[-43.50842910000001,-43.497544,-43.4906598,-43.48739579999999,-43.484556,-43.4810268,-43.4752546,-43.4704108,-43.471091,-43.4691278,-43.46638340000001,-43.4650372,-43.4771109,-43.4794694,-43.4797519,-43.48343990000001,-43.4929874,-43.49502200000001,-43.50741230000001,-43.5145879,-43.51443280000001,-43.5114397,-43.5101973,-43.50842910000001],"lat":[-22.86910739999999,-22.864502,-22.8654528,-22.8644728,-22.8707256,-22.8707505,-22.8666822,-22.8668002,-22.8642421,-22.86325449999999,-22.8646378,-22.8585793,-22.8574875,-22.858405,-22.8604047,-22.8618984,-22.8626768,-22.8565129,-22.8602416,-22.8604922,-22.8627506,-22.8631798,-22.8665733,-22.86910739999999]}]],[[{"lng":[-43.5180469,-43.5203602,-43.515109,-43.5145879,-43.50741230000001,-43.49502200000001,-43.4967355,-43.4873917,-43.48274259999999,-43.473657,-43.4547458,-43.45611509999999,-43.45416229999999,-43.4550163,-43.450208,-43.46921800000001,-43.4848996,-43.49022829999999,-43.5209082,-43.5250424,-43.5269201,-43.5270254,-43.5246954,-43.5221988,-43.5180469],"lat":[-22.8447046,-22.8465258,-22.852274,-22.8604922,-22.8602416,-22.8565129,-22.8512712,-22.8487328,-22.8538118,-22.8570298,-22.8603633,-22.8587028,-22.858144,-22.85686849999999,-22.8559658,-22.840411,-22.8307076,-22.815918,-22.8217698,-22.8245054,-22.8274559,-22.8310535,-22.8362956,-22.8380136,-22.8447046]}]],[[{"lng":[-43.46825490000001,-43.45521910000001,-43.455451,-43.44961969999999,-43.4549488,-43.45381669999999,-43.4650372,-43.4672208,-43.4672201,-43.4685184,-43.46825490000001],"lat":[-22.8753576,-22.8752554,-22.8716226,-22.8717884,-22.8630775,-22.8605225,-22.8585793,-22.8659899,-22.8725375,-22.8741641,-22.8753576]}]],[[{"lng":[-43.4823285,-43.46825490000001,-43.46638340000001,-43.4691278,-43.471091,-43.4704108,-43.4753588,-43.4823256,-43.4825316,-43.4823285],"lat":[-22.8757205,-22.8753576,-22.8646378,-22.86325449999999,-22.8642421,-22.8668002,-22.8667226,-22.87089469999999,-22.8722612,-22.8757205]}]],[[{"lng":[-43.4788957,-43.48009320000001,-43.4800123,-43.4772124,-43.47634739999999,-43.4700357,-43.4638291,-43.4545681,-43.4541412,-43.4565802,-43.4635389,-43.4635739,-43.46471630000001,-43.4646394,-43.4806922,-43.4802332,-43.4788957],"lat":[-22.8919184,-22.8927074,-22.8983359,-22.9016303,-22.9094489,-22.9144713,-22.9080237,-22.8930876,-22.8875745,-22.8852691,-22.8858061,-22.882754,-22.8827751,-22.88583779999999,-22.8863272,-22.8881202,-22.8919184]}]],[[{"lng":[-43.48126910000001,-43.4646394,-43.46471630000001,-43.4635739,-43.4635389,-43.4515709,-43.45232470000001,-43.45596270000001,-43.455701,-43.4805544,-43.48193430000001,-43.48126910000001],"lat":[-22.8862828,-22.88583779999999,-22.8827751,-22.882754,-22.8858061,-22.8847107,-22.882443,-22.8827873,-22.8752498,-22.8759873,-22.8816973,-22.8862828]}]],[[{"lng":[-43.50423050000001,-43.4986891,-43.496134,-43.48229859999999,-43.4815412,-43.4789594,-43.4823285,-43.4822612,-43.484556,-43.4868423,-43.48991830000001,-43.4905211,-43.4920146,-43.49299129999999,-43.49313859999999,-43.4894498,-43.4880477,-43.4916103,-43.491542,-43.4947261,-43.4950726,-43.4988876,-43.4988376,-43.5011267,-43.5001779,-43.50414019999999,-43.5042019,-43.506525,-43.50654339999999,-43.50423050000001],"lat":[-22.8879106,-22.8874985,-22.8848335,-22.8819765,-22.8762629,-22.8756392,-22.8757205,-22.8710077,-22.8707256,-22.8659166,-22.866588,-22.8683526,-22.8669455,-22.8695299,-22.871688,-22.8713405,-22.87691299999999,-22.8778738,-22.8788172,-22.8785083,-22.8761699,-22.87637059999999,-22.8783513,-22.87875349999999,-22.8813316,-22.8797337,-22.8774793,-22.8784894,-22.8810639,-22.8879106]}]],[[{"lng":[-43.5096379,-43.5072862,-43.5044073,-43.5044408,-43.50808190000001,-43.5069542,-43.5042019,-43.50414019999999,-43.5001779,-43.5011267,-43.4988376,-43.4988876,-43.4950726,-43.4947261,-43.491542,-43.4916103,-43.4880477,-43.4894498,-43.49313859999999,-43.4929376,-43.4920146,-43.4905211,-43.48991830000001,-43.48629589999999,-43.48739579999999,-43.4906598,-43.497544,-43.5085889,-43.5096379],"lat":[-22.8714965,-22.8709232,-22.8731935,-22.8762603,-22.8774749,-22.8799712,-22.8774793,-22.8797337,-22.8813316,-22.87875349999999,-22.8783513,-22.87637059999999,-22.8761699,-22.8785083,-22.8788172,-22.8778738,-22.87691299999999,-22.8713405,-22.871688,-22.8690571,-22.8669455,-22.8683526,-22.866588,-22.8658946,-22.8644728,-22.8654528,-22.864502,-22.8692784,-22.8714965]}]],[[{"lng":[-43.5344011,-43.5330185,-43.5320274,-43.5262476,-43.5261045,-43.5224193,-43.5216358,-43.51395280000001,-43.5098897,-43.50877109999999,-43.5128341,-43.50654429999999,-43.5027165,-43.50808190000001,-43.5044408,-43.5044073,-43.5072862,-43.5096379,-43.5087139,-43.5110055,-43.5114397,-43.51443280000001,-43.5145879,-43.5412009,-43.5410065,-43.54234,-43.5412565,-43.5354038,-43.5363001,-43.5344011],"lat":[-22.8775295,-22.8774842,-22.882609,-22.8823924,-22.885692,-22.8846239,-22.8870104,-22.8871488,-22.8900986,-22.8915034,-22.8975424,-22.893008,-22.8921202,-22.8774749,-22.8762603,-22.8731935,-22.8709232,-22.8714965,-22.8677984,-22.8658331,-22.8631798,-22.8627506,-22.8604922,-22.861371,-22.8628895,-22.8631391,-22.8658216,-22.8671486,-22.872596,-22.8775295]}]],[[{"lng":[-43.48009320000001,-43.4788957,-43.48193430000001,-43.496134,-43.4986891,-43.5028928,-43.50423050000001,-43.5027165,-43.50654429999999,-43.5128341,-43.5081022,-43.5023646,-43.4992463,-43.4980459,-43.4943471,-43.4933167,-43.4965096,-43.4952823,-43.48759270000001,-43.482874,-43.47284519999999,-43.4723479,-43.467519,-43.46916809999999,-43.4676318,-43.47634739999999,-43.4772124,-43.4800123,-43.4793775,-43.48009320000001],"lat":[-22.8927074,-22.8919184,-22.8816973,-22.8848335,-22.8874985,-22.8870292,-22.8879106,-22.8921202,-22.893008,-22.8975424,-22.8991003,-22.9049775,-22.9042485,-22.9077602,-22.9091918,-22.91339109999999,-22.9171523,-22.9228528,-22.9270337,-22.9255648,-22.9317931,-22.9279293,-22.9231981,-22.9199926,-22.9163322,-22.9094489,-22.9016303,-22.8983359,-22.8953192,-22.8927074]}]],[[{"lng":[-43.624644,-43.6158551,-43.6009853,-43.59771550000001,-43.59654129999999,-43.59785549999999,-43.5943933,-43.5850099,-43.5845696,-43.58740820000001,-43.5857083,-43.58223539999999,-43.5786299,-43.5746394,-43.5748773,-43.5673665,-43.564167,-43.5601312,-43.5145879,-43.515109,-43.5203602,-43.5180469,-43.5209085,-43.5246954,-43.5272468,-43.5250424,-43.5209082,-43.57865779999999,-43.5882461,-43.5926009,-43.59349640000001,-43.5971931,-43.6175047,-43.624644],"lat":[-22.862786,-22.8740468,-22.882401,-22.8829501,-22.8786383,-22.8782339,-22.8747762,-22.8769066,-22.8725756,-22.8702139,-22.8681193,-22.8693692,-22.8737837,-22.8722116,-22.8699173,-22.8686255,-22.8636603,-22.8627456,-22.8604922,-22.852274,-22.8465258,-22.8447046,-22.8391256,-22.8362956,-22.8299319,-22.8245054,-22.8217698,-22.833406,-22.8386403,-22.8510973,-22.8604031,-22.857821,-22.86169619999999,-22.862786]}]],[[{"lng":[-43.6300949,-43.6265403,-43.6216641,-43.6209615,-43.62430829999999,-43.62528159999999,-43.6338356,-43.6361028,-43.6300949],"lat":[-22.93969449999999,-22.939156,-22.9362104,-22.9194941,-22.9198403,-22.9149535,-22.9164398,-22.93439080000001,-22.93969449999999]}]],[[{"lng":[-43.65201099999999,-43.651504,-43.6441052,-43.6395851,-43.6361071,-43.6338356,-43.6260545,-43.62867070000001,-43.627134,-43.62707089999999,-43.6193301,-43.6214654,-43.6194379,-43.6251371,-43.6369146,-43.6355726,-43.6372288,-43.6460708,-43.65256520000001,-43.6524917,-43.655045,-43.66177609999999,-43.65201099999999],"lat":[-22.9157845,-22.9209294,-22.9241783,-22.9318729,-22.9344267,-22.9164398,-22.9140716,-22.9089079,-22.9072479,-22.9025637,-22.8979414,-22.8909379,-22.8873257,-22.8883614,-22.8959231,-22.8941513,-22.89500719999999,-22.9043025,-22.9057783,-22.9046532,-22.9042999,-22.9095195,-22.9157845]}]],[[{"lng":[-43.69548999999999,-43.68939,-43.6868316,-43.6787346,-43.67375310000001,-43.6517338,-43.65201099999999,-43.662154,-43.655045,-43.6524917,-43.65256520000001,-43.6493206,-43.64804729999999,-43.65341300000001,-43.6530282,-43.6556124,-43.67929629999999,-43.68701950000001,-43.6938739,-43.69548999999999],"lat":[-22.9101402,-22.9121429,-22.9164671,-22.9130722,-22.9155045,-22.9185603,-22.9157845,-22.9094162,-22.9042999,-22.9046532,-22.9057783,-22.9053708,-22.893164,-22.8935148,-22.8897181,-22.8872712,-22.89474269999999,-22.8946403,-22.9091926,-22.9101402]}]],[[{"lng":[-43.7101614,-43.6993923,-43.6943874,-43.68271989999999,-43.6791436,-43.64394129999999,-43.64383369999999,-43.6426102,-43.643781,-43.6433435,-43.6528453,-43.6535817,-43.65317080000001,-43.6629856,-43.6632724,-43.6653741,-43.65839620000001,-43.661171,-43.666659,-43.6662865,-43.6776649,-43.6822116,-43.69096159999999,-43.6978277,-43.70491119999999,-43.7093405,-43.7132428,-43.71538710000001,-43.7180402,-43.72592599999999,-43.7333207,-43.74593350000001,-43.75189289999999,-43.7507263,-43.7536499,-43.7346981,-43.7101614],"lat":[-22.90575189999999,-22.9004818,-22.8929776,-22.8952454,-22.8947054,-22.8839341,-22.8802275,-22.8798131,-22.8797648,-22.8774572,-22.8778931,-22.8750125,-22.8781844,-22.8807203,-22.882309,-22.8765615,-22.8716583,-22.86773699999999,-22.867785,-22.8652422,-22.8652915,-22.8633141,-22.8651351,-22.8649039,-22.8680891,-22.86799539999999,-22.87143589999999,-22.87123,-22.8729888,-22.8729556,-22.8777527,-22.8771573,-22.8800141,-22.8878793,-22.8892657,-22.8970573,-22.90575189999999]}]],[[{"lng":[-43.66575989999999,-43.65969139999999,-43.65549190000001,-43.6503404,-43.6481342,-43.6461253,-43.6493343,-43.6448503,-43.6379104,-43.61971339999999,-43.6140694,-43.61339349999999,-43.61629749999999,-43.6304771,-43.6394461,-43.6441052,-43.6511384,-43.6517774,-43.6559745,-43.66481329999999,-43.66688300000001,-43.66575989999999],"lat":[-22.9400707,-22.9449896,-22.9461188,-22.9513204,-22.9490475,-22.9501973,-22.9543566,-22.9570671,-22.9561256,-22.9481209,-22.942001,-22.9361723,-22.9348354,-22.9396235,-22.9320377,-22.9241783,-22.9211842,-22.9267518,-22.930903,-22.9340611,-22.936584,-22.9400707]}]],[[{"lng":[-43.67976110000001,-43.6786242,-43.6670233,-43.6562606,-43.6517774,-43.6509675,-43.67375310000001,-43.6787346,-43.6839997,-43.6836574,-43.67976110000001],"lat":[-22.92180939999999,-22.9266498,-22.9356522,-22.9311694,-22.9267518,-22.9186399,-22.9155045,-22.9130722,-22.9155402,-22.9164405,-22.92180939999999]}]],[[{"lng":[-43.726948,-43.71947790000001,-43.7082859,-43.70409169999999,-43.694952,-43.6952962,-43.68811480000001,-43.6996479,-43.70051489999999,-43.69871919999999,-43.6947739,-43.6948685,-43.6964815,-43.69599940000001,-43.685372,-43.6878302,-43.68939,-43.69548999999999,-43.6939866,-43.68701950000001,-43.6943874,-43.6993923,-43.7101614,-43.74729620000001,-43.7536499,-43.76636509999999,-43.7796434,-43.78898179999999,-43.7953662,-43.7965385,-43.789848,-43.7826099,-43.78116569999999,-43.7817849,-43.7735475,-43.76822180000001,-43.76701449999999,-43.7534636,-43.7504711,-43.7497694,-43.7464686,-43.726948],"lat":[-22.95914879999999,-22.9669935,-22.9635847,-22.9559239,-22.94648249999999,-22.94478969999999,-22.9399589,-22.9385016,-22.9339414,-22.9290265,-22.9275864,-22.9264188,-22.9264539,-22.9231586,-22.9162441,-22.91602,-22.9121429,-22.9101402,-22.9094218,-22.8946403,-22.8929776,-22.9004818,-22.90575189999999,-22.8926486,-22.8892657,-22.8952407,-22.8971262,-22.9131975,-22.9165428,-22.9194283,-22.9260832,-22.9237934,-22.9253892,-22.9279606,-22.9334143,-22.9323627,-22.93517539999999,-22.9409764,-22.9436198,-22.9463674,-22.9470828,-22.95914879999999]}]],[[{"lng":[-43.6857467,-43.68435729999999,-43.684257,-43.68287549999999,-43.6808483,-43.6832862,-43.6821546,-43.68621309999999,-43.6815715,-43.687867,-43.67078900000001,-43.6649493,-43.6576835,-43.65436969999999,-43.6492744,-43.6461253,-43.6481342,-43.6503404,-43.65549190000001,-43.6602265,-43.66621279999999,-43.6660256,-43.6674351,-43.6790248,-43.6806339,-43.6790452,-43.6867829,-43.6861595,-43.6952962,-43.6926238,-43.6857467],"lat":[-22.947379,-22.94657,-22.9486553,-22.9477945,-22.949675,-22.9540574,-22.954549,-22.95500759999999,-22.9592523,-22.9628787,-22.9703394,-22.96731170000001,-22.9569221,-22.954948,-22.9541669,-22.9501973,-22.9490475,-22.9513204,-22.9461188,-22.9446268,-22.9394953,-22.9353285,-22.935382,-22.9258273,-22.9260318,-22.9286689,-22.9380599,-22.9389678,-22.94478969999999,-22.9463932,-22.947379]}]],[[{"lng":[-43.7034448,-43.7028832,-43.7073615,-43.706644,-43.7034448],"lat":[-22.9858403,-22.9852257,-22.9865559,-22.9869268,-22.9858403]}],[{"lng":[-43.69553269999999,-43.69520070000001,-43.6958688,-43.69613510000001,-43.69553269999999],"lat":[-22.9865235,-22.9861739,-22.9863426,-22.9867257,-22.9865235]}],[{"lng":[-43.7138357,-43.7106262,-43.7039264,-43.7003959,-43.6958661,-43.6894636,-43.68615250000001,-43.6830217,-43.6800362,-43.6743367,-43.6745149,-43.6804436,-43.681453,-43.6864071,-43.69779010000001,-43.6979306,-43.70333499999999,-43.7086809,-43.7086696,-43.7103294,-43.71079580000001,-43.71947790000001,-43.71875290000001,-43.7208298,-43.7197733,-43.7138357],"lat":[-22.9696682,-22.9712529,-22.9793368,-22.9863375,-22.9848173,-22.9917937,-22.9855154,-22.9844782,-22.9814926,-22.9812576,-22.9777255,-22.9779457,-22.9733707,-22.9708088,-22.9692843,-22.9679969,-22.9690248,-22.9654029,-22.9677436,-22.9675494,-22.9646063,-22.9669935,-22.9701762,-22.9713076,-22.9735998,-22.9696682]}]],[[{"lng":[-43.69932609999999,-43.68811480000001,-43.6861595,-43.6867829,-43.6790452,-43.6806339,-43.6790248,-43.6796882,-43.6839997,-43.69599940000001,-43.6964815,-43.6948685,-43.6947739,-43.6990256,-43.7001984,-43.69932609999999],"lat":[-22.9386193,-22.9399589,-22.9389678,-22.9380599,-22.9286689,-22.9260318,-22.9258273,-22.9219952,-22.9155402,-22.9231586,-22.9264539,-22.9264188,-22.9275864,-22.92947479999999,-22.93589069999999,-22.9386193]}]],[[{"lng":[-43.20684389999999,-43.2062483,-43.2089639,-43.2085792,-43.20487790000001,-43.204989,-43.2033303,-43.1996468,-43.1932255,-43.1894465,-43.189697,-43.1878681,-43.1869525,-43.18305369999999,-43.1839891,-43.1874863,-43.1846416,-43.18613819999999,-43.1836532,-43.1860842,-43.19128990000001,-43.1936857,-43.1945309,-43.1980085,-43.19397019999999,-43.1954983,-43.1990273,-43.19842200000001,-43.2025422,-43.20865149999999,-43.20684389999999],"lat":[-22.9403928,-22.942134,-22.9432615,-22.9458635,-22.9444683,-22.946226,-22.9466541,-22.9433132,-22.9463313,-22.9451869,-22.9413933,-22.93925200000001,-22.9404058,-22.9394725,-22.9358319,-22.9345141,-22.9333669,-22.9307314,-22.9282907,-22.9263431,-22.9276347,-22.9293152,-22.9322821,-22.9342658,-22.9337331,-22.936292,-22.9362636,-22.9396393,-22.93844349999999,-22.9404281,-22.9403928]}]],[[{"lng":[-43.20870850000001,-43.20887209999999,-43.20957850000001,-43.20905,-43.20870850000001],"lat":[-22.8912642,-22.8899944,-22.8911907,-22.8919991,-22.8912642]}],[{"lng":[-43.2306329,-43.2270949,-43.2221761,-43.2175476,-43.2149185,-43.2103007,-43.209573,-43.1937619,-43.18842899999999,-43.1821539,-43.180725,-43.1822104,-43.1811522,-43.19074390000001,-43.1958147,-43.2107019,-43.2158052,-43.2044935,-43.2039444,-43.2099971,-43.2139034,-43.2127352,-43.216265,-43.2170231,-43.21885830000001,-43.2187039,-43.22410449999999,-43.2245698,-43.22600500000001,-43.2302232,-43.2328951,-43.2357631,-43.2318889,-43.2334181,-43.2306329],"lat":[-22.8872435,-22.8849351,-22.8887889,-22.88781569999999,-22.8946051,-22.8986804,-22.90927049999999,-22.9031983,-22.8988204,-22.9002867,-22.8971496,-22.897093,-22.89534699999999,-22.8919189,-22.89185389999999,-22.8974448,-22.8867182,-22.8750489,-22.8716253,-22.8668686,-22.8711692,-22.87272279999999,-22.8733408,-22.8757072,-22.8744895,-22.8719853,-22.8735989,-22.8751412,-22.8690529,-22.8678123,-22.869127,-22.8758343,-22.8854919,-22.8867909,-22.8872435]}],[{"lng":[-43.2073223,-43.2081397,-43.21094189999999,-43.2111698,-43.2085486,-43.2073223],"lat":[-22.8889687,-22.8866593,-22.8868577,-22.8874288,-22.8897008,-22.8889687]}],[{"lng":[-43.19567920000001,-43.1955844,-43.1981486,-43.19753410000001,-43.19567920000001],"lat":[-22.8874926,-22.8871033,-22.8877532,-22.8881483,-22.8874926]}]],[[{"lng":[-43.54709099999999,-43.54553600000001,-43.5462228,-43.5420994,-43.54357599999999,-43.54334459999999,-43.5400101,-43.53499410000001,-43.5333049,-43.5295139,-43.53084270000001,-43.5267616,-43.52504980000001,-43.52352399999999,-43.5128341,-43.50877109999999,-43.51395280000001,-43.5216358,-43.5224193,-43.5261045,-43.5254657,-43.52737579999999,-43.53125579999999,-43.53303529999999,-43.5354445,-43.5393091,-43.5460887,-43.54709099999999],"lat":[-22.8902466,-22.8932234,-22.8968341,-22.9028369,-22.9030573,-22.9047302,-22.9041703,-22.9072217,-22.9052068,-22.9043263,-22.9083355,-22.904925,-22.8986605,-22.89760039999999,-22.8975424,-22.8915034,-22.8871488,-22.8870104,-22.8846239,-22.885692,-22.8829602,-22.88207,-22.8827863,-22.8854087,-22.8845532,-22.88556489999999,-22.889673,-22.8902466]}]],[[{"lng":[-43.1839891,-43.18305369999999,-43.180532,-43.1782631,-43.1805366,-43.1834826,-43.18613819999999,-43.1846416,-43.1874863,-43.1861139,-43.1839891],"lat":[-22.9358319,-22.9394725,-22.9384718,-22.9353961,-22.9295944,-22.928619,-22.9307314,-22.9333669,-22.9345141,-22.9351366,-22.9358319]}]],[[{"lng":[-43.5780396,-43.5780469,-43.5793922,-43.57922019999999,-43.5852246,-43.5891867,-43.5914911,-43.5943269,-43.5953552,-43.5975065,-43.597874,-43.6015718,-43.6019957,-43.6040748,-43.6045568,-43.5780396],"lat":[-22.905688,-22.9014673,-22.9014665,-22.8991802,-22.8969448,-22.8978048,-22.8901407,-22.890473,-22.8894154,-22.893825,-22.9005459,-22.9013808,-22.9046473,-22.9036729,-22.9108401,-22.905688]}]],[[{"lng":[-43.6065733,-43.6054135,-43.6047678,-43.6058286,-43.6017438,-43.5994848,-43.5918484,-43.5921989,-43.58925929999999,-43.5818375,-43.5811739,-43.583294,-43.582539,-43.5806011,-43.5803564,-43.6060912,-43.60504890000001,-43.606842,-43.60685669999999,-43.6065733],"lat":[-22.9247321,-22.9250347,-22.928341,-22.9343611,-22.9332518,-22.9294126,-22.92567829999999,-22.9237254,-22.9234551,-22.9192238,-22.9114387,-22.9105284,-22.90797939999999,-22.908082,-22.906138,-22.9111193,-22.9130259,-22.9149447,-22.9185841,-22.9247321]}]],[[{"lng":[-43.62528159999999,-43.62430829999999,-43.6209615,-43.6216641,-43.6058286,-43.6047678,-43.6069689,-43.606842,-43.60504890000001,-43.6063183,-43.6045568,-43.6040748,-43.6019957,-43.6015718,-43.597874,-43.5976202,-43.6024783,-43.6025858,-43.610074,-43.6276736,-43.6260545,-43.6289583,-43.62528159999999],"lat":[-22.9149535,-22.9198403,-22.9194941,-22.9362104,-22.9343611,-22.928341,-22.9223911,-22.9149447,-22.9130259,-22.912011,-22.9108401,-22.9036729,-22.9046473,-22.9013808,-22.9005459,-22.8980991,-22.8975501,-22.8985807,-22.9000772,-22.9120608,-22.9140716,-22.9156639,-22.9149535]}]],[[{"lng":[-43.627495,-43.6233007,-43.6203914,-43.610074,-43.6025858,-43.6024783,-43.5976034,-43.5956188,-43.5976812,-43.59752220000001,-43.60560570000001,-43.6060875,-43.6180495,-43.6214654,-43.6193301,-43.62707089999999,-43.627134,-43.62867070000001,-43.62770949999999,-43.627495],"lat":[-22.9119305,-22.9099707,-22.9066422,-22.9000772,-22.8985807,-22.8975501,-22.8979622,-22.8889987,-22.8881394,-22.8870487,-22.8858691,-22.8848396,-22.88553559999999,-22.8909379,-22.8979414,-22.9025637,-22.9072479,-22.9089079,-22.9100207,-22.9119305]}]],[[{"lng":[-43.6629856,-43.65317080000001,-43.6535817,-43.6528453,-43.6433435,-43.643781,-43.64263700000001,-43.64383369999999,-43.64394129999999,-43.65533719999999,-43.6530282,-43.65341300000001,-43.64804729999999,-43.6493206,-43.6436177,-43.6422829,-43.6372288,-43.6355726,-43.6369146,-43.6251371,-43.6194379,-43.61835329999999,-43.6213596,-43.6200097,-43.61231710000001,-43.6158551,-43.624644,-43.64429639999999,-43.6504662,-43.6570516,-43.6662865,-43.666659,-43.661171,-43.65839620000001,-43.6653741,-43.6632724,-43.6629856],"lat":[-22.8807203,-22.8781844,-22.8750125,-22.8778931,-22.8774572,-22.8797648,-22.8802648,-22.8802275,-22.8839341,-22.8873858,-22.8897181,-22.8935148,-22.893164,-22.9053708,-22.9027058,-22.8993336,-22.89500719999999,-22.8941513,-22.8959231,-22.8883614,-22.8873257,-22.8850714,-22.8844232,-22.8793855,-22.8762926,-22.8740468,-22.862786,-22.8562487,-22.8580807,-22.8626657,-22.8652422,-22.867785,-22.86773699999999,-22.8716583,-22.8765615,-22.882309,-22.8807203]}]],[[{"lng":[-43.2451061,-43.2451262,-43.2424653,-43.2432771,-43.24219899999999,-43.24225910000001,-43.2377257,-43.24051259999999,-43.2443686,-43.24682479999999,-43.24729430000001,-43.2451061],"lat":[-22.8532159,-22.8546765,-22.85431179999999,-22.8555913,-22.8553956,-22.85725339999999,-22.8561952,-22.8492685,-22.8477832,-22.8502664,-22.8533482,-22.8532159]}]],[[{"lng":[-43.1860842,-43.1842759,-43.1805366,-43.1791512,-43.1768356,-43.17637799999999,-43.1687559,-43.1678466,-43.1673593,-43.16913329999999,-43.17031859999999,-43.1726962,-43.17204309999999,-43.1689023,-43.1694767,-43.1738472,-43.1747925,-43.1767804,-43.17761120000001,-43.1805782,-43.1801176,-43.18426939999999,-43.1860842],"lat":[-22.9263428,-22.9285921,-22.9295944,-22.9326411,-22.9329093,-22.92516909999999,-22.9246513,-22.92249469999999,-22.9192365,-22.9168877,-22.919757,-22.9178283,-22.9155018,-22.9145873,-22.91116209999999,-22.9134595,-22.9128683,-22.9146696,-22.9187773,-22.9199365,-22.92284799999999,-22.9244143,-22.9263428]}]],[[{"lng":[-43.23652570000001,-43.2382172,-43.2397672,-43.2417304,-43.2394135,-43.23233949999999,-43.2337455,-43.2365776,-43.2382266,-43.2413119,-43.23652570000001],"lat":[-22.8754756,-22.8777697,-22.8757461,-22.87683269999999,-22.88023,-22.8690009,-22.8633333,-22.8617212,-22.8627666,-22.8688138,-22.8754756]}]],[[{"lng":[-43.2438413,-43.2453506,-43.24365029999999,-43.2439813,-43.24198060000001,-43.2432232,-43.2410105,-43.2367207,-43.2377257,-43.24225910000001,-43.24219899999999,-43.2432771,-43.2424653,-43.24572450000001,-43.2459001,-43.2438413],"lat":[-22.8583461,-22.85824359999999,-22.859295,-22.8615259,-22.8621662,-22.8650092,-22.8650633,-22.8613993,-22.8561952,-22.85725339999999,-22.8553956,-22.8555913,-22.85431179999999,-22.8548073,-22.8567865,-22.8583461]}]],[[{"lng":[-43.182334,-43.1807868,-43.1783708,-43.17956899999999,-43.1695728,-43.1626467,-43.1617767,-43.1599648,-43.15978819999999,-43.1642209,-43.1642307,-43.1610124,-43.1567015,-43.1505684,-43.1511183,-43.15478559999999,-43.1556685,-43.1509894,-43.1515996,-43.1577211,-43.1583285,-43.16218070000001,-43.1638522,-43.16315509999999,-43.16517400000001,-43.1697539,-43.1789938,-43.1806947,-43.18497959999999,-43.182334],"lat":[-22.9549665,-22.9578227,-22.9568427,-22.9610711,-22.9573268,-22.959442,-22.9615467,-22.961577,-22.9575616,-22.9565352,-22.9544847,-22.9527828,-22.9534393,-22.9512678,-22.9488391,-22.9473233,-22.9433767,-22.94063120000001,-22.9387139,-22.9412902,-22.9434813,-22.9433526,-22.9457942,-22.9473774,-22.9476824,-22.9518879,-22.9484484,-22.9489139,-22.95605269999999,-22.9549665]}],[{"lng":[-43.14650199999999,-43.1461031,-43.1472493,-43.1484543,-43.14650199999999],"lat":[-22.9347873,-22.93421949999999,-22.9343989,-22.93555869999999,-22.9347873]}]],[[{"lng":[-43.2546817,-43.2562225,-43.2473514,-43.2478504,-43.2471095,-43.2441212,-43.2448384,-43.2417304,-43.2397672,-43.2382172,-43.23691919999999,-43.2416899,-43.2365776,-43.2384686,-43.2410105,-43.2432232,-43.24198060000001,-43.2439813,-43.24365029999999,-43.2453506,-43.2438413,-43.2458862,-43.2451061,-43.2472928,-43.2471754,-43.2443686,-43.24051259999999,-43.2433745,-43.24673809999999,-43.2546817],"lat":[-22.8363895,-22.8378354,-22.8474146,-22.8637718,-22.8691331,-22.870053,-22.8728032,-22.87683269999999,-22.8757461,-22.8777697,-22.8741051,-22.8691873,-22.8617212,-22.8625635,-22.8650633,-22.8650092,-22.8621662,-22.8615259,-22.859295,-22.85824359999999,-22.8583461,-22.85719,-22.8532159,-22.8534731,-22.8515908,-22.8477832,-22.8492685,-22.8421206,-22.8400596,-22.8363895]}]],[[{"lng":[-43.1972557,-43.1936788,-43.1878734,-43.17956899999999,-43.1783708,-43.1807868,-43.182334,-43.18497959999999,-43.18152489999999,-43.18981489999999,-43.1910669,-43.19417199999999,-43.19144740000001,-43.19714330000001,-43.19727899999999,-43.1972557],"lat":[-22.9627376,-22.9613144,-22.9632625,-22.9610711,-22.9568427,-22.9578227,-22.9549665,-22.95605269999999,-22.9503486,-22.9533808,-22.9500696,-22.9511699,-22.9580942,-22.95855229999999,-22.9597543,-22.9627376]}]],[[{"lng":[-43.2027547,-43.2040151,-43.2021225,-43.20047819999999,-43.1972557,-43.1972789,-43.19144740000001,-43.19417199999999,-43.19636189999999,-43.2016536,-43.2100219,-43.2019217,-43.2044785,-43.2027547],"lat":[-22.9578354,-22.9607949,-22.96039949999999,-22.9621401,-22.9627376,-22.9586182,-22.9580942,-22.9511699,-22.95262,-22.9485641,-22.9519619,-22.9545661,-22.9569496,-22.9578354]}]],[[{"lng":[-43.1858257,-43.17980519999999,-43.1797213,-43.1781446,-43.17625109999999,-43.1756085,-43.17698000000001,-43.17953300000001,-43.18305369999999,-43.1822303,-43.1837034,-43.1852415,-43.1860623,-43.1858257],"lat":[-22.9519441,-22.9494334,-22.9440899,-22.94300549999999,-22.9440225,-22.9428436,-22.9404682,-22.9391833,-22.9394725,-22.9420008,-22.9438605,-22.9436374,-22.9508267,-22.9519441]}]],[[{"lng":[-43.19636189999999,-43.1910669,-43.18981489999999,-43.1858257,-43.1852415,-43.1837034,-43.1822303,-43.18305369999999,-43.1869525,-43.1878681,-43.189697,-43.1894465,-43.1932255,-43.196381,-43.2016536,-43.19808969999999,-43.19636189999999],"lat":[-22.95262,-22.9500696,-22.9533808,-22.9519441,-22.9436374,-22.9438605,-22.9420008,-22.9394725,-22.9404058,-22.93925200000001,-22.9413933,-22.9451869,-22.9463313,-22.94503389999999,-22.9485641,-22.9509769,-22.95262]}]],[[{"lng":[-43.71079580000001,-43.7103294,-43.7086696,-43.7086809,-43.70333499999999,-43.6979306,-43.69779010000001,-43.6861657,-43.681453,-43.6804436,-43.6745149,-43.6759235,-43.67078900000001,-43.687867,-43.6815715,-43.68621309999999,-43.6821546,-43.6832862,-43.6807576,-43.68287549999999,-43.684257,-43.68435729999999,-43.6857467,-43.6950701,-43.70921540000001,-43.71079580000001],"lat":[-22.9646063,-22.9675494,-22.9677436,-22.9654029,-22.9690248,-22.9679969,-22.9692843,-22.9709245,-22.9733707,-22.9779457,-22.9777255,-22.9719712,-22.9703394,-22.9628787,-22.9592523,-22.95500759999999,-22.954549,-22.9540574,-22.9502898,-22.9477945,-22.9486553,-22.94657,-22.947379,-22.9454031,-22.9641037,-22.9646063]}]],[[{"lng":[-43.6600845,-43.6597697,-43.66131039999999,-43.6606897,-43.6600845],"lat":[-22.9986541,-22.9982914,-22.9984681,-22.99898649999999,-22.9986541]}],[{"lng":[-43.6604478,-43.6604793,-43.66086720000001,-43.66077900000001,-43.6604478],"lat":[-22.999842,-22.9995149,-22.9996426,-22.9999823,-22.999842]}],[{"lng":[-43.6743367,-43.664772,-43.65288779999999,-43.65041749999999,-43.65059149999999,-43.6472662,-43.6478966,-43.6410354,-43.6345342,-43.6328239,-43.63107079999999,-43.6268813,-43.6245874,-43.6205031,-43.6127404,-43.6124996,-43.61405659999999,-43.6185679,-43.6229809,-43.62018629999999,-43.6149792,-43.61212789999999,-43.6099664,-43.612562,-43.6143272,-43.61866599999999,-43.62315239999999,-43.62451789999999,-43.6219792,-43.6223187,-43.6291555,-43.6269342,-43.6269976,-43.63289129999999,-43.63282689999999,-43.6339867,-43.6358927,-43.63728889999999,-43.6371811,-43.6402245,-43.6429024,-43.6433824,-43.645503,-43.6428155,-43.6455486,-43.6466131,-43.6448503,-43.6492396,-43.6522795,-43.65436969999999,-43.6576835,-43.66544519999999,-43.67583259999999,-43.6745149,-43.6743367],"lat":[-22.9812576,-22.9869171,-23.0009214,-22.997521,-22.99318359999999,-22.9924126,-22.9896265,-22.987363,-22.9807399,-22.9800838,-22.985186,-22.9814379,-22.9844954,-22.9815657,-22.979349,-22.975002,-22.9723147,-22.9686331,-22.9689123,-22.9648784,-22.9636343,-22.96125749999999,-22.9549481,-22.95405909999999,-22.9564672,-22.9555122,-22.9567655,-22.9549615,-22.9526335,-22.9511882,-22.9545179,-22.9551892,-22.9588277,-22.9575382,-22.9606653,-22.95926369999999,-22.9600748,-22.9590721,-22.9608721,-22.961616,-22.9642962,-22.9624677,-22.9614932,-22.9584241,-22.9601114,-22.9586644,-22.9570671,-22.9534839,-22.955247,-22.954948,-22.9569221,-22.9677199,-22.9718424,-22.9777255,-22.9812576]}]],[[{"lng":[-43.5613187,-43.55912439999999,-43.561399,-43.5638517,-43.56107769999999,-43.5613187],"lat":[-23.0811387,-23.0806446,-23.0787394,-23.0821527,-23.0828927,-23.0811387]}],[{"lng":[-43.6481352,-43.6434719,-43.6387056,-43.630904,-43.62444229999999,-43.6153974,-43.6072458,-43.6054961,-43.6091066,-43.6124996,-43.6128468,-43.6205031,-43.6245874,-43.6268813,-43.63107079999999,-43.6328239,-43.6402535,-43.6410354,-43.6478966,-43.6472662,-43.6509544,-43.65041749999999,-43.6536559,-43.6526623,-43.6481352],"lat":[-23.0015546,-23.0017847,-23.0064291,-23.0062807,-23.0086855,-23.004223,-22.9948379,-22.9871894,-22.9836112,-22.975002,-22.9794493,-22.9815657,-22.9844954,-22.9814379,-22.985186,-22.9800838,-22.98546839999999,-22.987363,-22.9896265,-22.9924126,-22.9938181,-22.997521,-23.0026211,-23.003561,-23.0015546]}],[{"lng":[-43.57307159999999,-43.5730942,-43.574063,-43.5735854,-43.57307159999999],"lat":[-23.0731838,-23.0728124,-23.072961,-23.0734559,-23.0731838]}],[{"lng":[-43.5664302,-43.5692183,-43.56803619999999,-43.57257969999999,-43.5649422,-43.5548852,-43.5540822,-43.5523874,-43.5519872,-43.5553161,-43.5585674,-43.55649469999999,-43.5523557,-43.5495203,-43.54971639999999,-43.5473826,-43.5485121,-43.5477308,-43.5431111,-43.54258979999999,-43.5394602,-43.53905390000001,-43.53210960000001,-43.53211389999999,-43.5303723,-43.5276179,-43.5267862,-43.5220365,-43.52752529999999,-43.5307971,-43.5310896,-43.5369515,-43.5456032,-43.56723759999999,-43.57198959999999,-43.5733226,-43.5739349,-43.5775781,-43.57873879999999,-43.5803126,-43.58099730000001,-43.58441449999999,-43.5839352,-43.5863492,-43.5867238,-43.5898595,-43.5902583,-43.5926498,-43.596512,-43.59974149999999,-43.5946055,-43.58224269999999,-43.5782112,-43.5724655,-43.5639627,-43.563044,-43.5639694,-43.5614139,-43.559966,-43.560409,-43.5574922,-43.5571897,-43.56043349999999,-43.5655604,-43.56801909999999,-43.5659635,-43.5670091,-43.5775897,-43.58631279999999,-43.5885293,-43.59339610000001,-43.6019869,-43.6061328,-43.61463819999999,-43.61968160000001,-43.629991,-43.6640988,-43.6670868,-43.6685205,-43.62384539999999,-43.6019623,-43.5822685,-43.5664302],"lat":[-23.0630271,-23.0663084,-23.07140219999999,-23.073457,-23.0758451,-23.0736853,-23.0759097,-23.0748353,-23.0735283,-23.07015,-23.0686115,-23.0603614,-23.0578936,-23.0537165,-23.0501906,-23.0473139,-23.0438849,-23.0417508,-23.03864799999999,-23.0339549,-23.0322484,-23.0289451,-23.022995,-23.0208071,-23.0170028,-23.015046,-23.0112961,-23.0077441,-23.0081282,-23.0098146,-23.0127549,-23.0135518,-23.0084581,-23.0033065,-23.0138917,-23.0132713,-23.0144693,-23.015017,-23.0140608,-23.0166857,-23.0125815,-23.0142653,-23.0173505,-23.0188898,-23.0214587,-23.0210531,-23.0172173,-23.0220445,-23.0211754,-23.0235001,-23.0328089,-23.0387773,-23.0460438,-23.0498474,-23.0539013,-23.050627,-23.0464204,-23.0451826,-23.0460514,-23.04803609999999,-23.0488099,-23.0508076,-23.05725869999999,-23.06150779999999,-23.0594783,-23.0553157,-23.0540709,-23.047623,-23.0450882,-23.0428417,-23.0426624,-23.03962779999999,-23.03300299999999,-23.0306095,-23.0326183,-23.0333753,-23.0405705,-23.04282659999999,-23.0540933,-23.0509092,-23.051183,-23.0549022,-23.0630271]}]],[[{"lng":[-43.5456032,-43.5369515,-43.5310896,-43.5307971,-43.52752529999999,-43.5220365,-43.5231416,-43.5209277,-43.5220837,-43.5192658,-43.5208738,-43.5193133,-43.516315,-43.52082399999999,-43.51764900000001,-43.5187858,-43.51746600000001,-43.538541,-43.5507134,-43.5614291,-43.5608519,-43.5624959,-43.56222460000001,-43.56793,-43.5710044,-43.5774097,-43.5851761,-43.5884392,-43.59500939999999,-43.59709180000001,-43.5974918,-43.6039736,-43.6057783,-43.6078174,-43.609666,-43.6055821,-43.6066628,-43.6149134,-43.6235374,-43.611749,-43.59974149999999,-43.596512,-43.5926498,-43.5902583,-43.5898595,-43.5867238,-43.5863492,-43.5839352,-43.58441449999999,-43.58099730000001,-43.5803126,-43.57873879999999,-43.5775781,-43.5739349,-43.5733226,-43.57198959999999,-43.5673627,-43.5456032],"lat":[-23.0084581,-23.0135518,-23.0127549,-23.0098146,-23.0081282,-23.0077441,-23.0020131,-22.9986667,-22.9946838,-22.9920027,-22.9883096,-22.9774374,-22.9741741,-22.9677925,-22.9640547,-22.957055,-22.9526673,-22.9422908,-22.9486401,-22.9496886,-22.94372,-22.9438717,-22.9416128,-22.9395372,-22.9453411,-22.947601,-22.95496899999999,-22.9523425,-22.9545056,-22.9569448,-22.9633658,-22.9635583,-22.9741259,-22.9738228,-22.9825165,-22.9868221,-22.9936043,-23.0038393,-23.0086602,-23.01924589999999,-23.0235001,-23.0211754,-23.0220445,-23.0172173,-23.0210531,-23.0214587,-23.0188898,-23.0173505,-23.0142653,-23.0125815,-23.0166857,-23.0140608,-23.015017,-23.0144693,-23.0132713,-23.0138917,-23.0036651,-23.0084581]}]],[[{"lng":[-43.6402245,-43.6371811,-43.63728889999999,-43.6358927,-43.6339867,-43.63282689999999,-43.63289129999999,-43.6269976,-43.6269342,-43.6291555,-43.6223187,-43.6219792,-43.62451789999999,-43.62315239999999,-43.61866599999999,-43.6143272,-43.612562,-43.6099664,-43.61212789999999,-43.6149792,-43.62018629999999,-43.6229809,-43.6185679,-43.61405659999999,-43.609666,-43.6078174,-43.6057783,-43.6039736,-43.5974918,-43.59709180000001,-43.5948159,-43.58815630000001,-43.5851761,-43.57708919999999,-43.57880859999999,-43.5779039,-43.5864819,-43.5924471,-43.603767,-43.6146549,-43.61339349999999,-43.6140694,-43.6170201,-43.6379104,-43.6420968,-43.6466131,-43.6455486,-43.6425644,-43.645503,-43.6433824,-43.6429024,-43.6402245],"lat":[-22.961616,-22.9608721,-22.9590721,-22.9600748,-22.95926369999999,-22.9606653,-22.9575382,-22.9588277,-22.9551892,-22.9545179,-22.9511882,-22.9526335,-22.9549615,-22.9567655,-22.9555122,-22.9564672,-22.95405909999999,-22.9549481,-22.96125749999999,-22.9636343,-22.9648784,-22.9689123,-22.9686331,-22.9723147,-22.9825165,-22.9738228,-22.9741259,-22.9635583,-22.9633658,-22.9569448,-22.9543503,-22.9523581,-22.95496899999999,-22.9474192,-22.9377439,-22.9318996,-22.9322429,-22.9355901,-22.9339548,-22.9346761,-22.9361723,-22.942001,-22.9463146,-22.9561256,-22.9558956,-22.9586644,-22.9601114,-22.9588005,-22.9614932,-22.9624677,-22.9642962,-22.961616]}]],[[{"lng":[-43.25161550000001,-43.2492105,-43.2507254,-43.2508396,-43.2531019,-43.2509334,-43.2485934,-43.2490721,-43.2470814,-43.2441934,-43.24672569999999,-43.2485834,-43.2499477,-43.2518518,-43.2522704,-43.25161550000001],"lat":[-22.9924397,-22.9923799,-22.993734,-22.992579,-22.9930028,-22.9941389,-22.9926571,-22.9917589,-22.99193,-22.98907909999999,-22.9869635,-22.9878015,-22.9870314,-22.9881568,-22.9905994,-22.9924397]}],[{"lng":[-43.2528187,-43.25537190000001,-43.2541874,-43.2558931,-43.2508485,-43.2496502,-43.2450854,-43.25427,-43.2557347,-43.2570145,-43.2536971,-43.2528187],"lat":[-22.9902306,-22.9887377,-22.9879427,-22.9863851,-22.9859384,-22.9870915,-22.9861392,-22.9833752,-22.9845501,-22.9885937,-22.9905449,-22.9902306]}]],[[{"lng":[-43.2541874,-43.2554271,-43.2532025,-43.2499477,-43.2446802,-43.24494019999999,-43.24767679999999,-43.2490721,-43.2485934,-43.2515266,-43.2502846,-43.23977979999999,-43.24236949999999,-43.2463755,-43.245461,-43.2509171,-43.2506964,-43.24541879999999,-43.25559519999999,-43.2541874],"lat":[-22.9879427,-22.9886384,-22.991019,-22.9870314,-22.9880279,-22.9902806,-22.9922054,-22.9917589,-22.9926571,-22.9942137,-22.9957876,-22.9907205,-22.9856151,-22.9846002,-22.9859157,-22.9827906,-22.9846193,-22.9867935,-22.9863702,-22.9879427]}]],[[{"lng":[-43.2842119,-43.2853307,-43.2798645,-43.28002919999999,-43.2752974,-43.2743847,-43.28096660000001,-43.2675627,-43.2696722,-43.2790285,-43.2817495,-43.28144309999999,-43.2858159,-43.28526209999999,-43.2842119],"lat":[-22.8606168,-22.8653642,-22.86567639999999,-22.8671885,-22.8689428,-22.8681003,-22.8601763,-22.8590856,-22.8562535,-22.8530755,-22.8539262,-22.8554905,-22.8575938,-22.858337,-22.8606168]}]],[[{"lng":[-43.2632132,-43.264174,-43.2617916,-43.2601851,-43.2583897,-43.2537592,-43.2544492,-43.25252309999999,-43.2512729,-43.24867010000001,-43.254152,-43.2539364,-43.263344,-43.2648844,-43.2632132],"lat":[-22.8924194,-22.8932865,-22.89402699999999,-22.8897831,-22.8909313,-22.8877529,-22.8892894,-22.8911672,-22.888097,-22.8897491,-22.8829227,-22.880068,-22.8867372,-22.8903642,-22.8924194]}]],[[{"lng":[-43.2748425,-43.2771019,-43.27571220000001,-43.271987,-43.2698815,-43.26781159999999,-43.2642199,-43.2579575,-43.2600712,-43.2673815,-43.2670185,-43.2628709,-43.268842,-43.2679646,-43.2783494,-43.28096660000001,-43.28006600000001,-43.2748425],"lat":[-22.8674312,-22.8633551,-22.862437,-22.8671854,-22.8671467,-22.8689504,-22.8659053,-22.86628019999999,-22.862365,-22.8616209,-22.8598147,-22.8571379,-22.8569847,-22.8597486,-22.8594887,-22.8601763,-22.86121319999999,-22.8674312]}],[{"lng":[-43.2713594,-43.2727499,-43.2717103,-43.2711484,-43.2713594],"lat":[-22.854794,-22.8546843,-22.8554244,-22.8557321,-22.854794]}]],[[{"lng":[-43.2506066,-43.2509171,-43.245461,-43.2463755,-43.24236949999999,-43.2397796,-43.2379535,-43.236672,-43.2321455,-43.2266361,-43.2248329,-43.2259149,-43.2165785,-43.2149068,-43.2155339,-43.2040504,-43.2027547,-43.2048173,-43.2018431,-43.20371670000001,-43.2057052,-43.2056439,-43.2108184,-43.2155989,-43.21968930000001,-43.2217417,-43.23288419999999,-43.2395169,-43.2427066,-43.23821,-43.2401892,-43.2361794,-43.2328701,-43.2270903,-43.2315978,-43.2337269,-43.238177,-43.236826,-43.23904239999999,-43.2377276,-43.2392064,-43.2398851,-43.23848599999999,-43.2426629,-43.2451607,-43.2488708,-43.2420859,-43.24983219999999,-43.25786859999999,-43.2558307,-43.2547593,-43.2506066],"lat":[-22.983574,-22.9827906,-22.9859157,-22.9846002,-22.9856151,-22.9907205,-22.9894163,-22.9848373,-22.9806122,-22.9792751,-22.975564,-22.9743264,-22.9635874,-22.9634104,-22.9623563,-22.9605697,-22.9578354,-22.95673709999999,-22.9546584,-22.9542058,-22.95530119999999,-22.9566316,-22.9569556,-22.9593385,-22.9597609,-22.9577867,-22.9647253,-22.9651493,-22.9684748,-22.9692362,-22.97152,-22.9718797,-22.970035,-22.9704996,-22.973301,-22.9721278,-22.972783,-22.974553,-22.9765259,-22.9801107,-22.97725969999999,-22.9785675,-22.9801632,-22.979109,-22.9744818,-22.976699,-22.9822587,-22.9790026,-22.9795746,-22.9801311,-22.9837773,-22.983574]}]],[[{"lng":[-43.2194495,-43.2193119,-43.22198069999999,-43.22162199999999,-43.2183624,-43.2180559,-43.21466900000001,-43.21417779999999,-43.2069091,-43.19577049999999,-43.1949329,-43.1979236,-43.1972557,-43.20047819999999,-43.2021225,-43.21153099999999,-43.21237489999999,-43.2148018,-43.2149068,-43.2165785,-43.2259149,-43.22485160000001,-43.2224083,-43.2194495],"lat":[-22.9767516,-22.9772093,-22.9777578,-22.9794876,-22.97883479999999,-22.9815847,-22.9819,-22.9805477,-22.9811489,-22.9777161,-22.976728,-22.9690812,-22.9627376,-22.9621401,-22.96039949999999,-22.961502,-22.9625865,-22.9618332,-22.9634104,-22.9635874,-22.9743264,-22.9769368,-22.9775446,-22.9767516]}]],[[{"lng":[-43.1956581,-43.19144969999999,-43.1907396,-43.1800881,-43.1777068,-43.1767804,-43.17151700000001,-43.1694767,-43.1689023,-43.16614500000001,-43.16718589999999,-43.1656756,-43.16261159999999,-43.1601959,-43.1575113,-43.1609306,-43.161849,-43.1696451,-43.1761918,-43.1768643,-43.1756258,-43.1748882,-43.1676248,-43.1655608,-43.1669422,-43.1678099,-43.1712004,-43.1716327,-43.1679905,-43.16730500000001,-43.1746784,-43.17575919999999,-43.17939969999999,-43.1790259,-43.1822104,-43.180725,-43.1821539,-43.18851420000001,-43.1937619,-43.198332,-43.1973426,-43.1956581],"lat":[-22.9117229,-22.9101371,-22.9114715,-22.9133907,-22.91814119999999,-22.9146696,-22.9115043,-22.91116209999999,-22.9145873,-22.9157058,-22.91777729999999,-22.9157671,-22.9173083,-22.9164814,-22.9124504,-22.9124813,-22.9045627,-22.9041954,-22.8986604,-22.896364,-22.8961773,-22.8975414,-22.8998745,-22.89678649999999,-22.8968353,-22.8996662,-22.8985418,-22.8977659,-22.8975098,-22.8954976,-22.8931379,-22.8959089,-22.8955595,-22.8922196,-22.897093,-22.8971496,-22.9002867,-22.8988513,-22.9031983,-22.9046544,-22.907291,-22.9117229]}],[{"lng":[-43.1727772,-43.1756007,-43.1769384,-43.1758663,-43.1727772],"lat":[-22.88317769999999,-22.8828117,-22.88411479999999,-22.8844345,-22.88317769999999]}]],[[{"lng":[-43.275257,-43.2759258,-43.2784348,-43.276694,-43.275257],"lat":[-23.0301076,-23.02891709999999,-23.03019,-23.0307108,-23.0301076]}],[{"lng":[-43.2755952,-43.2753692,-43.2674335,-43.2577693,-43.24821,-43.24397920000001,-43.2398754,-43.23907000000001,-43.23147609999999,-43.23185960000001,-43.2265285,-43.23247089999999,-43.2379538,-43.2502846,-43.2531019,-43.2508396,-43.2507254,-43.2492105,-43.25161550000001,-43.2523314,-43.25697630000001,-43.2542699,-43.25650899999999,-43.26579989999999,-43.2786647,-43.2845389,-43.2847839,-43.2755952],"lat":[-23.001144,-23.0034266,-23.0010279,-23.0001609,-22.999962,-23.0013198,-23.0004309,-22.9989352,-22.9953683,-22.9924918,-22.9900368,-22.9881975,-22.9894163,-22.9957876,-22.9930028,-22.992579,-22.993734,-22.9923799,-22.9924397,-22.9908394,-22.9889591,-22.9833769,-22.9797356,-22.9826507,-22.98189,-22.9909844,-23.0011528,-23.001144]}]],[[{"lng":[-43.29705929999999,-43.2958732,-43.2970199,-43.2960112,-43.2932372,-43.2938027,-43.2970056,-43.2927269,-43.28270679999999,-43.2786647,-43.26579989999999,-43.2581803,-43.2512443,-43.2420859,-43.2488708,-43.2451607,-43.2426629,-43.23848599999999,-43.2385796,-43.2394005,-43.2398851,-43.2392064,-43.2377276,-43.2384414,-43.23904239999999,-43.236826,-43.238177,-43.2337269,-43.2315978,-43.2270282,-43.2401527,-43.2381775,-43.2426624,-43.2408976,-43.2380377,-43.23288419999999,-43.221786,-43.21968930000001,-43.2155989,-43.2108184,-43.2056439,-43.2055672,-43.20220150000001,-43.2100219,-43.21411149999999,-43.2178544,-43.21910589999999,-43.21830990000001,-43.2143374,-43.21897070000001,-43.222141,-43.2304273,-43.231629,-43.23406689999999,-43.2355027,-43.23731669999999,-43.239413,-43.2396205,-43.24074770000001,-43.2456045,-43.244758,-43.2426973,-43.2411121,-43.2420907,-43.24446349999999,-43.24213700000001,-43.23948799999999,-43.2410566,-43.24887400000001,-43.2504268,-43.25316670000001,-43.2532443,-43.2517792,-43.2573761,-43.26223189999999,-43.2650866,-43.2723624,-43.2747482,-43.2725889,-43.2749579,-43.2794525,-43.28571489999999,-43.2910658,-43.3001224,-43.30134799999999,-43.2998986,-43.2979325,-43.29705929999999],"lat":[-22.9750577,-22.9740661,-22.9751835,-22.9764467,-22.9748297,-22.9763234,-22.9794784,-22.9794815,-22.98794149999999,-22.98189,-22.9826507,-22.9796435,-22.9789099,-22.9822587,-22.976699,-22.9744818,-22.979109,-22.9801632,-22.9797791,-22.9795406,-22.9785675,-22.97725969999999,-22.9801107,-22.9771331,-22.9765259,-22.974553,-22.972783,-22.9721278,-22.973301,-22.9702157,-22.9715329,-22.9692813,-22.9686672,-22.9661083,-22.9644293,-22.9647253,-22.9577995,-22.9597609,-22.9593385,-22.9569556,-22.9566316,-22.9551532,-22.9543635,-22.9519619,-22.9520036,-22.9467313,-22.9403793,-22.9344082,-22.9332353,-22.9339786,-22.9309333,-22.939704,-22.94475779999999,-22.9454423,-22.9452367,-22.9409269,-22.9414188,-22.9448738,-22.9454249,-22.9415426,-22.9405041,-22.94339759999999,-22.9433789,-22.9403855,-22.9391033,-22.9362612,-22.9366572,-22.9325335,-22.93979269999999,-22.9388152,-22.93999879999999,-22.9409177,-22.9403646,-22.9446492,-22.9429498,-22.9452749,-22.945107,-22.9444154,-22.94218459999999,-22.9442578,-22.9398216,-22.9436529,-22.9445676,-22.9506616,-22.96530689999999,-22.9749591,-22.9738318,-22.9750577]}]],[[{"lng":[-43.1956581,-43.1928379,-43.1891143,-43.188758,-43.1877225,-43.18758270000001,-43.18016779999999,-43.1911253,-43.19144969999999,-43.19343989999999,-43.1956581],"lat":[-22.9117229,-22.9121362,-22.9149562,-22.918035,-22.9180378,-22.915142,-22.9138463,-22.9113508,-22.9101371,-22.9112545,-22.9117229]}]],[[{"lng":[-43.2650866,-43.26223189999999,-43.2565031,-43.2562886,-43.2551409,-43.2517792,-43.2518976,-43.2532443,-43.25316670000001,-43.2504268,-43.24907899999999,-43.24720809999999,-43.2429434,-43.242845,-43.2444663,-43.24558559999999,-43.24458550000001,-43.24991250000001,-43.25856890000001,-43.2694432,-43.27375099999999,-43.2696267,-43.2650866],"lat":[-22.9452749,-22.9429498,-22.9444607,-22.9428705,-22.9435314,-22.9403646,-22.9395551,-22.9409177,-22.93999879999999,-22.9388152,-22.9398764,-22.9385127,-22.93454569999999,-22.9324473,-22.9330725,-22.9312925,-22.93019439999999,-22.9300025,-22.9390971,-22.9398124,-22.9444112,-22.9453528,-22.9452749]}]],[[{"lng":[-43.2212599,-43.2118684,-43.21259879999999,-43.2101014,-43.20957070000001,-43.20786469999999,-43.2095245,-43.209762,-43.2131993,-43.2134507,-43.2182775,-43.2198075,-43.2155037,-43.2183213,-43.2168507,-43.2243847,-43.2212599],"lat":[-22.921853,-22.9179803,-22.9167289,-22.9158119,-22.9119034,-22.9105493,-22.9095123,-22.90651,-22.9062326,-22.9074563,-22.9080734,-22.9096376,-22.9101288,-22.9115659,-22.9131086,-22.9181222,-22.921853]}]],[[{"lng":[-43.2420123,-43.23965820000001,-43.239413,-43.23731669999999,-43.2355027,-43.231629,-43.2304273,-43.22694559999999,-43.2236407,-43.2226931,-43.2204009,-43.2179522,-43.2145383,-43.2144843,-43.2121167,-43.2118684,-43.2257347,-43.22839279999999,-43.2277483,-43.2316564,-43.2311001,-43.2337799,-43.234745,-43.23593499999999,-43.23831059999999,-43.24213700000001,-43.24446349999999,-43.2420907,-43.24122920000001,-43.24551580000001,-43.2420123],"lat":[-22.94514849999999,-22.9449828,-22.9414188,-22.9409269,-22.9452367,-22.94475779999999,-22.939704,-22.93521,-22.9334956,-22.9311136,-22.9321288,-22.92618030000001,-22.9237912,-22.9207815,-22.9196941,-22.9179803,-22.925073,-22.9282985,-22.9291763,-22.93153119999999,-22.9336147,-22.9349137,-22.9371645,-22.9349683,-22.9377867,-22.9362612,-22.9391033,-22.9403855,-22.9435356,-22.9404168,-22.94514849999999]}]],[[{"lng":[-43.23592740000001,-43.23522450000001,-43.2347155,-43.232044,-43.23070449999999,-43.2299333,-43.2252601,-43.2212599,-43.2243847,-43.2238108,-43.2289825,-43.2318279,-43.2347756,-43.23634959999999,-43.23592740000001],"lat":[-22.9250953,-22.9236711,-22.9246555,-22.9238524,-22.9247482,-22.9234402,-22.9251105,-22.921853,-22.9181222,-22.916748,-22.9158028,-22.9194755,-22.9187309,-22.924054,-22.9250953]}]],[[{"lng":[-43.1488236,-43.1473699,-43.150855,-43.1492665,-43.1513378,-43.1510426,-43.1488236],"lat":[-22.9657467,-22.9616586,-22.9633846,-22.9652441,-22.9666001,-22.9669864,-22.9657467]}],[{"lng":[-43.1732393,-43.1678536,-43.1648834,-43.162397,-43.1583877,-43.1617767,-43.1626467,-43.1695728,-43.17624739999999,-43.175892,-43.1732393],"lat":[-22.9666551,-22.9638345,-22.9635629,-22.9654707,-22.9632988,-22.9615467,-22.959442,-22.9573268,-22.9598709,-22.9615366,-22.9666551]}]],[[{"lng":[-43.19123069999999,-43.1895055,-43.1910409,-43.19667030000001,-43.1950425,-43.19123069999999],"lat":[-22.9877112,-22.9872009,-22.9796499,-22.9809835,-22.9836381,-22.9877112]}]],[[{"lng":[-43.1818669,-43.18179689999999,-43.1825325,-43.1824631,-43.1818669],"lat":[-22.9862172,-22.9860676,-22.9862024,-22.9864723,-22.9862172]}],[{"lng":[-43.1894497,-43.1833633,-43.18808599999999,-43.18869230000001,-43.18228990000001,-43.1732393,-43.17481000000001,-43.1816676,-43.18719350000001,-43.1900347,-43.1911195,-43.1894497],"lat":[-22.9874265,-22.9861276,-22.9854389,-22.9808919,-22.9721514,-22.9666551,-22.9642796,-22.9672594,-22.9714726,-22.9759302,-22.9817909,-22.9874265]}]],[[{"lng":[-43.19650429999999,-43.19667030000001,-43.1914121,-43.1937806,-43.1887783,-43.1931742,-43.19193729999999,-43.1867382,-43.1893633,-43.1936788,-43.1972557,-43.1979236,-43.1948953,-43.1972275,-43.19650429999999],"lat":[-22.9827479,-22.9809835,-22.9799062,-22.9760655,-22.9697274,-22.9648996,-22.9638605,-22.9653977,-22.9628682,-22.9613144,-22.9627376,-22.9690812,-22.9775695,-22.98010039999999,-22.9827479]}]],[[{"lng":[-43.19265579999999,-43.1910409,-43.18719350000001,-43.1887783,-43.191872,-43.1938267,-43.19265579999999],"lat":[-22.979365,-22.9796499,-22.9714726,-22.9697274,-22.9723288,-22.9769487,-22.979365]}]],[[{"lng":[-43.18719350000001,-43.1816676,-43.17481000000001,-43.17624739999999,-43.17468450000001,-43.17956899999999,-43.1796793,-43.1810144,-43.1798274,-43.1882303,-43.18719350000001],"lat":[-22.9714726,-22.9672594,-22.9642796,-22.9598709,-22.9590599,-22.9610711,-22.9628813,-22.9628776,-22.9648051,-22.9702895,-22.9714726]}]],[[{"lng":[-43.1882303,-43.1798274,-43.1810144,-43.1791621,-43.1818152,-43.18970179999999,-43.1867794,-43.1873081,-43.19193729999999,-43.1931742,-43.1882303],"lat":[-22.9702895,-22.9648051,-22.9628776,-22.9614048,-22.9609482,-22.9631861,-22.96474449999999,-22.9657473,-22.9638605,-22.9648996,-22.9702895]}]],[[{"lng":[-43.2265285,-43.2153007,-43.21531239999999,-43.2169043,-43.2180559,-43.2246339,-43.2252361,-43.2264136,-43.22937729999999,-43.2265285],"lat":[-22.9900368,-22.9876807,-22.9836972,-22.9836722,-22.9815847,-22.9826924,-22.980609,-22.9806444,-22.9865541,-22.9900368]}]],[[{"lng":[-43.1978756,-43.1998956,-43.19972369999999,-43.19793589999999,-43.1978756],"lat":[-23.0728718,-23.0725463,-23.0733252,-23.0741345,-23.0728718]}],[{"lng":[-43.1902629,-43.1921755,-43.1977807,-43.19844,-43.1919505,-43.1902629],"lat":[-23.0710932,-23.0669005,-23.0682716,-23.07088449999999,-23.0734869,-23.0710932]}],[{"lng":[-43.1417612,-43.1467597,-43.14930589999999,-43.1457249,-43.14161209999999,-43.1417612],"lat":[-23.0632233,-23.0588031,-23.0585208,-23.0653026,-23.0653438,-23.0632233]}],[{"lng":[-43.2005606,-43.1970559,-43.207757,-43.20785069999999,-43.2005606],"lat":[-23.0377752,-23.0349259,-23.0380677,-23.0403728,-23.0377752]}],[{"lng":[-43.1915759,-43.1921414,-43.193054,-43.19279909999999,-43.1915759],"lat":[-23.0300022,-23.0290597,-23.029427,-23.0303859,-23.0300022]}],[{"lng":[-43.20114769999999,-43.20670639999999,-43.2057607,-43.2022828,-43.20114769999999],"lat":[-23.0260875,-23.026069,-23.0271536,-23.0275988,-23.0260875]}],[{"lng":[-43.2153007,-43.1980489,-43.1925926,-43.1914081,-43.1893996,-43.1901877,-43.18835079999999,-43.19123069999999,-43.1941144,-43.1969944,-43.19702049999999,-43.19529439999999,-43.2069091,-43.21417779999999,-43.2156031,-43.2153007],"lat":[-22.9876807,-22.9878033,-22.9890765,-22.9912998,-22.9909357,-22.9901677,-22.9879882,-22.9877112,-22.9839233,-22.9826463,-22.979133,-22.9773273,-22.9811489,-22.9805477,-22.9847577,-22.9876807]}],[{"lng":[-43.1904458,-43.1910658,-43.1957831,-43.19351439999999,-43.1922719,-43.1904458],"lat":[-23.0270505,-23.0255959,-23.0274757,-23.0274657,-23.027812,-23.0270505]}]],[[{"lng":[-43.23247089999999,-43.2280003,-43.2294777,-43.2264136,-43.2252361,-43.2246339,-43.2180559,-43.2183624,-43.22162199999999,-43.22198069999999,-43.2194495,-43.2224083,-43.2249848,-43.2266361,-43.2321455,-43.23697809999999,-43.2379535,-43.2368356,-43.23247089999999],"lat":[-22.9881975,-22.9893241,-22.9855706,-22.9806444,-22.980609,-22.9826924,-22.9815847,-22.97883479999999,-22.9794876,-22.9777578,-22.9767516,-22.9775446,-22.9764245,-22.9792751,-22.9806122,-22.9852947,-22.9894163,-22.9895127,-22.9881975]}],[{"lng":[-43.2169043,-43.21531239999999,-43.21466900000001,-43.2180559,-43.2169043],"lat":[-22.9836722,-22.9836972,-22.9819,-22.9815847,-22.9836722]}]],[[{"lng":[-43.2790285,-43.2720586,-43.26738,-43.26581350000001,-43.26990730000001,-43.26847100000001,-43.2699012,-43.27525179999999,-43.27770789999999,-43.2772766,-43.2795831,-43.2818425,-43.28350859999999,-43.2829236,-43.28848869999999,-43.29208610000001,-43.2842701,-43.28144309999999,-43.28172199999999,-43.2790285],"lat":[-22.8530755,-22.8545553,-22.8577349,-22.855131,-22.8507639,-22.8496568,-22.8458032,-22.84439,-22.846156,-22.8474143,-22.8488646,-22.8483792,-22.8496428,-22.8505601,-22.8507301,-22.8525604,-22.8570446,-22.8554905,-22.8540668,-22.8530755]}]],[[{"lng":[-43.25792329999999,-43.2583758,-43.2562373,-43.2527989,-43.25341479999999,-43.24642359999999,-43.2478504,-43.2472109,-43.2544383,-43.2575194,-43.2511575,-43.25177269999999,-43.2473002,-43.2489062,-43.2521545,-43.2523094,-43.2559274,-43.2596378,-43.2588109,-43.2600712,-43.25779310000001,-43.25820509999999,-43.2642199,-43.265701,-43.2624056,-43.25792329999999],"lat":[-22.8680252,-22.8727415,-22.8770576,-22.8746012,-22.8730324,-22.8707218,-22.8637718,-22.84795699999999,-22.8390836,-22.8453597,-22.8453737,-22.8476577,-22.8484015,-22.8514124,-22.8536362,-22.8568161,-22.8570492,-22.8592285,-22.8610219,-22.862365,-22.864785,-22.8666946,-22.8659053,-22.867924,-22.8692078,-22.8680252]}]],[[{"lng":[-43.29208610000001,-43.28848869999999,-43.2829236,-43.28350859999999,-43.2818425,-43.2795831,-43.2772106,-43.2789352,-43.2801985,-43.282649,-43.2836167,-43.2855242,-43.2889625,-43.2911193,-43.29218669999999,-43.290204,-43.2880724,-43.287767,-43.28975579999999,-43.2968866,-43.29671949999999,-43.29208610000001],"lat":[-22.8525604,-22.8507301,-22.8505601,-22.8496428,-22.8483792,-22.8488646,-22.846505,-22.8456732,-22.8470619,-22.8464185,-22.8474674,-22.8459341,-22.8495798,-22.8494338,-22.8468169,-22.8444367,-22.8442957,-22.8420422,-22.8419897,-22.8456161,-22.8487359,-22.8525604]}]],[[{"lng":[-43.2699012,-43.268474,-43.26990730000001,-43.26581350000001,-43.263492,-43.26432680000001,-43.2572203,-43.2544383,-43.26043620000001,-43.26191050000001,-43.2634929,-43.26217369999999,-43.2636007,-43.2691457,-43.2683618,-43.27066299999999,-43.2716742,-43.2707024,-43.2699012],"lat":[-22.8458032,-22.84796129999999,-22.8507639,-22.855131,-22.8524967,-22.8513801,-22.8456407,-22.8390836,-22.83559129999999,-22.836995,-22.8364706,-22.8350453,-22.8342423,-22.8415152,-22.84410859999999,-22.8427222,-22.8450439,-22.846281,-22.8458032]}]],[[{"lng":[-43.3048736,-43.3026106,-43.30085039999999,-43.3012738,-43.29353369999999,-43.29208610000001,-43.29652859999999,-43.2968866,-43.2949413,-43.28464090000001,-43.2687945,-43.27307769999999,-43.28056400000001,-43.2852046,-43.2792463,-43.28547529999999,-43.28795350000001,-43.2894814,-43.2899568,-43.2881378,-43.2888245,-43.30236,-43.3033055,-43.3011285,-43.3065649,-43.3048736],"lat":[-22.8472352,-22.8460297,-22.8491665,-22.85172799999999,-22.8549214,-22.8525604,-22.8494121,-22.8456161,-22.8455655,-22.8387583,-22.8192626,-22.8103597,-22.8135568,-22.8185486,-22.823211,-22.8313657,-22.8302061,-22.8308633,-22.831778,-22.8329248,-22.8358709,-22.837743,-22.8392506,-22.8415724,-22.8448959,-22.8472352]}]],[[{"lng":[-43.2889625,-43.2855242,-43.2836167,-43.27525179999999,-43.2716742,-43.27066299999999,-43.2685523,-43.26781390000001,-43.2691457,-43.2636007,-43.26217369999999,-43.2634929,-43.26191050000001,-43.26043620000001,-43.2562225,-43.25491230000001,-43.2648604,-43.2687945,-43.2802515,-43.2885435,-43.2880724,-43.29073390000001,-43.2919051,-43.2889625],"lat":[-22.8495798,-22.8459341,-22.8474674,-22.84439,-22.8450439,-22.8427222,-22.8442711,-22.8428832,-22.8415152,-22.8342423,-22.8350453,-22.8364706,-22.836995,-22.83559129999999,-22.8378354,-22.83535999999999,-22.8263564,-22.8192626,-22.8341407,-22.841218,-22.8442957,-22.8448667,-22.8487182,-22.8495798]}]],[[{"lng":[-43.319081,-43.3175455,-43.31076609999999,-43.3069526,-43.3045254,-43.3014398,-43.2933262,-43.29410740000001,-43.2919089,-43.2987889,-43.3021818,-43.3013013,-43.3049383,-43.3056534,-43.3092295,-43.31497969999999,-43.3178663,-43.319081],"lat":[-22.8333553,-22.8372967,-22.8390858,-22.8361946,-22.8401177,-22.8374757,-22.8369086,-22.8347262,-22.8315631,-22.8326171,-22.8319046,-22.8293003,-22.8302725,-22.8290303,-22.8333775,-22.8323497,-22.8332933,-22.8333553]}]],[[{"lng":[-43.220401,-43.21897070000001,-43.21428040000001,-43.2170987,-43.2161792,-43.21048349999999,-43.20871040000001,-43.20474209999999,-43.20487560000001,-43.20637230000001,-43.2027508,-43.2029785,-43.2015949,-43.2015618,-43.200207,-43.1992638,-43.1969146,-43.19766289999999,-43.1962415,-43.19807269999999,-43.2014573,-43.20699219999999,-43.2101014,-43.21259879999999,-43.2121167,-43.2144843,-43.2144077,-43.2179522,-43.219029,-43.220401],"lat":[-22.9321273,-22.9339786,-22.9333873,-22.9355301,-22.9378465,-22.9373875,-22.9383664,-22.9359361,-22.9321591,-22.9312911,-22.9301714,-22.9316805,-22.9313414,-22.9338298,-22.9340978,-22.9315592,-22.9307689,-22.92923799999999,-22.9274507,-22.9272259,-22.9211967,-22.9210725,-22.9158119,-22.9167289,-22.9196941,-22.9207815,-22.9235524,-22.92618030000001,-22.9297393,-22.9321273]}]],[[{"lng":[-43.3166197,-43.3135143,-43.3051058,-43.3033887,-43.3013626,-43.2978618,-43.2952889,-43.29264059999999,-43.290245,-43.2892849,-43.2877607,-43.28957079999999,-43.29016130000001,-43.2903386,-43.2872414,-43.28056400000001,-43.27307769999999,-43.2722794,-43.276875,-43.27911659999999,-43.2870244,-43.28851880000001,-43.2911893,-43.29572099999999,-43.29964,-43.3021912,-43.30074309999999,-43.3110806,-43.3151184,-43.3166197],"lat":[-22.8197889,-22.8261774,-22.8218466,-22.8220526,-22.8193876,-22.8206841,-22.8194307,-22.81566429999999,-22.816758,-22.8157257,-22.8208989,-22.8215887,-22.8204143,-22.8222786,-22.8207597,-22.8135568,-22.8103597,-22.8035939,-22.8038594,-22.8074293,-22.8082388,-22.8101898,-22.8100352,-22.8063086,-22.8061133,-22.8090914,-22.8154806,-22.8196062,-22.8198255,-22.8197889]}]],[[{"lng":[-43.2987889,-43.2925094,-43.2919151,-43.29410740000001,-43.2932879,-43.2888245,-43.2881378,-43.2899568,-43.2894814,-43.28795350000001,-43.28547529999999,-43.2792463,-43.2852046,-43.2901193,-43.2893403,-43.29056259999999,-43.29409,-43.2951255,-43.29900749999999,-43.3021818,-43.2987889],"lat":[-22.8326171,-22.8311388,-22.8323083,-22.8347262,-22.8368765,-22.8358709,-22.8329248,-22.831778,-22.8308633,-22.8302061,-22.8313657,-22.823211,-22.8185486,-22.8221082,-22.8247275,-22.82650719999999,-22.8281317,-22.8255401,-22.82723129999999,-22.8319046,-22.8326171]}]],[[{"lng":[-43.3129423,-43.30810969999999,-43.30603380000001,-43.3049383,-43.3019864,-43.2951255,-43.29409,-43.2919503,-43.2893403,-43.291005,-43.2877607,-43.2888423,-43.290245,-43.29264059999999,-43.2952889,-43.2982375,-43.3013626,-43.3033887,-43.3051058,-43.3135143,-43.31330579999999,-43.3129423],"lat":[-22.8302681,-22.8317347,-22.8291936,-22.8302725,-22.8298129,-22.8255401,-22.8281317,-22.8273151,-22.8247275,-22.8209488,-22.8208989,-22.8159752,-22.816758,-22.81566429999999,-22.8194307,-22.820788,-22.8193876,-22.8220526,-22.8218466,-22.8261774,-22.8276068,-22.8302681]}],[{"lng":[-43.2952626,-43.2950131,-43.29561959999999,-43.2959266,-43.2952626],"lat":[-22.8190834,-22.8184765,-22.8185081,-22.8188913,-22.8190834]}]],[[{"lng":[-43.2387138,-43.23593499999999,-43.234745,-43.2337799,-43.2311001,-43.2316564,-43.2277483,-43.22839279999999,-43.2257347,-43.2299333,-43.23070449999999,-43.2323251,-43.2410566,-43.2387138],"lat":[-22.9378179,-22.9349683,-22.9371645,-22.9349137,-22.9336147,-22.93153119999999,-22.9291763,-22.9282985,-22.925073,-22.9234402,-22.9247482,-22.923914,-22.9325335,-22.9378179]}]],[[{"lng":[-43.23804289999999,-43.23879949999999,-43.2377831,-43.23476149999999,-43.2346329,-43.2373561,-43.2354767,-43.23454569999999,-43.2336581,-43.2318279,-43.2289825,-43.22408790000001,-43.2243847,-43.2168507,-43.2183213,-43.2154658,-43.2221111,-43.2259922,-43.22401929999999,-43.2355916,-43.2377301,-43.2392599,-43.2390559,-43.23804289999999],"lat":[-22.9107331,-22.9125063,-22.9133816,-22.9141201,-22.9154166,-22.9170976,-22.9195581,-22.918689,-22.9197737,-22.9194755,-22.9158028,-22.9165384,-22.9181222,-22.9131086,-22.9115659,-22.9103973,-22.9096755,-22.9118992,-22.9098203,-22.9095751,-22.9083593,-22.9090396,-22.9109217,-22.9107331]}]],[[{"lng":[-43.2444663,-43.242845,-43.2429434,-43.2334245,-43.23522450000001,-43.2380257,-43.24051579999999,-43.2436152,-43.2441114,-43.243461,-43.2459244,-43.2443004,-43.24558559999999,-43.2444663],"lat":[-22.9330725,-22.9324473,-22.93454569999999,-22.9247514,-22.9236711,-22.9256621,-22.9241831,-22.9260942,-22.9253705,-22.928133,-22.93007589999999,-22.9306144,-22.9312925,-22.9330725]}]],[[{"lng":[-43.2622848,-43.25697879999999,-43.2350621,-43.2346569,-43.2387423,-43.23804289999999,-43.24172050000001,-43.24703299999999,-43.2479479,-43.2468061,-43.24861310000001,-43.2480876,-43.250556,-43.25030659999999,-43.26219299999999,-43.2622848],"lat":[-22.9191947,-22.9206905,-22.9155883,-22.914293,-22.9126203,-22.9107331,-22.907584,-22.9081409,-22.9098166,-22.9114285,-22.9117915,-22.9143526,-22.9148088,-22.9159354,-22.917057,-22.9191947]}]],[[{"lng":[-43.25030659999999,-43.250556,-43.2480876,-43.24861310000001,-43.2468061,-43.2479479,-43.24703299999999,-43.25649809999999,-43.25817440000001,-43.2634705,-43.26290289999999,-43.25030659999999],"lat":[-22.9159354,-22.9148088,-22.9143526,-22.9117915,-22.9114285,-22.9098166,-22.9081409,-22.9110877,-22.9104277,-22.9154175,-22.917106,-22.9159354]}]],[[{"lng":[-43.2587245,-43.24991250000001,-43.243938,-43.2442298,-43.24130960000001,-43.24089369999999,-43.24372770000001,-43.246546,-43.2498222,-43.25277979999999,-43.2547647,-43.2527996,-43.25526130000001,-43.2565893,-43.2564927,-43.2669352,-43.2694432,-43.2587245],"lat":[-22.9391713,-22.9300025,-22.9290245,-22.9254384,-22.9250785,-22.9239297,-22.9200051,-22.9216965,-22.9185159,-22.9196421,-22.9230997,-22.9240003,-22.9271908,-22.9268121,-22.9291034,-22.9365454,-22.9398124,-22.9391713]}]],[[{"lng":[-43.2495375,-43.2475475,-43.247126,-43.24372770000001,-43.2408936,-43.2380257,-43.2366848,-43.2352844,-43.2373561,-43.2352808,-43.2489843,-43.2495375],"lat":[-22.9197027,-22.9201239,-22.9215221,-22.9200051,-22.9244611,-22.9256621,-22.9247817,-22.9196149,-22.9170976,-22.9156311,-22.9182423,-22.9197027]}]],[[{"lng":[-43.25349229999999,-43.2498958,-43.2475327,-43.2383177,-43.2318889,-43.2355472,-43.2394135,-43.2448384,-43.2443971,-43.2471095,-43.2469912,-43.25341479999999,-43.2527989,-43.2562373,-43.2545997,-43.25349229999999],"lat":[-22.8838087,-22.8824753,-22.8887245,-22.8888772,-22.8854919,-22.8760897,-22.88023,-22.8728032,-22.8696861,-22.8691331,-22.8713609,-22.8730324,-22.8746012,-22.8770576,-22.8794321,-22.8838087]}]],[[{"lng":[-43.27235839999999,-43.2669352,-43.2564927,-43.2565893,-43.25526130000001,-43.2527996,-43.2547647,-43.2530529,-43.25351949999999,-43.2593762,-43.2622848,-43.2644134,-43.2787483,-43.2785496,-43.2801136,-43.28646639999999,-43.2851609,-43.28617200000001,-43.2794525,-43.2749579,-43.2725889,-43.2745004,-43.27235839999999],"lat":[-22.9435733,-22.9365454,-22.9291034,-22.9268121,-22.9271908,-22.9240003,-22.9230997,-22.9212617,-22.919311,-22.9204367,-22.9191947,-22.9153672,-22.92125739999999,-22.9280287,-22.9312998,-22.9358906,-22.940434,-22.9437598,-22.9398216,-22.9442578,-22.94218459999999,-22.9444596,-22.9435733]}]],[[{"lng":[-43.2598092,-43.2588109,-43.2596378,-43.2559274,-43.2523094,-43.2521545,-43.2489062,-43.2473002,-43.25177269999999,-43.2511575,-43.2573308,-43.259804,-43.2671999,-43.2656813,-43.2639533,-43.2625053,-43.2673269,-43.2598092],"lat":[-22.8622824,-22.8610219,-22.8592285,-22.8570492,-22.8568161,-22.8536362,-22.8514124,-22.8484015,-22.8476577,-22.8453737,-22.8456584,-22.8469813,-22.8563317,-22.8577767,-22.8569319,-22.8578312,-22.8609918,-22.8622824]}]],[[{"lng":[-43.2910716,-43.28907229999999,-43.2864958,-43.2841821,-43.282968,-43.2812541,-43.28154,-43.2805466,-43.2820536,-43.2775624,-43.2780981,-43.2803948,-43.28206979999999,-43.28330459999999,-43.2870982,-43.2885095,-43.2874135,-43.2884494,-43.2867645,-43.2892234,-43.2900233,-43.2910716],"lat":[-22.8997591,-22.9010102,-22.901946,-22.8994085,-22.9007253,-22.8999215,-22.8988209,-22.8992274,-22.8980742,-22.8932064,-22.89215639999999,-22.8931187,-22.8923431,-22.8876,-22.8870418,-22.88946779999999,-22.8937846,-22.8942943,-22.8969023,-22.8962447,-22.897747,-22.8997591]}]],[[{"lng":[-43.2923023,-43.2874744,-43.2857581,-43.28151709999999,-43.28279490000001,-43.2838478,-43.2848498,-43.2864958,-43.29008969999999,-43.29283,-43.29491609999999,-43.2923023],"lat":[-22.9090192,-22.9101732,-22.9070619,-22.9078661,-22.9010666,-22.9015509,-22.9002538,-22.901946,-22.8997637,-22.8999901,-22.9110272,-22.9090192]}]],[[{"lng":[-43.3024431,-43.305971,-43.3009329,-43.2975764,-43.2952733,-43.2960804,-43.2941471,-43.29523359999999,-43.2929778,-43.29283,-43.2897842,-43.2892234,-43.2867645,-43.2884494,-43.2874135,-43.28814130000001,-43.28480249999999,-43.2857475,-43.2822944,-43.28242239999999,-43.27957000000001,-43.2894515,-43.2945657,-43.2943191,-43.30055160000001,-43.3014672,-43.3028864,-43.3024431],"lat":[-22.91297429999999,-22.9182412,-22.9210096,-22.9211366,-22.917048,-22.91473689999999,-22.9137957,-22.9096164,-22.9053993,-22.8999901,-22.8991045,-22.8962447,-22.8969023,-22.8942943,-22.8937846,-22.8878955,-22.8875733,-22.8846503,-22.885133,-22.883856,-22.8826842,-22.8825467,-22.8888927,-22.8902627,-22.8928122,-22.9020415,-22.9032258,-22.91297429999999]}]],[[{"lng":[-43.28206979999999,-43.2803948,-43.2780981,-43.2759315,-43.2737951,-43.270508,-43.26655119999999,-43.265535,-43.2633558,-43.265266,-43.26470620000001,-43.26272889999999,-43.2656927,-43.2691103,-43.26910939999999,-43.271149,-43.2726875,-43.2735387,-43.2767466,-43.2778638,-43.27957000000001,-43.28242239999999,-43.2822944,-43.2857475,-43.2834838,-43.28206979999999],"lat":[-22.8923431,-22.8931187,-22.89215639999999,-22.8955245,-22.8954961,-22.899377,-22.8961563,-22.8931588,-22.8923336,-22.890316,-22.8880603,-22.8872336,-22.8855972,-22.8874869,-22.8862135,-22.8866416,-22.8846081,-22.88555059999999,-22.8838889,-22.8848068,-22.8826842,-22.883856,-22.885133,-22.8846503,-22.889221,-22.8923431]}]],[[{"lng":[-43.3180138,-43.3155558,-43.31494989999999,-43.31047239999999,-43.3077233,-43.3044925,-43.3047905,-43.3064558,-43.3047979,-43.3012719,-43.3038838,-43.3022898,-43.3057071,-43.3102869,-43.3116484,-43.3110213,-43.3136479,-43.31005800000001,-43.31463409999999,-43.3168982,-43.3171582,-43.32172629999999,-43.3265726,-43.325042,-43.3230837,-43.3180138],"lat":[-22.908246,-22.9089875,-22.90383600000001,-22.9056313,-22.8948058,-22.895965,-22.8937029,-22.8927917,-22.8907116,-22.890111,-22.8826203,-22.8788501,-22.8754571,-22.87507579999999,-22.8762982,-22.8780817,-22.8793539,-22.8841276,-22.892528,-22.8935848,-22.897286,-22.8995178,-22.9056174,-22.9094906,-22.91071999999999,-22.908246]}]],[[{"lng":[-43.31494989999999,-43.3155558,-43.3180138,-43.3228771,-43.320531,-43.3165851,-43.3107136,-43.305971,-43.3028156,-43.303313,-43.3014672,-43.3009569,-43.2943191,-43.29601400000001,-43.2945706,-43.29783010000001,-43.29955569999999,-43.3000804,-43.30165390000001,-43.3007377,-43.3038391,-43.3012719,-43.3031588,-43.306064,-43.30425510000001,-43.3044925,-43.3077233,-43.3109811,-43.31494989999999],"lat":[-22.90383600000001,-22.9089875,-22.908246,-22.9104333,-22.9170852,-22.9178997,-22.9164977,-22.9182412,-22.9139332,-22.9046397,-22.9020415,-22.89369469999999,-22.8902627,-22.8876714,-22.887573,-22.8827684,-22.882212,-22.8799506,-22.8806208,-22.8788743,-22.8815671,-22.890111,-22.8899512,-22.8921377,-22.8954296,-22.895965,-22.8948058,-22.905553,-22.90383600000001]}]],[[{"lng":[-43.23563229999999,-43.2330576,-43.2324162,-43.2314315,-43.22860439999999,-43.226281,-43.22401929999999,-43.2259922,-43.22227599999999,-43.22343489999999,-43.21992309999999,-43.2177712,-43.2134507,-43.2131993,-43.2096518,-43.2103007,-43.2149185,-43.2175476,-43.2221761,-43.22650729999999,-43.2338472,-43.2326254,-43.2328038,-43.2335857,-43.2364368,-43.2356347,-43.23563229999999],"lat":[-22.9009482,-22.9006136,-22.9016618,-22.9084127,-22.9065418,-22.909273,-22.9098203,-22.9118992,-22.910281,-22.9100093,-22.90994839999999,-22.9078055,-22.9074563,-22.9062326,-22.9064918,-22.8986804,-22.8946051,-22.88781569999999,-22.8887889,-22.8850584,-22.8896583,-22.89132799999999,-22.8953236,-22.8975623,-22.8978773,-22.8986994,-22.9009482]}]],[[{"lng":[-43.3033478,-43.3022754,-43.30055350000001,-43.30165390000001,-43.3000804,-43.29955569999999,-43.29783010000001,-43.2945706,-43.29601400000001,-43.2949948,-43.2894515,-43.2862109,-43.2939266,-43.2954665,-43.2963877,-43.29602209999999,-43.2971314,-43.2990161,-43.3037701,-43.3034988,-43.3033478],"lat":[-22.8786936,-22.8797139,-22.879036,-22.8806208,-22.8799506,-22.882212,-22.8827684,-22.887573,-22.8876714,-22.8892282,-22.8825467,-22.8813893,-22.873341,-22.8722295,-22.8729272,-22.8712,-22.8720593,-22.8708037,-22.8736178,-22.8754141,-22.8786936]}]],[[{"lng":[-43.3187047,-43.3161824,-43.31710119999999,-43.3159776,-43.319343,-43.3208232,-43.32547599999999,-43.3276713,-43.3313777,-43.33068709999999,-43.3187047],"lat":[-22.8190409,-22.8181127,-22.8149175,-22.8141309,-22.8080301,-22.8016031,-22.8011495,-22.8022709,-22.8089047,-22.8127693,-22.8190409]}]],[[{"lng":[-43.3159776,-43.31710119999999,-43.3161824,-43.3182068,-43.31153219999999,-43.30074309999999,-43.3021912,-43.29964,-43.30078529999999,-43.3030311,-43.3039401,-43.311414,-43.3208232,-43.3206212,-43.3159776],"lat":[-22.8141309,-22.8149175,-22.8181127,-22.8192157,-22.819719,-22.8154806,-22.8090914,-22.8061133,-22.8037556,-22.8038011,-22.8013065,-22.79992039999999,-22.8016031,-22.8026432,-22.8141309]}]],[[{"lng":[-43.2894187,-43.2862109,-43.2885835,-43.2813501,-43.2756055,-43.2676019,-43.2707466,-43.2705924,-43.268355,-43.271987,-43.27571220000001,-43.2771019,-43.27443259999999,-43.2752974,-43.28002919999999,-43.2798645,-43.2853307,-43.2843148,-43.2858159,-43.28842679999999,-43.2878644,-43.29049819999999,-43.29492889999999,-43.2884567,-43.2940823,-43.29049,-43.2894187],"lat":[-22.879253,-22.8813893,-22.8829249,-22.8819877,-22.8763221,-22.872792,-22.8702686,-22.8686399,-22.8686781,-22.8671854,-22.862437,-22.8633551,-22.8671229,-22.8689428,-22.8671885,-22.86567639999999,-22.8653642,-22.8599738,-22.8575942,-22.8570267,-22.8665248,-22.8661332,-22.8687516,-22.8720166,-22.8734436,-22.8768038,-22.879253]}]],[[{"lng":[-43.2778638,-43.2767466,-43.27536359999999,-43.2721349,-43.271149,-43.26910939999999,-43.2691103,-43.2656927,-43.26312569999999,-43.2611573,-43.2539364,-43.2583758,-43.25792329999999,-43.2624056,-43.2648796,-43.2705924,-43.2707466,-43.2676019,-43.2756055,-43.2813501,-43.2778638],"lat":[-22.8848068,-22.8838889,-22.8854124,-22.8848042,-22.8866416,-22.8862135,-22.8874869,-22.8855972,-22.8866255,-22.8856181,-22.880068,-22.8727415,-22.8680252,-22.8692078,-22.8677942,-22.8686399,-22.8702686,-22.872792,-22.8763221,-22.8819877,-22.8848068]}]],[[{"lng":[-43.30876780000001,-43.3090329,-43.3110097,-43.3089595,-43.3090886,-43.30347039999999,-43.3037701,-43.2979865,-43.2973469,-43.29846269999999,-43.3063295,-43.29807979999999,-43.30284020000001,-43.304037,-43.3028675,-43.3074933,-43.3144302,-43.315147,-43.3119917,-43.30876780000001],"lat":[-22.8699831,-22.8721858,-22.8716007,-22.87342899999999,-22.8752778,-22.8766956,-22.8736178,-22.8707714,-22.8691606,-22.8676907,-22.8657219,-22.85904369999999,-22.8575665,-22.8592093,-22.859274,-22.8628345,-22.8613399,-22.8633554,-22.86738639999999,-22.8699831]}]],[[{"lng":[-43.3063295,-43.3055477,-43.29846269999999,-43.2973469,-43.2990161,-43.2971314,-43.29602209999999,-43.2963877,-43.2892148,-43.28940360000001,-43.29492889999999,-43.29049819999999,-43.2878644,-43.28749180000001,-43.2888416,-43.2843343,-43.29208610000001,-43.30497899999999,-43.3063295],"lat":[-22.8657219,-22.866614,-22.8676907,-22.8691606,-22.8708037,-22.8720593,-22.8712,-22.8729272,-22.8729249,-22.8710004,-22.8687516,-22.8661332,-22.8665248,-22.8600602,-22.8572552,-22.8568666,-22.8525604,-22.8653079,-22.8657219]}]],[[{"lng":[-43.20699219999999,-43.2014573,-43.1983275,-43.1949139,-43.1955821,-43.1930626,-43.1956073,-43.1944396,-43.19563309999999,-43.198332,-43.209573,-43.20786469999999,-43.2098017,-43.2100443,-43.20699219999999],"lat":[-22.9210725,-22.9211967,-22.926217,-22.9236874,-22.9215998,-22.920592,-22.9129877,-22.9117426,-22.9118044,-22.9046544,-22.90927049999999,-22.9105493,-22.9125613,-22.91677709999999,-22.9210725]}]],[[{"lng":[-43.2628523,-43.26327120000001,-43.2652745,-43.2636367,-43.2641346,-43.25817440000001,-43.25649809999999,-43.2477256,-43.2407679,-43.2392599,-43.23741380000001,-43.2411098,-43.24263759999999,-43.2411481,-43.24261449999999,-43.2412918,-43.2417384,-43.2427627,-43.2440473,-43.24377459999999,-43.24560269999999,-43.24623769999999,-43.2512729,-43.25252309999999,-43.2544492,-43.2537592,-43.2583897,-43.26091659999999,-43.2616235,-43.264174,-43.2633558,-43.265535,-43.26681050000001,-43.2645221,-43.2628523],"lat":[-22.8972232,-22.9000762,-22.9014963,-22.902173,-22.9067026,-22.9104277,-22.9110877,-22.9081153,-22.907621,-22.9090396,-22.9082175,-22.9045843,-22.9062739,-22.9043738,-22.8975035,-22.8961777,-22.8963378,-22.8973906,-22.8967449,-22.8976246,-22.8954096,-22.892732,-22.888097,-22.8911672,-22.8892894,-22.8877529,-22.8909313,-22.8902438,-22.8940101,-22.8932865,-22.8923336,-22.8931588,-22.8956647,-22.8968161,-22.8972232]}]],[[{"lng":[-43.2769925,-43.2644134,-43.2628913,-43.2634705,-43.25817440000001,-43.2641346,-43.2636367,-43.2652745,-43.26327120000001,-43.2628523,-43.2664558,-43.270508,-43.2729577,-43.2708755,-43.2756721,-43.2743237,-43.2726656,-43.2720219,-43.2760276,-43.2749619,-43.2773763,-43.2769925],"lat":[-22.9204038,-22.9153672,-22.9166599,-22.9154175,-22.9104277,-22.9067026,-22.902173,-22.9014963,-22.9000762,-22.8972232,-22.8960039,-22.899377,-22.8991874,-22.9033179,-22.90406489999999,-22.9045177,-22.9043098,-22.9056681,-22.9090477,-22.9133175,-22.9145631,-22.9204038]}]],[[{"lng":[-43.28279490000001,-43.28184339999999,-43.2830613,-43.28092349999999,-43.2776613,-43.2726044,-43.27544819999999,-43.2708755,-43.2729812,-43.2708141,-43.2737951,-43.2759315,-43.2761335,-43.2786092,-43.2820536,-43.2805466,-43.28154,-43.2812541,-43.282968,-43.2841821,-43.2838478,-43.28279490000001],"lat":[-22.9010666,-22.90248,-22.9033061,-22.9070248,-22.907559,-22.9044411,-22.9038083,-22.9033179,-22.8993617,-22.8984463,-22.8954961,-22.8955245,-22.89364759999999,-22.8933702,-22.8980742,-22.8992274,-22.8988209,-22.8999215,-22.9007253,-22.8994085,-22.9015509,-22.9010666]}]],[[{"lng":[-43.2975764,-43.29150980000001,-43.2857641,-43.279734,-43.2769925,-43.2773872,-43.2748967,-43.2760276,-43.27284449999999,-43.2726044,-43.2776613,-43.28060680000001,-43.28297680000001,-43.2857581,-43.2874744,-43.2926755,-43.2951944,-43.2941471,-43.2960804,-43.2952733,-43.29692829999999,-43.2975764],"lat":[-22.9211366,-22.9219461,-22.9192308,-22.9212775,-22.9204038,-22.9143019,-22.9128014,-22.9090477,-22.9073259,-22.9044411,-22.907559,-22.9069184,-22.9080837,-22.9070619,-22.9101732,-22.909182,-22.9113223,-22.9137957,-22.91473689999999,-22.917048,-22.919986,-22.9211366]}]],[[{"lng":[-43.5756601,-43.5734855,-43.56850120000001,-43.5616166,-43.5519571,-43.5499208,-43.5574969,-43.5649234,-43.5710846,-43.5736568,-43.576626,-43.5756601],"lat":[-22.9412583,-22.94181499999999,-22.9394727,-22.94156,-22.924893,-22.9144142,-22.9142973,-22.9229111,-22.9256009,-22.9288972,-22.9385246,-22.9412583]}]]],null,"left_join(st_make_valid(st_transform(areas, cr.... - total_pop",{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"pane":"polygon","stroke":true,"color":"#333333","weight":0.5,"opacity":[0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9],"fill":true,"fillColor":["#007796","#009397","#007B97","#008398","#00A790","#00B884","#00B587","#00C179","#00B785","#00AA8F","#00B686","#007B97","#008798","#007796","#007996","#007F97","#009097","#008898","#008197","#008998","#007D97","#009397","#008998","#00B487","#00A293","#009197","#008998","#007D97","#00A293","#008598","#009397","#009297","#008998","#007896","#008197","#008398","#00C17A","#481864","#008E97","#007896","#009C95","#00AB8E","#008498","#00A293","#00A691","#009696","#008398","#008197","#00B289","#008E97","#008D98","#009A96","#00B289","#00A790","#00A293","#00AF8C","#00B884","#009097","#009C95","#007F97","#007796","#009C95","#008398","#007C97","#007896","#00B18A","#007996","#009896","#008D98","#009796","#006D93","#007295","#007595","#009A96","#00A392","#007C97","#008398","#008B98","#00A790","#007F97","#008197","#007C97","#00A492","#00AC8E","#008598","#008998","#007C97","#007D97","#007896","#009297","#DBE12C","#00B289","#008097","#008498","#008B98","#009C95","#009297","#00B18A","#00A990","#008498","#008498","#00A790","#008D98","#008C98","#009297","#00A392","#008998","#009696","#008898","#007C97","#009597","#00C475","#008D98","#006691","#009297","#009597","#00B08B","#009F94","#008498","#00AB8E","#009896","#008998","#008898","#006A92","#009297","#006A92","#006490","#005D8D","#007094","#008197","#008898","#008197","#008498","#00A990","#00A691","#009197","#008398","#00A691","#00B18A","#009A96","#006A92","#00618F","#007495","#007194","#006D93","#007896","#008598","#009097","#007295","#00618F","#005E8E","#007B97","#007B97","#006D93","#007194","#008197","#007495","#00B487","#006E94","#009197","#007796","#00A392","#007C97","#00C278","#00B289","#008998","#00B785","#008097","#008B98","#00B388","#008B98","#007996","#006A92","#009C95","#008798","#00AB8E","#007094","#00A193","#00A990","#009D95","#007896","#007B97","#00BC80","#00B388","#00B686","#009D95","#00B289","#008197","#007996","#00B289","#00BD7F","#00AB8E","#007295","#007C97","#009D95","#2DC770","#00B388","#007595","#00A591","#009E94"],"fillOpacity":[0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6],"smoothFactor":1,"noClip":false},["<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>1&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005110&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>24462&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>2&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005112&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>32413&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>3&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005111&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>25644&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>4&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005114&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>27667&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>5&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005113&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>38510&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>6&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005116&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>44196&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>7&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005115&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>42916&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>8&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005118&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>47474&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>9&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005117&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>43707&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>10&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005119&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>39138&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>11&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005101&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>43238&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>12&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005100&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>25465&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>13&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005103&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>28882&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>14&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005102&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>24345&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>15&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005105&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>25102&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>16&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005104&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>26675&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>17&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005107&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>31185&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>18&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005106&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>29245&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>19&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005109&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>27230&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>20&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005108&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>29480&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>21&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005130&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>26212&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>22&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005132&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>32423&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>23&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005131&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>29310&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>24&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005134&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>42491&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>25&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005133&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>36549&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>26&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005136&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>31581&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>27&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005135&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>29372&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>28&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005138&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>26098&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>29&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005137&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>36397&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>30&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005139&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>28370&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>31&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005121&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>32213&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>32&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005120&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>31949&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>33&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005123&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>29567&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>34&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005122&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>24848&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>35&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005125&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>27169&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>36&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005124&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>27690&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>37&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005127&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>47144&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>38&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005126&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td> 3361&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>39&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005129&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>30705&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>40&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005128&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>24947&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>41&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005150&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>34816&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>42&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005152&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>39424&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>43&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005151&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>27886&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>44&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005154&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>36410&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>45&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005153&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>37856&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>46&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005156&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>32866&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>47&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005155&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>27737&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>48&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005158&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>27214&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>49&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005157&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>41801&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>50&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005159&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>31002&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>51&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005141&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>30443&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>52&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005140&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>34048&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>53&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005143&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>41887&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>54&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005142&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>38367&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>55&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005145&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>36515&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>56&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005144&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>40926&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>57&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005147&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>43865&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>58&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005146&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>31189&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>59&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005149&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>34709&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>60&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005148&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>26646&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>61&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005170&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>24430&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>62&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005172&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>34763&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>63&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005171&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>27747&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>64&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005174&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>26007&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>65&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005173&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>24852&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>66&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005176&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>41586&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>67&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005175&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>25168&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>68&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005178&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>33828&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>69&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005177&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>30400&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>70&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005179&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>33473&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>71&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005161&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>21904&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>72&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005160&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>23503&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>73&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005163&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>24080&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>74&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005162&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>34026&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>75&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005165&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>36982&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>76&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005164&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>25963&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>77&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005167&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>27831&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>78&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005166&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>29834&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>79&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005169&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>38453&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>80&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005168&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>26726&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>81&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005192&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>27444&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>82&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005191&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>25910&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>83&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005194&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>37301&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>84&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005193&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>39596&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>85&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005196&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>28324&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>86&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005195&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>29608&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>87&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005198&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>25874&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>88&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005197&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>26112&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>89&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005199&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>24860&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>90&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005181&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>31950&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>91&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005180&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>65847&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>92&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005183&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>41980&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>93&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005182&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>26943&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>94&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005185&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>28150&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>95&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005184&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>29949&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>96&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005187&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>34689&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>97&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005186&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>32033&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>98&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005189&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>41458&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>99&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005188&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>38793&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>100&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005190&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>27928&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>101&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005011&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>28034&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>102&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005010&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>38419&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>103&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005013&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>30335&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>104&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005012&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>30013&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>105&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005015&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>31793&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>106&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005014&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>36796&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>107&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005017&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>29569&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>108&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005016&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>32879&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>109&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005019&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>29170&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>110&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005018&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>25948&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>111&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005002&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>32667&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>112&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005001&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>48664&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>113&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005004&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>30600&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>114&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005003&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>20065&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>115&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005006&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>31843&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>116&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005005&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>32806&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>117&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005008&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>41220&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>118&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005007&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>35787&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>119&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005009&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>28173&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>120&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005031&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>39260&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>121&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005030&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>33718&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>122&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005033&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>29352&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>123&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005032&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>29082&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>124&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005035&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>21409&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>125&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005034&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>32076&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>126&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005037&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>21316&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>127&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005036&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>19947&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>128&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005039&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>18044&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>129&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005038&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>22520&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>130&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005020&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>27405&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>131&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005022&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>29146&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>132&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005021&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>27424&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>133&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005024&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>27959&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>134&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005023&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>38585&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>135&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005026&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>37949&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>136&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005025&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>31407&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>137&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005028&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>27683&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>138&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005027&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>37839&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>139&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005029&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>41460&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>140&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005051&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>34012&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>141&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005050&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>21198&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>142&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005053&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>19123&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>143&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005052&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>23777&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>144&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005055&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>23140&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>145&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005054&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>22019&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>146&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005057&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>24678&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>147&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005056&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>28245&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>148&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005059&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>31258&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>149&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005058&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>23244&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>150&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005040&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>19154&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>151&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005042&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>18486&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>152&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005041&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>25351&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>153&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005044&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>25644&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>154&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005043&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>22122&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>155&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005046&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>23061&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>156&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005045&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>27373&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>157&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005048&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>23836&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>158&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005047&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>42743&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>159&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005049&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>22208&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>160&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005071&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>31714&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>161&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005070&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>24315&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>162&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005073&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>36831&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>163&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005072&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>25800&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>164&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005075&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>47816&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>165&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005074&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>41847&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>166&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005077&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>29485&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>167&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005076&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>43764&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>168&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005079&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>27034&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>169&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005078&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>29737&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>170&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005080&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>42091&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>171&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005060&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>29954&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>172&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005062&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>25256&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>173&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005061&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>21291&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>174&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005064&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>34748&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>175&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005063&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>28623&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>176&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005066&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>39365&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>177&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005065&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>22647&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>178&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005068&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>36160&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>179&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005067&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>38671&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>180&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005069&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>35188&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>181&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005093&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>24646&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>182&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005092&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>25676&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>183&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005095&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>45540&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>184&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005094&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>42415&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>185&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005097&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>43378&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>186&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005096&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>35133&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>187&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005099&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>41992&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>188&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005098&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>27250&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>189&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005082&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>25226&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>190&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005081&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>41820&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>191&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005084&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>45698&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>192&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005083&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>39316&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>193&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005086&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>23559&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>194&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005085&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>25776&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>195&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005088&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>35211&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>196&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005087&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>49933&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>197&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005089&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>42172&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>198&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005091&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>24152&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>199&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005090&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>37487&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>200&emsp;<\/td><\/tr><tr><td>1<\/td><th>code_weighting&emsp;<\/th><td>3304557005200&emsp;<\/td><\/tr><tr><td>2<\/td><th>code_muni&emsp;<\/th><td>3304557&emsp;<\/td><\/tr><tr><td>3<\/td><th>name_muni&emsp;<\/th><td>Rio De Janeiro&emsp;<\/td><\/tr><tr><td>4<\/td><th>code_state&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>5<\/td><th>abbrev_state&emsp;<\/th><td>RJ&emsp;<\/td><\/tr><tr><td>6<\/td><th>code_region&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>7<\/td><th>name_region&emsp;<\/th><td>Sudeste&emsp;<\/td><\/tr><tr><td>8<\/td><th>total_pop&emsp;<\/th><td>35413&emsp;<\/td><\/tr><tr><td>9<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>"],{"maxWidth":800,"minWidth":50,"autoPan":true,"keepInView":false,"closeButton":true,"closeOnClick":true,"className":""},["24462","32413.0000000001","25644","27667","38510.0000000002","44196.0000000001","42916.0000000001","47474","43707.0000000006","39138","43237.9999999996","25464.9999999999","28882","24345","25102.0000000008","26675","31184.9999999996","29245","27230","29479.9999999993","26212","32422.9999999982","29310","42491.0000000008","36549.0000000001","31581","29372.0000000001","26098","36397","28370","32213","31948.9999999995","29566.9999999999","24848","27169.0000000001","27690.0000000002","47143.9999999976","3361","30704.9999999999","24947","34816.0000000003","39424.0000000001","27886","36410","37855.9999999978","32866","27737.0000000007","27214","41801.0000000002","31002.0000000001","30443","34048","41887.0000000015","38366.9999999987","36514.9999999967","40926.0000000015","43864.9999999923","31189","34709","26646","24430","34762.9999999998","27747.0000000004","26007","24852.0000000003","41586","25168","33828","30399.9999999998","33473.0000000012","21904.0000000001","23503","24080","34026","36981.9999999999","25962.9999999999","27830.9999999999","29834","38453","26725.9999999999","27444","25910","37301.0000000001","39596.0000000001","28324.0000000001","29608.0000000001","25874","26112","24860","31950","65846.9999999999","41979.9999999998","26943","28149.9999999999","29948.9999999999","34689.0000000004","32033","41457.9999999999","38793","27928","28033.9999999996","38419.0000000011","30334.9999999999","30012.9999999998","31793","36796.0000000002","29569","32879.0000000001","29170.0000000002","25947.9999999988","32666.9999999998","48663.9999999999","30599.9999999999","20065","31842.9999999999","32805.9999999999","41220","35786.9999999935","28172.9999999999","39260","33718","29352","29082","21409","32075.9999999999","21316.0000000001","19946.9999999988","18044.0000000002","22519.9999999996","27405.0000000001","29145.999999999","27424.0000000005","27958.9999999998","38584.9999999998","37948.9999999999","31407.0000000001","27682.9999999999","37839","41460.0000000001","34011.9999999997","21198","19123.0000000001","23776.9999999999","23140","22019","24678","28245","31258.0000000002","23244","19153.9999999999","18486","25351","25643.9999999998","22121.9999999999","23061.0000000001","27373","23836.0000000001","42743","22207.9999999987","31714","24315","36831.0000000002","25799.9999999999","47815.9999999994","41847.0000000005","29484.9999999972","43763.9999999998","27034.0000000007","29737","42090.9999999999","29954","25256","21291","34748.0000000016","28623.0000000001","39365.0000000018","22647.0000000001","36160.0000000003","38671.0000000002","35188","24646.0000000003","25676.0000000001","45539.9999999998","42415.0000000012","43378.0000000002","35133.0000000009","41991.9999999993","27250","25225.9999999999","41819.999999998","45698.0000000002","39316.0000000001","23559","25776","35211","49932.9999999999","42172.0000000002","24152","37486.9999999999","35412.9999999999"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},{"stroke":true,"weight":1,"opacity":0.9,"fillOpacity":0.84,"bringToFront":false,"sendToBack":false}]},{"method":"addScaleBar","args":[{"maxWidth":100,"metric":true,"imperial":true,"updateWhenIdle":true,"position":"bottomleft"}]},{"method":"addHomeButton","args":[-43.7965385,-23.0828927,-43.09904849999999,-22.7460214,true,"left_join(st_make_valid(st_transform(areas, cr.... - total_pop","Zoom to left_join(st_make_valid(st_transform(areas, cr.... - total_pop","<strong> left_join(st_make_valid(st_transform(areas, cr.... - total_pop <\/strong>","bottomright"]},{"method":"addLayersControl","args":[["CartoDB.Positron","CartoDB.DarkMatter","OpenStreetMap","Esri.WorldImagery","OpenTopoMap"],"left_join(st_make_valid(st_transform(areas, cr.... - total_pop",{"collapsed":true,"autoZIndex":true,"position":"topleft"}]},{"method":"addLegend","args":[{"colors":["#4B0055 , #432A6F 10.624779950709%, #005D8D 26.6283647537049%, #008998 42.6319495567008%, #00AF8C 58.6355343596966%, #50CC68 74.6391191626926%, #C6DF33 90.6427039656884%, #FDE333 "],"labels":["10,000","20,000","30,000","40,000","50,000","60,000"],"na_color":null,"na_label":"NA","opacity":1,"position":"topright","type":"numeric","title":"left_join(st_make_valid(st_transform(areas, cr.... - total_pop","extra":{"p_1":0.1062477995070897,"p_n":0.9064270396568844},"layerId":null,"className":"info legend","group":"left_join(st_make_valid(st_transform(areas, cr.... - total_pop"}]}],"limits":{"lat":[-23.0828927,-22.7460214],"lng":[-43.7965385,-43.09904849999999]},"fitBounds":[-23.0828927,-43.7965385,-22.7460214,-43.09904849999999,[]]},"evals":[],"jsHooks":{"render":[{"code":"function(el, x, data) {\n  return (\n      function(el, x, data) {\n      // get the leaflet map\n      var map = this; //HTMLWidgets.find('#' + el.id);\n      // we need a new div element because we have to handle\n      // the mouseover output separately\n      // debugger;\n      function addElement () {\n      // generate new div Element\n      var newDiv = $(document.createElement('div'));\n      // append at end of leaflet htmlwidget container\n      $(el).append(newDiv);\n      //provide ID and style\n      newDiv.addClass('lnlt');\n      newDiv.css({\n      'position': 'relative',\n      'bottomleft':  '0px',\n      'background-color': 'rgba(255, 255, 255, 0.7)',\n      'box-shadow': '0 0 2px #bbb',\n      'background-clip': 'padding-box',\n      'margin': '0',\n      'padding-left': '5px',\n      'color': '#333',\n      'font': '9px/1.5 \"Helvetica Neue\", Arial, Helvetica, sans-serif',\n      'z-index': '700',\n      });\n      return newDiv;\n      }\n\n\n      // check for already existing lnlt class to not duplicate\n      var lnlt = $(el).find('.lnlt');\n\n      if(!lnlt.length) {\n      lnlt = addElement();\n\n      // grab the special div we generated in the beginning\n      // and put the mousmove output there\n\n      map.on('mousemove', function (e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                           ' lon: ' + (e.latlng.lng).toFixed(5) +\n                           ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                           ' | zoom: ' + map.getZoom() +\n                           ' | x: ' + L.CRS.EPSG3857.project(e.latlng).x.toFixed(0) +\n                           ' | y: ' + L.CRS.EPSG3857.project(e.latlng).y.toFixed(0) +\n                           ' | epsg: 3857 ' +\n                           ' | proj4: +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs ');\n      } else {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      }\n      });\n\n      // remove the lnlt div when mouse leaves map\n      map.on('mouseout', function (e) {\n      var strip = document.querySelector('.lnlt');\n      if( strip !==null) strip.remove();\n      });\n\n      };\n\n      //$(el).keypress(67, function(e) {\n      map.on('preclick', function(e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      var txt = document.querySelector('.lnlt').textContent;\n      console.log(txt);\n      //txt.innerText.focus();\n      //txt.select();\n      setClipboardText('\"' + txt + '\"');\n      }\n      });\n\n      }\n      ).call(this.getMap(), el, x, data);\n}","data":null},{"code":"function(el, x, data) {\n  return (function(el,x,data){\n           var map = this;\n\n           map.on('keypress', function(e) {\n               console.log(e.originalEvent.code);\n               var key = e.originalEvent.code;\n               if (key === 'KeyE') {\n                   var bb = this.getBounds();\n                   var txt = JSON.stringify(bb);\n                   console.log(txt);\n\n                   setClipboardText('\\'' + txt + '\\'');\n               }\n           })\n        }).call(this.getMap(), el, x, data);\n}","data":null}]}}</script>
</div>
</div>
</section>
</section>
</section>
<section id="boas-práticas" class="level1">
<h1>Boas práticas</h1>
<p>O <a href="https://style.tidyverse.org/pipes.html">guia de estilo do tidyverse</a> propõe algumas orientações gerais sobre o uso de pipes. Abaixo eu reutilizao vários exemplos do guia.</p>
<section id="pipes-longos" class="level3">
<h3 class="anchored" data-anchor-id="pipes-longos">Pipes longos</h3>
<p>Primeiro, deve-se evitar de fazer um pipe long numa mesma linha. Esta recomendação visa melhorar a leitura do código. Também se recomenda deixar um espaço em branco antes do <code>|&gt;</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Bom</span></span>
<span id="cb27-2">iris <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb27-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(Species) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb27-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">where</span>(is.numeric), mean)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb27-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ungroup</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb27-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>Species, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"measure"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb27-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(value)</span>
<span id="cb27-8">  </span>
<span id="cb27-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Ruim</span></span>
<span id="cb27-10">iris <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(Species)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb27-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">where</span>(is.numeric), mean))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ungroup</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb27-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>Species, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"measure"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(value)</span></code></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 3
   Species    measure      value
   &lt;fct&gt;      &lt;chr&gt;        &lt;dbl&gt;
 1 setosa     Petal.Width  0.246
 2 versicolor Petal.Width  1.33 
 3 setosa     Petal.Length 1.46 
 4 virginica  Petal.Width  2.03 
 5 versicolor Sepal.Width  2.77 
 6 virginica  Sepal.Width  2.97 
 7 setosa     Sepal.Width  3.43 
 8 versicolor Petal.Length 4.26 
 9 setosa     Sepal.Length 5.01 
10 virginica  Petal.Length 5.55 
11 versicolor Sepal.Length 5.94 
12 virginica  Sepal.Length 6.59 </code></pre>
</div>
</div>
</section>
<section id="funções-longas" class="level3">
<h3 class="anchored" data-anchor-id="funções-longas">Funções longas</h3>
<p>No caso de funções longas, deve-se quebrar/indentar o código.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Bom</span></span>
<span id="cb29-2">iris <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb29-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(Species) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb29-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(</span>
<span id="cb29-5">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Sepal.Length =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(Sepal.Length),</span>
<span id="cb29-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Sepal.Width =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(Sepal.Width),</span>
<span id="cb29-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Species =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n_distinct</span>(Species)</span>
<span id="cb29-8">  )</span>
<span id="cb29-9"></span>
<span id="cb29-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Bom</span></span>
<span id="cb29-11">iris <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb29-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(Species) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb29-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Sepal.Length =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(Sepal.Length),</span>
<span id="cb29-14">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Sepal.Width =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(Sepal.Width),</span>
<span id="cb29-15">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Species =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n_distinct</span>(Species))</span>
<span id="cb29-16"></span>
<span id="cb29-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Ruim</span></span>
<span id="cb29-18">iris <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb29-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(Species) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb29-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Sepal.Length =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(Sepal.Length), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Sepal.Width =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(Sepal.Width), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Species =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n_distinct</span>(Species))</span></code></pre></div>
</div>
</section>
<section id="pipes-curtos" class="level3">
<h3 class="anchored" data-anchor-id="pipes-curtos">Pipes curtos</h3>
<p>Este aqui é um gatilho pessoal; tento evitar ao máximo usar um pipe com uma única função. Pipes são úteis quando se aplica uma longa sequência de funções a um mesmo objeto; faz pouco sentido usar um pipe quando se aplica somente uma função.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Bom</span></span>
<span id="cb30-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(AirPassengers)</span>
<span id="cb30-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(AirPassengers)</span>
<span id="cb30-4"></span>
<span id="cb30-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Horrível</span></span>
<span id="cb30-6">AirPassengers <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>()</span>
<span id="cb30-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Pior ainda</span></span>
<span id="cb30-8">AirPassengers <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb30-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Péssimo</span></span>
<span id="cb30-10">mtcars <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> wt, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> mpg))</span></code></pre></div>
</div>
</section>
<section id="pipes-dentro-de-funções" class="level3">
<h3 class="anchored" data-anchor-id="pipes-dentro-de-funções">Pipes dentro de funções</h3>
<p>É possível utilizar pipes dentro de funções para fazer pequenas transformações. Pessoalmente, acho que isto deixa o código confuso; quase sempre vale a pena criar um objeto intermediário ao invés de usar o pipe.</p>
<p>O código abaixo, por exemplo, usa a base <code>economics_long</code>, que reúne um conjunto de séries de tempo, e indexa elas na primeira observação. Assim o primeiro valor de cada série tem valor igual a 100 e os valores subsequentes são “proporcionais” a este valor inicial.</p>
<p>Para chegar neste cálculo eu uso um pipe, dentro de uma sequência de pipes.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1">economics_long <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb31-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(economics_long <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb31-3">              <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(date <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(date)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb31-4">              <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(variable, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">base =</span> value)</span>
<span id="cb31-5">            ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb31-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(variable) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb31-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">index =</span> value <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> base <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb31-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(date <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.Date</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1980-01-01"</span>))</span></code></pre></div>
</div>
<p>A versão alternativa do código cria um objeto intermediário com os valores iniciais de cada uma das séries.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb32" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1">base_index <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> economics_long <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb32-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(date <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(date)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb32-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(variable, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">base =</span> value)</span>
<span id="cb32-4"></span>
<span id="cb32-5">economics_index <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> economics_long <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb32-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(date, variable, value) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb32-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(base_index, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"variable"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb32-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(variable) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb32-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">index =</span> value <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> base <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb32-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(date <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.Date</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1980-01-01"</span>))</span></code></pre></div>
</div>
<p>Por fim, faço um gráfico do resultado final para tornar evidente o que está acontecendo.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb33" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(economics_index, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> date, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> index)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb33-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb33-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(variable))</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/2023-09-pipes-in-r/index_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" style="width:70.0%"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="qual-pipe-usar" class="level1">
<h1>Qual pipe usar?</h1>
<p>Como comentei acima, o pipe nativo do R foi inspirado no pipe do pacote <code>magrittr</code>, um dos mais populares pacotes criados. Há algumas pequenas diferenças entre o <code>%&gt;%</code> e o <code>|&gt;</code>. Primeiro, em termos de eficiência, o <code>|&gt;</code> é levemente mais rápido, mas a diferença é praticamente imperceptível.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb34" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(microbenchmark)</span>
<span id="cb34-2"></span>
<span id="cb34-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">microbenchmark</span>(</span>
<span id="cb34-4">  {<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>()},</span>
<span id="cb34-5">  {<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>()}</span>
<span id="cb34-6">  )</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Unit: microseconds
                               expr    min      lq     mean median     uq
      {     mean(rnorm(n = 1000)) } 28.372 29.1305 30.74262 29.397 29.725
 {     rnorm(n = 1000) %&gt;% mean() } 29.356 29.9710 30.99641 30.217 30.586
    max neval cld
 74.128   100   a
 73.144   100   a</code></pre>
</div>
</div>
<p>A principal diferença entre os dois é o uso do <em>placeholder</em>. O operador <em>placeholder</em> do <code>magrittr</code> é o ponto <code>.</code> e é mais versátil que o <code>_</code>. No exemplo abaixo eu consigo colocar a tabela filtrada dentro da função <code>rownames</code> durante o pipe.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb36" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1">mtcars <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb36-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(cyl <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb36-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(.))</span></code></pre></div>
</div>
<p>Isto não funciona com o pipe nativo.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb37" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1">mtcars <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb37-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(cyl <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb37-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(_))</span></code></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error: invalid use of pipe placeholder</code></pre>
</div>
</div>
<p>Isto pode ser bastante conveniente quando se lida com objetos espaciais. Imagine o caso em que se tem um objeto criado com <code>sf</code> que guarda polígonos e se quer encontrar as coordenadas dos centróides destes polígonos.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb39" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1">dat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb39-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_transform</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">crs =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4674</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb39-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb39-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">center =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_centroid</span>(.),</span>
<span id="cb39-5">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">coords =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_coordinates</span>(center)</span>
<span id="cb39-6">    )</span></code></pre></div>
</div>
<p>Também consegue-se usar o <code>.</code> junto com operadores e não apenas com funções. O código abaixo calcula a raiz do erro quadrado médio dos resíduos da regressão. Como vimos acima, isto não é possível com o pipe nativo e exigiria uma função anônima.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb40" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1">fit <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(mpg <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> wt, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> mtcars)</span>
<span id="cb40-2"></span>
<span id="cb40-3">fit <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb40-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">residuals</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb40-5">  .<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb40-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb40-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>()</span></code></pre></div>
</div>
<p>O <code>.</code> pode ser seguido de outros operadores como o <code>$</code>. Assim pode-se extrair uma coluna específica depois de filtrar uma tabela.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb41" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1">mtcars <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb41-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(cyl <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb41-3">  .<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>mpg</span></code></pre></div>
</div>
<p>O <code>.</code> também pode ser fornecido para múltiplos argumentos como no exemplo abaixo.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb42" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1">mtcars <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb42-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">anti_join</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> ., <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> .)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] mpg  cyl  disp hp   drat wt   qsec vs   am   gear carb
&lt;0 rows&gt; (or 0-length row.names)</code></pre>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb44" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1">mtcars <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb44-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">anti_join</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> _, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> _)</span></code></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error: pipe placeholder may only appear once</code></pre>
</div>
</div>
<p>Por fim, o pipe nativo também é um pouco inútil quando se usa o <code>data.table</code>. Isto acontece por causa da sintaxe do pacote.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb46" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(data.table)</span>
<span id="cb46-2">dtmtcars <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">copy</span>(mtcars)</span>
<span id="cb46-3">dtmtcars <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">setDT</span>(dtmtcars)</span></code></pre></div>
</div>
<p>Na sintaxe do <code>data.table</code> é possível encadear as operação naturalmente usando <code>[</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb47" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1">dtmtcars[, .(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mpg =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(mpg)), by <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> cyl][<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">order</span>(cyl)]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   cyl      mpg
1:   4 26.66364
2:   6 19.74286
3:   8 15.10000</code></pre>
</div>
</div>
<p>Muitos, contudo, preferem usar o pipe <code>%&gt;%</code> para encadear as operações, já que o código fica mais legível (especialmente em operações mais longas).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb49" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1">dtmtcars[, .(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mpg =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(mpg)), by <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> cyl] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb49-2">  .[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">order</span>(cyl)]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   cyl      mpg
1:   4 26.66364
2:   6 19.74286
3:   8 15.10000</code></pre>
</div>
</div>
<p>Novamente, como o placeholder do pipe nativo espera sempre receber uma função, o código abaixo não funciona.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb51" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1">dtmtcars[, .(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mpg =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(mpg)), by <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> cyl] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb51-2">  _[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">order</span>(cyl)]</span></code></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error: pipe placeholder can only be used as a named argument</code></pre>
</div>
</div>
<p>A solução, como vimos acima, seria criar uma função anônima. Neste caso, também seria possível disfarçar o <code>[</code> como uma função (por favor, não faça isto).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb53" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1">.p <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span></span>
<span id="cb53-2"></span>
<span id="cb53-3">dtmtcars[, .(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mpg =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(mpg)), by <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> cyl] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb53-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.p</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">order</span>(cyl))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   cyl      mpg
1:   4 26.66364
2:   6 19.74286
3:   8 15.10000</code></pre>
</div>
</div>
</section>
<section id="resumo-1" class="level1">
<h1>Resumo</h1>
<p>O pipe é um operador simples que serve para deixar o código mais limpo. Sempre é uma boa escolha usar pipes quando se quer aplicar múltiplas funções num mesmo objeto. O custo do <code>|&gt;</code> é mínimo em termos de eficiência; além disso, ele diminui a necessidade de criar objetos intermediários o que poupa memória do sistema.</p>
<p>O pipe nativo é imbutido no R a partir da versão 4.1.0 enquanto o <code>%&gt;%</code> exige <code>library(magrittr)</code>. Vale notar que muitos pacotes carregam o <code>%&gt;%</code> automaticamente. De fato, pacotes como <code>dplyr</code>, <code>leaflet</code>, <code>mapview</code>, <code>rvest</code>, <code>gt</code>, e <code>flextable</code> são praticamente inutilizáveis sem pipes<sup>1</sup>.</p>
<p>Antes de pensar em usar o pipe nativo, vale a pena reforçar que ele foi criado recentemente. Isto significa que qualquer código ou pacote desenvolvido com uso de pipes vai exigir a versão 4.1.0 ou superior, o que pode exigir que o usuário atualize a sua versão do R. Além disso, algumas funcionalidades do pipe nativo mudaram nas versões 4.2 e 4.3 o que pode complicar ainda mais o uso do pipe.</p>
<p>Pessoalmente, tento utilizar o <code>|&gt;</code> nos posts do blog, mas sem nunca utilizar o <code>_</code>. Quando preciso de um <em>placeholder</em> utilizo o <code>%&gt;%</code>, mas evito usá-lo com operadores como <code>.^2</code>.</p>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Uma quantidade enorme de pacotes utiliza o <code>magrittr</code> como dependência. Veja a <a href="https://cloud.r-project.org/web/packages/magrittr/index.html">página do CRAN</a>.↩︎</p></li>
</ol>
</section></div> ]]></description>
  <category>data-science</category>
  <category>tutorial-R</category>
  <guid>https:://www.restateinsight.com/posts/general-posts/2023-09-pipes-in-r/index.html</guid>
  <pubDate>Fri, 15 Sep 2023 03:00:00 GMT</pubDate>
  <media:content url="https:://www.restateinsight.com/static/images/thumbnails/pipes.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Weekly Viz: Ruas de Porto Alegre</title>
  <dc:creator>Vinicius Oike</dc:creator>
  <link>https:://www.restateinsight.com/posts/general-posts/2023-09-ruas-porto-alegre/index.html</link>
  <description><![CDATA[ 




<section id="nome-das-ruas-de-porto-alegre" class="level1">
<h1>Nome das ruas de Porto Alegre</h1>
<section id="uma-avenida-polêmica" class="level2">
<h2 class="anchored" data-anchor-id="uma-avenida-polêmica">Uma avenida polêmica</h2>
<p>Aqueles que acompanham as venturas da capital gaúcha bem devem saber da polêmica Avenida <a href="https://pt.wikipedia.org/wiki/Humberto_Castelo_Branco">Castelo Branco</a>, que dá entrada à cidade, para quem vem da Região Metropolitana. Em 2014, a câmara de vereadores de Porto Alegre <a href="https://pt.wikipedia.org/wiki/Humberto_Castelo_Branco">aprovou a mudança da Av. Castelo Branco para Av. da Legalidade e da Democracia</a>. A Avenida da Legalidade, como ficou conhecida, durou pouco tempo: em 2018 a justiça considerou inválida a lei que alterou o nome da avenida e ela voltou a se chamar Castelo Branco, agora <a href="https://g1.globo.com/rs/rio-grande-do-sul/noticia/justica-considera-lei-invalida-e-avenida-da-legalidade-volta-a-se-chamar-castelo-branco-em-porto-alegre.ghtml">Av. Presidente Castelo Branco</a>, como se querendo debochar da mudança anterior.</p>
<p>Na minha vivência na cidade, sempre reparei na quantidade de ruas e avenidas que homenageavam não somente os presidentes da ditadura militar, mas membros do exército em geral. A principal via do boêmio bairro da Cidade Baixa chama-se Rua General Lima e Silva; a avenida que liga a Protásio com a 24, Av. Coronel Lucas de Oliveira; um longo trecho da terceira perimetral, Av. Coronel Aparício Borges; no querido Bom Fim, General João Telles; no Centro Histórico, Gen.&nbsp;Vitorino, Gen.&nbsp;Andrade Neves, Gen.&nbsp;Câmara, Gen.&nbsp;Salustiano, Cel. Fernando Machado e tantos outros.</p>
<p>Parti então para a empreitada de classificar todas as ruas da cidade e entender quais os nomes que formam os logradouros de Porto Alegre. O resultado está no mapa abaixo. Para ver em mais detalhes, selecione “Abrir imagem em nova aba” e use o zoom.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/2023-09-ruas-porto-alegre/images/ruas_porto_alegre-01.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</section>
<section id="sobre-o-mapa" class="level2">
<h2 class="anchored" data-anchor-id="sobre-o-mapa">Sobre o mapa</h2>
<p>A tarefa foi mais difícil do que esperava. De imediato, nota-se que a maior parte das ruas têm nome de pessoas, cerca de 65%. O restante das ruas ou são “coisas”, como <a href="https://www.openstreetmap.org/search?query=avenida%20icaraí%2C%20Porto%20Alegre%2C%20brasil#map=19/-30.08394/-51.24020">Av. Icaraí</a>, <a href="https://www.openstreetmap.org/search?query=avenida%20ipiranga%2C%20Porto%20Alegre%2C%20brasil#map=19/-30.04832/-51.21778">Av. Ipiranga</a>, etc. ou são ruas sem nome como Beco A, Rua 1, etc. Estas ruas sem nome concentram-se ou em aglomerados subnormais (favelas) ou em condomínios fechados. Por fim, temos ruas que têm nomes de outros lugares, como a Av. Nova York, Rua Europa, etc.</p>
<p>O exército realmente tem muitas ruas, em torno de 185, ou 3% do total; é mais do que o nome de ruas que têm os políticos (35) e até mesmo do que as figuras religiosas que têm 155. Há menos ruas com nomes de políticos do que eu esperava; as poucas ruas, contudo, costumam ser bastante importantes, como a <a href="https://www.openstreetmap.org/search?query=avenida%20joão%20pessoa%2C%20Porto%20Alegre%2C%20brasil#map=19/-30.04069/-51.21662">Av. João Pessoa</a>, <a href="https://www.openstreetmap.org/search?query=avenida%20Getulio%20vargas%2C%20Porto%20Alegre%2C%20brasil#map=19/-30.04847/-51.22164">Av. Getúlio Vargas</a> e <a href="https://www.openstreetmap.org/search?query=avenida%20protasio%20alves%2C%20Porto%20Alegre%2C%20brasil#map=17/-30.03897/-51.17337">Av. Protásio Alves</a>. Nossos padres, freis e papas têm muitas ruas, mas a maioria delas são pequenas; a exceção é a <a href="https://www.openstreetmap.org/search?query=avenida%20padre%20cacique%2C%20Porto%20Alegre%2C%20brasil#map=19/-30.08122/-51.24605">Av. Padre Cacique</a>, na Zona Sul.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/2023-09-ruas-porto-alegre/images/ruas_porto_alegre_exercito-01.svg" class="img-fluid figure-img"></p>
</figure>
</div>
<p>Como mencionei acima, o Centro Histórico concentra muitas ruas com nomes de generais, coroneis e marechais.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/2023-09-ruas-porto-alegre/images/ruas_porto_alegre_centro-01.svg" class="img-fluid figure-img"></p>
</figure>
</div>
<p>As ruas sem nome são bastante aglomeradas espacialmente. Na sua maioria, estas ruas são de condomínios fechados ou de aglomerados subnormais. A foto abaixo mostra a esquina da Rua C com a Rua Oito, no bairro Bom Jesus. As ruas em volta seguem o mesmo padrão: Rua 11, Rua Doze, Rua P, etc.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/2023-09-ruas-porto-alegre/images/rua_c.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>Algumas partes da cidade parecem temáticas. Na Zona Norte, por exemplo, no Bairro São Geraldo, há um enorme número de <a href="https://www.google.com/maps/place/Av.+Ceará+-+São+João,+Porto+Alegre+-+RS/@-30.0054329,-51.195621,17z/data=!3m1!4b1!4m6!3m5!1s0x951979e917aa503f:0x1e57c186de1a6f8f!8m2!3d-30.0054376!4d-51.1930461!16s%2Fg%2F1ymwj9h24?entry=ttu">ruas contíguas com nomes de locais</a>: Av. Pará, Av. Amazonas, Av. Bahia, Av. Ceará, Av. França, Av. Madrid, etc. No Partenon, a Rua Chile faz esquina com a R. Valparaíso e é paralela com a R. Buenos Aires.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/2023-09-ruas-porto-alegre/images/ruas_porto_alegre_sao_geraldo.svg" class="img-fluid figure-img"></p>
</figure>
</div>
<p>Os nomes de personalidades históricas estão espalhados pela cidade e não parece haver um padrão. Os escritores <a href="https://www.openstreetmap.org/search?query=rua%20machado%20de%20assis%2C%20Porto%20Alegre%2C%20brasil#map=18/-30.05202/-51.19218">Machado de Assis</a>, <a href="https://www.openstreetmap.org/search?query=rua%20Graciliano%20ramos%2C%20Porto%20Alegre%2C%20brasil#map=19/-30.04883/-51.16817">Graciliano Ramos</a>, <a href="https://www.openstreetmap.org/search?query=rua%20Eça%20de%20queiroz%2C%20Porto%20Alegre%2C%20brasil#map=18/-30.04284/-51.19189">Eça de Queiroz</a>, <a href="https://www.openstreetmap.org/search?query=rua%20Olavo%20bilac%2C%20Porto%20Alegre%2C%20brasil#map=19/-30.04442/-51.21938">Olavo Bilac</a> e outros estão cada um em um canto. Já Raimundo Correa, Alfonso Celso e Vicente de Carvalho (todos poetas) estão reunidos no entorno da <a href="https://www.google.com/maps/place/Praça+Japão/@-30.0265601,-51.1812002,17.55z/data=!4m6!3m5!1s0x951977809c31b487:0x6421931df0819801!8m2!3d-30.0271922!4d-51.1792611!16s%2Fg%2F1239pmhr?entry=ttu">Praça Japão</a>; durante um trecho, também, <a href="https://www.openstreetmap.org/search?query=rua%20castro%20alves%2C%20Porto%20Alegre%2C%20brasil#map=18/-30.03184/-51.19972">Castro Alves e Casemiro de Abreu são paralelos</a>. A Av. Érico Veríssimo, na sua longa extensão, faz esquina com a Olavo Bilac e eventualmente encontra-se com a <a href="https://www.openstreetmap.org/search?query=avenida%20José%20de%20alencar%2C%20Porto%20Alegre%2C%20brasil#map=18/-30.05869/-51.21496">Av. José de Alencar</a>.</p>
<p>Muitas ruas têm nomes de profissões, como R. Doutor Flores ou <a href="https://www.openstreetmap.org/search?query=rua%20professor%20fitzgerald%2C%20Porto%20Alegre%2C%20brasil#map=18/-30.03789/-51.18274">R. Professor Fitzgerald</a>. A profissão mais comum é a de doutor (cerca de 120 ruas) seguida por professor (cerca de 80 ruas). Também temos bastante engenheiros, como na Av. Engenheiro Alfredo Corrêa Daudt. No meio das ruas temos até uma Av. <a href="https://zonasulpoa.com.br/economista-nilo-wulff/">Economista Nilo Wulff</a>, no Bairro Restinga, que foi um dos criados do Conselho de Economia do Rio Grande do Sul. As ruas com nomes de profissão estão espalhadas por toda a cidade. No Bairro Tristeza, na Zona Sul, há várias delas reunidas, várias ruas com nome de Doutor.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/2023-09-ruas-porto-alegre/images/ruas_porto_alegre_profissao.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</section>
<section id="sobre-fazer-o-mapa" class="level2">
<h2 class="anchored" data-anchor-id="sobre-fazer-o-mapa">Sobre fazer o mapa</h2>
<p>Classificar o nome das ruas é uma tarefa nada trivial. Primeiro, porque as categorias que eu me propus a usar não são mututamente excludentes. A <a href="https://www.google.com/maps/place/Av.+Sen.+Salgado+Filho+-+Centro+Histórico,+Porto+Alegre+-+RS,+90010-220/@-30.0309451,-51.2284569,17z/data=!3m1!4b1!4m6!3m5!1s0x95197905f944bcf3:0x1ed53ab49ea58101!8m2!3d-30.0309498!4d-51.225882!16s%2Fg%2F1ymvdsdkm?entry=ttu">Av. Senador Salgado Filho</a>, por exemplo, é nome de um município, refere-se a uma profissão (senador), é nome de um político e, de maneira geral, é nome de uma personalidade histórica.</p>
<p>A Av. Bento Gonçalves também é um pouco ambígua, afinal é o nome de um município importante; neste caso, contudo, tanto a avenida como a cidade homenageam Bento Gonçalves da Silva, tenente-coronel, líder da Revolução Farroupilha. Além disso, a <a href="https://leismunicipais.com.br/a/rs/p/porto-alegre/lei-ordinaria/1936/1/1/lei-ordinaria-n-1-1936-da-nova-denominacao-a-estrada-do-mato-grosso-a-avenida-que-com-o-nome-de-bento-goncalves-atravessa-o-parque-farroupilha-a-rua-que-tem-esse-nome-e-a-travessa-victoria">Lei Ordinária No 1 de março de 1936</a>, deixa evidente que o homenageado era o General. Infelizmente, são poucas as ruas e avenidas que estão propriamente documentadas online. Em alguns casos não há registros de quem era a pessoa homenageada ou há mesmo várias pessoas com nome similar.</p>
<p>Por fim, algumas ruas são simplesmente difíceis de classificar. A Travessa Azevedo, por exemplo. Quem terá sido este Azevedo? Na dúvida, ficou como personalidade histórica.</p>
<p>Para a minha surpesa algumas ruas tem nomes duplicados. A BR-290 que liga a cidade ao litoral tem o nome Estrada Marechal Osório no Google Maps, mas tem nome Rodovia Osvaldo Aranha no OpenStreetMaps. Até onde me lembro sempre ouvi as pessoas chamando ela de <a href="https://gauchazh.clicrbs.com.br/cultura-e-lazer/almanaque/noticia/2020/01/a-historia-da-freeway-a-estrada-que-liga-gauchos-ao-litoral-norte-desde-1973-ck5ekne01001r01ocsz3qxui4.html">“freeway”</a>. Não consegui encontrar algum tipo de material oficial na prefeitura para sanar a dúvida.</p>
<p>Não encontrei nenhum tipo de “dicionário” ou lista com personalidades gaúchas. Sem uma boa lista que junta nomes com descrições fica difícil aplicar algum tipo de metodologia que envolva aprendizado de máquina. A classificação foi feita com uso extensivo de regex; a revisão foi na base de tentativa e erro, pois há incontáveis exceções a todo tipo de regra. Na minha classificação as categorias “coringa” são “personalidade histórica” e “coisa”. Até por isso, estas são as duas categorias com maior chance de estar superestimadas.</p>
</section>
<section id="código" class="level2">
<h2 class="anchored" data-anchor-id="código">Código</h2>
<p>Como sempre, o código para fazer o mapa segue abaixo:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Classificar o nome das ruas de Poa #</span></span>
<span id="cb1-2"></span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(osmdata)</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(sf)</span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb1-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb1-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(stringr)</span>
<span id="cb1-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggtext)</span>
<span id="cb1-9">sysfonts<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">font_add</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gill Sans"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GillSans.ttc"</span>)</span>
<span id="cb1-10">showtext<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">showtext_auto</span>()</span>
<span id="cb1-11"></span>
<span id="cb1-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Import Data -------------------------------------------------------------</span></span>
<span id="cb1-13"></span>
<span id="cb1-14"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## geobr -------------------------------------------------------------------</span></span>
<span id="cb1-15"></span>
<span id="cb1-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># City border</span></span>
<span id="cb1-17">poa <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> geobr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_municipality</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4314902</span>)</span>
<span id="cb1-18"></span>
<span id="cb1-19"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## osmdata -----------------------------------------------------------------</span></span>
<span id="cb1-20"></span>
<span id="cb1-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Define bbox</span></span>
<span id="cb1-22">bbox <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getbb</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Porto Alegre Brazil"</span>)</span>
<span id="cb1-23"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Base query</span></span>
<span id="cb1-24">qr <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">opq</span>(bbox)</span>
<span id="cb1-25"></span>
<span id="cb1-26"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add feature requests to query</span></span>
<span id="cb1-27"></span>
<span id="cb1-28"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># All roads</span></span>
<span id="cb1-29">qr_roads <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_osm_feature</span>(qr, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">key =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"highway"</span>)</span>
<span id="cb1-30"></span>
<span id="cb1-31"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Only big roads</span></span>
<span id="cb1-32">qr_big_streets <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_osm_feature</span>(</span>
<span id="cb1-33">  qr,</span>
<span id="cb1-34">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">key =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"highway"</span>,</span>
<span id="cb1-35">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">value =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"motorway"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"primary"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"motorway_link"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"primary_link"</span>)</span>
<span id="cb1-36">)</span>
<span id="cb1-37"></span>
<span id="cb1-38"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Only medium roads</span></span>
<span id="cb1-39">qr_med_streets <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_osm_feature</span>(</span>
<span id="cb1-40">  qr,</span>
<span id="cb1-41">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">key =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"highway"</span>,</span>
<span id="cb1-42">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">value =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"secondary"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tertiary"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"secondary_link"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tertiary_link"</span>)</span>
<span id="cb1-43">)</span>
<span id="cb1-44"></span>
<span id="cb1-45"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Only small roads</span></span>
<span id="cb1-46">qr_small_streets <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_osm_feature</span>(</span>
<span id="cb1-47">  qr,</span>
<span id="cb1-48">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">key =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"highway"</span>,</span>
<span id="cb1-49">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">value =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"residential"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"living_street"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"unclassified"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"service"</span>,</span>
<span id="cb1-50">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"footway"</span>)</span>
<span id="cb1-51">)</span>
<span id="cb1-52"></span>
<span id="cb1-53"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Download</span></span>
<span id="cb1-54">roads <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">osmdata_sf</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">q =</span> qr_roads)</span>
<span id="cb1-55">roads <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> roads<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>osm_lines</span>
<span id="cb1-56">roads <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_transform</span>(roads, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">crs =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4674</span>)</span>
<span id="cb1-57">roads <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_join</span>(roads, poa)</span>
<span id="cb1-58">roads <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(roads, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(code_muni))</span>
<span id="cb1-59"></span>
<span id="cb1-60"></span>
<span id="cb1-61">big_streets <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">osmdata_sf</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">q =</span> qr_big_streets)</span>
<span id="cb1-62">med_streets <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">osmdata_sf</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">q =</span> qr_med_streets)</span>
<span id="cb1-63">small_streets <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">osmdata_sf</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">q =</span> qr_small_streets)</span>
<span id="cb1-64"></span>
<span id="cb1-65"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Get street names</span></span>
<span id="cb1-66">snames <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> roads<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>name</span>
<span id="cb1-67"></span>
<span id="cb1-68"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Remove duplicate names and missing values</span></span>
<span id="cb1-69">snames <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>(snames)</span>
<span id="cb1-70">snames <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">na.omit</span>(snames)</span>
<span id="cb1-71"></span>
<span id="cb1-72"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert to tibble</span></span>
<span id="cb1-73">dictionary <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(</span>
<span id="cb1-74">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">street_name =</span> snames</span>
<span id="cb1-75">)</span>
<span id="cb1-76"></span>
<span id="cb1-77"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Streets - classify ------------------------------------------------------</span></span>
<span id="cb1-78"></span>
<span id="cb1-79"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Group into categories: historical personalities, names of other cities or </span></span>
<span id="cb1-80"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; states, jobs, holiday, religious figure, army, nameless</span></span>
<span id="cb1-81"></span>
<span id="cb1-82"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Get names of all cities and states in Brazil</span></span>
<span id="cb1-83">muni <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> sidrar<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_sidra</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4709</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">geo =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"City"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">variable =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">93</span>)</span>
<span id="cb1-84"></span>
<span id="cb1-85">name_muni <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> muni <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb1-86">  janitor<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">clean_names</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb1-87">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(valor <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb1-88">  tidyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">separate</span>(municipio, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">into =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"name_muni"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"abb"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" - "</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb1-89">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pull</span>(name_muni) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb1-90">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>()</span>
<span id="cb1-91"> </span>
<span id="cb1-92">state <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> geobr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_state</span>()</span>
<span id="cb1-93">state_name <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> state<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>name_state</span>
<span id="cb1-94"></span>
<span id="cb1-95">state_lower <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(</span>
<span id="cb1-96">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rio Grande do Sul"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rio de Janeiro"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rio Grande do Norte"</span>,</span>
<span id="cb1-97">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mato Grosso do Sul"</span></span>
<span id="cb1-98">  )</span>
<span id="cb1-99"></span>
<span id="cb1-100">state_name <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(state_name, state_lower)</span>
<span id="cb1-101"></span>
<span id="cb1-102">geonames <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(name_muni, state_name)</span>
<span id="cb1-103">geostring <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(glue<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glue</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"({geonames})"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">collapse =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"|"</span>)</span>
<span id="cb1-104"></span>
<span id="cb1-105"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Common titles for army position, liberal professions, and religious</span></span>
<span id="cb1-106"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; personalities</span></span>
<span id="cb1-107"></span>
<span id="cb1-108">posto_exercito <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(</span>
<span id="cb1-109">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Marechal"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Almirante"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"General"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Comandante"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Coronel"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cabo"</span>,</span>
<span id="cb1-110">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Capitão"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Brigadeiro"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Tenente"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"(Castello Branco)"</span>,</span>
<span id="cb1-111">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"(Costa e Silva)"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"(Ernesto Geisel)"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PM"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Major"</span></span>
<span id="cb1-112">  )</span>
<span id="cb1-113"></span>
<span id="cb1-114"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Common prefixes for job titles</span></span>
<span id="cb1-115">profissao <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(</span>
<span id="cb1-116">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Engenheir"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Doutor"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Profess"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Desembargador"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Economista"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Jornalista"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Escrivão"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Contabilista"</span></span>
<span id="cb1-117">  )</span>
<span id="cb1-118"></span>
<span id="cb1-119"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Common names for religious figures</span></span>
<span id="cb1-120">santidade <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Frei"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Santo"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Santa"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"São"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Padre"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Papa"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Reverendo"</span>)</span>
<span id="cb1-121"></span>
<span id="cb1-122">politico <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vereador"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Deputado"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Governador"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Senador"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Presidente"</span>)</span>
<span id="cb1-123"></span>
<span id="cb1-124"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Collapse strings</span></span>
<span id="cb1-125">posto_exercito <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(posto_exercito, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">collapse =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"|"</span>)</span>
<span id="cb1-126">profissao <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(profissao, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">collapse =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"|"</span>)</span>
<span id="cb1-127">santidade <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(santidade, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" "</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">collapse =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"|"</span>)</span>
<span id="cb1-128">politico <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(politico, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">collapse =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"|"</span>)</span>
<span id="cb1-129"></span>
<span id="cb1-130"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Proxy for closed condominiums / favelas</span></span>
<span id="cb1-131"></span>
<span id="cb1-132">cardinais <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(</span>
<span id="cb1-133">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Um"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dois"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Três"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Quatro"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cinco"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Seis"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sete"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Oito"</span>,</span>
<span id="cb1-134">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Nove"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dez"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Onze"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Doze"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Treze"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Catorze"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Quatorze"</span>,</span>
<span id="cb1-135">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Quinze"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dezesseis"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dezesete"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dezoito"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dezenove"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vinte"</span>,</span>
<span id="cb1-136">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vinte e Um"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vinte e Dois"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vinte e Três"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vinte e Quatro"</span>,</span>
<span id="cb1-137">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vinte e Cinco"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vinte e Seis"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vinte e Sete"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vinte e Oito"</span>,</span>
<span id="cb1-138">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vinte e Nove"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Trinta"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Quarenta"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cinquenta"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sessenta"</span>,</span>
<span id="cb1-139">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Setenta"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Oitenta"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Noventa"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cem"</span></span>
<span id="cb1-140">  )</span>
<span id="cb1-141"></span>
<span id="cb1-142">cardinais <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"(Rua "</span>, cardinais, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">")"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">collapse =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"|"</span>)</span>
<span id="cb1-143"></span>
<span id="cb1-144"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; "nameless" streets</span></span>
<span id="cb1-145">name_vias <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(</span>
<span id="cb1-146">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Alameda"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Avenida"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Acesso"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Beco"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Caminho"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Passagem"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Via"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Viela"</span></span>
<span id="cb1-147">)</span>
<span id="cb1-148"></span>
<span id="cb1-149">rx_vias <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(name_vias, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"[A-Z0-9]+[A-Z]?$"</span>)</span>
<span id="cb1-150"></span>
<span id="cb1-151">rua_sem_nome <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"[0-9].+"</span>, rx_vias, cardinais)</span>
<span id="cb1-152"></span>
<span id="cb1-153">rua_sem_nome <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(glue<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glue</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"({rua_sem_nome})"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">collapse =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"|"</span>)</span>
<span id="cb1-154"></span>
<span id="cb1-155">rua_sem_nome <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(rua_sem_nome, cardinais, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"|"</span>)</span>
<span id="cb1-156"></span>
<span id="cb1-157">dictionary <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dictionary <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb1-158">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb1-159">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">class =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(</span>
<span id="cb1-160">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_count</span>(street_name, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">w+"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Personalidade Histórica"</span>,</span>
<span id="cb1-161">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_count</span>(street_name, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">w+"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Coisa"</span>,</span>
<span id="cb1-162">      <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Outro"</span></span>
<span id="cb1-163">    ),</span>
<span id="cb1-164">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">class =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(</span>
<span id="cb1-165">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_detect</span>(street_name, geostring) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Nome de Cidade/UF"</span>,</span>
<span id="cb1-166">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_detect</span>(street_name, politico) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Político"</span>,</span>
<span id="cb1-167">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_detect</span>(street_name, posto_exercito) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Exército"</span>,</span>
<span id="cb1-168">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_detect</span>(street_name, profissao) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Profissão"</span>,</span>
<span id="cb1-169">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_detect</span>(street_name, santidade) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Figura Religiosa"</span>,</span>
<span id="cb1-170">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_detect</span>(street_name, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"[0-9] de"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Feriado"</span>,</span>
<span id="cb1-171">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_detect</span>(street_name, rua_sem_nome) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rua sem nome"</span>,</span>
<span id="cb1-172">      <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> class</span>
<span id="cb1-173">    )</span>
<span id="cb1-174">  )</span>
<span id="cb1-175"></span>
<span id="cb1-176">pers <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(</span>
<span id="cb1-177">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Carlos Gomes"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Protásio Alves"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Salgado Filho"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mário Tavares Haussen"</span>,</span>
<span id="cb1-178">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Donário Braga"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Joracy Camargo"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Goethe"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mozart"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Schiller"</span>,</span>
<span id="cb1-179">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Edgar Pires de Castro"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Plínio Brasil Milano"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Santos Dumont"</span></span>
<span id="cb1-180">  )</span>
<span id="cb1-181"></span>
<span id="cb1-182">exercito <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(</span>
<span id="cb1-183">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Bento Gonçalves"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Luís Carlos Prestes"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Presidente Castello Branco"</span>,</span>
<span id="cb1-184">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"João Antônio da Silveira"</span></span>
<span id="cb1-185">  )</span>
<span id="cb1-186"></span>
<span id="cb1-187">politicos <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(</span>
<span id="cb1-188">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Getúlio Vargas"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"João Pessoa"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Protásio Alves"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Loureiro da Silva"</span></span>
<span id="cb1-189">  )</span>
<span id="cb1-190"></span>
<span id="cb1-191">coisas <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(</span>
<span id="cb1-192">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Azenha"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rua da Conceição"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Túnel da Conceição"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Elevada da Conceição"</span>,</span>
<span id="cb1-193">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Viaduto da Conceição"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Ipiranga"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Beira Rio"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rio Jacuí"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" Banco"</span>,</span>
<span id="cb1-194">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Lago das "</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Lago do"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rio dos Frades"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rio Pardo"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rio Claro"</span>,</span>
<span id="cb1-195">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rio dos Sinos"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rio Negro"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rio Grande"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rio Tejo"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rio Maria"</span>,</span>
<span id="cb1-196">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rio Verde"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rio Solimoes"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rio Xingu"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rio Tapajos"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Avenida da Cavalhada"</span>,</span>
<span id="cb1-197">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Estrada do Varejão"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Estrada da Taquara"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sarandi"</span></span>
<span id="cb1-198">  )</span>
<span id="cb1-199"></span>
<span id="cb1-200">locais <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(</span>
<span id="cb1-201">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Chicago"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Madri"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Nova York"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Nova Zelândia"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Quito"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Brasil"</span>,</span>
<span id="cb1-202">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Europa"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Estados Unidos"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Japão"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Itália"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Polônia"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Caracas"</span>,</span>
<span id="cb1-203">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Buenos Aires"</span></span>
<span id="cb1-204">)</span>
<span id="cb1-205"></span>
<span id="cb1-206">pers <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(glue<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glue</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"({pers})"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">collapse =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"|"</span>)</span>
<span id="cb1-207">coisas <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(glue<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glue</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"({coisas})"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">collapse =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"|"</span>)</span>
<span id="cb1-208">locais <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(glue<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glue</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"({locais})"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">collapse =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"|"</span>)</span>
<span id="cb1-209">politicos <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(glue<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glue</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"({politicos})"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">collapse =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"|"</span>)</span>
<span id="cb1-210">exercito <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(glue<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glue</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"({exercito})"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">collapse =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"|"</span>)</span>
<span id="cb1-211"></span>
<span id="cb1-212"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Ajustes manuais</span></span>
<span id="cb1-213">dictionary <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dictionary <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb1-214">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb1-215">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">class =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">if_else</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_detect</span>(street_name, pers), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Personalidade Histórica"</span>, class),</span>
<span id="cb1-216">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">class =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">if_else</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_detect</span>(street_name, coisas), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Coisa"</span>, class),</span>
<span id="cb1-217">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">class =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">if_else</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_detect</span>(street_name, locais), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Nome de Cidade/UF"</span>, class),</span>
<span id="cb1-218">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">class =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">if_else</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_detect</span>(street_name, politicos), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Político"</span>, class),</span>
<span id="cb1-219">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">class =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">if_else</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_detect</span>(street_name, exercito), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Exército"</span>, class)</span>
<span id="cb1-220">  )</span>
<span id="cb1-221"></span>
<span id="cb1-222">dictionary <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb1-223">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">count</span>(class, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sort =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb1-224">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">share =</span> n <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(n) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)</span>
<span id="cb1-225"></span>
<span id="cb1-226"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Streets ---------------------------------------------------------------</span></span>
<span id="cb1-227"></span>
<span id="cb1-228">s1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> big_streets<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>osm_lines <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb1-229">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_transform</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">crs =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4674</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb1-230">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(dictionary, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"name"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"street_name"</span>))</span>
<span id="cb1-231"></span>
<span id="cb1-232">s2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> med_streets<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>osm_lines <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb1-233">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_transform</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">crs =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4674</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb1-234">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(dictionary, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"name"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"street_name"</span>))</span>
<span id="cb1-235"></span>
<span id="cb1-236">s3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> small_streets<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>osm_lines <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb1-237">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_transform</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">crs =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4674</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb1-238">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(dictionary, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"name"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"street_name"</span>))</span>
<span id="cb1-239"></span>
<span id="cb1-240"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot ------------------------------------------------------------------</span></span>
<span id="cb1-241">cores <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(</span>
<span id="cb1-242">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"coisa"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#33a02c"</span>,</span>
<span id="cb1-243">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"exercito"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#b15928"</span>,</span>
<span id="cb1-244">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"feriado"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#fb9a99"</span>,</span>
<span id="cb1-245">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"religioso"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#e41a1c"</span>,</span>
<span id="cb1-246">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"nome_cidade"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#1f77b4"</span>,</span>
<span id="cb1-247">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"personalidade"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#ff7f00"</span>,</span>
<span id="cb1-248">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"politico"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#a6cee3"</span>,</span>
<span id="cb1-249">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"profissao"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#984ea3"</span>,</span>
<span id="cb1-250">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sem_nome"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#e78ac3"</span></span>
<span id="cb1-251">  )</span>
<span id="cb1-252"></span>
<span id="cb1-253">bg_color <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#F5F5F5"</span></span>
<span id="cb1-254"></span>
<span id="cb1-255">p1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-256">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_sf</span>(</span>
<span id="cb1-257">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(s1, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(class)),</span>
<span id="cb1-258">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> class),</span>
<span id="cb1-259">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>,</span>
<span id="cb1-260">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">key_glyph =</span> draw_key_rect</span>
<span id="cb1-261">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-262">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_sf</span>(</span>
<span id="cb1-263">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(s2, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(class)),</span>
<span id="cb1-264">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> class),</span>
<span id="cb1-265">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">key_glyph =</span> draw_key_rect,</span>
<span id="cb1-266">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.35</span></span>
<span id="cb1-267">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-268">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_sf</span>(</span>
<span id="cb1-269">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(s3, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(class)),</span>
<span id="cb1-270">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> class),</span>
<span id="cb1-271">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">key_glyph =</span> draw_key_rect,</span>
<span id="cb1-272">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.15</span></span>
<span id="cb1-273">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-274">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_sf</span>(</span>
<span id="cb1-275">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylim =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">30.124</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">29.9691</span>),</span>
<span id="cb1-276">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlim =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">51.265</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">51.135</span>)</span>
<span id="cb1-277">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-278">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_colour_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unname</span>(cores)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-279">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(</span>
<span id="cb1-280">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"**Origem do Nome de Ruas em Porto Alegre**"</span>,</span>
<span id="cb1-281">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">caption =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fonte: OSM. Cores: ColorBrewer. Autor: @viniciusoike"</span></span>
<span id="cb1-282">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-283">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_void</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-284">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb1-285">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_rect</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> bg_color, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> bg_color),</span>
<span id="cb1-286">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_rect</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> bg_color, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> bg_color),</span>
<span id="cb1-287">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Plot Margin</span></span>
<span id="cb1-288">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.margin =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">margin</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">t =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">l =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">b =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">unit =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cm"</span>),</span>
<span id="cb1-289">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Textual elements</span></span>
<span id="cb1-290">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gill Sans"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>),</span>
<span id="cb1-291">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_markdown</span>(</span>
<span id="cb1-292">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gill Sans"</span>,</span>
<span id="cb1-293">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>,</span>
<span id="cb1-294">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span></span>
<span id="cb1-295">    ),</span>
<span id="cb1-296">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.border =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_rect</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray20"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"transparent"</span>),</span>
<span id="cb1-297">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Legend </span></span>
<span id="cb1-298">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.16</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>),</span>
<span id="cb1-299">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#legend.position = "right",</span></span>
<span id="cb1-300">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb1-301">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_rect</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> bg_color, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> bg_color),</span>
<span id="cb1-302">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.box.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_rect</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> bg_color, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> bg_color),</span>
<span id="cb1-303">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>),</span>
<span id="cb1-304">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.margin =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">margin</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">t =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">b =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">unit =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cm"</span>)</span>
<span id="cb1-305">  )</span></code></pre></div>
</details>
</div>


</section>
</section>

 ]]></description>
  <category>mapas</category>
  <category>ggplot2</category>
  <category>weekly-viz</category>
  <category>data-visualization</category>
  <guid>https:://www.restateinsight.com/posts/general-posts/2023-09-ruas-porto-alegre/index.html</guid>
  <pubDate>Wed, 06 Sep 2023 03:00:00 GMT</pubDate>
</item>
<item>
  <title>Mapa de altitude de ruas de Brasília</title>
  <dc:creator>Vinicius Oike</dc:creator>
  <link>https:://www.restateinsight.com/posts/general-posts/2023-09-brasilia/index 2.html</link>
  <description><![CDATA[ 




<p>Inspirado num antigo post de <a href="https://www.blakerobertmills.com/my-work/visualizations">BlakeRMills</a>, criador do pacote <a href="https://github.com/BlakeRMills/MetBrewer">{MetBrewer}</a>, criei um mapa com a altitude das ruas em Brasília.</p>
<p>Em breve farei um post com tutorial detalhado e também pretendo replicar este tipo de mapa para outras cidades interessantes. O código para replicar o gráfico está abaixo.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(sf)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(osmdata)</span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(purrr)</span>
<span id="cb1-6">sf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sf_use_s2</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb1-7">sysfonts<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">font_add_google</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Roboto Condensed"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Roboto Condensed"</span>)</span>
<span id="cb1-8">showtext<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">showtext_auto</span>()</span>
<span id="cb1-9"></span>
<span id="cb1-10">url <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://pt.wikipedia.org/wiki/Lista_de_municípios_do_Brasil_por_população"</span></span>
<span id="cb1-11"></span>
<span id="cb1-12">tab <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> xml2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_html</span>(url) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb1-13">  rvest<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">html_table</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb1-14">  purrr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pluck</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb1-15"></span>
<span id="cb1-16">as_numeric_char <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Vectorize</span>(<span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) {</span>
<span id="cb1-17">  ls <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> stringr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_extract_all</span>(x, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"[[:digit:]]"</span>)</span>
<span id="cb1-18">  y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(ls[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">collapse =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span>
<span id="cb1-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(y)</span>
<span id="cb1-20">})</span>
<span id="cb1-21"></span>
<span id="cb1-22">clean_tab <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> tab <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb1-23">  janitor<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">clean_names</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb1-24">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename</span>(</span>
<span id="cb1-25">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">code_muni =</span> codigo_ibge,</span>
<span id="cb1-26">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name_muni =</span> municipio,</span>
<span id="cb1-27">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rank =</span> posicao,</span>
<span id="cb1-28">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name_state =</span> unidade_federativa,</span>
<span id="cb1-29">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pop =</span> populacao</span>
<span id="cb1-30">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb1-31">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(name_muni <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Brasil"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb1-32">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb1-33">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">code_muni =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(code_muni),</span>
<span id="cb1-34">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pop =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as_numeric_char</span>(pop),</span>
<span id="cb1-35">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rank =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rank</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>pop)</span>
<span id="cb1-36">  )</span>
<span id="cb1-37"></span>
<span id="cb1-38">top20 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">slice_max</span>(clean_tab, pop, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)</span>
<span id="cb1-39"></span>
<span id="cb1-40">get_border <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(city) {</span>
<span id="cb1-41">  </span>
<span id="cb1-42">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Encontra o código do município</span></span>
<span id="cb1-43">  code_muni <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> top20 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb1-44">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(name_muni <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> city) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb1-45">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pull</span>(code_muni) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb1-46">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>()</span>
<span id="cb1-47">  </span>
<span id="cb1-48">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stopifnot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(code_muni) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb1-49">  </span>
<span id="cb1-50">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Baixa o shapefile do município</span></span>
<span id="cb1-51">  border <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> geobr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_municipality</span>(code_muni, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">showProgress =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb1-52">  </span>
<span id="cb1-53">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(border)</span>
<span id="cb1-54">}</span>
<span id="cb1-55"></span>
<span id="cb1-56">get_streets <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(city, border) {</span>
<span id="cb1-57">  </span>
<span id="cb1-58">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Encontra o nome da Unidade Federativa</span></span>
<span id="cb1-59">  nome_uf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> top20 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb1-60">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(name_muni <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> city) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb1-61">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pull</span>(name_state)</span>
<span id="cb1-62">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Monta o nome do local</span></span>
<span id="cb1-63">  name_place <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> stringr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_glue</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"{city}, {nome_uf}, Brazil"</span>)</span>
<span id="cb1-64">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Monta a query</span></span>
<span id="cb1-65">  place <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">opq</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bbox =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getbb</span>(name_place))</span>
<span id="cb1-66">  </span>
<span id="cb1-67">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Importa todas as principais vias da cidade</span></span>
<span id="cb1-68">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># streets = add_osm_feature(</span></span>
<span id="cb1-69">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   place,</span></span>
<span id="cb1-70">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   key = "highway",</span></span>
<span id="cb1-71">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   value = c(</span></span>
<span id="cb1-72">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     "motorway", "primary", "motorway_link", "primary_link",</span></span>
<span id="cb1-73">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     "secondary", "tertiary", "secondary_link", "tertiary_link",</span></span>
<span id="cb1-74">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     "residential"</span></span>
<span id="cb1-75">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     )</span></span>
<span id="cb1-76">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># )</span></span>
<span id="cb1-77">  </span>
<span id="cb1-78">  streets <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_osm_feature</span>(place, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">key =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"highway"</span>)</span>
<span id="cb1-79">  </span>
<span id="cb1-80">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Converte o dado</span></span>
<span id="cb1-81">  streets <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> streets <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb1-82">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">osmdata_sf</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb1-83">    .<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>osm_lines <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb1-84">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(osm_id, name) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb1-85">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_transform</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">crs =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4674</span>)</span>
<span id="cb1-86">  </span>
<span id="cb1-87">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Enconrtra a intersecção entre as estradas e o limites do município</span></span>
<span id="cb1-88">  streets_border <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_intersection</span>(streets, border)</span>
<span id="cb1-89">  </span>
<span id="cb1-90">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># out = list(streets = streets, streets_border = streets_border)</span></span>
<span id="cb1-91">  </span>
<span id="cb1-92">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(streets_border)</span>
<span id="cb1-93">  </span>
<span id="cb1-94">}</span>
<span id="cb1-95"></span>
<span id="cb1-96">get_elevation <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(border, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">z =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>) {</span>
<span id="cb1-97">  </span>
<span id="cb1-98">  altitude <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> elevatr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_elev_raster</span>(border, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">z =</span> z, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">clip =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bbox"</span>)</span>
<span id="cb1-99">  altitude <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> raster<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rasterToPolygons</span>(altitude)</span>
<span id="cb1-100">  altitude <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_as_sf</span>(altitude)</span>
<span id="cb1-101">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(altitude)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"elevation"</span></span>
<span id="cb1-102">  </span>
<span id="cb1-103">  altitude <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_transform</span>(altitude, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">crs =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4674</span>)</span>
<span id="cb1-104">  altitude <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">suppressWarnings</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_intersection</span>(altitude, border))</span>
<span id="cb1-105">  altitude <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(altitude, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_is_valid</span>(altitude))</span>
<span id="cb1-106">  </span>
<span id="cb1-107">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(altitude)</span>
<span id="cb1-108">  </span>
<span id="cb1-109">}</span>
<span id="cb1-110"></span>
<span id="cb1-111">add_jenks_breaks <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(shp, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">k =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">round =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) {</span>
<span id="cb1-112">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Classifica os dados de altitude em k grupos segundo o algo. de Jenks</span></span>
<span id="cb1-113">  jbreaks <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> BAMMtools<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getJenksBreaks</span>(shp<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>elevation, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">k =</span> k)</span>
<span id="cb1-114">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Arredonda os números para chegar numa legenda menos quebrada</span></span>
<span id="cb1-115">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (round) {</span>
<span id="cb1-116">    jbreaks <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(jbreaks, r)</span>
<span id="cb1-117">  }</span>
<span id="cb1-118">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Cria a coluna 'jenks_group' que classifica cada valor num grupo</span></span>
<span id="cb1-119">  shp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(shp, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">jenks_group =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cut</span>(elevation, jbreaks))</span>
<span id="cb1-120">  </span>
<span id="cb1-121">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Verifica se todas as observações tem um grupo</span></span>
<span id="cb1-122">  check <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">any</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(shp<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>jenks_group))</span>
<span id="cb1-123">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (check) {</span>
<span id="cb1-124">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">warning</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Some observations have failed to be grouped"</span>)</span>
<span id="cb1-125">  }</span>
<span id="cb1-126">  </span>
<span id="cb1-127">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Transforma os groups em legendas</span></span>
<span id="cb1-128">  labels <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_jenks_labels</span>(jbreaks)</span>
<span id="cb1-129">  </span>
<span id="cb1-130">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Retorna o output numa lista</span></span>
<span id="cb1-131">  out <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shp =</span> shp, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> labels)</span>
<span id="cb1-132">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(out)</span>
<span id="cb1-133">  </span>
<span id="cb1-134">}</span>
<span id="cb1-135"></span>
<span id="cb1-136">get_jenks_labels <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) {</span>
<span id="cb1-137">  labels <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(x, x[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"–"</span>)</span>
<span id="cb1-138">  labels[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;"</span>, x[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>])</span>
<span id="cb1-139">  labels[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(labels)] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&gt;"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(x))</span>
<span id="cb1-140">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(labels)</span>
<span id="cb1-141">}</span>
<span id="cb1-142"></span>
<span id="cb1-143">get_streets_altitude <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(altitude, streets) {</span>
<span id="cb1-144">  </span>
<span id="cb1-145">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stopifnot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">any</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(altitude) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"jenks_group"</span>))</span>
<span id="cb1-146">  </span>
<span id="cb1-147">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Get all groups</span></span>
<span id="cb1-148">  groups <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">levels</span>(altitude<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>jenks_group)</span>
<span id="cb1-149">  </span>
<span id="cb1-150">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; For each group get the full polygon and join with streets</span></span>
<span id="cb1-151">  join_streets <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(group) {</span>
<span id="cb1-152">    </span>
<span id="cb1-153">    poly <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> altitude <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb1-154">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(jenks_group <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> group) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb1-155">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_union</span>(.) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb1-156">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_as_sf</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb1-157">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_make_valid</span>()</span>
<span id="cb1-158">    </span>
<span id="cb1-159">    joined <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">suppressWarnings</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_intersection</span>(streets, poly))</span>
<span id="cb1-160">    </span>
<span id="cb1-161">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(joined)</span>
<span id="cb1-162">    </span>
<span id="cb1-163">  }</span>
<span id="cb1-164">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Apply the function to all groups</span></span>
<span id="cb1-165">  street_levels <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> purrr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(groups, join_streets)</span>
<span id="cb1-166">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Bind all results together</span></span>
<span id="cb1-167">  out <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>(street_levels, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.id =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"level"</span>)</span>
<span id="cb1-168">  </span>
<span id="cb1-169">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(out)</span>
<span id="cb1-170">  </span>
<span id="cb1-171">}</span>
<span id="cb1-172"></span>
<span id="cb1-173">map_plot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(shp, labels, title, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">showtext =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) {</span>
<span id="cb1-174">  </span>
<span id="cb1-175">  colors <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> viridis<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plasma</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(labels) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb1-176">  colors <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> colors[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(colors)]</span>
<span id="cb1-177">  </span>
<span id="cb1-178">  font <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(showtext <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Roboto Condensed"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sans"</span>)</span>
<span id="cb1-179">  </span>
<span id="cb1-180">  plot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span></span>
<span id="cb1-181">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> shp) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-182">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_sf</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> level, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> level), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-183">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_manual</span>(</span>
<span id="cb1-184">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Altitude"</span>,</span>
<span id="cb1-185">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> labels,</span>
<span id="cb1-186">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> colors) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-187">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_manual</span>(</span>
<span id="cb1-188">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Altitude"</span>,</span>
<span id="cb1-189">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> labels,</span>
<span id="cb1-190">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> colors) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-191">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guides</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guide_legend</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guide_legend</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-192">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggtitle</span>(title) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-193">    ggthemes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_map</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-194">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_sf</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-195">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb1-196">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(</span>
<span id="cb1-197">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>,</span>
<span id="cb1-198">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,</span>
<span id="cb1-199">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> font</span>
<span id="cb1-200">      ),</span>
<span id="cb1-201">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(</span>
<span id="cb1-202">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>,</span>
<span id="cb1-203">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> font,</span>
<span id="cb1-204">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray10"</span></span>
<span id="cb1-205">      ),</span>
<span id="cb1-206">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(</span>
<span id="cb1-207">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>,</span>
<span id="cb1-208">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> font,</span>
<span id="cb1-209">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray10"</span></span>
<span id="cb1-210">      ),</span>
<span id="cb1-211">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"top"</span>,</span>
<span id="cb1-212">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.direction =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"horizontal"</span>,</span>
<span id="cb1-213">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_rect</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#f6eee3"</span>),</span>
<span id="cb1-214">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_rect</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#f6eee3"</span>),</span>
<span id="cb1-215">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_rect</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#f6eee3"</span>)</span>
<span id="cb1-216">    )</span>
<span id="cb1-217">  </span>
<span id="cb1-218">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(plot)</span>
<span id="cb1-219">  </span>
<span id="cb1-220">}</span>
<span id="cb1-221"></span>
<span id="cb1-222">map_altitude <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(city, k, z) {</span>
<span id="cb1-223">  </span>
<span id="cb1-224">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Importa o shape do limite do município</span></span>
<span id="cb1-225">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">message</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Importando os limites do município: "</span>, city)</span>
<span id="cb1-226">  city_border <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_border</span>(city)</span>
<span id="cb1-227">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Importa as principais vias da cidade e junta com o limite do muni</span></span>
<span id="cb1-228">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">message</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Importando as vias."</span>)</span>
<span id="cb1-229">  city_street <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_streets</span>(city, city_border)</span>
<span id="cb1-230">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Importa a altitude da cidade</span></span>
<span id="cb1-231">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">message</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Importando a altitude."</span>)</span>
<span id="cb1-232">  city_elevation <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">suppressMessages</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_elevation</span>(city_border, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">z =</span> z))</span>
<span id="cb1-233">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Classifica a altitude em grupos</span></span>
<span id="cb1-234">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">message</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Classificando e juntando os shapefiles."</span>)</span>
<span id="cb1-235">  jenks <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_jenks_breaks</span>(city_elevation, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">k =</span> k)</span>
<span id="cb1-236">  city_elevation <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> jenks[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"shp"</span>]]</span>
<span id="cb1-237">  labels <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> jenks[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"labels"</span>]]</span>
<span id="cb1-238">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Junta a altitude (agrupada) com as vias</span></span>
<span id="cb1-239">  city_street_elevation <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_streets_altitude</span>(city_elevation, city_street)</span>
<span id="cb1-240">  </span>
<span id="cb1-241">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Monta o mapa final</span></span>
<span id="cb1-242">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">message</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gerando o mapa final."</span>)</span>
<span id="cb1-243">  plot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map_plot</span>(city_street_elevation, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> labels, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> city)</span>
<span id="cb1-244">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">message</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Feito."</span>)</span>
<span id="cb1-245">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Retorna o output numa lista</span></span>
<span id="cb1-246">  out <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb1-247">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shp =</span> city_street_elevation,</span>
<span id="cb1-248">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">streets =</span> city_street,</span>
<span id="cb1-249">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">elevation =</span> city_elevation,</span>
<span id="cb1-250">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot =</span> plot</span>
<span id="cb1-251">  )</span>
<span id="cb1-252">  </span>
<span id="cb1-253">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(out)</span>
<span id="cb1-254">  </span>
<span id="cb1-255">}</span>
<span id="cb1-256"></span>
<span id="cb1-257">export_citymap <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(city, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">w =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">h =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, ...) {</span>
<span id="cb1-258">  </span>
<span id="cb1-259">  plot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map_altitude</span>(city, ...)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>plot</span>
<span id="cb1-260">  </span>
<span id="cb1-261">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.numeric</span>(city)) {</span>
<span id="cb1-262">    name_city <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> cities_brasil <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb1-263">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(code_muni <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> city) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb1-264">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pull</span>(name_muni)</span>
<span id="cb1-265">  } <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.character</span>(city)) {</span>
<span id="cb1-266">    name_city <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> city</span>
<span id="cb1-267">  }</span>
<span id="cb1-268">  </span>
<span id="cb1-269">  name_file <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> glue<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glue</span>(</span>
<span id="cb1-270">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"elevation_{janitor::make_clean_names(name_city)}.svg"</span></span>
<span id="cb1-271">  )</span>
<span id="cb1-272">  </span>
<span id="cb1-273">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggsave</span>(</span>
<span id="cb1-274">    here<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">here</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"graphics/altitude"</span>, name_file),</span>
<span id="cb1-275">    plot,</span>
<span id="cb1-276">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> w,</span>
<span id="cb1-277">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">height =</span> h</span>
<span id="cb1-278">  )</span>
<span id="cb1-279">  </span>
<span id="cb1-280">  name_file <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> glue<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glue</span>(</span>
<span id="cb1-281">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"elevation_{janitor::make_clean_names(name_city)}.png"</span></span>
<span id="cb1-282">  )</span>
<span id="cb1-283">  </span>
<span id="cb1-284">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggsave</span>(</span>
<span id="cb1-285">    here<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">here</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"graphics/altitude"</span>, name_file),</span>
<span id="cb1-286">    plot,</span>
<span id="cb1-287">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> w,</span>
<span id="cb1-288">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">height =</span> h</span>
<span id="cb1-289">  )</span>
<span id="cb1-290">}</span>
<span id="cb1-291"></span>
<span id="cb1-292">safe_export <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> purrr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">safely</span>(export_citymap)</span>
<span id="cb1-293"></span>
<span id="cb1-294">params <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tribble</span>(</span>
<span id="cb1-295">  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>city,       <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>z, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>k,</span>
<span id="cb1-296">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#----------------#---#---#</span></span>
<span id="cb1-297">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"São Paulo"</span>,       <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>,  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,</span>
<span id="cb1-298">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rio de Janeiro"</span>,  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>,  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,</span>
<span id="cb1-299">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Brasília"</span>,        <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>,  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,</span>
<span id="cb1-300">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fortaleza"</span>,      <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>,  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,</span>
<span id="cb1-301">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Salvador"</span>,       <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,</span>
<span id="cb1-302">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Belo Horizonte"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,</span>
<span id="cb1-303">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Manaus"</span>,          <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>,  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,</span>
<span id="cb1-304">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Curitiba"</span>,       <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,</span>
<span id="cb1-305">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Recife"</span>,         <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,</span>
<span id="cb1-306">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Goiânia"</span>,         <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>,  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,</span>
<span id="cb1-307">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Porto Alegre"</span>,    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>,  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,</span>
<span id="cb1-308">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Belém"</span>,           <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>,  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,</span>
<span id="cb1-309">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Guarulhos"</span>,       <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>,  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,</span>
<span id="cb1-310">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Campinas"</span>,        <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>,  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,</span>
<span id="cb1-311">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"São Luís"</span>,        <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>,  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,</span>
<span id="cb1-312">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Maceió"</span>,         <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>,  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>,</span>
<span id="cb1-313">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Campo Grande"</span>,    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,</span>
<span id="cb1-314">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"São Gonçalo"</span>,     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>,  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,</span>
<span id="cb1-315">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Teresina"</span>,        <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,</span>
<span id="cb1-316">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"João Pessoa"</span>,     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>,  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,</span>
<span id="cb1-317">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Joinville"</span>,       <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>,  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span></span>
<span id="cb1-318">  )</span>
<span id="cb1-319"></span>
<span id="cb1-320"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Exportar todas as cidades listadas acima</span></span>
<span id="cb1-321"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#pmap(params, safe_export)</span></span>
<span id="cb1-322"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Exportar uma cidade em particular</span></span>
<span id="cb1-323"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#safe_export("Brasília", z = 8, k = 7)</span></span></code></pre></div>
</details>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/2023-09-brasilia/images/elevation_brasilia.svg" class="img-fluid figure-img"></p>
</figure>
</div>



 ]]></description>
  <category>data-visualization</category>
  <category>mapas</category>
  <guid>https:://www.restateinsight.com/posts/general-posts/2023-09-brasilia/index 2.html</guid>
  <pubDate>Sun, 03 Sep 2023 03:00:00 GMT</pubDate>
</item>
<item>
  <title>Mapa de altitude de ruas de Brasília</title>
  <dc:creator>Vinicius Oike</dc:creator>
  <link>https:://www.restateinsight.com/posts/general-posts/2023-09-brasilia/index.html</link>
  <description><![CDATA[ 




<p>Inspirado num antigo post de <a href="https://www.blakerobertmills.com/my-work/visualizations">BlakeRMills</a>, criador do pacote <a href="https://github.com/BlakeRMills/MetBrewer">{MetBrewer}</a>, criei um mapa com a altitude das ruas em Brasília.</p>
<p>Em breve farei um post com tutorial detalhado e também pretendo replicar este tipo de mapa para outras cidades interessantes. O código para replicar o gráfico está abaixo.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(sf)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(osmdata)</span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(purrr)</span>
<span id="cb1-6">sf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sf_use_s2</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb1-7">sysfonts<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">font_add_google</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Roboto Condensed"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Roboto Condensed"</span>)</span>
<span id="cb1-8">showtext<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">showtext_auto</span>()</span>
<span id="cb1-9"></span>
<span id="cb1-10">url <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://pt.wikipedia.org/wiki/Lista_de_municípios_do_Brasil_por_população"</span></span>
<span id="cb1-11"></span>
<span id="cb1-12">tab <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> xml2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_html</span>(url) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb1-13">  rvest<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">html_table</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb1-14">  purrr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pluck</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb1-15"></span>
<span id="cb1-16">as_numeric_char <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Vectorize</span>(<span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) {</span>
<span id="cb1-17">  ls <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> stringr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_extract_all</span>(x, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"[[:digit:]]"</span>)</span>
<span id="cb1-18">  y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(ls[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">collapse =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span>
<span id="cb1-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(y)</span>
<span id="cb1-20">})</span>
<span id="cb1-21"></span>
<span id="cb1-22">clean_tab <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> tab <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb1-23">  janitor<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">clean_names</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb1-24">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename</span>(</span>
<span id="cb1-25">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">code_muni =</span> codigo_ibge,</span>
<span id="cb1-26">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name_muni =</span> municipio,</span>
<span id="cb1-27">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rank =</span> posicao,</span>
<span id="cb1-28">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name_state =</span> unidade_federativa,</span>
<span id="cb1-29">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pop =</span> populacao</span>
<span id="cb1-30">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb1-31">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(name_muni <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Brasil"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb1-32">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb1-33">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">code_muni =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(code_muni),</span>
<span id="cb1-34">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pop =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as_numeric_char</span>(pop),</span>
<span id="cb1-35">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rank =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rank</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>pop)</span>
<span id="cb1-36">  )</span>
<span id="cb1-37"></span>
<span id="cb1-38">top20 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">slice_max</span>(clean_tab, pop, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)</span>
<span id="cb1-39"></span>
<span id="cb1-40">get_border <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(city) {</span>
<span id="cb1-41">  </span>
<span id="cb1-42">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Encontra o código do município</span></span>
<span id="cb1-43">  code_muni <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> top20 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb1-44">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(name_muni <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> city) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb1-45">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pull</span>(code_muni) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb1-46">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>()</span>
<span id="cb1-47">  </span>
<span id="cb1-48">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stopifnot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(code_muni) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb1-49">  </span>
<span id="cb1-50">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Baixa o shapefile do município</span></span>
<span id="cb1-51">  border <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> geobr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_municipality</span>(code_muni, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">showProgress =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb1-52">  </span>
<span id="cb1-53">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(border)</span>
<span id="cb1-54">}</span>
<span id="cb1-55"></span>
<span id="cb1-56">get_streets <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(city, border) {</span>
<span id="cb1-57">  </span>
<span id="cb1-58">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Encontra o nome da Unidade Federativa</span></span>
<span id="cb1-59">  nome_uf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> top20 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb1-60">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(name_muni <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> city) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb1-61">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pull</span>(name_state)</span>
<span id="cb1-62">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Monta o nome do local</span></span>
<span id="cb1-63">  name_place <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> stringr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_glue</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"{city}, {nome_uf}, Brazil"</span>)</span>
<span id="cb1-64">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Monta a query</span></span>
<span id="cb1-65">  place <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">opq</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bbox =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getbb</span>(name_place))</span>
<span id="cb1-66">  </span>
<span id="cb1-67">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Importa todas as principais vias da cidade</span></span>
<span id="cb1-68">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># streets = add_osm_feature(</span></span>
<span id="cb1-69">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   place,</span></span>
<span id="cb1-70">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   key = "highway",</span></span>
<span id="cb1-71">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   value = c(</span></span>
<span id="cb1-72">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     "motorway", "primary", "motorway_link", "primary_link",</span></span>
<span id="cb1-73">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     "secondary", "tertiary", "secondary_link", "tertiary_link",</span></span>
<span id="cb1-74">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     "residential"</span></span>
<span id="cb1-75">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     )</span></span>
<span id="cb1-76">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># )</span></span>
<span id="cb1-77">  </span>
<span id="cb1-78">  streets <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_osm_feature</span>(place, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">key =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"highway"</span>)</span>
<span id="cb1-79">  </span>
<span id="cb1-80">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Converte o dado</span></span>
<span id="cb1-81">  streets <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> streets <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb1-82">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">osmdata_sf</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb1-83">    .<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>osm_lines <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb1-84">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(osm_id, name) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb1-85">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_transform</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">crs =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4674</span>)</span>
<span id="cb1-86">  </span>
<span id="cb1-87">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Enconrtra a intersecção entre as estradas e o limites do município</span></span>
<span id="cb1-88">  streets_border <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_intersection</span>(streets, border)</span>
<span id="cb1-89">  </span>
<span id="cb1-90">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># out = list(streets = streets, streets_border = streets_border)</span></span>
<span id="cb1-91">  </span>
<span id="cb1-92">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(streets_border)</span>
<span id="cb1-93">  </span>
<span id="cb1-94">}</span>
<span id="cb1-95"></span>
<span id="cb1-96">get_elevation <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(border, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">z =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>) {</span>
<span id="cb1-97">  </span>
<span id="cb1-98">  altitude <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> elevatr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_elev_raster</span>(border, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">z =</span> z, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">clip =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bbox"</span>)</span>
<span id="cb1-99">  altitude <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> raster<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rasterToPolygons</span>(altitude)</span>
<span id="cb1-100">  altitude <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_as_sf</span>(altitude)</span>
<span id="cb1-101">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(altitude)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"elevation"</span></span>
<span id="cb1-102">  </span>
<span id="cb1-103">  altitude <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_transform</span>(altitude, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">crs =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4674</span>)</span>
<span id="cb1-104">  altitude <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">suppressWarnings</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_intersection</span>(altitude, border))</span>
<span id="cb1-105">  altitude <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(altitude, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_is_valid</span>(altitude))</span>
<span id="cb1-106">  </span>
<span id="cb1-107">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(altitude)</span>
<span id="cb1-108">  </span>
<span id="cb1-109">}</span>
<span id="cb1-110"></span>
<span id="cb1-111">add_jenks_breaks <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(shp, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">k =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">round =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) {</span>
<span id="cb1-112">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Classifica os dados de altitude em k grupos segundo o algo. de Jenks</span></span>
<span id="cb1-113">  jbreaks <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> BAMMtools<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getJenksBreaks</span>(shp<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>elevation, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">k =</span> k)</span>
<span id="cb1-114">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Arredonda os números para chegar numa legenda menos quebrada</span></span>
<span id="cb1-115">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (round) {</span>
<span id="cb1-116">    jbreaks <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(jbreaks, r)</span>
<span id="cb1-117">  }</span>
<span id="cb1-118">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Cria a coluna 'jenks_group' que classifica cada valor num grupo</span></span>
<span id="cb1-119">  shp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(shp, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">jenks_group =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cut</span>(elevation, jbreaks))</span>
<span id="cb1-120">  </span>
<span id="cb1-121">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Verifica se todas as observações tem um grupo</span></span>
<span id="cb1-122">  check <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">any</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(shp<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>jenks_group))</span>
<span id="cb1-123">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (check) {</span>
<span id="cb1-124">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">warning</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Some observations have failed to be grouped"</span>)</span>
<span id="cb1-125">  }</span>
<span id="cb1-126">  </span>
<span id="cb1-127">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Transforma os groups em legendas</span></span>
<span id="cb1-128">  labels <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_jenks_labels</span>(jbreaks)</span>
<span id="cb1-129">  </span>
<span id="cb1-130">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Retorna o output numa lista</span></span>
<span id="cb1-131">  out <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shp =</span> shp, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> labels)</span>
<span id="cb1-132">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(out)</span>
<span id="cb1-133">  </span>
<span id="cb1-134">}</span>
<span id="cb1-135"></span>
<span id="cb1-136">get_jenks_labels <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) {</span>
<span id="cb1-137">  labels <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(x, x[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"–"</span>)</span>
<span id="cb1-138">  labels[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;"</span>, x[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>])</span>
<span id="cb1-139">  labels[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(labels)] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&gt;"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(x))</span>
<span id="cb1-140">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(labels)</span>
<span id="cb1-141">}</span>
<span id="cb1-142"></span>
<span id="cb1-143">get_streets_altitude <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(altitude, streets) {</span>
<span id="cb1-144">  </span>
<span id="cb1-145">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stopifnot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">any</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(altitude) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"jenks_group"</span>))</span>
<span id="cb1-146">  </span>
<span id="cb1-147">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Get all groups</span></span>
<span id="cb1-148">  groups <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">levels</span>(altitude<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>jenks_group)</span>
<span id="cb1-149">  </span>
<span id="cb1-150">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; For each group get the full polygon and join with streets</span></span>
<span id="cb1-151">  join_streets <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(group) {</span>
<span id="cb1-152">    </span>
<span id="cb1-153">    poly <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> altitude <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb1-154">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(jenks_group <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> group) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb1-155">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_union</span>(.) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb1-156">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_as_sf</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb1-157">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_make_valid</span>()</span>
<span id="cb1-158">    </span>
<span id="cb1-159">    joined <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">suppressWarnings</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_intersection</span>(streets, poly))</span>
<span id="cb1-160">    </span>
<span id="cb1-161">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(joined)</span>
<span id="cb1-162">    </span>
<span id="cb1-163">  }</span>
<span id="cb1-164">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Apply the function to all groups</span></span>
<span id="cb1-165">  street_levels <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> purrr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(groups, join_streets)</span>
<span id="cb1-166">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Bind all results together</span></span>
<span id="cb1-167">  out <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>(street_levels, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.id =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"level"</span>)</span>
<span id="cb1-168">  </span>
<span id="cb1-169">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(out)</span>
<span id="cb1-170">  </span>
<span id="cb1-171">}</span>
<span id="cb1-172"></span>
<span id="cb1-173">map_plot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(shp, labels, title, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">showtext =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) {</span>
<span id="cb1-174">  </span>
<span id="cb1-175">  colors <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> viridis<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plasma</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(labels) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb1-176">  colors <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> colors[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(colors)]</span>
<span id="cb1-177">  </span>
<span id="cb1-178">  font <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(showtext <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Roboto Condensed"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sans"</span>)</span>
<span id="cb1-179">  </span>
<span id="cb1-180">  plot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span></span>
<span id="cb1-181">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> shp) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-182">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_sf</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> level, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> level), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-183">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_manual</span>(</span>
<span id="cb1-184">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Altitude"</span>,</span>
<span id="cb1-185">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> labels,</span>
<span id="cb1-186">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> colors) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-187">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_manual</span>(</span>
<span id="cb1-188">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Altitude"</span>,</span>
<span id="cb1-189">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> labels,</span>
<span id="cb1-190">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> colors) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-191">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guides</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guide_legend</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guide_legend</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-192">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggtitle</span>(title) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-193">    ggthemes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_map</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-194">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_sf</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-195">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb1-196">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(</span>
<span id="cb1-197">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>,</span>
<span id="cb1-198">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,</span>
<span id="cb1-199">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> font</span>
<span id="cb1-200">      ),</span>
<span id="cb1-201">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(</span>
<span id="cb1-202">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>,</span>
<span id="cb1-203">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> font,</span>
<span id="cb1-204">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray10"</span></span>
<span id="cb1-205">      ),</span>
<span id="cb1-206">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(</span>
<span id="cb1-207">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>,</span>
<span id="cb1-208">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> font,</span>
<span id="cb1-209">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray10"</span></span>
<span id="cb1-210">      ),</span>
<span id="cb1-211">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"top"</span>,</span>
<span id="cb1-212">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.direction =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"horizontal"</span>,</span>
<span id="cb1-213">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_rect</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#f6eee3"</span>),</span>
<span id="cb1-214">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_rect</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#f6eee3"</span>),</span>
<span id="cb1-215">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_rect</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#f6eee3"</span>)</span>
<span id="cb1-216">    )</span>
<span id="cb1-217">  </span>
<span id="cb1-218">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(plot)</span>
<span id="cb1-219">  </span>
<span id="cb1-220">}</span>
<span id="cb1-221"></span>
<span id="cb1-222">map_altitude <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(city, k, z) {</span>
<span id="cb1-223">  </span>
<span id="cb1-224">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Importa o shape do limite do município</span></span>
<span id="cb1-225">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">message</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Importando os limites do município: "</span>, city)</span>
<span id="cb1-226">  city_border <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_border</span>(city)</span>
<span id="cb1-227">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Importa as principais vias da cidade e junta com o limite do muni</span></span>
<span id="cb1-228">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">message</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Importando as vias."</span>)</span>
<span id="cb1-229">  city_street <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_streets</span>(city, city_border)</span>
<span id="cb1-230">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Importa a altitude da cidade</span></span>
<span id="cb1-231">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">message</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Importando a altitude."</span>)</span>
<span id="cb1-232">  city_elevation <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">suppressMessages</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_elevation</span>(city_border, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">z =</span> z))</span>
<span id="cb1-233">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Classifica a altitude em grupos</span></span>
<span id="cb1-234">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">message</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Classificando e juntando os shapefiles."</span>)</span>
<span id="cb1-235">  jenks <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_jenks_breaks</span>(city_elevation, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">k =</span> k)</span>
<span id="cb1-236">  city_elevation <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> jenks[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"shp"</span>]]</span>
<span id="cb1-237">  labels <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> jenks[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"labels"</span>]]</span>
<span id="cb1-238">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Junta a altitude (agrupada) com as vias</span></span>
<span id="cb1-239">  city_street_elevation <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_streets_altitude</span>(city_elevation, city_street)</span>
<span id="cb1-240">  </span>
<span id="cb1-241">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Monta o mapa final</span></span>
<span id="cb1-242">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">message</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gerando o mapa final."</span>)</span>
<span id="cb1-243">  plot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map_plot</span>(city_street_elevation, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> labels, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> city)</span>
<span id="cb1-244">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">message</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Feito."</span>)</span>
<span id="cb1-245">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Retorna o output numa lista</span></span>
<span id="cb1-246">  out <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb1-247">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shp =</span> city_street_elevation,</span>
<span id="cb1-248">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">streets =</span> city_street,</span>
<span id="cb1-249">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">elevation =</span> city_elevation,</span>
<span id="cb1-250">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot =</span> plot</span>
<span id="cb1-251">  )</span>
<span id="cb1-252">  </span>
<span id="cb1-253">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(out)</span>
<span id="cb1-254">  </span>
<span id="cb1-255">}</span>
<span id="cb1-256"></span>
<span id="cb1-257">export_citymap <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(city, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">w =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">h =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, ...) {</span>
<span id="cb1-258">  </span>
<span id="cb1-259">  plot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map_altitude</span>(city, ...)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>plot</span>
<span id="cb1-260">  </span>
<span id="cb1-261">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.numeric</span>(city)) {</span>
<span id="cb1-262">    name_city <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> cities_brasil <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb1-263">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(code_muni <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> city) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb1-264">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pull</span>(name_muni)</span>
<span id="cb1-265">  } <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.character</span>(city)) {</span>
<span id="cb1-266">    name_city <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> city</span>
<span id="cb1-267">  }</span>
<span id="cb1-268">  </span>
<span id="cb1-269">  name_file <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> glue<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glue</span>(</span>
<span id="cb1-270">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"elevation_{janitor::make_clean_names(name_city)}.svg"</span></span>
<span id="cb1-271">  )</span>
<span id="cb1-272">  </span>
<span id="cb1-273">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggsave</span>(</span>
<span id="cb1-274">    here<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">here</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"graphics/altitude"</span>, name_file),</span>
<span id="cb1-275">    plot,</span>
<span id="cb1-276">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> w,</span>
<span id="cb1-277">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">height =</span> h</span>
<span id="cb1-278">  )</span>
<span id="cb1-279">  </span>
<span id="cb1-280">  name_file <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> glue<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glue</span>(</span>
<span id="cb1-281">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"elevation_{janitor::make_clean_names(name_city)}.png"</span></span>
<span id="cb1-282">  )</span>
<span id="cb1-283">  </span>
<span id="cb1-284">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggsave</span>(</span>
<span id="cb1-285">    here<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">here</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"graphics/altitude"</span>, name_file),</span>
<span id="cb1-286">    plot,</span>
<span id="cb1-287">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> w,</span>
<span id="cb1-288">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">height =</span> h</span>
<span id="cb1-289">  )</span>
<span id="cb1-290">}</span>
<span id="cb1-291"></span>
<span id="cb1-292">safe_export <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> purrr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">safely</span>(export_citymap)</span>
<span id="cb1-293"></span>
<span id="cb1-294">params <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tribble</span>(</span>
<span id="cb1-295">  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>city,       <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>z, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>k,</span>
<span id="cb1-296">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#----------------#---#---#</span></span>
<span id="cb1-297">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"São Paulo"</span>,       <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>,  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,</span>
<span id="cb1-298">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rio de Janeiro"</span>,  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>,  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,</span>
<span id="cb1-299">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Brasília"</span>,        <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>,  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,</span>
<span id="cb1-300">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fortaleza"</span>,      <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>,  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,</span>
<span id="cb1-301">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Salvador"</span>,       <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,</span>
<span id="cb1-302">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Belo Horizonte"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,</span>
<span id="cb1-303">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Manaus"</span>,          <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>,  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,</span>
<span id="cb1-304">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Curitiba"</span>,       <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,</span>
<span id="cb1-305">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Recife"</span>,         <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,</span>
<span id="cb1-306">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Goiânia"</span>,         <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>,  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,</span>
<span id="cb1-307">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Porto Alegre"</span>,    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>,  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,</span>
<span id="cb1-308">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Belém"</span>,           <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>,  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,</span>
<span id="cb1-309">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Guarulhos"</span>,       <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>,  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,</span>
<span id="cb1-310">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Campinas"</span>,        <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>,  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,</span>
<span id="cb1-311">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"São Luís"</span>,        <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>,  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,</span>
<span id="cb1-312">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Maceió"</span>,         <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>,  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>,</span>
<span id="cb1-313">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Campo Grande"</span>,    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,</span>
<span id="cb1-314">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"São Gonçalo"</span>,     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>,  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,</span>
<span id="cb1-315">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Teresina"</span>,        <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,</span>
<span id="cb1-316">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"João Pessoa"</span>,     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>,  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,</span>
<span id="cb1-317">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Joinville"</span>,       <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>,  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span></span>
<span id="cb1-318">  )</span>
<span id="cb1-319"></span>
<span id="cb1-320"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Exportar todas as cidades listadas acima</span></span>
<span id="cb1-321"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#pmap(params, safe_export)</span></span>
<span id="cb1-322"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Exportar uma cidade em particular</span></span>
<span id="cb1-323"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#safe_export("Brasília", z = 8, k = 7)</span></span></code></pre></div>
</details>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/2023-09-brasilia/images/elevation_brasilia.svg" class="img-fluid figure-img"></p>
</figure>
</div>



 ]]></description>
  <category>data-visualization</category>
  <category>mapas</category>
  <guid>https:://www.restateinsight.com/posts/general-posts/2023-09-brasilia/index.html</guid>
  <pubDate>Sun, 03 Sep 2023 03:00:00 GMT</pubDate>
</item>
<item>
  <title>Shiny Dashboard: IDH municípios</title>
  <dc:creator>Vinicius Oike</dc:creator>
  <link>https:://www.restateinsight.com/posts/general-posts/2023-08-firjan-app/index.html</link>
  <description><![CDATA[ 




<section id="dashboard-idh-firjan" class="level1">
<h1>Dashboard IDH-Firjan</h1>
<section id="introdução" class="level2">
<h2 class="anchored" data-anchor-id="introdução">Introdução</h2>
<p>Este ano decidi aprender <a href="https://shiny.posit.co">Shiny</a> para construir aplicativos de dados. Shiny é um pacote que facilita a criação de aplicativos e que permite combinar linguagens (como HTML, CSS, R). Como primeiro projeto, optei por fazer um dashboard simples, que mostrasse os dados de desenvolvimento humano dos municípios brasileiros.</p>
<p>A curva de aprendizado do Shiny é dura no início; o lado bom é acaba-se forçando a aprender o básico de HTML e CSS no processo de montar o aplicativo. Como o código, em R, se relaciona com o aplicativo também muda: tudo tem que ser planejado em termos de front-end e back-end. Organizei a estrutura do aplicativo quase como se fosse um pacote de R e também usei o <a href="https://rstudio.github.io/renv/articles/renv.html">renv</a> para garantir que tudo continue funcionando bem.</p>
<p>Não conheço material de referência em português, mas posso recomendar o livro Mastering Shiny de Hadley Wickham.</p>
<p>Links:</p>
<ul>
<li><p><a href="https://viniciusoike.shinyapps.io/shiny-firjan-ifdm/">Aplicativo</a></p></li>
<li><p><a href="https://github.com/viniciusoike/shiny-firjan-ifdm">Repositório</a></p></li>
</ul>
</section>
<section id="sobre-o-app" class="level2">
<h2 class="anchored" data-anchor-id="sobre-o-app">Sobre o app</h2>
<p>O app foi feito em Shiny, usando o pacote <a href="https://rinterface.github.io/shinydashboardPlus/">shinydashboardplus</a>, e todos os códigos estão no <a href="https://github.com/viniciusoike/shiny-firjan-ifdm">repositório</a> do Github.</p>
<p>Este aplicativo permite visualizar os dados do Índice Firjan de Desenvolvimento Municipal (IFDM) num dashboard. O IFDM tem metodologia similar ao popular Índice de Desenvolvimento Humano (IDH) da ONU; contudo, o IFDM abrange um número maior de variáveis. Além disso, o IFDM é calculado anualmente enqunto o IDH é calculado apenas uma vez a cada dez anos.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/static/images/firjan_dashboard.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>A interpretação do IFDM é bastante simples: quanto maior, melhor. O mapa interativo permite escolher uma cidade e compará-la com a realidade do seu estado. Também é possível fazer uma comparação regional ou nacional, alterando o campo ‘Comparação Geográfica’, mas note que isto pode levar algum tempo para carregar. A lista de cidades está ordenada pelo tamanho da população, então as principais cidades tem maior destaque.</p>
<p>O usuário pode escolher o tipo de mapa, paleta de cores e o número de grupos para produzir diferentes tipos de visualização. O dashboard contém um pequeno box com explicações sobre a metodologia do IFDM, a classificação dos dados, e sobre como utilizar o app.</p>
<p>Os quatro gráficos que aparecem abaixo do mapa ajudam a contextualizar a cidade.</p>
<p>Na primeira linha há dois gráficos estáticos: um painel de histogramas e uma espécie de gráfico de linha. Em ambos os casos, o objetivo é ajudar a contextualizar o município em relação à base de comparação. No caso acima, vê-se como São Paulo está entre os maiores IDHs do estado, mas que tem um escore relativamente ruim no critério de educação.</p>
<p><img src="https:://www.restateinsight.com/static/images/firjan_graficos_1.png" class="img-fluid"></p>
<p>A segunda linha mostra gráficos interativos, feitos com {plotly}. O gráfico da esquerda compara os números do município contra os valores médios do Brasil. Já o gráfico da esquerda mostra a evolução temporal de todas as variáveis do IFDM. Nesta comparação fica evidente o impacto da Crise de 2014-16.</p>
<p><img src="https:://www.restateinsight.com/static/images/firjan_graficos_2.png" class="img-fluid"></p>
</section>
<section id="alguns-exemplos-de-uso" class="level2">
<h2 class="anchored" data-anchor-id="alguns-exemplos-de-uso">Alguns exemplos de uso</h2>
<p>Um caso interessante que surgiu nos dados foi Porto Alegre. Em geral, a capital do estado, e a sua região metropolitana concentram cidades com os maiores níveis de desenvolvimento humano do seu respectivo estado. Isto não vale para a Região Metropolitana de Porto Alegre; as cidades com os melhores indicadores de desenvolvimento humano no RS estão concentrados na “Serra Gaúcha”, no entorno de Caxias do Sul e Bento Gonçalves.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/static/images/firjan_mapa_rs.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>Outro caso interessante é de Belo Horizonte e do estado de Minas Gerais como um todo. Em Minas Gerais há cidades com alto padrão de desenvolvimento como Uberlândia e Uberaba e cidade com baixíssimo desenvolvimento como Minas Novas e Santa Helena de Minas.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/static/images/firjan_mapa_mg.png" class="img-fluid figure-img"></p>
</figure>
</div>


</section>
</section>

 ]]></description>
  <category>shiny</category>
  <category>data-visualization</category>
  <category>brasil</category>
  <guid>https:://www.restateinsight.com/posts/general-posts/2023-08-firjan-app/index.html</guid>
  <pubDate>Fri, 25 Aug 2023 03:00:00 GMT</pubDate>
</item>
<item>
  <title>Weekly Viz: Recife em mapas</title>
  <dc:creator>Vinicius Oike</dc:creator>
  <link>https:://www.restateinsight.com/posts/general-posts/2023-08-recife/index.html</link>
  <description><![CDATA[ 




<section id="recife" class="level1">
<h1>Recife</h1>
<p>Semana que vem vou estar no Recife a trabalho e para conhecer um pouco da cidade resolvi tirar um tempo para fazer alguns mapas da cidade.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/static/maps/summary_recife.svg" class="img-fluid figure-img"></p>
</figure>
</div>
<section id="detalhes-do-mapa" class="level2">
<h2 class="anchored" data-anchor-id="detalhes-do-mapa">Detalhes do mapa</h2>
<p>Os dados dos dois primeiros mapas, das principais vias e dos corpos d’água, são do <a href="OpenStreetMap OpenStreetMap https://www.openstreetmap.org">OpenStreetMap</a>. Pode-se ver, por exemplo, a Rodovia Mario Covas, que corta a cidade de norte a sul e o famoso Rio Capibaribe que atravessa a cidade.</p>
<p>Para o terceiro mapa puxei os dados do <a href="https://ciclomapa.org.br/?lat=-8.0584930&amp;lng=-34.8848190&amp;z=12.00">Ciclomapa</a>. Apesar do título, eu incluí tanto ciclovias, ciclofaixas e ciclorrotas.</p>
<p>Os mapas da segunda linha foram todos feitos com dados do projeto de <a href="https://github.com/ipeaGIT/aopdata">Acesso a Oportunidades</a> do IPEA. Os dados de população e renda são do Censo de 2010 e espacialmente interpolados com os hexágonos H3, da Uber. Para facilitar a visualização usei o algoritmo de Jenks para agrupar os dados em 7 grupos. Além disso, usei uma transformação log tanto na renda como na população para reduzir um pouco da variância nos dados.</p>
<p>A renda da cidade é visivelmente concentrada na região sul-sudeste, próxima do litoral e na região centro-leste, no que me parece ser a região dos bairros Madalena e Boa Vista. Já a densidade populacional não segue um padrão simples; a população está espalhada por toda a cidade.</p>
<p>Como medida de acesso a empregos usei o percentual de oportunidades de emprego acessíveis a 15 minutos de carro em horário de pico. Segundo os dados do Censo, a maior parte dos deslocamentos casa-trabalho na RM de Recife são de menos de uma hora (83,4%). Assim, 15 minutos de carro (em horário de pico) me parece ser um “luxo” que as pessoas estão dispostas a pagar e que deve se refletir, em algum nível, no preço dos imóveis.</p>
<p>O mapa sugere que Recife é uma cidade monocêntrica, com a maior parte dos empregos concentrada na região central. Interessante notar que, apesar da distância geográfica, a região sul, de Boa Viagem, Pina, etc. continua com indicadores de acessibilidade relativamente altos.</p>
<p>Para tentar mensurar a verticalização calculei a proporção de apartamentos em relação ao total de domicílios em cada região. Novamente os dados vem do Censo e são agrupados a nível de setor censitário. Eu faço uma interpolação espacial simples com os hexágonos H3, na mesma resolução 9 do projeto do IPEA, para manter o padrão. Grosso modo, parece que as regiões de rendas mais altas coincidem com as regiões mais verticalizadas.</p>
<p>Por fim, os dados de anúncios e preço provém de anúncios online de venda de imóveis ativos entre janeiro e junho de 2023. Por simplicidade, eu escolhi trabalhar apenas com anúncios de apartamentos e removi algumas observações discrepantes para conseguir um valor médio mais razoável. O preço médio observado na cidade neste período foi de R$7.900, com a maior parte das observações caindo dentro do intervalo R$3.800-R$12.700.</p>
</section>
<section id="mapas" class="level2">
<h2 class="anchored" data-anchor-id="mapas">Mapas</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/static/maps/summary_rec_1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/static/maps/summary_rec_2.svg" class="img-fluid figure-img"></p>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/static/maps/summary_rec_3.svg" class="img-fluid figure-img"></p>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/static/maps/summary_rec_4.svg" class="img-fluid figure-img"></p>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/static/maps/summary_rec_5.svg" class="img-fluid figure-img"></p>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/static/maps/summary_rec_6.svg" class="img-fluid figure-img"></p>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/static/maps/summary_rec_7.svg" class="img-fluid figure-img"></p>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/static/maps/summary_rec_8.svg" class="img-fluid figure-img"></p>
</figure>
</div>


</section>
</section>

 ]]></description>
  <category>mapas</category>
  <category>ggplot2</category>
  <category>weekly-viz</category>
  <category>data-visualization</category>
  <guid>https:://www.restateinsight.com/posts/general-posts/2023-08-recife/index.html</guid>
  <pubDate>Wed, 23 Aug 2023 03:00:00 GMT</pubDate>
</item>
<item>
  <title>O impacto dos juros na demanda imobiliário</title>
  <dc:creator>Vinicius Oike</dc:creator>
  <link>https:://www.restateinsight.com/posts/general-posts/2023-08-juros-affordability/index.html</link>
  <description><![CDATA[ 




<section id="juros-e-financiamento-imobiliário" class="level1">
<h1>Juros e financiamento imobiliário</h1>
<p>A taxa de juros é talvez a variável macroeconômica mais importante para se observar quando se pensa em financiamento imobiliário. Quanto maior for a taxa de juros, mais “caro” fica o financiamento habitacional. Ou seja, mais difícil fica de comprar um imóvel.</p>
<p>O financiamento imobiliário nada mais é do que um empréstimo que uma família contrai com o sistema financeiro (um banco); este empréstimo é uma dívida que a família deve repagar em parcelas mensais e sobre cada pagamento incide um valor de juros.</p>
<section id="um-pouco-sobre-juros" class="level2">
<h2 class="anchored" data-anchor-id="um-pouco-sobre-juros">Um pouco sobre juros</h2>
<p>A taxa de juros tem um efeito geral sobre a economia, mas o seu efeito é mais notável para o consumidor na hora de fazer compras grandes, de longo prazo: caso de um automóvel ou de um imóvel. Uma taxa menor significa que fica mais “barato” tomar crédito, enquanto uma taxa maior significa o contrário.</p>
<p>Quem define a taxa de juros “geral” da economia, a taxa SELIC, é o Cômite de Política Monetária (COPOM). A SELIC é, na verdade, uma meta de taxa de juros, que o Banco Central do Brasil (BCB) deve perseguir. O COPOM se reúne periodicamente para definir a taxa SELIC; na ocasião mais recente, no início de agosto, decidiu-se reduzir a taxa de 13,75% a.a. para 13,25% a.a. - a primeira queda depois de um ciclo de alta de 3 anos.</p>
<p>Tipicamente, a taxa de juros é a ferramenta de política monetária que se usa para controlar a inflação: quando a taxa de inflação aumenta muito, o COPOM decide aumentar a taxa de juros. Foi isto o que aconteceu em 2014-16 e também em 2021-23.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/2023-08-juros-affordability/index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
<p>O gráfico acima mostra as oscilações recentes da SELIC. No final de 2016 encerrou-se um longo ciclo de alta que começou em reação à escalada da inflação em 2014. A taxa, então, chegou a cair até 2% a.a. no final de 2020, acompanhando a tendência internacional de taxas de juros baixíssimas, muito próximas de 0% a.a. A volta da inflação com a pandemia levou o COPOM a agressivamente aumentar a taxa SELIC nos meses seguintes. A taxa manteve-se estável em 13,75% a.a. desde agosto do ano passado.</p>
<p>A taxa SELIC influencia as demais taxas de juros da economia indiretamente. Como será mostrado mais adiante, há várias taxas de financiamento imobiliário disponíveis.</p>
</section>
</section>
<section id="financiamento-de-um-imóvel" class="level1">
<h1>Financiamento de um imóvel</h1>
<p>O típico financiamento de um imóvel envolve o pagamento de um valor de entrada e a contratação de uma dívida que será paga mensalmente ao longo de um período de tempo, tipicamente em torno de 25 a 30 anos. A modalidade de financiamento mais comum envolve um sistema de parcelas decrescentes com amortização constante, chamado, assim, de Sistema de Amortização Constante (SAC).</p>
<p>A matemática por trás deste sistema é bastante simples. Do preço do imóvel <img src="https://latex.codecogs.com/png.latex?P"> subtraí-se o valor de entrada <img src="https://latex.codecogs.com/png.latex?E">. O valor restante forma a dívida <img src="https://latex.codecogs.com/png.latex?D%20=%20P-E"> que deve ser paga de volta. A razão entre estes valores é chamada de “loan-to-value ratio” (LTV), isto é <img src="https://latex.codecogs.com/png.latex?LTV%20=%20%5Cfrac%7BD%7D%7BP%7D%20=%20%5Cfrac%7BP-E%7D%7BP%7D%20=%201-%5Cfrac%7BE%7D%7BP%7D">.</p>
<p>Valores comuns de LTV giram em torno de 70-80%, mas isto varia bastante. Um LTV de 80%, essencialmente, significa que o devedor pagou 20% do valor de imóvel como entrada; assim, um <em>LTV alto</em> significa um <em>valor de entrada baixo</em> e uma <em>dívida grande</em>; inversamente, um <em>LTV baixo</em> significa um <em>valor entrada elevado</em> e uma <em>dívida pequena</em>.</p>
<p>No típico financiamento SAC, o valor da dívida é amortizado em “parcelas” constantes, isto é, o valor da amortização é <img src="https://latex.codecogs.com/png.latex?A%20=%20D%20/%20N"> onde <img src="https://latex.codecogs.com/png.latex?N"> é o número de períodos do financiamento. No caso de um financiamento de 30 anos com pagamentos mensais, <img src="https://latex.codecogs.com/png.latex?A%20=%20%5Cfrac%7BD%7D%7B360%7D">.</p>
<p>O pagamento de juros que incide sobre a dívida costuma ser a soma de uma parcela pré-fixada com uma parte variável, atrelada a algum indexador monetário. O caso mais comum é de uma parte fixa (e.g.&nbsp;8,99%) somada à TR (taxa referencial)<sup>1</sup>. O valor da TR depende de outros fatores, mas não costuma passar de 0,2% a.m.</p>
<section id="exemplo-guiado" class="level2">
<h2 class="anchored" data-anchor-id="exemplo-guiado">Exemplo Guiado</h2>
<section id="o-empréstimo" class="level3">
<h3 class="anchored" data-anchor-id="o-empréstimo">O empréstimo</h3>
<p>Vamos simular o financiamento de um imóvel de R$450.000. Supondo um LTV de 80%, o valor da entrada é de R$90.000 e o valor a ser financiado, portanto, é de R$360.000. Num contrato de 30 anos, o valor da amortização é de:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AA%20=%20%5Cfrac%7BR%5C$360.000%7D%7BR%5C$360%7D%20=%20R%5C$1.000%0A"></p>
<p>Vamos começar assumindo que a taxa de juros seja de 10% a.a. A tabela abaixo mostra o fluxo de pagamentos do primeiro ano do empréstimo. Note como o valor da amortização é sempre o mesmo. À medida que a dívida vai sendo paga, o valor cobrado de juros também diminui e, por conseguinte, diminui também o valor da parcela mensal.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">

<div id="nckfliuozs" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#nckfliuozs table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#nckfliuozs thead, #nckfliuozs tbody, #nckfliuozs tfoot, #nckfliuozs tr, #nckfliuozs td, #nckfliuozs th {
  border-style: none;
}

#nckfliuozs p {
  margin: 0;
  padding: 0;
}

#nckfliuozs .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 3px;
  border-top-color: #D5D5D5;
  border-right-style: solid;
  border-right-width: 3px;
  border-right-color: #D5D5D5;
  border-bottom-style: solid;
  border-bottom-width: 3px;
  border-bottom-color: #D5D5D5;
  border-left-style: solid;
  border-left-width: 3px;
  border-left-color: #D5D5D5;
}

#nckfliuozs .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#nckfliuozs .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#nckfliuozs .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#nckfliuozs .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#nckfliuozs .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D5D5D5;
}

#nckfliuozs .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D5D5D5;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D5D5D5;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#nckfliuozs .gt_col_heading {
  color: #FFFFFF;
  background-color: #016763;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#nckfliuozs .gt_column_spanner_outer {
  color: #FFFFFF;
  background-color: #016763;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#nckfliuozs .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#nckfliuozs .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#nckfliuozs .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D5D5D5;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#nckfliuozs .gt_spanner_row {
  border-bottom-style: hidden;
}

#nckfliuozs .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D5D5D5;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D5D5D5;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#nckfliuozs .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D5D5D5;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D5D5D5;
  vertical-align: middle;
}

#nckfliuozs .gt_from_md > :first-child {
  margin-top: 0;
}

#nckfliuozs .gt_from_md > :last-child {
  margin-bottom: 0;
}

#nckfliuozs .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D5D5D5;
  border-left-style: solid;
  border-left-width: 1px;
  border-left-color: #D5D5D5;
  border-right-style: solid;
  border-right-width: 1px;
  border-right-color: #D5D5D5;
  vertical-align: middle;
  overflow-x: hidden;
}

#nckfliuozs .gt_stub {
  color: #FFFFFF;
  background-color: #929292;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D5D5D5;
  padding-left: 5px;
  padding-right: 5px;
}

#nckfliuozs .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#nckfliuozs .gt_row_group_first td {
  border-top-width: 2px;
}

#nckfliuozs .gt_row_group_first th {
  border-top-width: 2px;
}

#nckfliuozs .gt_summary_row {
  color: #FFFFFF;
  background-color: #5F5F5F;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#nckfliuozs .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D5D5D5;
}

#nckfliuozs .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#nckfliuozs .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D5D5D5;
}

#nckfliuozs .gt_grand_summary_row {
  color: #FFFFFF;
  background-color: #929292;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#nckfliuozs .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D5D5D5;
}

#nckfliuozs .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D5D5D5;
}

#nckfliuozs .gt_striped {
  background-color: #F4F4F4;
}

#nckfliuozs .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D5D5D5;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D5D5D5;
}

#nckfliuozs .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#nckfliuozs .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#nckfliuozs .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#nckfliuozs .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#nckfliuozs .gt_left {
  text-align: left;
}

#nckfliuozs .gt_center {
  text-align: center;
}

#nckfliuozs .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#nckfliuozs .gt_font_normal {
  font-weight: normal;
}

#nckfliuozs .gt_font_bold {
  font-weight: bold;
}

#nckfliuozs .gt_font_italic {
  font-style: italic;
}

#nckfliuozs .gt_super {
  font-size: 65%;
}

#nckfliuozs .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#nckfliuozs .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#nckfliuozs .gt_indent_1 {
  text-indent: 5px;
}

#nckfliuozs .gt_indent_2 {
  text-indent: 10px;
}

#nckfliuozs .gt_indent_3 {
  text-indent: 15px;
}

#nckfliuozs .gt_indent_4 {
  text-indent: 20px;
}

#nckfliuozs .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <caption>Fluxo de pagamento do financiamento de um imóvel de 450.000 (SAC).</caption>
  <thead>
    
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Período (mês)">Período (mês)</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Amortização">Amortização</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Juros">Juros</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Parcela">Parcela</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Dívida">Dívida</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="periodo" class="gt_row gt_right">1</td>
<td headers="amort" class="gt_row gt_right">R$1.000</td>
<td headers="juros" class="gt_row gt_right">R$2.870,69</td>
<td headers="pmt" class="gt_row gt_right">R$3.870,69</td>
<td headers="divida" class="gt_row gt_right">R$360.000</td></tr>
    <tr><td headers="periodo" class="gt_row gt_right gt_striped">2</td>
<td headers="amort" class="gt_row gt_right gt_striped">R$1.000</td>
<td headers="juros" class="gt_row gt_right gt_striped">R$2.862,72</td>
<td headers="pmt" class="gt_row gt_right gt_striped">R$3.862,72</td>
<td headers="divida" class="gt_row gt_right gt_striped">R$359.000</td></tr>
    <tr><td headers="periodo" class="gt_row gt_right">3</td>
<td headers="amort" class="gt_row gt_right">R$1.000</td>
<td headers="juros" class="gt_row gt_right">R$2.854,74</td>
<td headers="pmt" class="gt_row gt_right">R$3.854,74</td>
<td headers="divida" class="gt_row gt_right">R$358.000</td></tr>
    <tr><td headers="periodo" class="gt_row gt_right gt_striped">4</td>
<td headers="amort" class="gt_row gt_right gt_striped">R$1.000</td>
<td headers="juros" class="gt_row gt_right gt_striped">R$2.846,77</td>
<td headers="pmt" class="gt_row gt_right gt_striped">R$3.846,77</td>
<td headers="divida" class="gt_row gt_right gt_striped">R$357.000</td></tr>
    <tr><td headers="periodo" class="gt_row gt_right">5</td>
<td headers="amort" class="gt_row gt_right">R$1.000</td>
<td headers="juros" class="gt_row gt_right">R$2.838,79</td>
<td headers="pmt" class="gt_row gt_right">R$3.838,79</td>
<td headers="divida" class="gt_row gt_right">R$356.000</td></tr>
    <tr><td headers="periodo" class="gt_row gt_right gt_striped">6</td>
<td headers="amort" class="gt_row gt_right gt_striped">R$1.000</td>
<td headers="juros" class="gt_row gt_right gt_striped">R$2.830,82</td>
<td headers="pmt" class="gt_row gt_right gt_striped">R$3.830,82</td>
<td headers="divida" class="gt_row gt_right gt_striped">R$355.000</td></tr>
    <tr><td headers="periodo" class="gt_row gt_right">7</td>
<td headers="amort" class="gt_row gt_right">R$1.000</td>
<td headers="juros" class="gt_row gt_right">R$2.822,85</td>
<td headers="pmt" class="gt_row gt_right">R$3.822,85</td>
<td headers="divida" class="gt_row gt_right">R$354.000</td></tr>
    <tr><td headers="periodo" class="gt_row gt_right gt_striped">8</td>
<td headers="amort" class="gt_row gt_right gt_striped">R$1.000</td>
<td headers="juros" class="gt_row gt_right gt_striped">R$2.814,87</td>
<td headers="pmt" class="gt_row gt_right gt_striped">R$3.814,87</td>
<td headers="divida" class="gt_row gt_right gt_striped">R$353.000</td></tr>
    <tr><td headers="periodo" class="gt_row gt_right">9</td>
<td headers="amort" class="gt_row gt_right">R$1.000</td>
<td headers="juros" class="gt_row gt_right">R$2.806,90</td>
<td headers="pmt" class="gt_row gt_right">R$3.806,90</td>
<td headers="divida" class="gt_row gt_right">R$352.000</td></tr>
    <tr><td headers="periodo" class="gt_row gt_right gt_striped">10</td>
<td headers="amort" class="gt_row gt_right gt_striped">R$1.000</td>
<td headers="juros" class="gt_row gt_right gt_striped">R$2.798,92</td>
<td headers="pmt" class="gt_row gt_right gt_striped">R$3.798,92</td>
<td headers="divida" class="gt_row gt_right gt_striped">R$351.000</td></tr>
    <tr><td headers="periodo" class="gt_row gt_right">11</td>
<td headers="amort" class="gt_row gt_right">R$1.000</td>
<td headers="juros" class="gt_row gt_right">R$2.790,95</td>
<td headers="pmt" class="gt_row gt_right">R$3.790,95</td>
<td headers="divida" class="gt_row gt_right">R$350.000</td></tr>
    <tr><td headers="periodo" class="gt_row gt_right gt_striped">12</td>
<td headers="amort" class="gt_row gt_right gt_striped">R$1.000</td>
<td headers="juros" class="gt_row gt_right gt_striped">R$2.782,98</td>
<td headers="pmt" class="gt_row gt_right gt_striped">R$3.782,98</td>
<td headers="divida" class="gt_row gt_right gt_striped">R$349.000</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
</div>
<p>Ao longo dos 360 meses do financiamento, o valor dos juros e da parcela vão diminuindo até que a dívida tenha sido totalmente paga. Note como no início do financiamento, a parcela mensal está na faixa de R$3800, mas já no final está próxima de R$1000.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/2023-08-juros-affordability/index_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="renda-necessária" class="level3">
<h3 class="anchored" data-anchor-id="renda-necessária">Renda necessária</h3>
<p>Agora podemos responder uma dúvida importante: qual a renda necessária para financiar este imóvel? Cada banco ou instituição financeira usa regras próprias para decidir se libera ou não o valor do financiamento imobiliário. Uma regra de bolso comum é de que o valor da parcela inicial não pode ser maior do que 30% da renda do requerente.</p>
<p>No exemplo acima, o valor da primeira parcela é de R$3870. A renda mínima necessária (RMN) para estar elegível a este financiamento é:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0ARMN%20=%20%5Cfrac%7BR%5C$%203.870,69%7D%7B0,3%7D%20=%20R%5C$%2012.902,3%0A"></p>
<p>Como que este resultado final depende da taxa de juros? Podemos simular o mesmo financiamento para diferentes taxas juros e calcular novamente a renda mínima necessária. A tabela abaixo mostra como a renda varia para valores de taxa de juros de 7% a 12%. É notável como a taxa de juros tem impacto direto no poder de compra e capacidade de pagamento das famílias. A uma taxa favorável de 7%, é necessário ter uma renda de R$10 mil para ser aprovado no financimento; já a uma taxa de 12% é necessário ter quase R$15 mil.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">

<div id="jfybywwxmk" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#jfybywwxmk table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#jfybywwxmk thead, #jfybywwxmk tbody, #jfybywwxmk tfoot, #jfybywwxmk tr, #jfybywwxmk td, #jfybywwxmk th {
  border-style: none;
}

#jfybywwxmk p {
  margin: 0;
  padding: 0;
}

#jfybywwxmk .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 3px;
  border-top-color: #D5D5D5;
  border-right-style: solid;
  border-right-width: 3px;
  border-right-color: #D5D5D5;
  border-bottom-style: solid;
  border-bottom-width: 3px;
  border-bottom-color: #D5D5D5;
  border-left-style: solid;
  border-left-width: 3px;
  border-left-color: #D5D5D5;
}

#jfybywwxmk .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#jfybywwxmk .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#jfybywwxmk .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#jfybywwxmk .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#jfybywwxmk .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D5D5D5;
}

#jfybywwxmk .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D5D5D5;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D5D5D5;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#jfybywwxmk .gt_col_heading {
  color: #FFFFFF;
  background-color: #016763;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#jfybywwxmk .gt_column_spanner_outer {
  color: #FFFFFF;
  background-color: #016763;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#jfybywwxmk .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#jfybywwxmk .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#jfybywwxmk .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D5D5D5;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#jfybywwxmk .gt_spanner_row {
  border-bottom-style: hidden;
}

#jfybywwxmk .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D5D5D5;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D5D5D5;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#jfybywwxmk .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D5D5D5;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D5D5D5;
  vertical-align: middle;
}

#jfybywwxmk .gt_from_md > :first-child {
  margin-top: 0;
}

#jfybywwxmk .gt_from_md > :last-child {
  margin-bottom: 0;
}

#jfybywwxmk .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D5D5D5;
  border-left-style: solid;
  border-left-width: 1px;
  border-left-color: #D5D5D5;
  border-right-style: solid;
  border-right-width: 1px;
  border-right-color: #D5D5D5;
  vertical-align: middle;
  overflow-x: hidden;
}

#jfybywwxmk .gt_stub {
  color: #FFFFFF;
  background-color: #929292;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D5D5D5;
  padding-left: 5px;
  padding-right: 5px;
}

#jfybywwxmk .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#jfybywwxmk .gt_row_group_first td {
  border-top-width: 2px;
}

#jfybywwxmk .gt_row_group_first th {
  border-top-width: 2px;
}

#jfybywwxmk .gt_summary_row {
  color: #FFFFFF;
  background-color: #5F5F5F;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#jfybywwxmk .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D5D5D5;
}

#jfybywwxmk .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#jfybywwxmk .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D5D5D5;
}

#jfybywwxmk .gt_grand_summary_row {
  color: #FFFFFF;
  background-color: #929292;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#jfybywwxmk .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D5D5D5;
}

#jfybywwxmk .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D5D5D5;
}

#jfybywwxmk .gt_striped {
  background-color: #F4F4F4;
}

#jfybywwxmk .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D5D5D5;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D5D5D5;
}

#jfybywwxmk .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#jfybywwxmk .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#jfybywwxmk .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#jfybywwxmk .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#jfybywwxmk .gt_left {
  text-align: left;
}

#jfybywwxmk .gt_center {
  text-align: center;
}

#jfybywwxmk .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#jfybywwxmk .gt_font_normal {
  font-weight: normal;
}

#jfybywwxmk .gt_font_bold {
  font-weight: bold;
}

#jfybywwxmk .gt_font_italic {
  font-style: italic;
}

#jfybywwxmk .gt_super {
  font-size: 65%;
}

#jfybywwxmk .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#jfybywwxmk .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#jfybywwxmk .gt_indent_1 {
  text-indent: 5px;
}

#jfybywwxmk .gt_indent_2 {
  text-indent: 10px;
}

#jfybywwxmk .gt_indent_3 {
  text-indent: 15px;
}

#jfybywwxmk .gt_indent_4 {
  text-indent: 20px;
}

#jfybywwxmk .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <caption>Renda mínima necessária para financiar um imóvel de R$450.000 a diferentes taxas de juros.</caption>
  <thead>
    
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Juros (% a.a)">Juros (% a.a)</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Renda Mínima">Renda Mínima</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="i" class="gt_row gt_right">7,00%</td>
<td headers="renda" class="gt_row gt_right">R$10.118,31</td></tr>
    <tr><td headers="i" class="gt_row gt_right gt_striped">7,50%</td>
<td headers="renda" class="gt_row gt_right gt_striped">R$10.587,24</td></tr>
    <tr><td headers="i" class="gt_row gt_right">8,00%</td>
<td headers="renda" class="gt_row gt_right">R$11.054,17</td></tr>
    <tr><td headers="i" class="gt_row gt_right gt_striped">8,50%</td>
<td headers="renda" class="gt_row gt_right gt_striped">R$11.519,13</td></tr>
    <tr><td headers="i" class="gt_row gt_right">9,00%</td>
<td headers="renda" class="gt_row gt_right">R$11.982,12</td></tr>
    <tr><td headers="i" class="gt_row gt_right gt_striped">9,50%</td>
<td headers="renda" class="gt_row gt_right gt_striped">R$12.443,17</td></tr>
    <tr><td headers="i" class="gt_row gt_right">10,00%</td>
<td headers="renda" class="gt_row gt_right">R$12.902,30</td></tr>
    <tr><td headers="i" class="gt_row gt_right gt_striped">10,50%</td>
<td headers="renda" class="gt_row gt_right gt_striped">R$13.359,52</td></tr>
    <tr><td headers="i" class="gt_row gt_right">11,00%</td>
<td headers="renda" class="gt_row gt_right">R$13.814,85</td></tr>
    <tr><td headers="i" class="gt_row gt_right gt_striped">11,50%</td>
<td headers="renda" class="gt_row gt_right gt_striped">R$14.268,30</td></tr>
    <tr><td headers="i" class="gt_row gt_right">12,00%</td>
<td headers="renda" class="gt_row gt_right">R$14.719,88</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="acessibilidade-à-moradia" class="level1">
<h1>Acessibilidade à moradia</h1>
<p>O Brasil, historicamente, tem taxas de juros bastante elevadas e isto também é verdadeiro sobre as taxas do financiamento habitacional. É importante notar que há múltiplas taxas de juros que se aplicam sobre financiamentos habitacionais, porque há várias linhas de crédito. O Banco Central do Brasil reconhece cinco linhas distintas: comercial, livre, Home Equity, FGTS e SFH. As duas últimas linhas são as mais conhecidas e representativas do mercado: em abril de 2023, elas acontavam conjuntamente por 90% do estoque de contratos de financiamento imobiliários para pessoas físicas.</p>
<p>O gráfico abaixo mostra a evolução destas linhas de financiamento. As linhas são as médias móveis suavaizadas de cada série. Pelo comportamento do gráfico, nota-se como todas as taxas tendem a subir em períodos de alta da SELIC, como durante o período 2016-2017, quando a taxa SELIC chegou a 14,25%. Já nos períodos de baixa, como em 2020, as taxas livres tendem a cair enquanto a taxa do FGTS não se altera, já que ela é vinculada ao programa habitacional.</p>
<p>Por fim, é interessante perceber que, a despeito da alta recente da SELIC, as taxas de juros das linhas de financiamento habitacional estão abaixo dos seus picos de 2016. Isto pode ser um indício de que houve uma melhoria institucional no sistema de crédito habitacional, relacionado a várias mudanças positivas levadas a cabo nos últimos anos pelo Banco Central do Brasil<sup>2</sup>.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/2023-08-juros-affordability/index_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
<p>Grosso modo, todas as taxas de juros da economia são balizadas pela taxa SELIC. O gráfico abaixo mostra como as taxas de financiamento habitacional reguladas (FGTS, SFH) e de mercado reagem às mudanças na SELIC.</p>
<p>É interessante perceber como a distância entre as taxas de mercado e as taxas reguladas diminuiu ao longo dos anos. Além disso, nota-se como o tempo de repasse da SELIC para o consumidor final varia ao longo dos ciclos econômicos. Mais recentemente, vê-se como houve uma defasagem inicial entre os aumentos da SELIC e os respectivos aumentos das taxas de financiamento.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/2023-08-juros-affordability/index_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
<section id="o-impacto-do-aumento-dos-juros" class="level2">
<h2 class="anchored" data-anchor-id="o-impacto-do-aumento-dos-juros">O impacto do aumento dos juros</h2>
<p>Nos últimos anos vimos uma alta significativa das taxas de juros. A taxa média de financiamento habitacional era próxima de 7% em 2020 e subiu para 11,6%. Considerando o imóvel do exemplo acima, seria necessário um aumento de mais de R$4000 na renda para conseguir comprar o mesmo imóvel - sem levar em conta o aumento de preço do imóvel.</p>
<p>Vamos retomar o exemplo do imóvel de R$450.000 acima. Mantendo este preço constante, podemos calcular qual a renda necessária para financiar este mesmo imóvel à medida que a taxa de juros foi aumentando. Por simplicidade, uso a taxa de juros média mensal em cada período<sup>3</sup>.</p>
<p>O gráfico abaixo apresenta, a cada mês, a renda necessária para financiar um imóvel de R$450.000<sup>4</sup>. No ponto mais baixo da taxa, seria necessário R$8.550 (a uma taxa de 6,63%) para ser aprovado num financiamento; já no ponto mais recente, seria necessário R$12.600 (a uma taxa de 11,6%).</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/2023-08-juros-affordability/index_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
<p>A análise acima olha somente o impacto do aumento dos juros e não leva em consideração o aumento médio do preços dos imóveis durante este período. Segundo o IGMI-R (Abrainc/FGV), de janeiro de 2018 a abril 2023, houve um aumento médio de 58% no preços dos imóveis. A tabela abaixo mostra a variação acumulada do IGMI-R em cada ano. Nota-se como os preços aumentam significativamente a partir de 2020.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">

<div id="safkxmkdhi" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#safkxmkdhi table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#safkxmkdhi thead, #safkxmkdhi tbody, #safkxmkdhi tfoot, #safkxmkdhi tr, #safkxmkdhi td, #safkxmkdhi th {
  border-style: none;
}

#safkxmkdhi p {
  margin: 0;
  padding: 0;
}

#safkxmkdhi .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 3px;
  border-top-color: #D5D5D5;
  border-right-style: solid;
  border-right-width: 3px;
  border-right-color: #D5D5D5;
  border-bottom-style: solid;
  border-bottom-width: 3px;
  border-bottom-color: #D5D5D5;
  border-left-style: solid;
  border-left-width: 3px;
  border-left-color: #D5D5D5;
}

#safkxmkdhi .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#safkxmkdhi .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#safkxmkdhi .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#safkxmkdhi .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#safkxmkdhi .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D5D5D5;
}

#safkxmkdhi .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D5D5D5;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D5D5D5;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#safkxmkdhi .gt_col_heading {
  color: #FFFFFF;
  background-color: #016763;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#safkxmkdhi .gt_column_spanner_outer {
  color: #FFFFFF;
  background-color: #016763;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#safkxmkdhi .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#safkxmkdhi .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#safkxmkdhi .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D5D5D5;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#safkxmkdhi .gt_spanner_row {
  border-bottom-style: hidden;
}

#safkxmkdhi .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D5D5D5;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D5D5D5;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#safkxmkdhi .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D5D5D5;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D5D5D5;
  vertical-align: middle;
}

#safkxmkdhi .gt_from_md > :first-child {
  margin-top: 0;
}

#safkxmkdhi .gt_from_md > :last-child {
  margin-bottom: 0;
}

#safkxmkdhi .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D5D5D5;
  border-left-style: solid;
  border-left-width: 1px;
  border-left-color: #D5D5D5;
  border-right-style: solid;
  border-right-width: 1px;
  border-right-color: #D5D5D5;
  vertical-align: middle;
  overflow-x: hidden;
}

#safkxmkdhi .gt_stub {
  color: #FFFFFF;
  background-color: #929292;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D5D5D5;
  padding-left: 5px;
  padding-right: 5px;
}

#safkxmkdhi .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#safkxmkdhi .gt_row_group_first td {
  border-top-width: 2px;
}

#safkxmkdhi .gt_row_group_first th {
  border-top-width: 2px;
}

#safkxmkdhi .gt_summary_row {
  color: #FFFFFF;
  background-color: #5F5F5F;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#safkxmkdhi .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D5D5D5;
}

#safkxmkdhi .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#safkxmkdhi .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D5D5D5;
}

#safkxmkdhi .gt_grand_summary_row {
  color: #FFFFFF;
  background-color: #929292;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#safkxmkdhi .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D5D5D5;
}

#safkxmkdhi .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D5D5D5;
}

#safkxmkdhi .gt_striped {
  background-color: #F4F4F4;
}

#safkxmkdhi .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D5D5D5;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D5D5D5;
}

#safkxmkdhi .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#safkxmkdhi .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#safkxmkdhi .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#safkxmkdhi .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#safkxmkdhi .gt_left {
  text-align: left;
}

#safkxmkdhi .gt_center {
  text-align: center;
}

#safkxmkdhi .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#safkxmkdhi .gt_font_normal {
  font-weight: normal;
}

#safkxmkdhi .gt_font_bold {
  font-weight: bold;
}

#safkxmkdhi .gt_font_italic {
  font-style: italic;
}

#safkxmkdhi .gt_super {
  font-size: 65%;
}

#safkxmkdhi .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#safkxmkdhi .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#safkxmkdhi .gt_indent_1 {
  text-indent: 5px;
}

#safkxmkdhi .gt_indent_2 {
  text-indent: 10px;
}

#safkxmkdhi .gt_indent_3 {
  text-indent: 15px;
}

#safkxmkdhi .gt_indent_4 {
  text-indent: 20px;
}

#safkxmkdhi .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <caption>Variação acumulada do IGMI-R por ano.</caption>
  <thead>
    
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Ano">Ano</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Var. Acum. (%)">Var. Acum. (%)</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="year" class="gt_row gt_right">2018</td>
<td headers="total" class="gt_row gt_right">0.64%</td></tr>
    <tr><td headers="year" class="gt_row gt_right gt_striped">2019</td>
<td headers="total" class="gt_row gt_right gt_striped">4.11%</td></tr>
    <tr><td headers="year" class="gt_row gt_right">2020</td>
<td headers="total" class="gt_row gt_right">10.28%</td></tr>
    <tr><td headers="year" class="gt_row gt_right gt_striped">2021</td>
<td headers="total" class="gt_row gt_right gt_striped">16.25%</td></tr>
    <tr><td headers="year" class="gt_row gt_right">2022</td>
<td headers="total" class="gt_row gt_right">15.06%</td></tr>
    <tr><td headers="year" class="gt_row gt_right gt_striped">2023</td>
<td headers="total" class="gt_row gt_right gt_striped">2.52%</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
</div>
<p>O gráfico abaixo refaz o experimento acima, mas leva em conta também o aumento médio do preços dos imóveis. Em cada mês vê-se a renda necessária para financiar um imóvel médio, que em janeiro de 2018 valia R\$450.000.</p>
<p>Fica evidente como a combinação simultânea de aumento de juros e de preços tornou os imóveis menos acessíveis. Em abril de 2023, seria necessário uma renda em torno de R\$20.000 para financiar o mesmo imóvel<sup>5</sup>.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/2023-08-juros-affordability/index_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
<p>A análise omite ainda um fator: o crescimento médio da renda ao longo do tempo. No Brasil, o salário mínimo é indexado à variação da inflação e, de maneira geral, quando a economia vai bem a renda média costuma crescer. Deixo esta última etapa da análise de acessibilidade financeira para outro post.</p>
<p>Além disso, o programa habitacional do Brasil, o Minha Casa Minha Vida (MCMV) oferece empréstimos com taxas mais atrativas do que as taxas médias de mercado, conforme a renda da família e o preço do imóvel<sup>6</sup>. Como o programa foi revisto recentemente, vou dedicar um post somente ao MCMV e como ele deve impactar a acessibilidade à moradia no Brasil.</p>
</section>
<section id="o-caminho-futuro" class="level2">
<h2 class="anchored" data-anchor-id="o-caminho-futuro">O caminho futuro</h2>
<p>Na última semana o COPOM decidiu reduzir a taxa SELIC em 0.5 p.p., diminuindo a taxa de 13,75% para 13,25%. Esta foi a primeira queda desde que se iniciou o ciclo de altas no início de 2021. Espera-se que o Banco Central agora entre num ciclo de queda de taxa de juros que devem se estabilizar em torno de 8,5% no longo prazo.</p>
<p>Como se viu na análise acima, as oscilações de SELIC eventualmente traduzem-se em mudanças nas taxas do financiamento imobiliário. Além da queda na taxa de juros, os índices de preços imobiliários, como o IGMI-R e o IVGR, começam a apontar para uma relativa estabilidade nos preços dos imóveis. Esta combinação deve aumentar o poder de compras das famílias e melhorar a acessibilidade financeira à moradia.</p>
<p>Há um último componente, da equação da acessibilidade à moradia, que ficou inexplorado neste post: a renda das famílias. Evidentemente, um aumento da renda média das famílias permite que elas tenham acesso a imóveis melhores e mais caros. Além disso, para imóveis com ticket menores, o MCMV oferece condições mais favoráveis de financiamento. Deixo esta discussão, contudo, para um outro momento.</p>


</section>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Em abril de 2023, cerca de 95% do estoque de contratos de financiamentos imobiliários para pessoas físicas era indexado pela TR. O IPCA era utilizado em cerca de 2% e outros indexadores eram utilizados em 2,2% dos contratos. Apenas 0,8% dos contratos eram pré-fixados.↩︎</p></li>
<li id="fn2"><p>Alguns exemplos incluem: cadastro positivo, regulamentação das fintechs de crédito, regulamentação das Letras Imobiliárias Garantidas (LIGs), portabilidade de crédito. Para mais informações veja a <a href="https://www.bcb.gov.br/acessoinformacao/bchashtag?modalAberto=sobre_agenda">Agenda BC#</a>.↩︎</p></li>
<li id="fn3"><p>A taxa de juros média do financiamento habitacional para pessoas físicas toma as cinco taxas apresentadas e pondera elas pelo volume de crédito. Assim, as principais linhas (FGTS e SFH) têm maior peso.↩︎</p></li>
<li id="fn4"><p>Por simplicidade, suponho um financiamento estilo SAC com LTV de 70% e prazo de 360 meses. Para ser aprovado no financiamento, suponho que o valor da primeira parcela não possa ser maior do que 30% da renda familiar bruta.↩︎</p></li>
<li id="fn5"><p>Vale notar que o IGMI-R é um índice de preços hedônico então ele provê um índice de preços “ajustado pela qualidade”, isto é, um quality adjusted price index. Assim, este aumento de preços não reflete meramente uma mudança no mix de imóveis disponíveis no mercado.↩︎</p></li>
<li id="fn6"><p>O preço de R\$450.000 não foi escolhido ao acaso já que ele supera o teto atual do Minha Casa Minha Vida e não estaria elegível ao programa.↩︎</p></li>
</ol>
</section></div> ]]></description>
  <category>real-estate</category>
  <category>economia</category>
  <guid>https:://www.restateinsight.com/posts/general-posts/2023-08-juros-affordability/index.html</guid>
  <pubDate>Thu, 17 Aug 2023 03:00:00 GMT</pubDate>
</item>
<item>
  <title>Importando dados do SIDRA</title>
  <dc:creator>Vinicius Oike</dc:creator>
  <link>https:://www.restateinsight.com/posts/general-posts/2023-08-importando-dados-sidra/index.html</link>
  <description><![CDATA[ 




<p>O SIDRA, ou Sistema IBGE de Recuperação Automática, é um sistema automatizado de coleta de dados do IBGE, que disponbiliza tabelas das várias pesquisas feitas pelo IBGE. O sistema é centralizado no <a href="https://sidra.ibge.gov.br/home/pnadcm">site</a>. Encontrar pesquisas e dados pode não ser fácil e, em geral, exige conhecimento prévio sobre as pesquisas do IBGE. O site oferece uma página de <a href="https://sidra.ibge.gov.br/ajuda">ajuda</a>.</p>
<p>Neste post vou comentar mais especificamente sobre o pacote <code>sidrar</code> que dialoga diretamente com a API do SIDRA para importar tabelas diretamente para dentro do <code>R</code>. O pacote tem duas funções centrais:</p>
<ul>
<li><code>info_sidra()</code> - busca os metadados e informações de uma tabela.</li>
<li><code>get_sidra()</code> - importa uma tabela do SIDRA seguindo um conjunto de parâmetros.</li>
</ul>
<section id="r" class="level1">
<h1>R</h1>
<p>Primeiro, temos que instalar o pacote <code>sidrar</code> e chamá-lo usando a função <code>library()</code>. Além disso, para a primeira parte deste tutorial mostro também como utilizar os pacotes <code>dplyr</code>, <code>tidyr</code> e <code>janitor</code> para limpar os dados.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Instale o pacote (caso necessário)</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">install.packages</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sidrar"</span>)</span>
<span id="cb1-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Outros pacotes usados neste tutorial</span></span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">install.packages</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"janitor"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dplyr"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tidyr"</span>))</span>
<span id="cb1-5"></span>
<span id="cb1-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sidrar"</span>)</span>
<span id="cb1-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"janitor"</span>)</span>
<span id="cb1-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dplyr"</span>)</span>
<span id="cb1-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tidyr"</span>)</span></code></pre></div>
</div>
</section>
<section id="importando-dados" class="level1">
<h1>Importando dados</h1>
<p>Vamos começar olhando para a tabela de estimativas da população dos municípios. A tabela <a href="https://sidra.ibge.gov.br/tabela/6579">6579</a> reúne os dados da pesquisa “Estimativas da População”, uma contagem anual da população de todos os municípios do Brasil.</p>
<p>Primeiro vamos usar a função <code>info_sidra</code> para verificar o conteúdo desta tabela.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">info_sidra</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6579</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$table
[1] "Tabela 6579: População residente estimada"

$period
[1] "2001, 2002, 2003, 2004, 2005, 2006, 2008, 2009, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021"

$variable
   cod                                   desc
1 9324 População residente estimada (Pessoas)

$classific_category
NULL

$geo
     cod                      desc
1 Brazil                Brasil (1)
2 Region         Grande Região (5)
3  State Unidade da Federação (27)
4   City         Município (5.570)</code></pre>
</div>
</div>
<p>A tabela, neste caso, é bastante simples. Os dados são anuais e estão disponíveis de 2001 a 2021. Há apenas uma variável: <code>População residente estimada (Pessoas)</code> com código <code>9324</code>. Por fim, os dados estão desagregados no nível nacional, regional, estadual e municipal.</p>
<p>Vamos importar a população de todos os municipios em 2021. Note que no código abaixo o argumento do ano é inserido como um <code>character</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">pop21 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_sidra</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6579</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">period =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2021"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">geo =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"City"</span>)</span>
<span id="cb4-2"></span>
<span id="cb4-3">pop21</span></code></pre></div>
</div>
<p>A tabela já vem formatada dentro do R.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">pop21 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_sidra</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6579</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">period =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2021"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">geo =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"City"</span>)</span>
<span id="cb5-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(pop21)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Nível Territorial (Código) Nível Territorial Unidade de Medida (Código)
2                          6         Município                         45
3                          6         Município                         45
4                          6         Município                         45
5                          6         Município                         45
6                          6         Município                         45
7                          6         Município                         45
  Unidade de Medida  Valor Município (Código)                  Município
2           Pessoas  22516            1100015 Alta Floresta D'Oeste - RO
3           Pessoas 111148            1100023             Ariquemes - RO
4           Pessoas   5067            1100031                Cabixi - RO
5           Pessoas  86416            1100049                Cacoal - RO
6           Pessoas  16088            1100056            Cerejeiras - RO
7           Pessoas  15213            1100064     Colorado do Oeste - RO
  Ano (Código)  Ano Variável (Código)                     Variável
2         2021 2021              9324 População residente estimada
3         2021 2021              9324 População residente estimada
4         2021 2021              9324 População residente estimada
5         2021 2021              9324 População residente estimada
6         2021 2021              9324 População residente estimada
7         2021 2021              9324 População residente estimada</code></pre>
</div>
</div>
<p>Ainda que os dados não estejam “sujos”, eles não estão num formato agradável para se trabalhar. Vamos fazer uma limpeza básica dos dados. Primeiro, vamos simplificar os nomes das colunas e selecionar apenas as colunas de maior interesse.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">pop21 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> janitor<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">clean_names</span>(pop21)</span>
<span id="cb7-2">pop21 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(pop21, municipio_codigo, municipio, ano, valor)</span></code></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="table-responsive">
<table class="table table-condensed table-hover table-striped table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: center;" data-quarto-table-cell-role="th">municipio_codigo</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">municipio</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">ano</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">valor</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2</td>
<td style="text-align: center;">1100015</td>
<td style="text-align: center;">Alta Floresta D'Oeste - RO</td>
<td style="text-align: center;">2021</td>
<td style="text-align: center;">22516</td>
</tr>
<tr class="even">
<td style="text-align: left;">3</td>
<td style="text-align: center;">1100023</td>
<td style="text-align: center;">Ariquemes - RO</td>
<td style="text-align: center;">2021</td>
<td style="text-align: center;">111148</td>
</tr>
<tr class="odd">
<td style="text-align: left;">4</td>
<td style="text-align: center;">1100031</td>
<td style="text-align: center;">Cabixi - RO</td>
<td style="text-align: center;">2021</td>
<td style="text-align: center;">5067</td>
</tr>
<tr class="even">
<td style="text-align: left;">5</td>
<td style="text-align: center;">1100049</td>
<td style="text-align: center;">Cacoal - RO</td>
<td style="text-align: center;">2021</td>
<td style="text-align: center;">86416</td>
</tr>
<tr class="odd">
<td style="text-align: left;">6</td>
<td style="text-align: center;">1100056</td>
<td style="text-align: center;">Cerejeiras - RO</td>
<td style="text-align: center;">2021</td>
<td style="text-align: center;">16088</td>
</tr>
<tr class="even">
<td style="text-align: left;">7</td>
<td style="text-align: center;">1100064</td>
<td style="text-align: center;">Colorado do Oeste - RO</td>
<td style="text-align: center;">2021</td>
<td style="text-align: center;">15213</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<p>Note que o nome dos municípios contém também a abreviação do estado ao qual o município pertence. Podemos deixar isto mais claro separando esta informação em duas colunas distintas.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">pop21 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> tidyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">separate</span>(</span>
<span id="cb8-2">  pop21,</span>
<span id="cb8-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"municipio"</span>,</span>
<span id="cb8-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">into =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"nome_muni"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"abr_estado"</span>),</span>
<span id="cb8-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" - "</span>)</span></code></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="table-responsive">
<table class="table table-condensed table-hover table-striped table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: center;" data-quarto-table-cell-role="th">municipio_codigo</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">nome_muni</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">abr_estado</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">ano</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">valor</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2</td>
<td style="text-align: center;">1100015</td>
<td style="text-align: center;">Alta Floresta D'Oeste</td>
<td style="text-align: center;">RO</td>
<td style="text-align: center;">2021</td>
<td style="text-align: center;">22516</td>
</tr>
<tr class="even">
<td style="text-align: left;">3</td>
<td style="text-align: center;">1100023</td>
<td style="text-align: center;">Ariquemes</td>
<td style="text-align: center;">RO</td>
<td style="text-align: center;">2021</td>
<td style="text-align: center;">111148</td>
</tr>
<tr class="odd">
<td style="text-align: left;">4</td>
<td style="text-align: center;">1100031</td>
<td style="text-align: center;">Cabixi</td>
<td style="text-align: center;">RO</td>
<td style="text-align: center;">2021</td>
<td style="text-align: center;">5067</td>
</tr>
<tr class="even">
<td style="text-align: left;">5</td>
<td style="text-align: center;">1100049</td>
<td style="text-align: center;">Cacoal</td>
<td style="text-align: center;">RO</td>
<td style="text-align: center;">2021</td>
<td style="text-align: center;">86416</td>
</tr>
<tr class="odd">
<td style="text-align: left;">6</td>
<td style="text-align: center;">1100056</td>
<td style="text-align: center;">Cerejeiras</td>
<td style="text-align: center;">RO</td>
<td style="text-align: center;">2021</td>
<td style="text-align: center;">16088</td>
</tr>
<tr class="even">
<td style="text-align: left;">7</td>
<td style="text-align: center;">1100064</td>
<td style="text-align: center;">Colorado do Oeste</td>
<td style="text-align: center;">RO</td>
<td style="text-align: center;">2021</td>
<td style="text-align: center;">15213</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<p>Por fim, podemos padronizar melhor o nome das colunas. Vamos utilizar as convenções do pacote <code>geobr</code>, por exemplo, e traduzir as variáveis para o inglês.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">pop21 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename</span>(</span>
<span id="cb9-2">  pop21,</span>
<span id="cb9-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name_muni =</span> nome_muni,</span>
<span id="cb9-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">abbrev_state =</span> abr_estado,</span>
<span id="cb9-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">code_muni =</span> municipio_codigo,</span>
<span id="cb9-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">year =</span> ano,</span>
<span id="cb9-7">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">population =</span> valor)</span></code></pre></div>
</div>
<p>A tabela final aparece abaixo.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="table-responsive">
<table class="table table-condensed table-hover table-striped table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: center;" data-quarto-table-cell-role="th">code_muni</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">name_muni</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">abbrev_state</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">year</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">population</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2</td>
<td style="text-align: center;">1100015</td>
<td style="text-align: center;">Alta Floresta D'Oeste</td>
<td style="text-align: center;">RO</td>
<td style="text-align: center;">2021</td>
<td style="text-align: center;">22516</td>
</tr>
<tr class="even">
<td style="text-align: left;">3</td>
<td style="text-align: center;">1100023</td>
<td style="text-align: center;">Ariquemes</td>
<td style="text-align: center;">RO</td>
<td style="text-align: center;">2021</td>
<td style="text-align: center;">111148</td>
</tr>
<tr class="odd">
<td style="text-align: left;">4</td>
<td style="text-align: center;">1100031</td>
<td style="text-align: center;">Cabixi</td>
<td style="text-align: center;">RO</td>
<td style="text-align: center;">2021</td>
<td style="text-align: center;">5067</td>
</tr>
<tr class="even">
<td style="text-align: left;">5</td>
<td style="text-align: center;">1100049</td>
<td style="text-align: center;">Cacoal</td>
<td style="text-align: center;">RO</td>
<td style="text-align: center;">2021</td>
<td style="text-align: center;">86416</td>
</tr>
<tr class="odd">
<td style="text-align: left;">6</td>
<td style="text-align: center;">1100056</td>
<td style="text-align: center;">Cerejeiras</td>
<td style="text-align: center;">RO</td>
<td style="text-align: center;">2021</td>
<td style="text-align: center;">16088</td>
</tr>
<tr class="even">
<td style="text-align: left;">7</td>
<td style="text-align: center;">1100064</td>
<td style="text-align: center;">Colorado do Oeste</td>
<td style="text-align: center;">RO</td>
<td style="text-align: center;">2021</td>
<td style="text-align: center;">15213</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<p>A padronização dos nomes traz como vantagem facilitar o <code>join</code> com o shapefile dos municípios usando o pacote <code>geobr</code>.</p>
<section id="variando-os-parâmetros-de-busca" class="level2">
<h2 class="anchored" data-anchor-id="variando-os-parâmetros-de-busca">Variando os parâmetros de busca</h2>
<p>A função <code>get_sidra()</code> permite refinar a query que gera a tabela final que é importada dentro do <code>R</code>. Os principais argumentos são:</p>
<ul>
<li><code>period</code> - escolhe a janela temporal dos dados.</li>
<li><code>variable</code> - escolhe a variável a ser importada.</li>
<li><code>geo</code> - nível geográfico dos dados (e.g.&nbsp;<code>"Brazil"</code>, <code>"City"</code>, <code>"Neighborhood"</code>, etc.).</li>
<li><code>geo.filter</code> - lista com filtros geográficos.</li>
<li><code>classific</code> - classificação dos dados.</li>
<li><code>category</code> - escolhe quais categorias (do <code>classific</code>) importar.</li>
</ul>
<p>De maneira geral, todos os parâmetros acima tem algumas nuances. Vamos explorá-los caso a caso</p>
</section>
<section id="importando-dados-de-vários-períodos" class="level2">
<h2 class="anchored" data-anchor-id="importando-dados-de-vários-períodos">Importando dados de vários períodos</h2>
<p>Para selecionar múltiplos períodos podemos montar um vetor <code>character</code> com os períodos desejados. Para selecionar uma sequência de períodos deve-se montar um string único encadeando os períodos com o sinal de “-”. O código abaixo deve deixar isto mais claro.</p>
<p>Note que se você rodar o código abaixo, provavelmente, vai enfrentar um problema de limite de query. A API do SIDRA restringe o número de linhas que um usuário pode chamar de uma só vez. Assim, para importar bases de dados maiores é preciso montar estratégias para particionar os dados.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Importa os dados de 2010 e de 2020</span></span>
<span id="cb10-2">pop <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_sidra</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6579</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">period =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2010"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2020"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">geo =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"City"</span>)</span>
<span id="cb10-3"></span>
<span id="cb10-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Importa todos os dados de 2010 até 2020 (erro: limite de requisição)</span></span>
<span id="cb10-5">pop <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_sidra</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6579</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">period =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2010-2020"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">geo =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"City"</span>)</span></code></pre></div>
</div>
<p>Um detalhe curioso é que a função não retorna erros quando o período extrapola os valores disponíveis nos dados. Assim a função abaixo retorna apenas os valores de 2021.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Importa todos os dados de 2021 até 2030</span></span>
<span id="cb11-2">pop <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_sidra</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6579</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">period =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2021-2030"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">geo =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"City"</span>)</span></code></pre></div>
</div>
<p>A mesma lógica acima vale para quando os dados são mensais ou trimestrais. Considere o exemplo da taxa de desocupação, levantada pela PNADC Trimestral. Note que os períodos estão no formato <code>YYYYQQ</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">info_sidra</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4099</span>)</span></code></pre></div>
</div>
<p>Vamos importar todos as observações da taxa de desocupação em 2012. Note que agora há múltiplas variáveis na mesma tabela e que o resultado já está em formato “long”.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1">unemp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_sidra</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4099</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">period =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"201201-201204"</span>)</span></code></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(unemp)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Nível Territorial (Código) Nível Territorial Unidade de Medida (Código)
2                          1            Brasil                          2
3                          1            Brasil                          2
4                          1            Brasil                          2
5                          1            Brasil                          2
6                          1            Brasil                          2
7                          1            Brasil                          2
  Unidade de Medida Valor Brasil (Código) Brasil Trimestre (Código)
2                 %   8.0               1 Brasil             201201
3                 %   0.9               1 Brasil             201201
4                 %  15.3               1 Brasil             201201
5                 %   0.7               1 Brasil             201201
6                 %  14.0               1 Brasil             201201
7                 %   0.7               1 Brasil             201201
          Trimestre Variável (Código)
2 1º trimestre 2012              4099
3 1º trimestre 2012              4103
4 1º trimestre 2012              4114
5 1º trimestre 2012              4115
6 1º trimestre 2012              4116
7 1º trimestre 2012              4117
                                                                                                                                                                           Variável
2                                                                                             Taxa de desocupação, na semana de referência, das pessoas de 14 anos ou mais de idade
3                                                                   Coeficiente de variação - Taxa de desocupação, na semana de referência, das pessoas de 14 anos ou mais de idade
4                           Taxa combinada de desocupação e de subocupação por insuficiência de horas trabalhadas, na semana de referência, das pessoas de 14 anos ou mais de idade
5 Coeficiente de variação - Taxa combinada de desocupação e de subocupação por insuficiência de horas trabalhadas, na semana de referência, das pessoas de 14 anos ou mais de idade
6                                                     Taxa combinada de desocupação e força de trabalho potencial, na semana de referência, das pessoas de 14 anos ou mais de idade
7                           Coeficiente de variação - Taxa combinada de desocupação e força de trabalho potencial, na semana de referência, das pessoas de 14 anos ou mais de idade</code></pre>
</div>
</div>
<p>Para refinar a busca acima temos de usar o argumento <code>variable</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1">unemp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_sidra</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4099</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">period =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"201201-202203"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">variable =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4099</span>)</span></code></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(unemp)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Nível Territorial (Código) Nível Territorial Unidade de Medida (Código)
2                          1            Brasil                          2
3                          1            Brasil                          2
4                          1            Brasil                          2
5                          1            Brasil                          2
6                          1            Brasil                          2
7                          1            Brasil                          2
  Unidade de Medida Valor Brasil (Código) Brasil Trimestre (Código)
2                 %   8.0               1 Brasil             201201
3                 %   7.6               1 Brasil             201202
4                 %   7.1               1 Brasil             201203
5                 %   6.9               1 Brasil             201204
6                 %   8.1               1 Brasil             201301
7                 %   7.5               1 Brasil             201302
          Trimestre Variável (Código)
2 1º trimestre 2012              4099
3 2º trimestre 2012              4099
4 3º trimestre 2012              4099
5 4º trimestre 2012              4099
6 1º trimestre 2013              4099
7 2º trimestre 2013              4099
                                                                               Variável
2 Taxa de desocupação, na semana de referência, das pessoas de 14 anos ou mais de idade
3 Taxa de desocupação, na semana de referência, das pessoas de 14 anos ou mais de idade
4 Taxa de desocupação, na semana de referência, das pessoas de 14 anos ou mais de idade
5 Taxa de desocupação, na semana de referência, das pessoas de 14 anos ou mais de idade
6 Taxa de desocupação, na semana de referência, das pessoas de 14 anos ou mais de idade
7 Taxa de desocupação, na semana de referência, das pessoas de 14 anos ou mais de idade</code></pre>
</div>
</div>
<p>Agora temos a série completa apenas da taxa de desocupação no Brasil. Podemos buscar também a taxa em cada uma das cidades do Brasil.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1">unemp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_sidra</span>(</span>
<span id="cb19-2">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4099</span>,</span>
<span id="cb19-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">period =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"201201-202203"</span>,</span>
<span id="cb19-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">variable =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4099</span>,</span>
<span id="cb19-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">geo =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"City"</span></span>
<span id="cb19-6">  )</span></code></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code>  Nível Territorial (Código) Nível Territorial Unidade de Medida (Código)
1                          6         Município                          2
2                          6         Município                          2
3                          6         Município                          2
4                          6         Município                          2
5                          6         Município                          2
6                          6         Município                          2
  Unidade de Medida Valor Município (Código)        Município
1                 %   9.0            1100205 Porto Velho - RO
2                 %  10.4            1200401  Rio Branco - AC
3                 %  12.9            1302603      Manaus - AM
4                 %   9.3            1400100   Boa Vista - RR
5                 %  10.5            1501402       Belém - PA
6                 %  12.6            1600303      Macapá - AP
  Trimestre (Código)         Trimestre Variável (Código)
1             201201 1º trimestre 2012              4099
2             201201 1º trimestre 2012              4099
3             201201 1º trimestre 2012              4099
4             201201 1º trimestre 2012              4099
5             201201 1º trimestre 2012              4099
6             201201 1º trimestre 2012              4099
                                                                               Variável
1 Taxa de desocupação, na semana de referência, das pessoas de 14 anos ou mais de idade
2 Taxa de desocupação, na semana de referência, das pessoas de 14 anos ou mais de idade
3 Taxa de desocupação, na semana de referência, das pessoas de 14 anos ou mais de idade
4 Taxa de desocupação, na semana de referência, das pessoas de 14 anos ou mais de idade
5 Taxa de desocupação, na semana de referência, das pessoas de 14 anos ou mais de idade
6 Taxa de desocupação, na semana de referência, das pessoas de 14 anos ou mais de idade</code></pre>
</div>
</div>
<p>Note, contudo, que temos o resultado somente nas capitais. Apesar do argumento “City” ser o mesmo que usamos na pesquisa de Estimativas da População, aqui o argumento “City” retorna apenas as capitais. Isto acontece porque a PNADC é uma pesquisa que é feita apenas nas capitais brasileiras e não tem uma desagregação a nível municipal para todos os municípios do Brasil. Este importante detalhe não fica evidente e depende do conhecimento prévio do usuário a respeito das pesquisas do IBGE.</p>
</section>
<section id="importando-muitos-dados" class="level2">
<h2 class="anchored" data-anchor-id="importando-muitos-dados">Importando muitos dados</h2>
<p>Como comentei acima, a API do SIDRA tem um limite de linhas nas queries. Isto significa que é preciso montar algumas estratégias para pegar as tabelas em partes menores. Na prática, isto vai depender muito da tabela e da informação que se quer.</p>
<p>O exemplo abaixo é bastante simples mas pode eventualmente ser útil em alguma outra aplicação. O código importa a tabela de estimativas populacionais ano a ano. O mesmo poderia ter sido feito num for-loop, mas prefiro usar o <code>lapply</code> por simplicidade.</p>
<p>Para acelerar o processo pode-se trocar o <code>lapply</code> por <code>parallel::mclapply</code> que roda a função em paralelo. Contudo, na minha experiência, esta estratégia acaba resultando em erros imprevistos. Não sei se isto é resultado de alguma restrição da API. Na prática, é mais seguro evitar o <code>mclapply</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Define um vetor com todos os anos da pesquisa</span></span>
<span id="cb21-2">periods <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2001</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2021</span>)</span>
<span id="cb21-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Converte para character</span></span>
<span id="cb21-4">periods <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.character</span>(periods)</span>
<span id="cb21-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Aplica a função get_sidra a cada elemento de periods (a cada ano)</span></span>
<span id="cb21-6">req <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lapply</span>(periods, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(p) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_sidra</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6579</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">period =</span> p, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">geo =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"City"</span>))</span>
<span id="cb21-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Junta o resultado numa única tabela</span></span>
<span id="cb21-8">tab <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>(req)</span></code></pre></div>
</div>
</section>
</section>
<section id="refinando-a-busca-em-casos-complexos" class="level1">
<h1>Refinando a busca em casos complexos</h1>
<section id="tabelas-do-censo" class="level2">
<h2 class="anchored" data-anchor-id="tabelas-do-censo">Tabelas do Censo</h2>
<p>Tabelas que vem do Censo costumam ter maior complexidade. Considere, por exemplo, a tabela 1378, que retorna a população residente, por situação do domicílio (urbano x rural), sexo e idade, segundo a condição no domicílio e compartilhamento da responsabilidade (responsável, cônjuge, filho, etc.)</p>
<p>O resultado da função abaixo é omitido para poupar espaço pois a saída é muito grande. Em casos como este é muito importante filtrar o resultado para conseguir uma tabela que faça sentido.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">info_sidra</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1378</span>)</span></code></pre></div>
</div>
<p>Vamos nos focar somente na população residente (var 93) de pessoas responsáveis do domicílio (cod 11941) por bairro de Porto Alegre (4314902).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1">resp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_sidra</span>(</span>
<span id="cb23-2">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1378</span>,</span>
<span id="cb23-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">variable =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">93</span>,</span>
<span id="cb23-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">classific =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"c455"</span>),</span>
<span id="cb23-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">geo =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Neighborhood"</span>,</span>
<span id="cb23-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">geo.filter =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"City"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4314902</span>)</span>
<span id="cb23-7">  )</span></code></pre></div>
</div>
<p>Após um pouco de limpeza no nome das colunas podemos ver o resultado abaixo.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="table-responsive">
<table class="table table-condensed table-hover table-striped table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: center;" data-quarto-table-cell-role="th">bairro</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">cond_domi</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">sexo</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">idade</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">situacao_domi</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">valor</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2</td>
<td style="text-align: center;">Medianeira</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">11568</td>
</tr>
<tr class="even">
<td style="text-align: left;">3</td>
<td style="text-align: center;">Medianeira</td>
<td style="text-align: center;">Pessoa responsável</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">4206</td>
</tr>
<tr class="odd">
<td style="text-align: left;">4</td>
<td style="text-align: center;">Medianeira</td>
<td style="text-align: center;">Pessoa responsável - com responsabilidade compartilhada</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">1054</td>
</tr>
<tr class="even">
<td style="text-align: left;">5</td>
<td style="text-align: center;">Medianeira</td>
<td style="text-align: center;">Pessoa responsável - sem responsabilidade compartilhada</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">3152</td>
</tr>
<tr class="odd">
<td style="text-align: left;">6</td>
<td style="text-align: center;">Medianeira</td>
<td style="text-align: center;">Cônjuge ou companheiro(a)</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">2101</td>
</tr>
<tr class="even">
<td style="text-align: left;">7</td>
<td style="text-align: center;">Medianeira</td>
<td style="text-align: center;">Cônjuge ou companheiro(a) - de sexo diferente</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">2094</td>
</tr>
<tr class="odd">
<td style="text-align: left;">8</td>
<td style="text-align: center;">Medianeira</td>
<td style="text-align: center;">Cônjuge ou companheiro(a) - de mesmo sexo</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">7</td>
</tr>
<tr class="even">
<td style="text-align: left;">9</td>
<td style="text-align: center;">Medianeira</td>
<td style="text-align: center;">Filho(a)</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">3429</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10</td>
<td style="text-align: center;">Medianeira</td>
<td style="text-align: center;">Filho(a) - da pessoa responsável e do cônjuge</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">1916</td>
</tr>
<tr class="even">
<td style="text-align: left;">11</td>
<td style="text-align: center;">Medianeira</td>
<td style="text-align: center;">Filho(a) - somente da pessoa responsável</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">1513</td>
</tr>
<tr class="odd">
<td style="text-align: left;">12</td>
<td style="text-align: center;">Medianeira</td>
<td style="text-align: center;">Enteado(a)</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">145</td>
</tr>
<tr class="even">
<td style="text-align: left;">13</td>
<td style="text-align: center;">Medianeira</td>
<td style="text-align: center;">Genro ou nora</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">170</td>
</tr>
<tr class="odd">
<td style="text-align: left;">14</td>
<td style="text-align: center;">Medianeira</td>
<td style="text-align: center;">Pai, mãe, padastro ou madrasta</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">183</td>
</tr>
<tr class="even">
<td style="text-align: left;">15</td>
<td style="text-align: center;">Medianeira</td>
<td style="text-align: center;">Sogro(a)</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">51</td>
</tr>
<tr class="odd">
<td style="text-align: left;">16</td>
<td style="text-align: center;">Medianeira</td>
<td style="text-align: center;">Neto(a)</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">549</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<p>Note que temos a coluna da condição do domicílio desagregada (c455), mas todas as outras (sexo, idade, etc.) estão agregadas.</p>
</section>
<section id="api-do-sidra" class="level2">
<h2 class="anchored" data-anchor-id="api-do-sidra">API do SIDRA</h2>
<p>Então imagine, por exemplo, que queremos esta mesma informação, por grupos de idade. Esta requisição quebra o limite da query. Além disso, os grupos de idade disponíveis são caóticos e não é possível filtrar dentro deste grupo da mesma maneira como fazemos com o argumento <code>variable</code>.</p>
<p>A solução é interagir diretamente com a API do SIDRA! O código acaba sendo bastante complexo/confuso. Muito provavelmente há maneiras de melhorar o código abaixo, mas foi como fiz para conseguir esta informação. Por conveniência chamo explicitamente todos os pacotes que uso. A limpeza dos dados foi a parte mais desafiadora do processo visto que não foi possível transformar o input de JSON para um <code>data.frame</code> de maneira direta.</p>
<p>Em partes, acho que dei o azar de ter escolhido uma tabela especialmente complicada. Se <code>jsonlite::fromJSON(x, simplifyDataFrame = TRUE)</code> tivesse funcionado, o código seria muito mais simples.</p>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Bibliotecas usadas</span></span>
<span id="cb24-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb24-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyr)</span>
<span id="cb24-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(stringr)</span>
<span id="cb24-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(janitor)</span>
<span id="cb24-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyjson)</span>
<span id="cb24-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(httr)</span>
<span id="cb24-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(jsonlite)</span>
<span id="cb24-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(geobr)</span>
<span id="cb24-10"></span>
<span id="cb24-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1. Montar a query</span></span>
<span id="cb24-12"></span>
<span id="cb24-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Montar um vetor com o código de todos os bairros de Porto Alegre</span></span>
<span id="cb24-14"></span>
<span id="cb24-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Importa o shapefile de todos os bairros IBGE (2010)</span></span>
<span id="cb24-16">bairros <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> geobr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_neighborhood</span>()</span>
<span id="cb24-17"></span>
<span id="cb24-18">bairros_poa <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> bairros <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb24-19">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Pega apenas os códigos dos bairros de POA</span></span>
<span id="cb24-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(code_muni <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4314902</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb24-21">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># O código do bairro tem alguns números sobrando no meio</span></span>
<span id="cb24-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">code_nb =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(</span>
<span id="cb24-23">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_sub</span>(code_neighborhood, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>),</span>
<span id="cb24-24">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_sub</span>(code_neighborhood, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>))</span>
<span id="cb24-25">    )</span>
<span id="cb24-26"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extrai o vetor com os códgios dos bairros</span></span>
<span id="cb24-27">codenb_poa <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> bairros_poa[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"code_nb"</span>]]</span>
<span id="cb24-28"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Colapsa o vetor num único string separado por vírgulas</span></span>
<span id="cb24-29">local <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(codenb_poa, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">collapse =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">","</span>)</span>
<span id="cb24-30"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Insere o string no formato da API</span></span>
<span id="cb24-31">local <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> stringr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_glue</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"localidades=N102[{local}]"</span>)</span>
<span id="cb24-32"></span>
<span id="cb24-33"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Base do url da API</span></span>
<span id="cb24-34">base <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://servicodados.ibge.gov.br/api/v3/agregados"</span></span>
<span id="cb24-35"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Número da tabela</span></span>
<span id="cb24-36">table <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1378</span></span>
<span id="cb24-37"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Período da extração (ano)</span></span>
<span id="cb24-38">period <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2010</span></span>
<span id="cb24-39"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Código da variável (Pessoas residentes)</span></span>
<span id="cb24-40">variable <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">93</span></span>
<span id="cb24-41"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Códigos das classes</span></span>
<span id="cb24-42">class <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">287</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">455</span>)</span>
<span id="cb24-43"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Filtro das classes (veja info_sidra(1378))</span></span>
<span id="cb24-44">category <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">93087</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">93100</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11941</span>))</span>
<span id="cb24-45"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Colapsa os strings</span></span>
<span id="cb24-46">category <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(category, paste, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">collapse =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">","</span>)</span>
<span id="cb24-47"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Coloca os strings no format da API</span></span>
<span id="cb24-48">cat_filter <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> stringr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_glue</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"{class}[{category}]"</span>)</span>
<span id="cb24-49"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Colapsa os strings num único string separado pelo operador booleano |</span></span>
<span id="cb24-50">cat_filter <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(cat_filter, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">collapse =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"|"</span>)</span>
<span id="cb24-51"></span>
<span id="cb24-52"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Monta a query</span></span>
<span id="cb24-53">query <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> stringr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_glue</span>(</span>
<span id="cb24-54">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"{base}/{table}/periodos/{period}/variaveis/{variable}?{local}&amp;classificacao={cat_filter}"</span></span>
<span id="cb24-55">)</span>
<span id="cb24-56"></span>
<span id="cb24-57"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 2. Importar dados</span></span>
<span id="cb24-58"></span>
<span id="cb24-59"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Importar os dados da API</span></span>
<span id="cb24-60">req <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> httr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">GET</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">url =</span> query)</span>
<span id="cb24-61">json <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> httr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">content</span>(req, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">as =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">encoding =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"UTF-8"</span>)</span>
<span id="cb24-62">json <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> jsonlite<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fromJSON</span>(json, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">simplifyVector =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb24-63"></span>
<span id="cb24-64"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 3. Limpar os dados</span></span>
<span id="cb24-65"></span>
<span id="cb24-66"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Simplificar os dados de JSON para um tibble</span></span>
<span id="cb24-67">valores <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> json <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb24-68">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">spread_all</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb24-69">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">enter_object</span>(resultados) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb24-70">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gather_array</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb24-71">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">spread_all</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb24-72">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">enter_object</span>(series) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb24-73">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gather_array</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb24-74">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">spread_all</span>()</span>
<span id="cb24-75"></span>
<span id="cb24-76"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extrair somente os valores da série</span></span>
<span id="cb24-77">valores <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> valores <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb24-78">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as_tibble</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb24-79">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">serie.2010 =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(serie<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.2010</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb24-80">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_wider</span>(</span>
<span id="cb24-81">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">id_cols =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"array.index"</span>,</span>
<span id="cb24-82">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_from =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"localidade.id"</span>,</span>
<span id="cb24-83">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_from =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"serie.2010"</span></span>
<span id="cb24-84">  )</span>
<span id="cb24-85"></span>
<span id="cb24-86"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extrair a classificação das variáveis (sexo, idade)</span></span>
<span id="cb24-87">classificacao <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> json <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb24-88">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">spread_all</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb24-89">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">enter_object</span>(resultados) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb24-90">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gather_array</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb24-91">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">spread_all</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb24-92">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">enter_object</span>(classificacoes) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb24-93">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gather_array</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb24-94">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">spread_all</span>()</span>
<span id="cb24-95"></span>
<span id="cb24-96"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extrai somente a coluna com os grupos de idade</span></span>
<span id="cb24-97">tblage <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> classificacao <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb24-98">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">contains</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"93"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb24-99">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as_tibble</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb24-100">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unite</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"age_group"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">everything</span>(), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb24-101">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(age_group <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb24-102">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">distinct</span>()</span>
<span id="cb24-103"></span>
<span id="cb24-104"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Cria um grid com todas as classificações na ordem correta</span></span>
<span id="cb24-105">tblclass <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expand_grid</span>(</span>
<span id="cb24-106">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">situacao_domicilio =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"urban"</span>,</span>
<span id="cb24-107">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">resp =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Responsável pelo Domicilio"</span>,</span>
<span id="cb24-108">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sex =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"male"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"female"</span>),</span>
<span id="cb24-109">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">age_group =</span> tblage<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>age_group</span>
<span id="cb24-110">)</span>
<span id="cb24-111"></span>
<span id="cb24-112"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Junta as classificações com os valores </span></span>
<span id="cb24-113">tab <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cbind</span>(valores, tblclass)</span>
<span id="cb24-114"></span>
<span id="cb24-115"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Converte os dados para wide</span></span>
<span id="cb24-116">tab <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> tab <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb24-117">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">starts_with</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"431"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"code_nb"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb24-118">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(code_nb, situacao_domicilio, resp, sex, age_group, value)</span>
<span id="cb24-119"></span>
<span id="cb24-120"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Converte os dados para uma tabela final</span></span>
<span id="cb24-121">respnb <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> tab <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb24-122">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_wider</span>(</span>
<span id="cb24-123">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">id_cols =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"code_nb"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"age_group"</span>),</span>
<span id="cb24-124">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_from =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sex"</span>,</span>
<span id="cb24-125">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_from =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"value"</span></span>
<span id="cb24-126">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb24-127">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">total =</span> male <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> female)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb24-128">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(code_nb) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb24-129">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">total_nb =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(total)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb24-130">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ungroup</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb24-131">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">share_nb =</span> total <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> total_nb <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)</span></code></pre></div>
</details>
</div>
<p>A tabela abaixo mostra o resultado final do código. A tabela apresenta o número total de pessoas responsáveis por domicílios em grupos de idade quinquenais por sexo e por bairro de Porto Alegre. Além disso, a coluna <code>total_nb</code> traz o número total de pessoas responsáveis por domicílio no bairro e <code>share_nb</code> computa a participação relativa de cada faixa de idade no total do bairro.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="table-responsive">
<table class="table table-condensed table-hover table-striped table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: center;" data-quarto-table-cell-role="th">code_nb</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">age_group</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">male</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">female</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">total</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">total_nb</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">share_nb</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">4314902003</td>
<td style="text-align: center;">20 a 24 anos</td>
<td style="text-align: center;">383</td>
<td style="text-align: center;">406</td>
<td style="text-align: center;">789</td>
<td style="text-align: center;">8757</td>
<td style="text-align: center;">9</td>
</tr>
<tr class="even">
<td style="text-align: center;">4314902005</td>
<td style="text-align: center;">20 a 24 anos</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">7</td>
<td style="text-align: center;">10</td>
<td style="text-align: center;">435</td>
<td style="text-align: center;">2</td>
</tr>
<tr class="odd">
<td style="text-align: center;">4314902007</td>
<td style="text-align: center;">20 a 24 anos</td>
<td style="text-align: center;">214</td>
<td style="text-align: center;">245</td>
<td style="text-align: center;">459</td>
<td style="text-align: center;">9116</td>
<td style="text-align: center;">5</td>
</tr>
<tr class="even">
<td style="text-align: center;">4314902069</td>
<td style="text-align: center;">20 a 24 anos</td>
<td style="text-align: center;">42</td>
<td style="text-align: center;">62</td>
<td style="text-align: center;">104</td>
<td style="text-align: center;">2071</td>
<td style="text-align: center;">5</td>
</tr>
<tr class="odd">
<td style="text-align: center;">4314902009</td>
<td style="text-align: center;">20 a 24 anos</td>
<td style="text-align: center;">331</td>
<td style="text-align: center;">359</td>
<td style="text-align: center;">690</td>
<td style="text-align: center;">13137</td>
<td style="text-align: center;">5</td>
</tr>
<tr class="even">
<td style="text-align: center;">4314902072</td>
<td style="text-align: center;">20 a 24 anos</td>
<td style="text-align: center;">75</td>
<td style="text-align: center;">57</td>
<td style="text-align: center;">132</td>
<td style="text-align: center;">3706</td>
<td style="text-align: center;">4</td>
</tr>
<tr class="odd">
<td style="text-align: center;">4314902068</td>
<td style="text-align: center;">20 a 24 anos</td>
<td style="text-align: center;">163</td>
<td style="text-align: center;">144</td>
<td style="text-align: center;">307</td>
<td style="text-align: center;">8052</td>
<td style="text-align: center;">4</td>
</tr>
<tr class="even">
<td style="text-align: center;">4314902013</td>
<td style="text-align: center;">20 a 24 anos</td>
<td style="text-align: center;">193</td>
<td style="text-align: center;">177</td>
<td style="text-align: center;">370</td>
<td style="text-align: center;">6319</td>
<td style="text-align: center;">6</td>
</tr>
<tr class="odd">
<td style="text-align: center;">4314902012</td>
<td style="text-align: center;">20 a 24 anos</td>
<td style="text-align: center;">31</td>
<td style="text-align: center;">19</td>
<td style="text-align: center;">50</td>
<td style="text-align: center;">2719</td>
<td style="text-align: center;">2</td>
</tr>
<tr class="even">
<td style="text-align: center;">4314902004</td>
<td style="text-align: center;">20 a 24 anos</td>
<td style="text-align: center;">206</td>
<td style="text-align: center;">227</td>
<td style="text-align: center;">433</td>
<td style="text-align: center;">13342</td>
<td style="text-align: center;">3</td>
</tr>
<tr class="odd">
<td style="text-align: center;">4314902032</td>
<td style="text-align: center;">20 a 24 anos</td>
<td style="text-align: center;">261</td>
<td style="text-align: center;">285</td>
<td style="text-align: center;">546</td>
<td style="text-align: center;">12171</td>
<td style="text-align: center;">4</td>
</tr>
<tr class="even">
<td style="text-align: center;">4314902022</td>
<td style="text-align: center;">20 a 24 anos</td>
<td style="text-align: center;">117</td>
<td style="text-align: center;">105</td>
<td style="text-align: center;">222</td>
<td style="text-align: center;">6910</td>
<td style="text-align: center;">3</td>
</tr>
<tr class="odd">
<td style="text-align: center;">4314902071</td>
<td style="text-align: center;">20 a 24 anos</td>
<td style="text-align: center;">49</td>
<td style="text-align: center;">29</td>
<td style="text-align: center;">78</td>
<td style="text-align: center;">NA</td>
<td style="text-align: center;">NA</td>
</tr>
<tr class="even">
<td style="text-align: center;">4314902045</td>
<td style="text-align: center;">20 a 24 anos</td>
<td style="text-align: center;">70</td>
<td style="text-align: center;">56</td>
<td style="text-align: center;">126</td>
<td style="text-align: center;">4190</td>
<td style="text-align: center;">3</td>
</tr>
<tr class="odd">
<td style="text-align: center;">4314902049</td>
<td style="text-align: center;">20 a 24 anos</td>
<td style="text-align: center;">71</td>
<td style="text-align: center;">65</td>
<td style="text-align: center;">136</td>
<td style="text-align: center;">4365</td>
<td style="text-align: center;">3</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<p>Apesar de claramente não ser o foco do post, pareceu um desperdício de esforço não fazer algo com esta informação. O código abaixo agrupa os dados um pouco mais e monta um mapa interativo dos domicílios por grupo de idade da pessoa responsável. Não seria difícil transformar isto num aplicativo para ver esta mesma info nas outras faixas de idade, mas isto fica para outro post.</p>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1">bairros <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> geobr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_neighborhood</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">showProgress =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb25-2"></span>
<span id="cb25-3">bairros_poa <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> bairros <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb25-4">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Pega apenas os códigos dos bairros de POA</span></span>
<span id="cb25-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(code_muni <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4314902</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb25-6">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># O código do bairro tem alguns números sobrando no meio</span></span>
<span id="cb25-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">code_nb =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(</span>
<span id="cb25-8">    stringr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_sub</span>(code_neighborhood, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>),</span>
<span id="cb25-9">    stringr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_sub</span>(code_neighborhood, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>))</span>
<span id="cb25-10">    )</span>
<span id="cb25-11"></span>
<span id="cb25-12"></span>
<span id="cb25-13">respnb <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> respnb <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb25-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">separate</span>(age_group, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">into =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"age_min"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"age_max"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" a "</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb25-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb25-16">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">age_generation =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(</span>
<span id="cb25-17">      age_min <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">25</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> age_min <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"25-39"</span>,</span>
<span id="cb25-18">      age_min <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> age_min <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"40-59"</span>,</span>
<span id="cb25-19">      age_min <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> age_min <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">80</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"60-79"</span>,</span>
<span id="cb25-20">      age_min <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">80</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"80+"</span>,</span>
<span id="cb25-21">      <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;25"</span></span>
<span id="cb25-22">    )</span>
<span id="cb25-23">  )</span>
<span id="cb25-24"></span>
<span id="cb25-25">resp_grouped_nb <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> respnb <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb25-26">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(code_nb, age_generation) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb25-27">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pop =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(total, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb25-28">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(code_nb) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb25-29">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">total_nb =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(pop)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb25-30">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ungroup</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb25-31">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">share_nb =</span> pop <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> total_nb <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)</span>
<span id="cb25-32"></span>
<span id="cb25-33">resp_ages <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_wider</span>(</span>
<span id="cb25-34">  resp_grouped_nb,</span>
<span id="cb25-35">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">id_cols =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"code_nb"</span>,</span>
<span id="cb25-36">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_from =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"age_generation"</span>,</span>
<span id="cb25-37">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_prefix =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"age_"</span>,</span>
<span id="cb25-38">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_from =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"share_nb"</span></span>
<span id="cb25-39">)</span>
<span id="cb25-40"></span>
<span id="cb25-41">resp_ages <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> janitor<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">clean_names</span>(resp_ages)</span>
<span id="cb25-42"></span>
<span id="cb25-43">resp_bairros <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(bairros_poa, resp_ages, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"code_nb"</span>)</span></code></pre></div>
</details>
</div>
<p>O mapa é gerado pelo código abaixo. O mapa mostra o share de domicílios, em cada bairro, que são chefiados por “adultos-jovens”, isto é, de 25 a 39 anos. Nota-se que os bairros que tem maiores percentuais estão mais na periferia da cidade. Alguns bairros de classe alta como Moinhos de Vento, Três Figueiras e Vila Assunção tem os menores percentuais.</p>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tmap)</span>
<span id="cb26-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tmaptools)</span>
<span id="cb26-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tmap_mode</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mode =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"view"</span>)</span>
<span id="cb26-4"></span>
<span id="cb26-5">m <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tm_shape</span>(resp_bairros) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tm_fill</span>(</span>
<span id="cb26-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"age_25_39"</span>,</span>
<span id="cb26-8">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">palette =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"inferno"</span>,</span>
<span id="cb26-9">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>,</span>
<span id="cb26-10">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">style =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"jenks"</span>,</span>
<span id="cb26-11">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,</span>
<span id="cb26-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">id =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"name_neighborhood"</span>,</span>
<span id="cb26-13">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Percentual de domicílios&lt;br&gt;chefiados por pessoas&lt;br&gt;de 25 a 39 anos (%)."</span>,</span>
<span id="cb26-14">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">popup.vars =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(</span>
<span id="cb26-15">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Menos de 25 anos"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"age_25"</span>,</span>
<span id="cb26-16">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"25 a 39 anos"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"age_25_39"</span>,</span>
<span id="cb26-17">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"40 a 59 anos"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"age_40_59"</span>,</span>
<span id="cb26-18">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"60 a 79 anos"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"age_60_79"</span>,</span>
<span id="cb26-19">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"80 anos ou mais"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"age_80"</span>),</span>
<span id="cb26-20">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">popup.format =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">digits =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb26-21">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.format =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">digits =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tm_borders</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-23">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tm_basemap</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">server =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CartoDB.Positron"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-24">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tm_view</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">set.view =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">51.179152</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">30.025976</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span>))</span>
<span id="cb26-25"></span>
<span id="cb26-26">leaf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tmap_leaflet</span>(m)</span>
<span id="cb26-27">widgetframe<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">frameWidget</span>(leaf, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"100%"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div id="htmlwidget-c54b2f67a90b5c0d92b4" style="width:100%;height:415.296px;" class="widgetframe html-widget "></div>
<script type="application/json" data-for="htmlwidget-c54b2f67a90b5c0d92b4">{"x":{"url":"index_files/figure-html//widgets/widget_unnamed-chunk-27.html","options":{"xdomain":"*","allowfullscreen":false,"lazyload":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>


</section>
</section>

 ]]></description>
  <category>data-science</category>
  <category>economia</category>
  <category>tutorial-R</category>
  <guid>https:://www.restateinsight.com/posts/general-posts/2023-08-importando-dados-sidra/index.html</guid>
  <pubDate>Thu, 10 Aug 2023 03:00:00 GMT</pubDate>
  <media:content url="https:://www.restateinsight.com/static/images/thumbnails/sidra_logo.png" medium="image" type="image/png" height="70" width="144"/>
</item>
<item>
  <title>Definindo objetos no R. = ou &lt;- ?</title>
  <dc:creator>Vinicius Oike</dc:creator>
  <link>https:://www.restateinsight.com/posts/general-posts/repost-definindo-objetos/index.html</link>
  <description><![CDATA[ 




<section id="definindo-objetos-no-r" class="level1">
<h1>Definindo objetos no R</h1>
<p>Há dois operadores para definir um objeto no R: <code>=</code> e <code>&lt;-</code>. A maior parte dos usuários parece preferir o último apesar dele parecer um tanto inconveniente. Em teclados antigos, havia uma tecla específica com o símbolo <code>&lt;-</code>, mas em teclados ABNT modernos ele exige três teclas para ser escrito.</p>
<p>Para contornar este incômodo é comum criar um atalho no teclado para esse símbolo; o RStudio, por exemplo, tem um atalho usando a teclas <code>Alt</code> e <code>-</code> em conjunto. Mas ainda assim fica a questão: por que não utilizar o <code>=</code>? A resposta curta é que o símbolo <code>&lt;-</code> é a melhor e mais consistente forma de definir objetos R. Na prática, contudo, há poucas diferenças entre as expressões e elas dificilmente vão fazer alguma diferença. Podemos começar com um exemplo bastante simples para entender estas diferenças.</p>
<section id="qual-a-diferença" class="level2">
<h2 class="anchored" data-anchor-id="qual-a-diferença">Qual a diferença?</h2>
<p>O código abaixo cria duas variáveis, <code>x</code> e <code>y</code>, cujos valores são a sequência <img src="https://latex.codecogs.com/png.latex?1,%202,%203,%204,%205">. Até aí tudo igual. A função <code>all.equal</code> certifica que os objetos são iguais e a função <code>rm</code> “deleta” os objetos. Esta última vai ser conveniente para manter os exemplos organizados.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1">x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span></span>
<span id="cb1-2">y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span></span>
<span id="cb1-3"></span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">all.equal</span>(x, y)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rm</span>(x, y)</span></code></pre></div>
</div>
<p>Agora considere o código abaixo. A função <code>median</code> está sendo aplicada em <code>x &lt;- 1:5</code>. O que acontece desta vez? O resultado é que é criada uma variável <code>x</code> com valor <code>1 2 3 4 5</code> e também é impresso a mediana deste vetor, i.e., <code>3</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">median</span>(x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">x</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 2 3 4 5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rm</span>(x)</span></code></pre></div>
</div>
<p>Poderíamos fazer o mesmo usando <code>=</code>, certo? Errado. Aí está uma das primeiras diferenças entre estes operadores. O código abaixo calcula a mediana do vetor, mas não cria um objeto chamado <code>x</code> com valor <code>1 2 3 4 5</code>. Por quê? O problema é que o operador <code>=</code> tem <em>duas finalidades distintas</em>. Ele serve tanto para definir <em>novos</em> objetos, como em <code>x = 2</code>, como também para definir o <em>valor dos argumentos de uma função</em>, como em <code>rnorm(n = 10, mean = 5, sd = 1)</code>. Coincidentemente, o nome do primeiro argumento da função <code>median</code> é x. Logo, o código abaixo é interpretado como: tire a mediana do vetor <code>1 2 3 4 5</code>. O mesmo acontece com outras funções (ex: <code>mean</code>, <code>var</code>, etc.)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">median</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1">x</span></code></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'x' not found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rm</span>(x)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in rm(x): object 'x' not found</code></pre>
</div>
</div>
<p>Outro exemplo em que há divergência entre os operadores é com o comando <code>lm</code>. Usando <code>&lt;-</code> podemos escrever, numa única linha, um comando que define um objeto <code>lm</code> (resultado de uma regressão) ao mesmo tempo em que pedimos ao R para imprimir os resultados desta regressão. O código abaixo faz justamente isto.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Imprime os resultados da regressão e salva as info num objeto chamado 'fit'</span></span>
<span id="cb15-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(fit <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(mpg <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> wt, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> mtcars))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = mpg ~ wt, data = mtcars)

Residuals:
    Min      1Q  Median      3Q     Max 
-4.5432 -2.3647 -0.1252  1.4096  6.8727 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  37.2851     1.8776  19.858  &lt; 2e-16 ***
wt           -5.3445     0.5591  -9.559 1.29e-10 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 3.046 on 30 degrees of freedom
Multiple R-squared:  0.7528,    Adjusted R-squared:  0.7446 
F-statistic: 91.38 on 1 and 30 DF,  p-value: 1.294e-10</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Verifica que é, de fato, um objeto lm</span></span>
<span id="cb17-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">class</span>(fit)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "lm"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rm</span>(fit)</span></code></pre></div>
</div>
<p>Note que isto não é possível com o operador <code>=</code>. Isto acontece, novamente, porque o <code>=</code> é interpretado de maneira diferente quando aparece dentro de uma função. É necessário quebrar o código em duas linhas.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Este exemplo não funciona</span></span>
<span id="cb20-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fit =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(mpg <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> wt, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> mtcars))</span></code></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in summary.lm(fit = lm(mpg ~ wt, data = mtcars)): argument "object" is missing, with no default</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># É preciso reescrever o código em duas linhas</span></span>
<span id="cb22-2">fit <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(mpg <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> wt, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> mtcars)</span>
<span id="cb22-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(fit)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = mpg ~ wt, data = mtcars)

Residuals:
    Min      1Q  Median      3Q     Max 
-4.5432 -2.3647 -0.1252  1.4096  6.8727 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  37.2851     1.8776  19.858  &lt; 2e-16 ***
wt           -5.3445     0.5591  -9.559 1.29e-10 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 3.046 on 30 degrees of freedom
Multiple R-squared:  0.7528,    Adjusted R-squared:  0.7446 
F-statistic: 91.38 on 1 and 30 DF,  p-value: 1.294e-10</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rm</span>(fit)</span></code></pre></div>
</div>
<p>Há também algumas pequenas divergências pontuais. Os primeiros dois argumentos da função <code>lm</code> são <code>formula</code> e <code>data</code>. Considere o código abaixo. Sem executar o código qual deve ser o resultado?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1">fit <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(formula <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> mpg <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> wt, data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> mtcars)</span></code></pre></div>
</div>
<p>Estamos aplicando a função <code>lm</code> em dois argumentos. O primeiro deles se chama <code>formula</code> e é definido como <code>mpg ~ wt</code>, o segundo é chamado <code>data</code> e é definido como os valores no data.frame <code>mtcars</code>. Ou seja, o resultado deve ser o mesmo do exemplo acima com <code>median(x &lt;- 1:5)</code>. A função é aplicada sobre os argumentos e os objetos <code>formula</code> e <code>data</code> são criados.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1">fit <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(formula <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> mpg <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> wt, data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> mtcars)</span>
<span id="cb26-2">fit</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = formula &lt;- mpg ~ wt, data = data &lt;- mtcars)

Coefficients:
(Intercept)           wt  
     37.285       -5.344  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1">formula</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>mpg ~ wt</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(data)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   mpg cyl disp  hp drat    wt  qsec vs am gear carb
Mazda RX4         21.0   6  160 110 3.90 2.620 16.46  0  1    4    4
Mazda RX4 Wag     21.0   6  160 110 3.90 2.875 17.02  0  1    4    4
Datsun 710        22.8   4  108  93 3.85 2.320 18.61  1  1    4    1
Hornet 4 Drive    21.4   6  258 110 3.08 3.215 19.44  1  0    3    1
Hornet Sportabout 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2
Valiant           18.1   6  225 105 2.76 3.460 20.22  1  0    3    1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb32" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rm</span>(fit, formula, data)</span></code></pre></div>
</div>
<p>Note que usei os nomes dos argumentos apenas para exemplificar o caso. Pode-se colocar um nome diferente, pois não estamos “chamando” o argumento e sim especificando qual valor/objeto a função deve utilizar.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Exemplo utilizando nomes diferentes</span></span>
<span id="cb33-2">fit <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(a <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mpg ~ wt"</span>, b <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> mtcars)</span>
<span id="cb33-3">fit</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = a &lt;- "mpg ~ wt", data = b &lt;- mtcars)

Coefficients:
(Intercept)           wt  
     37.285       -5.344  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb35" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(a)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "mpg ~ wt"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb37" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(b)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   mpg cyl disp  hp drat    wt  qsec vs am gear carb
Mazda RX4         21.0   6  160 110 3.90 2.620 16.46  0  1    4    4
Mazda RX4 Wag     21.0   6  160 110 3.90 2.875 17.02  0  1    4    4
Datsun 710        22.8   4  108  93 3.85 2.320 18.61  1  1    4    1
Hornet 4 Drive    21.4   6  258 110 3.08 3.215 19.44  1  0    3    1
Hornet Sportabout 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2
Valiant           18.1   6  225 105 2.76 3.460 20.22  1  0    3    1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rm</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">list =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ls</span>())</span></code></pre></div>
</div>
<p>O mesmo não é possível com <code>=</code>, por causa da duplicidade apontada acima.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1">fit <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">a =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mpg ~ wt"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">b =</span> mtcars)</span></code></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in terms.formula(formula, data = data): argument is not a valid model</code></pre>
</div>
</div>
<p>Há ainda mais alguns exemplos estranhos, resultados da ordem que o R processa os comandos. O segundo código abaixo, por exemplo, não funciona. Isto acontece porque o <code>&lt;-</code> tem “prioridade” e é lido primeiro.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1">(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1">(x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span></code></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in x &lt;- y = 5: could not find function "&lt;-&lt;-"</code></pre>
</div>
</div>
<p>É difícil encontrar desvatagens em usar o <code>&lt;-</code> (além da dificuldade de escrevê-lo num teclado normal). Mas há pelo menos um caso em que ele pode levar a problemas. O código abaixo mostra como este operador pode ser sensível a espaços em branco. No caso, define-se o valor de <code>x</code> como <code>-2</code>. O primeiro teste verifica se o valor de <code>x</code> é menor que <img src="https://latex.codecogs.com/png.latex?-1">. Logo, espera-se que o código imprima <code>"ótimo"</code> pois <code>-2</code> é menor que <code>-1</code>. Já o segundo teste faz <em>quase</em> o mesmo. A única diferença é um espaço em branco, mas agora ao invés de um teste, a linha de código define o valor de x como <code>1</code> e imprime <code>"ótimo"</code>, pois o valor do teste (por padrão) é <code>TRUE</code>.</p>
<p>Assim como muitos dos exemplos acima, é difícil imaginar que isto possa ser um problema real. Eventualmente, podemos apagar espaços em branco usando o ‘localizar e substituir’ e isto talvez leve a um erro como o abaixo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Define x como -2</span></span>
<span id="cb46-2">x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb46-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Se x for menor que -1 (menos um) então "ótimo"</span></span>
<span id="cb46-4"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ótimo"</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"errado"</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "ótimo"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Verifica o valor de x</span></span>
<span id="cb48-2">x</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb50" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Mesma linha com uma diferença sutil</span></span>
<span id="cb50-2"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> ) <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ótimo"</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"errado"</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "ótimo"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb52" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Agora acabamos de mudar o valor de x (e não há aviso algum!)</span></span>
<span id="cb52-2">x</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
</div>
</section>
<section id="mais-um-adendo" class="level2">
<h2 class="anchored" data-anchor-id="mais-um-adendo">Mais um adendo</h2>
<p>Eu citei apenas dois operadores: <code>=</code> e <code>&lt;-</code>; mas na verdade há ainda outros: <code>&lt;&lt;-</code>, <code>-&gt;</code> e <code>-&gt;&gt;</code> (veja <code>help("assignOps")</code>). Os operadores com “flecha dupla” são comumente utilizadas dentro de funções para usos específicos. Algumas pessoas acham que o operador <code>-&gt;</code> é mais intuitivo quando usado com “pipes”. Pessoalmente, acho este tipo de código abominável.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1">AirPassengers <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb54-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb54-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">window</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1955</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">end =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1958</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>)) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">-&gt;</span> sub_air_passengers</span>
<span id="cb54-4"></span>
<span id="cb54-5">sub_air_passengers</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Jan      Feb      Mar      Apr      May      Jun      Jul      Aug
1955 5.488938 5.451038 5.587249 5.594711 5.598422 5.752573 5.897154 5.849325
1956 5.648974 5.624018 5.758902 5.746203 5.762051 5.924256 6.023448 6.003887
1957 5.752573 5.707110 5.874931 5.852202 5.872118 6.045005 6.142037 6.146329
1958 5.828946 5.762051 5.891644 5.852202 5.894403 6.075346 6.196444 6.224558
          Sep      Oct      Nov      Dec
1955 5.743003 5.613128 5.468060 5.627621
1956 5.872118 5.723585 5.602119 5.723585
1957 6.001415 5.849325 5.720312 5.817111
1958 6.001415 5.883322 5.736572 5.820083</code></pre>
</div>
</div>
<p>Além dos operadores base, o popular pacote <code>magrittr</code> também possui um novo tipo de operador. Muitos conhecem o <code>%&gt;%</code> que ajuda a formar “pipes” e carregar objetos progressivamente em funções distintas. Menos conhecido, mas igualmente poderoso, o <code>%&lt;&gt;%</code> faz algo parecido.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(magrittr)</span>
<span id="cb56-2">x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span></span>
<span id="cb56-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(x)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 2 3 4 5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb58" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1">x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&lt;&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&lt;&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sin</span>()</span>
<span id="cb58-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(x)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.14112</code></pre>
</div>
</div>
<p>Note que o código acima é equivalente ao abaixo. A vantagem do operador <code>%&lt;&gt;%</code> é de evitar a repetição do <code>x &lt;- x ...</code> o que pode ser conveniente quando o nome do objeto é longo. Da mesma forma, também pode ser aplicado para transformar elementos em uma lista ou colunas num <code>data.frame</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1">x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span></span>
<span id="cb60-2">x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sin</span>()</span></code></pre></div>
</div>
<p>Não recomendo o uso nem do <code>-&gt;</code> e nem do <code>%&lt;&gt;%</code>.</p>
</section>
<section id="resumo" class="level2">
<h2 class="anchored" data-anchor-id="resumo">Resumo</h2>
<p>No geral, o operador <code>&lt;-</code> é a forma mais “segura” de se definir objetos. De fato, atualmente, este operador é considerado o mais apropriado. O livro <a href="https://adv-r.hadley.nz/"><em>Advanced R</em></a>, do influente autor Hadley Wickham, por exemplo, recomenda que se use o operador <code>&lt;-</code> <em>exclusivamente</em> para definir objetos.</p>
<p>A inconveniência de escrevê-lo num teclado moderno é contornada, como comentado acima, por atalhos como o <code>Alt</code> + <code>-</code> no RStudio. Em editores de texto como o VSCode, Sublime Text ou Notepad++ também é possível criar atalhos personalizados para o <code>&lt;-</code>. Pessoalmente, eu já me acostumei a digitar <code>&lt;-</code> manualmente e não vejo grande problema nisso. Acho que o <code>=</code> tem seu valor por ser mais intutivo, especialmente para usuários que já tem algum conhecimento de programação, mas acabo usando mais o <code>&lt;-</code>. Por fim, o <code>&lt;-</code> fica bem bonito quando se usa uma fonte com ligaturas como o <a href="https://github.com/tonsky/FiraCode">Fira Code</a>.</p>
<p>É importante frisar que o <code>&lt;-</code> continua sendo o operador de predileção da comunidade dos usuários de R e novas funções/pacotes devem ser escritas com este sinal. Por sorte há opções bastante simples que trocam os <code>=</code> para <code>&lt;-</code> corretamente como o <code>formatR</code> apresentado abaixo. Veja também o addin do pacote <code>styler</code>. Ou seja, é possível escrever seu código usando <code>=</code> e trocá-los por <code>&lt;-</code> de maneira automática se for necessário.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(formatR)</span>
<span id="cb61-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tidy_source</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">text =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x = rnorm(n = 10, mean = 2)"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">arrow =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>x &lt;- rnorm(n = 10, mean = 2)</code></pre>
</div>
</div>
<p>O ponto central deste post, na verdade, é mostrar como os operadores <code>&lt;-</code> e <code>=</code> são muito similares na prática e que a escolha entre um ou outro acaba caindo numa questão subjetiva. Há quem acredite ser mais cômodo usar o <code>=</code> não só porque ele é mais fácil de escrever, mas também porque ele é mais próximo de <em>universal</em>. Várias linguagens de programação comuns para a/o economista (Matlab, Python, Stata, etc.) usam o sinal de igualdade para definir objetos e parece estranho ter que usar o <code>&lt;-</code> somente para o R.</p>
<p>Em livros de econometria ambos os operadores são utilizados. Os livros <a href="https://www.econometrics-with-r.org/index.html">Introduction to Econometrics with R</a>, <a href="https://www.zeileis.org/teaching/AER/">Applied Econometrics with R</a>, <a href="https://link.springer.com/book/10.1057/9781137317940">Arbia. Spatial Econometrics</a>, entre outros, usam o <code>&lt;-</code>. Já os livros <a href="https://faculty.chicagobooth.edu/ruey-s-tsay/research/analysis-of-financial-time-series-3rd-edition">Tsay. Financial Time Series</a> e <a href="https://link.springer.com/book/10.1007/978-3-319-52452-8">Shumway &amp; Stoffer. Time Series Analysis</a> usam <code>=</code>.</p>
<p>No fim, use o operador que melhor</p>


</section>
</section>

 ]]></description>
  <category>tutorial-R</category>
  <guid>https:://www.restateinsight.com/posts/general-posts/repost-definindo-objetos/index.html</guid>
  <pubDate>Tue, 11 Jul 2023 03:00:00 GMT</pubDate>
  <media:content url="https:://www.restateinsight.com/static/codigo_generico.png" medium="image" type="image/png" height="56" width="144"/>
</item>
<item>
  <title>Pacotes Essenciais R</title>
  <dc:creator>Vinicius Oike</dc:creator>
  <link>https:://www.restateinsight.com/posts/general-posts/repost-pacotes-essenciais-r/index.html</link>
  <description><![CDATA[ 




<p>R é uma das linguagens de programação mais populares para ciência de dados, estatística, economia e várias outras áreas quantitativas. O <code>R</code> já vem com alguns pacotes “imbutidos” que, em geral, são referidos como <code>base R</code>, são os pacotes que são instalados automaticamente junto com o <code>R</code> como o <code>stats</code>, <code>utils</code>, <code>graphics</code>, <code>datasets</code> entre outros.</p>
<p>Ou seja, já é possível importar dados e limpá-los, fazer análises estatísticas, gráficos e tabelas sem carregar nenhum pacote adicional.</p>
<p>Mas para o usufruir de todo o potencial que o R pode oferecer é essencial conhecer os melhores pacotes e as suas funções.</p>
<section id="a-lista-de-pacotes-essenciais" class="level1">
<h1>A lista de pacotes essenciais</h1>
<table class="table">
<colgroup>
<col style="width: 39%">
<col style="width: 60%">
</colgroup>
<thead>
<tr class="header">
<th>Nome do Pacote</th>
<th>Principal Uso</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p><code>data.table</code></p></td>
<td><p>Manipulação de dados extremamente veloz para bigdata</p></td>
</tr>
<tr class="even">
<td><p><code>dplyr</code> + <code>tidyr</code></p></td>
<td><p>Manipulação de dados</p></td>
</tr>
<tr class="odd">
<td><p><code>readr</code></p></td>
<td><p>Importar e exportar arquivos</p></td>
</tr>
<tr class="even">
<td><p><code>stringr</code></p></td>
<td><p>Trabalhar com strings</p></td>
</tr>
<tr class="odd">
<td><p><code>lubridate</code></p></td>
<td><p>Trabalhar com datas</p></td>
</tr>
<tr class="even">
<td><p><code>ggplot2</code></p></td>
<td><p>Visualização de dados com varias extensões</p></td>
</tr>
<tr class="odd">
<td><p><code>knitr</code> + <code>shiny</code> + <code>rmarkdown</code> + <code>quarto</code></p></td>
<td><p>Desenvolvimento de relatórios, apresentações, dashboards e Apps</p></td>
</tr>
<tr class="even">
<td><p><code>dbplyr</code></p></td>
<td><p>Interface para interagir com Bases de Dados (SQL, PostGreSQL, etc.)</p></td>
</tr>
</tbody>
</table>
<p>A verdade é que cada usuário de <code>R</code> tem demandas específicas, então é difícil dizer quais são os pacotes <strong>indisipensáveis</strong>. Por isso o foco da minha lista foi em pacotes que facilitam três partes essenciais de qualquer análise de dados: importação, manipulação e apresentação dos dados.</p>
<p>Independentemente do foco do seu projeto ou da sua pesquisa eu garanto que será necessário:</p>
<ol type="1">
<li>Importar dados no <code>R</code></li>
<li>Transformar esses dados</li>
<li>Apresentar seus resultados na forma de gráficos, tabelas, relatórios, dashboards, etc.</li>
</ol>
</section>
<section id="importar-dados" class="level1">
<h1>Importar dados</h1>
<section id="tabelas-csv" class="level3">
<h3 class="anchored" data-anchor-id="tabelas-csv">Tabelas csv</h3>
<p>Quando comecei a usar <code>R</code> uma das partes mais agoniantes era conseguir importar arquivos de dados externos corretamente. As funções <code>read.csv</code>, <code>read.csv2</code>, <code>read.delim</code> funcionam bem, mas o <code>readr</code> tornou isso tudo muito mais fácil.</p>
<p>O pacote essencialmente tem funções <code>read_*</code> (<code>read_csv</code>, <code>read_fwf</code>, etc.) que servem para importar dados e funções <code>write_</code> (<code>write_csv</code>, <code>write_excel_csv</code>, etc.) que servem para exportar dados num formato específico.</p>
<p>Além das funções <code>read_*</code> e <code>write_*</code>, vale a pena explorar as funções <code>parse_*</code> como <code>parse_number</code> e <code>parse_date</code> que são muito convenientes para garantir que seus dados estejam sendo interpretados da maneira correta.</p>
<p>Para arquivos mais pesados vale considerar duas opções: <code>vroom</code> e <code>data.table</code>. O primeiro é um pacote enxuto que permite a importação e exportação rápida de arquivos <code>csv</code> mais pesados. Já a segunda opção é um pacote completo, que será disuctido em maiores detalhes abaixo, de importação e manipulação de dados. A função <code>data.table::fread</code> é extremamente veloz.</p>
</section>
<section id="outros-formatos" class="level3">
<h3 class="anchored" data-anchor-id="outros-formatos">Outros formatos</h3>
<p>Se você utiliza dados em formatos mais específicos então outros pacotes se tornam essenciais. A lista abaixo cita alguns dos casos mais comuns:</p>
<ul>
<li><code>haven</code> - SPSS, SAS e Stata</li>
<li><code>readxl</code> - Excel</li>
<li><code>jsonlite</code> - Json</li>
<li><code>sf</code> - Shapefiles em geral</li>
</ul>
<p>Por fim, vale notar um pacote simpático chamado <code>rio</code> que tem duas funções centrais <code>import</code> e <code>export</code>. Essas funções automaticamente detectam o tipo de arquivo que você quer importar ou exportar e chamam a função do pacote apropriado para executar a tarefa.</p>
<p>A única desvantagem desta conveniência é que em casos mais complicados pode ser difícil lembrar do nome dos argumentos da função que você precisa. Por exemplo, o <code>import</code> usa o o <code>readxl</code> para importar um arquivo <code>xlsx</code>. Mas você precisa lembrar de cabeça que o argumento para selecionar uma aba específica é <code>sheet</code>.</p>
</section>
</section>
<section id="manipulação-de-dados" class="level1">
<h1>Manipulação de dados</h1>
<p>Toda análise começa com uma base de dados (ou muitas bases de dados). E se você já se aventurou o suficiente no mundo, você sabe que são raríssimas as bases de dados que já vem prontas no momento em que você baixa o <code>csv</code> ou <code>xlsx</code>. Na grande maioria dos casos, é preciso passar por diversas etapas de limpeza ou de pré-processamento para transformar os dados em algo que possa ser analisado.</p>
<p>O <code>R</code> tem várias funções no seu core para realizar essas tarefas mas há dois pacotes essenciais que melhoram (e muito) essa tarefa: <code>dplyr</code> e <code>data.table</code>.</p>
<section id="dplyr-x-data.table" class="level2">
<h2 class="anchored" data-anchor-id="dplyr-x-data.table">dplyr x data.table</h2>
<p>O <code>dplyr</code> é bastante intuitivo, poderoso e há centenas de tutoriais e livros sobre ele. Ele serve para transformar os dados: criar colunas, filtrar linhas, reordernar dados, etc. Ele integra um “ecossistema” de pacotes chamado <a href="https://www.tidyverse.org">tidyverse</a>, uma coleção de pacotes para processamento e visualização de dados, construídos em torno de uma filosofia comum.</p>
<p>O <code>data.table</code> surgiu com o intuito de fazer o <code>R</code> funcionar melhor num mundo de big data. Seu desenvolvimento foi focado em ser o mais rápido, eficiente e sucinto possível, permitindo trabalhar com bases de dados muito grandes dentro do <code>R</code> (~100GB). Em termos de velocidade, o <code>data.table</code> ganha facilmente de praticamente <a href="https://h2oai.github.io/db-benchmark/">todas as outras linguagens populares em data science</a>. Ele é centena de vezes mais rápido que base <code>R</code> e também ganha com folga do seu competidor <code>dplyr</code>.</p>
<p>Se o <code>data.table</code> é tão mais eficiente então como o <code>dplyr</code> se tornou mais popular do que ele?</p>
<p>Acontece que o <code>dplyr</code> é melhor integrado com vários outros pacotes podersos do <code>tidyverse</code>. Também há muito material de apoio ao <code>dplyr</code> na forma de tutoriais, vídeos, livros, etc. disponíveis na internet. Quase todo curso de R ensina a usar o <code>dplyr</code>. Assim, a curva de aprendizado fica mais fácil.</p>
<p>O <code>data.table</code> funciona muito bem com funções do <code>base R</code> como <code>lapply</code>, <code>colMeans()</code>, etc. e tem uma sintaxe concisa e flexível, onde o usuário acaba tendo bastante liberdade para criar as suas soluções. Já o <code>dplyr</code> vai pelo caminho de tentar facilitar ao máximo a vida do usuário criando várias funções com usos bastante específicos para otimizar pequenas tarefas do dia-a-dia do processamento de dados.</p>
<p>Outra pequena desvantagem do <code>data.table</code> é que ele <strong>não funciona de primeira no Mac</strong>. Como ele usa OpenMP é preciso baixar outros programas e modificar algumas configurações no <code>R</code> o que pode ser bem trabalhoso e chato.</p>
<p>Na comparação fica o seguinte:</p>
<table class="table">
<colgroup>
<col style="width: 65%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th><code>dplyr</code></th>
<th><code>data.table</code></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Mais funções para aprender. Em geral, o código fica mais comprido</td>
<td>Sintaxe sucinta</td>
</tr>
<tr class="even">
<td>Funções melhor integradas com o <code>tidyverse</code></td>
<td>Funções melhor integradas com base <code>R</code></td>
</tr>
<tr class="odd">
<td>Muito mais veloz que o base <code>R</code></td>
<td>Opção mais veloz possível</td>
</tr>
<tr class="even">
<td>Sintaxe mais intuitiva, mais material de apoio na internet, mais popular.</td>
<td>Menos material de apoio disponível</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
</tr>
</tbody>
</table>
</section>
<section id="tidyverse" class="level2">
<h2 class="anchored" data-anchor-id="tidyverse">tidyverse</h2>
<p>Indepedentemente da sua escolha entre <code>dplyr</code> e/ou <code>data.table</code> (recomendo usar os dois!) vale a pena explorar os demais pacotes do <code>tidyverse</code>.</p>
<section id="tidyr" class="level3">
<h3 class="anchored" data-anchor-id="tidyr">tidyr</h3>
<p>O <code>tidyr</code> acrescenta algumas importantes funcionalidades que faltam no <code>dplyr</code>. Talvez as duas funções mais importantes do pacote sejam <code>pivot_longer</code> e <code>pivot_wider</code> que servem para converter seus dados de transversais (wide) para longitudinais (long) e vice-versa. O <code>tidyr</code> também traz um novo tipo de objeto o <code>tibble</code>, uma versão moderna do <code>data.frame</code>.</p>
<p>Vale também explorar algumas funções muito úteis como <code>separate</code>, <code>fill</code>, <code>complete</code>, <code>replace_na</code> entre outras.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyr)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb1-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Exemplo de tibble</span></span>
<span id="cb1-4">data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as_tibble</span>(USPersonalExpenditure)</span>
<span id="cb1-5">data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(data, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">variable =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(USPersonalExpenditure))</span>
<span id="cb1-6">data</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 6
  `1940` `1945` `1950` `1955` `1960` variable           
   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;              
1 22.2   44.5    59.6    73.2  86.8  Food and Tobacco   
2 10.5   15.5    29      36.5  46.2  Household Operation
3  3.53   5.76    9.71   14    21.1  Medical and Health 
4  1.04   1.98    2.45    3.4   5.4  Personal Care      
5  0.341  0.974   1.8     2.6   3.64 Private Education  </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Exemplo de dado longitudinal</span></span>
<span id="cb3-2">long <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(data, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>variable, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"year"</span>)</span>
<span id="cb3-3">long</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 25 × 3
   variable            year  value
   &lt;chr&gt;               &lt;chr&gt; &lt;dbl&gt;
 1 Food and Tobacco    1940   22.2
 2 Food and Tobacco    1945   44.5
 3 Food and Tobacco    1950   59.6
 4 Food and Tobacco    1955   73.2
 5 Food and Tobacco    1960   86.8
 6 Household Operation 1940   10.5
 7 Household Operation 1945   15.5
 8 Household Operation 1950   29  
 9 Household Operation 1955   36.5
10 Household Operation 1960   46.2
# ℹ 15 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calcula a variação e apresenta de maneira transversal</span></span>
<span id="cb5-2">long <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(variable) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">variacao =</span> (value <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lag</span>(value) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">na.omit</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_wider</span>(</span>
<span id="cb5-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">id_cols =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"variable"</span>,</span>
<span id="cb5-8">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_from =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"year"</span>,</span>
<span id="cb5-9">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_from =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"variacao"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 5
# Groups:   variable [5]
  variable            `1945` `1950` `1955` `1960`
  &lt;chr&gt;                &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
1 Food and Tobacco     100.    33.9   22.8   18.6
2 Household Operation   47.6   87.1   25.9   26.6
3 Medical and Health    63.2   68.6   44.2   50.7
4 Personal Care         90.4   23.7   38.8   58.8
5 Private Education    186.    84.8   44.4   40  </code></pre>
</div>
</div>
</section>
<section id="stringr" class="level3">
<h3 class="anchored" data-anchor-id="stringr">stringr</h3>
<p>O <code>stringr</code> é um pacote voltado para facilitar a manipulação de vetores de texto (<code>character</code>). Todas as funções do pacote são convenientemente precedidas pelo prefixo <code>str_</code> e a lista dos argumentos segue um padrão uniforme. O nome das funções também é bastante intuitivo.</p>
<p>Novamente, há funções base como <code>gsub</code>, <code>grep</code>, <code>strsplit</code>, <code>sub</code>, entre outras, que servem para manipular vetores de string, mas essas funções carecem de “coesão interna” e em alguns casos elas podem retornar valores inesperados ou “erros silenciosos”.</p>
<p>Uma função muito divertida do pacote é a <code>str_glue</code> que facilita na hora de concatenar strings. Note como é simples incluir variáveis como parte do texto e inclusive fazer transformações nas variáveis.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(stringr)</span>
<span id="cb7-2"></span>
<span id="cb7-3">nome <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vinicius Oike"</span></span>
<span id="cb7-4">idade <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">29</span></span>
<span id="cb7-5">nfav <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">runif</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">min =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">max =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span>
<span id="cb7-6"></span>
<span id="cb7-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_glue</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Olá, meu nome é {nome}, tenho {idade} anos. Ano que vem, terei {idade + 1} anos. Meu número favorito é {round(nfav)}."</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Olá, meu nome é Vinicius Oike, tenho 29 anos. Ano que vem, terei 30 anos. Meu número favorito é 8.</code></pre>
</div>
</div>
</section>
<section id="lubridate" class="level3">
<h3 class="anchored" data-anchor-id="lubridate">lubridate</h3>
<p>O <code>lubridate</code> é um pacote exclusivamente focado em manipulação de vetores de datas e tudo relacionado ao tempo como variável. Variáveis de datas podem ser uma dor de cabeça tremenda no processo de limpeza de dados, pois há inúmeros formatos diferentes, que variam para cada país, fora os problemas potenciais de ano bissextos, fusos-horários diferentes, etc.</p>
<p>Especialmente para quem precisa trabalhar com séries de tempo ou dados em painel, o <code>lubridate</code> é um pacote é essencial.</p>
<p>O pacote também facilita “operações aritméticas” com datas como no exemplo abaixo:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(lubridate)</span>
<span id="cb9-2"></span>
<span id="cb9-3">start <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ymd</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2020-01-15"</span>)</span>
<span id="cb9-4">start <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">years</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">months</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2021-04-15"</code></pre>
</div>
</div>
<p>Ele também permite a extração de qualquer informação específica de uma data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1">agora <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ymd_hms</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2022-06-10 20:36:15"</span>)</span></code></pre></div>
</div>
<p>Como o dia da semana:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">wday</span>(agora)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6</code></pre>
</div>
</div>
<p>O trimestre:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">quarter</span>(agora)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2</code></pre>
</div>
</div>
<p>Ou o mês (com a opção de ter a abreviação do mês já no padrão desejado!):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">month</span>(agora, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">locale =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pt_BR"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] Jun
12 Levels: Jan &lt; Fev &lt; Mar &lt; Abr &lt; Mai &lt; Jun &lt; Jul &lt; Ago &lt; Set &lt; ... &lt; Dez</code></pre>
</div>
</div>
</section>
<section id="dbplyr" class="level3">
<h3 class="anchored" data-anchor-id="dbplyr">dbplyr</h3>
<p>O <code>dbplyr</code> é um pacote muito interessante que transforma o <code>R</code> numa “interface” para o SQL. O pacote traduz código escrito em <code>dplyr</code> para código em SQL. Assim, é possível acessar, transformar e baixar dados de uma Base de Dados em SQL, PostGreSQL, etc. diretamente no <code>R</code>.</p>
<p>O código abaixo é um exemplo (bem artficial) que demonstra o funcionamento da pacote. A função <code>show_query()</code> não costuma ser usada na prática, mas ela serve para mostrar o que o pacote está fazendo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb18-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dbplyr)</span>
<span id="cb18-3"></span>
<span id="cb18-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Abre um servidor SQL para servir de exemplo</span></span>
<span id="cb18-5">con <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> DBI<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dbConnect</span>(RSQLite<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">SQLite</span>(), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dbname =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">":memory:"</span>)</span>
<span id="cb18-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Faz o update da tabela mtcars para esse servidor</span></span>
<span id="cb18-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">copy_to</span>(con, mtcars)</span>
<span id="cb18-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Acessa a tabela do servidor usando tbl</span></span>
<span id="cb18-9">db <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tbl</span>(con, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mtcars"</span>)</span>
<span id="cb18-10"></span>
<span id="cb18-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Trabalha normalmente usando comandos do dplyr</span></span>
<span id="cb18-12">db <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb18-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(cyl <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb18-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">disp =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(disp))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb18-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(cyl) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb18-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">a1 =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(disp, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">a2 =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">median</span>(wt, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb18-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">desc</span>(a1)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb18-18">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># No lugar de show_query() use collect() para baixar os dados</span></span>
<span id="cb18-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">show_query</span>()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;SQL&gt;
SELECT `cyl`, AVG(`disp`) AS `a1`, MEDIAN(`wt`) AS `a2`
FROM (
  SELECT
    `mpg`,
    `cyl`,
    LOG(ROUND(`disp`, 0)) AS `disp`,
    `hp`,
    `drat`,
    `wt`,
    `qsec`,
    `vs`,
    `am`,
    `gear`,
    `carb`
  FROM `mtcars`
  WHERE (`cyl` IN (4.0, 6.0))
)
GROUP BY `cyl`
ORDER BY `a1` DESC</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="visualização-de-dados" class="level1">
<h1>Visualização de dados</h1>
<p>Aqui a lista fica simples pois o <code>ggplot2</code> é simplesmente indispensável. O <code>ggplot2</code> foi lançado em 2005 e até hoje ainda é o pacote mais baixado de <code>R</code> na <a href="https://www.r-pkg.org/downloaded">lista oficial do CRAN</a>. É um pacote sinônimo de <code>R</code> e dá um baile em qualquer outro pacote de visualização.</p>
<p>O <code>ggplot2</code> tem uma sintaxe bastante intuitiva em que o usário vai adicionando camadas e elementos sobre o gráfico.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb20-2"></span>
<span id="cb20-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> mtcars, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> wt, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> mpg)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb20-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#ef476f"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lm"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">se =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb20-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.factor</span>(cyl))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb20-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#073b4c"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#06d6a0"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#ffd166"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb20-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>()</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https:://www.restateinsight.com/posts/general-posts/repost-pacotes-essenciais-r/index_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>O pacote por si só já é muito poderoso, mas há ainda inúmeras <a href="https://exts.ggplot2.tidyverse.org/gallery/">extensões desnenvolvidas por outros usuários</a>.</p>
<p>Para ter uma ideia do potencial do pacote vale olhar, por exemplo, a <a href="https://www.cedricscherer.com/top/dataviz/#&amp;gid=1&amp;pid=50">galeria de visualizações do Cédric Scherer</a>.</p>
</section>
<section id="relatórios-e-apps" class="level1">
<h1>Relatórios e Apps</h1>
<section id="rmarkdown" class="level2">
<h2 class="anchored" data-anchor-id="rmarkdown">RMarkdown</h2>
<p>Uma análise de dados, em geral, vira um de dois produtos: um relatório/artigo ou um aplicativo interativo. Novamente o <code>R</code> tem funcionalidades incríveis para ambos os objetivos. Existe um tipo de arquivo chamado <code>RMarkdown</code> que junto com o pacote <code>knitr</code> permite compilar um arquivo misto de <code>Markdown</code> e <code>R</code> em formato <code>pdf</code>, <code>html</code>, <code>doc</code> ou <code>ppt</code>.</p>
<p>Essa extensão é tão poderosa que não só é possível escrever um artigo científico com ela, mas também, um <a href="https://pkgs.rstudio.com/flexdashboard/">dashboard interativo</a>, um <a href="https://bookdown.org">livro inteiro</a>, ou até um <a href="https://bookdown.org/yihui/blogdown/">blog/site</a> (este blog é escrito em <code>RMarkdown</code>).</p>
<p>Atualmente o formato do código é ainda mais flexível, permitindo misturar linguagens como <code>R</code>, <code>Python</code>, <code>SQL</code> e outras num mesmo arquivo. <a href="https://rmarkdown.rstudio.com">Um resumo das funcionalidades pode ser visto aqui</a>.</p>
</section>
<section id="shiny" class="level2">
<h2 class="anchored" data-anchor-id="shiny">Shiny</h2>
<p>O pacote <code>shiny</code> tem se tornado cada vez mais potente nos últimos anos. Inicialmente, ele servia para montar dashboards relativamente simples, que permitiam ao usuário mais liberdade para explorar e montar suas próprias análises. Atualmente, tanto o pacote como as suas extensões melhoraram muito o seu potencial.</p>
<p>A <a href="https://shiny.rstudio.com/gallery/">galeria de apps do RStudio</a> já está um pouco desatualizada, mas dá um sabor do que é possível fazer com <code>shiny</code>.</p>
<p>Alguns exemplos:</p>
<ul>
<li><a href="https://vnijs.shinyapps.io/radiant/?SSUID=102af87a3a">Radiant</a> - Esta é, sem dúvida, uma das aplicações mais completas e impressionantes de Shiny, vale um post inteiro por si só.</li>
<li><a href="https://vac-lshtm.shinyapps.io/ncov_tracker/?_ga=2.208589338.945012269.1654951879-1352143415.1654951879#">Monitor de Covid</a></li>
<li><a href="https://voronoys.shinyapps.io/voronoys/?_ga=2.21641907.945012269.1654951879-1352143415.1654951879">Anaálise do Perfil de Eleitor no Brasil</a></li>
</ul>
</section>
<section id="quarto" class="level2">
<h2 class="anchored" data-anchor-id="quarto">Quarto</h2>
<p>Recentemente lançado, o <code>quarto</code> não é um pacote de <code>R</code> propriamente dito. O Quarto é como um <code>RMarkdown</code> turbinado, é um meio de publicar análises de dados com textos. De maneira geral o Quarto te permite:</p>
<ul>
<li>Escrever e rodar análises de dados em <code>R</code>, python e julia</li>
<li>Publicar relatórios, dashboards, livros, sites, etc.</li>
<li>Publicar artigos científicos utilizando equações, citações, etc.</li>
</ul>
<p>Para conhecer mais sobre o Quarto vale a pena checar o <a href="https://quarto.org/">site</a>. Como o Quarto foi desenvolvido pela Posit, que desenvolvou o <code>RStudio</code> a IDE mais popular de <code>R</code>, o Quarto e o <code>R</code> funcionam muito bem no <code>RStudio</code>.</p>
</section>
</section>
<section id="quero-baixar-tudo" class="level1">
<h1>Quero baixar tudo</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># O tidyverse inclui a instalação do dplyr, tidyr, readr, stringr e outros</span></span>
<span id="cb21-2">packs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(</span>
<span id="cb21-3">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data.table"</span>,</span>
<span id="cb21-4">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"vroom"</span>,</span>
<span id="cb21-5">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tidyverse"</span>,</span>
<span id="cb21-6">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"readxl"</span>,</span>
<span id="cb21-7">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"haven"</span>,</span>
<span id="cb21-8">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"jsonlite"</span>,</span>
<span id="cb21-9">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sf"</span>,</span>
<span id="cb21-10">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rio"</span>,</span>
<span id="cb21-11">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lubridate"</span>,</span>
<span id="cb21-12">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dbplyr"</span>,</span>
<span id="cb21-13">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"odbc"</span>,</span>
<span id="cb21-14">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DBI"</span>,</span>
<span id="cb21-15">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"knitr"</span>,</span>
<span id="cb21-16">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"shiny"</span>,</span>
<span id="cb21-17">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"quarto"</span></span>
<span id="cb21-18">  )</span>
<span id="cb21-19"></span>
<span id="cb21-20"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">install.packages</span>(packs, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">repos =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://vps.fmvz.usp.br/CRAN/"</span>)</span></code></pre></div>
</div>


</section>

 ]]></description>
  <category>data-science</category>
  <category>econometria</category>
  <category>tutorial-R</category>
  <guid>https:://www.restateinsight.com/posts/general-posts/repost-pacotes-essenciais-r/index.html</guid>
  <pubDate>Fri, 30 Jun 2023 03:00:00 GMT</pubDate>
  <media:content url="https:://www.restateinsight.com/static/installing_packages.png" medium="image" type="image/png" height="46" width="144"/>
</item>
<item>
  <title>Visualizando uma única variável</title>
  <dc:creator>Vinicius Oike</dc:creator>
  <link>https:://www.restateinsight.com/posts/general-posts/repost-mapa-desigualdade/index.html</link>
  <description><![CDATA[ 




<p>Há algum tempo atrás tive o seguinte problema: como visualizar várias observações de uma única variável numérica num gráfico? Tentei algumas soluções óbvias, mas nenhuma pareceu funcionar muito bem. Neste post junto algumas das minhas tentativas.</p>
<p>Os dados provêm do <a href="https://www.nossasaopaulo.org.br/2019/11/05/mapa-da-desigualdade-2019-e-lancado-em-sao-paulo/">Mapa da Desigualdade 2019</a>. Neste site pode-se baixar todos os dados além de baixar o relatório completo que apresenta informações socioeconômicas atualizadas para todos os distritos de São Paulo, compilando e sistematizando dados de diversas fontes públicas.</p>
<section id="pacotes-tema-e-dados." class="level1">
<h1>Pacotes, tema e dados.</h1>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(stringr)</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(forcats)</span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(readxl)</span>
<span id="cb1-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(janitor)</span>
<span id="cb1-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(classInt)</span>
<span id="cb1-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggrepel)</span>
<span id="cb1-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(showtext)</span>
<span id="cb1-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(sf)</span></code></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Importa a fonte Roboto Light</span></span>
<span id="cb2-2">sysfonts<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">font_add_google</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Roboto"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Roboto Light"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">regular.wt =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">300</span>)</span>
<span id="cb2-3">showtext<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">showtext_auto</span>()</span>
<span id="cb2-4"></span>
<span id="cb2-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Um tema básico para os gráficos</span></span>
<span id="cb2-6">theme_vini <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb2-8">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Roboto Light"</span>),</span>
<span id="cb2-9">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Roboto Light"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>),</span>
<span id="cb2-10">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid.minor =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb2-11">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span></span>
<span id="cb2-12">  )</span></code></pre></div>
</div>
<p>O código abaixo mostra como importei e limpei os dados.</p>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Importa os dados do arquivo xlsx</span></span>
<span id="cb3-2">df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> readxl<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_excel</span>(</span>
<span id="cb3-3">  here<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">here</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"posts"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"general-posts"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"repost-mapa-desigualdade"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tabela.xlsx"</span>),</span>
<span id="cb3-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sheet =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span></span>
<span id="cb3-5">)</span>
<span id="cb3-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Arruma o nome das colunas</span></span>
<span id="cb3-7">df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> janitor<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">clean_names</span>(df)</span>
<span id="cb3-8"></span>
<span id="cb3-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Alguns bairros para destacar nos graficos</span></span>
<span id="cb3-10">sel_bairro <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Grajaú"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Penha"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sapopemba"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Bela Vista"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Moema"</span>)</span>
<span id="cb3-11"></span>
<span id="cb3-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Função para converter os numeros</span></span>
<span id="cb3-13">as_numeric_string <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) {</span>
<span id="cb3-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stopifnot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.character</span>(x))</span>
<span id="cb3-15">  x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> stringr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_remove_all</span>(x, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">."</span>)</span>
<span id="cb3-16">  x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> stringr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_replace</span>(x, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">","</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"."</span>)</span>
<span id="cb3-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(x))</span>
<span id="cb3-18">  </span>
<span id="cb3-19">}</span>
<span id="cb3-20"></span>
<span id="cb3-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Função para abreviar o nome dos distritos</span></span>
<span id="cb3-22">pat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vila"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Jardim"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cidade"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Santo"</span>)</span>
<span id="cb3-23">pat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(pat, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">collapse =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"|"</span>)</span>
<span id="cb3-24"></span>
<span id="cb3-25">str_shorten <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) {</span>
<span id="cb3-26">  </span>
<span id="cb3-27">  vl <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(</span>
<span id="cb3-28">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vila"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vl."</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Jardim"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Jd."</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cidade"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cd."</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Santo"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"St."</span>,</span>
<span id="cb3-29">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Santa"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"St."</span></span>
<span id="cb3-30">    )</span>
<span id="cb3-31">  </span>
<span id="cb3-32">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unname</span>(vl[x]))</span>
<span id="cb3-33"></span>
<span id="cb3-34">}</span>
<span id="cb3-35"></span>
<span id="cb3-36"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Limpa os dados</span></span>
<span id="cb3-37">df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> df <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-38">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Renomeia a coluna de idade_media_ao_morrer</span></span>
<span id="cb3-39">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expec_vida =</span> idade_media_ao_morrer) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-40">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Seleciona apenas as colunas de interesse</span></span>
<span id="cb3-41">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(id_regiao, distrito, expec_vida, populacao_total) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-42">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb3-43">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Encurta o nome dos distritos</span></span>
<span id="cb3-44">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label_distrito =</span> stringr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_replace_all</span>(distrito, pat, str_shorten),</span>
<span id="cb3-45">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Converte as colunas numéricas</span></span>
<span id="cb3-46">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expec_vida =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as_numeric_string</span>(expec_vida),</span>
<span id="cb3-47">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">populacao_total =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as_numeric_string</span>(populacao_total),</span>
<span id="cb3-48">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Variável dummy para indicar os bairros destacados</span></span>
<span id="cb3-49">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">highlight =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">if_else</span>(distrito <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> sel_bairro, 1L, 0L))</span>
<span id="cb3-50">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-51">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">na.omit</span>()</span>
<span id="cb3-52"></span>
<span id="cb3-53"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Tabela auxiliar somente com os valores médios do municíoio</span></span>
<span id="cb3-54">df_media <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(df, distrito <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Município SP"</span>)</span>
<span id="cb3-55"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Tabela auxiliar somente com os municipios destacados</span></span>
<span id="cb3-56">df_aux_label <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(df, highlight <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb3-57"></span>
<span id="cb3-58"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Remove a média da tabela</span></span>
<span id="cb3-59">df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(df, distrito <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Município SP"</span>)</span></code></pre></div>
</details>
</div>
</section>
<section id="expectativa-de-vida-por-distrito-de-são-paulo" class="level1">
<h1>Expectativa de vida por distrito de São Paulo</h1>
<p>Há mais de 90 distritos em São Paulo e temos estimativas da expectativa de vida média em cada um deles. O expec_vida mais alto foi de 80,57 anos, registrado no distrito de Moema, cifra próxima a de países como Dinamarca e Liechtenstein. Como referência, a expectativa de vida média em São Paulo é de 68,7.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<table class="table table-hover table-striped table-sm small" data-quarto-postprocess="true">
<caption>Distritos com expectativa de vida mais elevada</caption>
<thead>
<tr class="header">
<th style="text-align: center;" data-quarto-table-cell-role="th">Distrito</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Expectativa de Vida</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Jardim Paulista</td>
<td style="text-align: center;">80.0</td>
</tr>
<tr class="even">
<td style="text-align: center;">Moema</td>
<td style="text-align: center;">79.8</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Itaim Bibi</td>
<td style="text-align: center;">79.5</td>
</tr>
<tr class="even">
<td style="text-align: center;">Alto de Pinheiros</td>
<td style="text-align: center;">79.4</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Pinheiros</td>
<td style="text-align: center;">78.8</td>
</tr>
<tr class="even">
<td style="text-align: center;">Vila Mariana</td>
<td style="text-align: center;">78.3</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Santo Amaro</td>
<td style="text-align: center;">78.2</td>
</tr>
<tr class="even">
<td style="text-align: center;">Consolação</td>
<td style="text-align: center;">78.1</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Perdizes</td>
<td style="text-align: center;">77.9</td>
</tr>
<tr class="even">
<td style="text-align: center;">Campo Belo</td>
<td style="text-align: center;">77.9</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>Do outro lado temos expec_vidaes significativamente mais baixos, registrados em alguns dos distritos de menor renda de São Paulo como Cidade Tiradentes e Marsilac. A diferença na expectativa de vida entre os distritos chega a mais de 20 anos.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<table class="table table-hover table-striped table-sm small" data-quarto-postprocess="true">
<caption>Distritos com expectativa de vida mais baixa</caption>
<thead>
<tr class="header">
<th style="text-align: center;" data-quarto-table-cell-role="th">Distrito</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Expectativa de Vida</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Iguatemi</td>
<td style="text-align: center;">59.3</td>
</tr>
<tr class="even">
<td style="text-align: center;">Cidade Tiradentes</td>
<td style="text-align: center;">59.4</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Jardim Ângela</td>
<td style="text-align: center;">59.8</td>
</tr>
<tr class="even">
<td style="text-align: center;">São Rafael</td>
<td style="text-align: center;">59.8</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Grajaú</td>
<td style="text-align: center;">60.4</td>
</tr>
<tr class="even">
<td style="text-align: center;">Guaianases</td>
<td style="text-align: center;">61.2</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Lajeado</td>
<td style="text-align: center;">61.5</td>
</tr>
<tr class="even">
<td style="text-align: center;">Anhanguera</td>
<td style="text-align: center;">61.5</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Marsilac</td>
<td style="text-align: center;">61.6</td>
</tr>
<tr class="even">
<td style="text-align: center;">Brás</td>
<td style="text-align: center;">61.7</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>O objetivo aqui é de enxergar mais claramente estas diferenças. Como é a expectativa de vida nos diferentes distritos de São Paulo?</p>
<section id="histograma" class="level2">
<h2 class="anchored" data-anchor-id="histograma">Histograma</h2>
<p>Uma solução bastante clássica seria de fazer um histograma. Neste tipo de gráfico a dispersão fica clara, mas pode ser difícil de dar destaque para distritos específicos. O histograma conta a frequência de observações dentro de janelas de tamanho fixo. A princípio, a única dificuldade em usar o histograma está em definir a amplitude de cada um destes intervalos, mas, na prática, este problema não costuma ser muito complexo.</p>
<p>Ainda que o gráfico seja comumente usado, ele não é tão popular, sendo raramente visto em publicações de jornal, por exemplo.</p>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(df, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> expec_vida)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_histogram</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bins =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#08519c"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_hline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yintercept =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text</span>(</span>
<span id="cb4-5">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> df_aux_label,</span>
<span id="cb4-6">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> expec_vida,</span>
<span id="cb4-7">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">17</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">19</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>),</span>
<span id="cb4-8">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> stringr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_wrap</span>(label_distrito, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)),</span>
<span id="cb4-9">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray25"</span>,</span>
<span id="cb4-10">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Roboto Light"</span>,</span>
<span id="cb4-11">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span></span>
<span id="cb4-12">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_segment</span>(</span>
<span id="cb4-14">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> df_aux_label,</span>
<span id="cb4-15">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> expec_vida,</span>
<span id="cb4-16">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xend =</span> expec_vida,</span>
<span id="cb4-17">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb4-18">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yend =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">17</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">19</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>),</span>
<span id="cb4-19">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray70"</span></span>
<span id="cb4-20">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(df<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>expec_vida) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(df<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>expec_vida) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-23">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(</span>
<span id="cb4-24">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Expectativa de Vida"</span>,</span>
<span id="cb4-25">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Anos de idade"</span>,</span>
<span id="cb4-26">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>,</span>
<span id="cb4-27">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">caption =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fonte: SMS (Secretaria Municipal de Saúde)"</span>,</span>
<span id="cb4-28">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">subtitle =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Idade média ao morrer em 2022."</span></span>
<span id="cb4-29">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-30">  theme_vini <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-31">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid.major.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>())</span></code></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/repost-mapa-desigualdade/index_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="gráfico-de-colunas" class="level2">
<h2 class="anchored" data-anchor-id="gráfico-de-colunas">Gráfico de colunas</h2>
<p>Um simples gráfico de colunas também poderia ser uma alternativa. Neste caso, como há muitas observações (distritos) diferentes, o gráfico acaba sobrecarregado e confuso.</p>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">ordered_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> df <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb5-3">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label_distrito =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(label_distrito),</span>
<span id="cb5-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label_distrito =</span> forcats<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fct_reorder</span>(label_distrito, expec_vida)</span>
<span id="cb5-5">  )</span>
<span id="cb5-6"></span>
<span id="cb5-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(ordered_df, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> label_distrito, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> expec_vida)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_col</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#08519c"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_flip</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(</span>
<span id="cb5-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Expectativa de Vida"</span>,</span>
<span id="cb5-13">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Anos de idade"</span>,</span>
<span id="cb5-14">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>,</span>
<span id="cb5-15">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">caption =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fonte: SMS (Secretaria Municipal de Saúde)"</span>,</span>
<span id="cb5-16">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">subtitle =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Idade média ao morrer em 2022."</span></span>
<span id="cb5-17">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-18">  theme_vini <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb5-20">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>),</span>
<span id="cb5-21">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">angle =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">90</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb5-22">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid.major.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>()</span>
<span id="cb5-23">    )</span></code></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/repost-mapa-desigualdade/index_files/figure-html/unnamed-chunk-8-1.png" style="width:100.0%" height="805" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Outra saída seria dividir os dados em grupos menores (e.g.&nbsp;alta, média-alta, média-baixa, baixa) e usar a função <code>facet_wrap</code>. O lado negativo disto, além de tornar o código mais complexo, é de acrescentar divisões nos dados que eventualmente são muito artificiais.</p>
<p>Aqui eu faço um divisão por quintil e crio uma denominação um tanto arbitrária para permitir a leitura dos dados.</p>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">xl <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Baixo"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Médio-Baixo"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Médio"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Médio-Alto"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Alto"</span>)</span>
<span id="cb6-2"></span>
<span id="cb6-3">quintile_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> ordered_df <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb6-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb6-5">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">life_group =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ntile</span>(expec_vida, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>),</span>
<span id="cb6-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">life_group =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(life_group, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> xl)</span>
<span id="cb6-7">    )</span>
<span id="cb6-8"></span>
<span id="cb6-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(quintile_df, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> label_distrito, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> expec_vida)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_col</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#08519c"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_flip</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(life_group), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scales =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"free_y"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Expectativa de Vida"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-14">  theme_vini <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb6-16">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>),</span>
<span id="cb6-17">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">strip.text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>),</span>
<span id="cb6-18">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid.major.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>()</span>
<span id="cb6-19">    )</span></code></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/repost-mapa-desigualdade/index_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="lolipop" class="level2">
<h2 class="anchored" data-anchor-id="lolipop">Lolipop</h2>
<p>Este tipo de gráfico vem ganhando espaço mesmo em veículos de mídia populares por ser bastante simples. Ele é mais comumente usado para mostrar a evolução de uma variável em dois momentos do tempo, mas também pode-se usá-lo analogamente a um gráfico de colunas.</p>
<p>Infelizmente, neste exemplo, ele vai sofrer do mesmo problema que o gráfico de colunas. A título de exemplo faço um gráfico deste estilo apenas para os distritos com as maiores e menores expectativas de vida.</p>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Ordena a base de dados pela expectativa de vida</span></span>
<span id="cb7-2">ordered_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(ordered_df, expec_vida)</span>
<span id="cb7-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Cria uma tabela com as primeiras 5 e últimas 5 linhas</span></span>
<span id="cb7-4">top_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(ordered_df, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tail</span>(ordered_df, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))</span>
<span id="cb7-5"></span>
<span id="cb7-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(top_df, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> label_distrito, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> expec_vida)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_segment</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xend =</span> label_distrito, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yend =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">55</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#08519c"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_flip</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-10">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(</span>
<span id="cb7-11">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Anos de vida"</span>,</span>
<span id="cb7-12">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>,</span>
<span id="cb7-13">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Expectativa de vida"</span>,</span>
<span id="cb7-14">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">subtitle =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Idade média ao morrer em 2022. Dados apenas dos distritos</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">com maiores e menores expectativas de vida."</span>,</span>
<span id="cb7-15">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">caption =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fonte: SMS (Secretaria Municipal de Saúde)"</span></span>
<span id="cb7-16">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-17">  theme_vini <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid.major.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>())</span></code></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/repost-mapa-desigualdade/index_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="gráfico-de-dispersão" class="level2">
<h2 class="anchored" data-anchor-id="gráfico-de-dispersão">Gráfico de dispersão</h2>
<p>Gráficos de dispersão apresentam a relação entre duas variáveis. Neste caso, podemos fazer alguns truques para inventar uma variável falsa que serve somente para que o <code>R</code> faça o gráfico.</p>
<p>Uma alternativa seria impor um expec_vida constante e arbitrário para uma das variáveis. Neste caso escolho <code>x = 1</code> e escondo o eixo. No gráfico abaixo, cada distrito é um ponto sobre uma mesma linha. Para amenizar a sobreposição de observações uso <code>alpha = 0.5</code> que acrescenta um pouco de transparência nas observações.</p>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">df_aux <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(</span>
<span id="cb8-2">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.025</span>,</span>
<span id="cb8-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> df_media<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>expec_vida,</span>
<span id="cb8-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Média = "</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(y, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span>
<span id="cb8-5">)</span>
<span id="cb8-6"></span>
<span id="cb8-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(df, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> expec_vida)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_vline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xintercept =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray60"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(</span>
<span id="cb8-10">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> highlight, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> highlight, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> populacao_total),</span>
<span id="cb8-11">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>,</span>
<span id="cb8-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#08519c"</span>,</span>
<span id="cb8-13">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text</span>(</span>
<span id="cb8-15">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> df_aux_label,</span>
<span id="cb8-16">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.95</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.95</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.05</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.05</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.05</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> expec_vida, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> label_distrito),</span>
<span id="cb8-17">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Roboto Light"</span>,</span>
<span id="cb8-18">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span></span>
<span id="cb8-19">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_segment</span>(</span>
<span id="cb8-21">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> df_aux_label,</span>
<span id="cb8-22">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray25"</span>,</span>
<span id="cb8-23">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(</span>
<span id="cb8-24">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xend =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.955</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.955</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.045</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.045</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.045</span>),</span>
<span id="cb8-25">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> expec_vida, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yend =</span> expec_vida</span>
<span id="cb8-26">    )</span>
<span id="cb8-27">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-28">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_segment</span>(</span>
<span id="cb8-29">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xend =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.02</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> df_media<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>expec_vida, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yend =</span> y),</span>
<span id="cb8-30">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xend =</span> xend, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yend =</span> yend),</span>
<span id="cb8-31">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray25"</span>,</span>
<span id="cb8-32">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-33">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text</span>(</span>
<span id="cb8-34">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> df_aux,</span>
<span id="cb8-35">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> label),</span>
<span id="cb8-36">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Roboto Light"</span>,</span>
<span id="cb8-37">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span></span>
<span id="cb8-38">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-39">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_flip</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-40">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.94</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.06</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-41">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(df<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>expec_vida) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(df<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>expec_vida) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-42">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_alpha_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.45</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-43">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_size_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">range =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">7.5</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb8-44">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_colour_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#08519c"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-45">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(</span>
<span id="cb8-46">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Expectativa de Vida"</span>,</span>
<span id="cb8-47">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>,</span>
<span id="cb8-48">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Anos de idade"</span>,</span>
<span id="cb8-49">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">caption =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fonte: SMS (Secretaria Municipal de Saúde)"</span>,</span>
<span id="cb8-50">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">subtitle =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Idade média ao morrer em 2022. Cada ponto representa um distrito de São Paulo."</span></span>
<span id="cb8-51">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-52">  theme_vini <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-53">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb8-54">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.ticks.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb8-55">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb8-56">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid.major.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>()</span>
<span id="cb8-57">  )</span></code></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/repost-mapa-desigualdade/index_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Uma solucão alternativa seria criar uma variável aleatória qualquer para servir como a variável “falsa”. Estranhamente, cria-se uma sensação melhor de dispersão e não há mais o problema de sobreposição. Contudo, o gráfico pode ser bastante confuso, pois dá a entender que estamos vendo a relação entre duas variáveis distintas, quando uma delas, na verdade, não representa coisa alguma.</p>
<p>Ainda assim, ideias similares foram implementadas pelo portal Nexo <a href="https://www.nexojornal.com.br/grafico/2019/11/12/A-desigualdade-na-cidade-de-S%C3%A3o-Paulo-em-20-indicadores">nesta postagem</a>.</p>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Cria uma variável aleatória qualquer seguindo uma Gaussiana</span></span>
<span id="cb9-2">df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> df <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(.)))</span>
<span id="cb9-3"></span>
<span id="cb9-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Para destacar o expec_vida médio</span></span>
<span id="cb9-5">df_aux <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(</span>
<span id="cb9-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.25</span>,</span>
<span id="cb9-7">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> df_media<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>expec_vida <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span>,</span>
<span id="cb9-8">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Média ="</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span>
<span id="cb9-9">)</span>
<span id="cb9-10"></span>
<span id="cb9-11">df_aux_label <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> df <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb9-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label_distrito =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">if_else</span>(highlight <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> 1L, label_distrito, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>))</span>
<span id="cb9-13"></span>
<span id="cb9-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(df, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> expec_vida)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_jitter</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> highlight, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> populacao_total),</span>
<span id="cb9-16">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>,</span>
<span id="cb9-17">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#08519c"</span></span>
<span id="cb9-18">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-19">  ggrepel<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text_repel</span>(</span>
<span id="cb9-20">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> df_aux_label,</span>
<span id="cb9-21">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> label_distrito),</span>
<span id="cb9-22">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">force =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,</span>
<span id="cb9-23">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Roboto Light"</span>,</span>
<span id="cb9-24">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span></span>
<span id="cb9-25">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-26">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text</span>(</span>
<span id="cb9-27">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> df_aux,</span>
<span id="cb9-28">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> label),</span>
<span id="cb9-29">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.15</span></span>
<span id="cb9-30">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-31">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_hline</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yintercept =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(expec_vida)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray70"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-32">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_flip</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-33">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_alpha_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.65</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-34">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(df<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>expec_vida) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(df<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>expec_vida) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-35">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-36">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(</span>
<span id="cb9-37">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Expectativa de Vida (idade média ao morrer)"</span>,</span>
<span id="cb9-38">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>,</span>
<span id="cb9-39">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Anos de idade"</span>,</span>
<span id="cb9-40">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">caption =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fonte: SMS (Secretaria Municipal de Saúde)"</span></span>
<span id="cb9-41">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-42">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guides</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-43">  theme_vini <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-44">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb9-45">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb9-46">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid.major.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>()</span>
<span id="cb9-47">  )</span></code></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/repost-mapa-desigualdade/index_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="mapa" class="level2">
<h2 class="anchored" data-anchor-id="mapa">Mapa</h2>
<p>Deixei a visualização mais óbvia para o final. Como a variável está distribuída espacialmente, pode-se fazer um simples mapa de São Paulo separado por distritos.</p>
<p>Aqui, eu uso o shapefile de distritos da Pesquisa Origem e Destino. Apesar de não haver um identificador comum entre as bases, foi relativamente simples fazer o join compatibilizando o nome dos distritos.</p>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Importa o shapefile</span></span>
<span id="cb10-2">distritos <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_read</span>(</span>
<span id="cb10-3">  here<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">here</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"posts"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"general-posts"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"repost-mapa-desigualdade"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"districts.gpkg"</span>),</span>
<span id="cb10-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">quiet =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span></span>
<span id="cb10-5">  )</span>
<span id="cb10-6"></span>
<span id="cb10-7">distritos <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> distritos <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb10-8">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Filtra apenas distritos de SP (capital)</span></span>
<span id="cb10-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(code_district <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">96</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb10-10">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Renomeia a coluna para facilitar o join</span></span>
<span id="cb10-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">distrito =</span> name_district)</span>
<span id="cb10-12"></span>
<span id="cb10-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Verifica se ha distritos com nome diferente (Mooca)</span></span>
<span id="cb10-14">anti <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">anti_join</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(df, distrito), distritos, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"distrito"</span>)</span>
<span id="cb10-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Altera a grafia para garantir o join</span></span>
<span id="cb10-16">df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> df <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb10-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb10-18">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">distrito =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">if_else</span>(distrito <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Moóca"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mooca"</span>, distrito)</span>
<span id="cb10-19">  )</span>
<span id="cb10-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Junta os dados no sf</span></span>
<span id="cb10-21">distritos <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(distritos, df, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"distrito"</span>)</span></code></pre></div>
</details>
</div>
<p>O gráfico abaixo mostra a expectativa de vida em cada distrito na cidade.</p>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(distritos) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_sf</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> expec_vida), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_viridis_c</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Expectativa</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">de Vida"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Expectativa de Vida por Distrito"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_void</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb11-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>),</span>
<span id="cb11-8">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>)</span>
<span id="cb11-9">  )</span></code></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/repost-mapa-desigualdade/index_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Outra maneira de apresentar este dado é agrupando-o de alguma forma. Eu sou particularmente parcial ao algoritmo de Jenks.</p>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Encontra os intervalos de cada grupo</span></span>
<span id="cb12-2">breaks <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> classInt<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">classIntervals</span>(distritos<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>expec_vida, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">style =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"jenks"</span>)</span>
<span id="cb12-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Classifica os valores em grupos</span></span>
<span id="cb12-4">distritos <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> distritos <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb12-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb12-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">jenks_group =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cut</span>(expec_vida, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks =</span> breaks<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>brks, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">include.lowest =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb12-7">  )</span>
<span id="cb12-8"></span>
<span id="cb12-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(distritos, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> jenks_group)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb12-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_sf</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray80"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb12-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_brewer</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">palette =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"BrBG"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Expectativa</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">de Vida"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb12-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Expectativa de Vida por Distrito"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb12-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_void</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb12-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb12-15">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>),</span>
<span id="cb12-16">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>)</span>
<span id="cb12-17">  )</span></code></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/repost-mapa-desigualdade/index_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>


</section>
</section>

 ]]></description>
  <category>data-visualization</category>
  <category>tutorial-R</category>
  <category>repost</category>
  <guid>https:://www.restateinsight.com/posts/general-posts/repost-mapa-desigualdade/index.html</guid>
  <pubDate>Wed, 28 Jun 2023 03:00:00 GMT</pubDate>
  <media:content url="https:://www.restateinsight.com/static/visualizando-unica-variavel.png" medium="image" type="image/png" height="89" width="144"/>
</item>
<item>
  <title>Preços de Imóveis e Demografia</title>
  <dc:creator>Vinicius Oike</dc:creator>
  <link>https:://www.restateinsight.com/posts/general-posts/repost-precos-imoveis-demografia/index.html</link>
  <description><![CDATA[ 




<p>Já vi em alguns lugares uma suposta ligação entre fatores demográficos e tendências de longo prazo no mercado imobiliário. Intuitivamente, alguns dos principais motivadores para comprar ou vender um imóvel estão ligados a fatores demográficos: nascimentos, casamentos, divórcios ou óbitos.</p>
<p>Este tipo de análise omite fatores importantes como renda, condições de financiamento e o contexto geral da economia. Ainda assim, fiquei curioso para ver se havia algum padrão entre tendências demográficas mais simples e o comportamento dos preços.</p>
<section id="dados-e-setup" class="level1">
<h1>Dados e setup</h1>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyr)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(stringr)</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggrepel)</span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(here)</span>
<span id="cb1-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(WDI)</span>
<span id="cb1-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(showtext)</span></code></pre></div>
</details>
</div>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">font_add</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Helvetica"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Helvetica.ttc"</span>)</span>
<span id="cb2-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">showtext_auto</span>()</span>
<span id="cb2-3"></span>
<span id="cb2-4">colors <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> MetBrewer<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">met.brewer</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Hokusai1"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>)[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>)]</span>
<span id="cb2-5"></span>
<span id="cb2-6">theme_vini <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb2-8">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid.minor =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb2-9">    </span>
<span id="cb2-10">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_rect</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>),</span>
<span id="cb2-11">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_rect</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>),</span>
<span id="cb2-12">    </span>
<span id="cb2-13">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"top"</span>,</span>
<span id="cb2-14">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.box.margin =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">margin</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>),</span>
<span id="cb2-15">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.margin =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">margin</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>),</span>
<span id="cb2-16">    </span>
<span id="cb2-17">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Helvetica"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray15"</span>),</span>
<span id="cb2-18">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>),</span>
<span id="cb2-19">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.subtitle =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray30"</span>),</span>
<span id="cb2-20">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.caption  =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray30"</span>),</span>
<span id="cb2-21">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">angle =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">90</span>)</span>
<span id="cb2-22">  )</span></code></pre></div>
</details>
</div>
<p>Para montar um painel de dados usei preços de imóveis do Bank for International Settelments (BIS), que reúne índices de preços imobiliários de diversos países do mundo. Os dados demográficos, de crescimento econômico, e share de população adulta, vem do Banco Mundial. Como os dados demográficos dependem de censos populacionais que demoram a ser divulgados, tive que restringir a amostra até 2020 para garantir que os dados fossem comparáveis no maior número possível de países.</p>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Import house price indexes from BIS #</span></span>
<span id="cb3-2">bis <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> readr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_csv</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">here</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"posts/general-posts/repost-precos-imoveis-demografia/rppi_bis_data.csv"</span>))</span>
<span id="cb3-3">bis <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> bis <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(year <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1960</span>, unit <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Index, 2010 = 100"</span>)</span>
<span id="cb3-5"></span>
<span id="cb3-6">bis_real <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> bis <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(nominal <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Real"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(year, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">country =</span> reference_area, value) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(year, country) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">index_house =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(value, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm =</span> T))</span>
<span id="cb3-11"></span>
<span id="cb3-12">bis_nominal <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> bis <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(nominal <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Nominal"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(year, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">country =</span> reference_area, value) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(year, country) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">index_house =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(value, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm =</span> T))</span>
<span id="cb3-17"></span>
<span id="cb3-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Import demographic data from WBD #</span></span>
<span id="cb3-19">wdi_names <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as_tibble</span>(WDI_data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>country)</span>
<span id="cb3-20"></span>
<span id="cb3-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#search &lt;- WDIsearch("population")</span></span>
<span id="cb3-22"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Total population</span></span>
<span id="cb3-23">pop <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">WDI</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">indicator =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SP.POP.TOTL"</span>)</span>
<span id="cb3-24"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Population growth</span></span>
<span id="cb3-25">pop_growth <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">WDI</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">indicator =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SP.POP.GROW"</span>)</span>
<span id="cb3-26"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Adult population</span></span>
<span id="cb3-27">codes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(</span>
<span id="cb3-28">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SP.POP.2024.MA"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SP.POP.2529.MA"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SP.POP.3034.MA"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SP.POP.3539.MA"</span>,</span>
<span id="cb3-29">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SP.POP.4044.FE"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SP.POP.2024.FE"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SP.POP.2529.FE"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SP.POP.3034.FE"</span>,</span>
<span id="cb3-30">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SP.POP.3539.FE"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SP.POP.4044.FE"</span>)</span>
<span id="cb3-31"></span>
<span id="cb3-32">adult_pop <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">WDI</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">indicator =</span> codes)</span>
<span id="cb3-33"></span>
<span id="cb3-34">tbl_pop_adult <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> adult_pop <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-35">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>iso2c, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>iso3c) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-36">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(year, country)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-37">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(year, country) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-38">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pop_adult =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(value, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm =</span> T)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-39">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ungroup</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-40">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb3-41">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">country =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_replace_all</span>(country, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Hong Kong SAR, China"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Hong Kong SAR"</span>),</span>
<span id="cb3-42">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">country =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_replace_all</span>(country, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Korea, Rep."</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Korea"</span>),</span>
<span id="cb3-43">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">country =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_replace_all</span>(country, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Russian Federation"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Russia"</span>))</span>
<span id="cb3-44"></span>
<span id="cb3-45">tbl_pop <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> pop <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-46">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb3-47">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">country =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_replace_all</span>(country, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Hong Kong SAR, China"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Hong Kong SAR"</span>),</span>
<span id="cb3-48">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">country =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_replace_all</span>(country, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Korea, Rep."</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Korea"</span>),</span>
<span id="cb3-49">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">country =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_replace_all</span>(country, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Russian Federation"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Russia"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-50">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(year, country, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pop =</span> SP.POP.TOTL) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-51">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(year) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-52">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(tbl_pop_adult)</span>
<span id="cb3-53"></span>
<span id="cb3-54">base_pop <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> tbl_pop <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-55">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(year <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2010</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-56">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(country, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">base_pop =</span> pop, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">base_pop_adult =</span> pop_adult)</span>
<span id="cb3-57"></span>
<span id="cb3-58">tbl_pop <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> tbl_pop <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-59">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(base_pop) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-60">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb3-61">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">index_pop =</span> pop <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> base_pop <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>,</span>
<span id="cb3-62">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">index_pop_adult =</span> pop_adult <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> base_pop_adult <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb3-63">    )</span>
<span id="cb3-64"></span>
<span id="cb3-65"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Join information across tables</span></span>
<span id="cb3-66"></span>
<span id="cb3-67"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Real property prices</span></span>
<span id="cb3-68">tbl <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> bis_real <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-69">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(year <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1970</span>, year <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2020</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-70">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(tbl_pop) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-71">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(year, country, index_house, index_pop, index_pop_adult) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-72">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(year, country), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"index"</span>)</span>
<span id="cb3-73"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Nominal property prices</span></span>
<span id="cb3-74">tbl_nominal <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> bis_nominal <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-75">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(year <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1970</span>, year <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2020</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-76">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(tbl_pop) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-77">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(year, country, index_house, index_pop, index_pop_adult) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-78">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(year, country), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"index"</span>)</span>
<span id="cb3-79"></span>
<span id="cb3-80"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert real prices to wide and compare evolution</span></span>
<span id="cb3-81">tbl_wide <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> tbl <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-82">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(</span>
<span id="cb3-83">    year <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2010</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2020</span>),</span>
<span id="cb3-84">    index <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"index_house"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"index_pop"</span>)</span>
<span id="cb3-85">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-86">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(country, index) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-87">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">diff =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">diff</span>(value)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-88">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ungroup</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-89">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(year <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2020</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-90">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_wider</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">id_cols =</span> country, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_from =</span> index, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_from =</span> diff) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-91">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(wdi_names, country, iso3c)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-92">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">highlight =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">if_else</span>(country <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"World"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)))</span>
<span id="cb3-93"></span>
<span id="cb3-94">tbl_wide_lr <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> tbl_nominal <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-95">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(</span>
<span id="cb3-96">    year <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1990</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2020</span>),</span>
<span id="cb3-97">    index <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"index_house"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"index_pop"</span>)</span>
<span id="cb3-98">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-99">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(country, index) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-100">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">diff =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">diff</span>(value)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-101">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ungroup</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-102">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(year <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2020</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(diff)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-103">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_wider</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">id_cols =</span> country, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_from =</span> index, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_from =</span> diff) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-104">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(wdi_names, country, iso3c)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-105">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">highlight =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">if_else</span>(country <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"World"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)))</span>
<span id="cb3-106"></span>
<span id="cb3-107">sel <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Australia"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"United States"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Japan"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Germany"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Austria"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"France"</span>)</span>
<span id="cb3-108">sel_latam <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Chile"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Brazil"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Peru"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mexico"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Colombia"</span>)</span></code></pre></div>
</details>
</div>
</section>
<section id="análise" class="level1">
<h1>Análise</h1>
<p>Nos gráficos abaixo eu destaco a variação real do preços dos imóveis (isto é, descontando a inflação geral) e variação no crescimento da população. Considero tanto o nível geral da população como da população adulta (aqui definida como a população de 20 a 44 anos, que formam o grosso da demanda por nova habitação).</p>
<p>O gráfico abaixo mostra como estas variáveis evoluíram nos EUA desde 1970. Durante os anos 1970 até o começo dos anos 2000 parece haver uma ligação próxima entre o mercado imobiliário e o crescimento da população. O descolamento começa ali por volta de 2002 e culmina na Crise Imobiliária e na Crise dos anos 2008-09. Após a Crise, os preços caem até o início de 2010; de lá pra cá os preços voltaram a subir, impulsionados pela baixíssima taxa de juros da economia norte americana neste período.</p>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">p1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb4-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(</span>
<span id="cb4-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(tbl, country <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"United States"</span>),</span>
<span id="cb4-4">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> year, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> value, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> index)</span>
<span id="cb4-5">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_manual</span>(</span>
<span id="cb4-8">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> colors,</span>
<span id="cb4-9">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>,</span>
<span id="cb4-10">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Real House Prices"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Population"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Adult Pop."</span>)</span>
<span id="cb4-11">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(</span>
<span id="cb4-13">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Over the long-run, house price seemed to follow pop. growth"</span>,</span>
<span id="cb4-14">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Index (2010 = 100)"</span>,</span>
<span id="cb4-15">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>,</span>
<span id="cb4-16">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">caption =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Source: Real House Price Indexes (BIS), Population (UN).</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">Adult Pop. defined as population from 20-44 years."</span></span>
<span id="cb4-17">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-18">  theme_vini</span>
<span id="cb4-19"></span>
<span id="cb4-20">p1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">subtitle =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Prices and demographic trends in the USA."</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/repost-precos-imoveis-demografia/index_files/figure-html/unnamed-chunk-5-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Olhando somente para este gráfico a história parece convincente, mas acho que por trás da recente valorização de imóveis está a escassez de novos imóveis no mercado. A imagem abaixo vem de um <a href="https://www.jchs.harvard.edu/blog/were-finally-building-more-small-homes-but-construction-remains-at-historically-low-levels">estudo do Joint Center for Housing Stuides (JCHS)</a> da Universidade de Harvard. Fica evidente como a construção de novos imóveis desacelerou muito na última década. Em estudos com horizontes mais longos, que voltam até a década de 1930 ou 1940, vê-se que a construção está em um de seus pontos mais baixos na história.</p>
<p>A escassez de oferta junto com uma tendência de concentração populacional em grandes metrópoles (com péssimas leis de zoneamento, como São Fransisco, por exemplo) - para mim - é uma história muito mais convincente do que imaginar que está havendo uma bolha imobiliária.</p>
<p><img src="https:://www.restateinsight.com/posts/general-posts/repost-precos-imoveis-demografia/jchs_house_starts.png" class="img-fluid"></p>
<section id="preços-e-população-andam-juntos" class="level3">
<h3 class="anchored" data-anchor-id="preços-e-população-andam-juntos">Preços e população andam juntos</h3>
<p>No agregado dos dados encontrei mais alguns países em que os preços parecem seguir as tendências demográficas. É o caso, por exemplo, de Cingapura, Japão e Itália. Vale notar que estes são países, atualmente, têm baixo crescimento populacional e vivem o envelhecimento de suas populações.</p>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">sel_conforme <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Singapore"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Belgium"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"France"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Japan"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Korea"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Italy"</span>)</span>
<span id="cb5-2">sel_acima <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Switzerland"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Hong Kong SAR"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Chile"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"India"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Malaysia"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Estonia"</span>)</span>
<span id="cb5-3"></span>
<span id="cb5-4">p2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb5-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(</span>
<span id="cb5-6">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(tbl, country <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> sel_conforme, year <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2000</span>),</span>
<span id="cb5-7">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> year, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> value, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> index)</span>
<span id="cb5-8">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_hline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yintercept =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray60"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>country) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_manual</span>(</span>
<span id="cb5-13">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> colors,</span>
<span id="cb5-14">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>,</span>
<span id="cb5-15">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Real House Prices"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Population"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Adult Pop."</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">140</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(</span>
<span id="cb5-18">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"House prices follow population growth"</span>,</span>
<span id="cb5-19">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>,</span>
<span id="cb5-20">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Index (2010 = 100)"</span>,</span>
<span id="cb5-21">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">caption =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Source: Real House Price Indexes (BIS), Population (UN).</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">Adult Pop. defined as population from 20-44 years."</span></span>
<span id="cb5-22">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-23">  theme_vini</span>
<span id="cb5-24"></span>
<span id="cb5-25">p2</span></code></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/repost-precos-imoveis-demografia/index_files/figure-html/unnamed-chunk-6-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="preços-e-população-divergem" class="level3">
<h3 class="anchored" data-anchor-id="preços-e-população-divergem">Preços e população divergem</h3>
<p>Mas há tabmém vários outros em que população e preços divergem. Vale lembrar que estamos comparando índices de preços imobiliárias reais, isto é, já descontando o efeito da inflação: no Chile, por exemplo, o preço médio dos imóveis cresceu cerca de 100% acima do nível da inflação (dobrou nos últimos dez anos). Chile e Hong Kong, em particular, são dois países onde o aumento do preço dos imóveis causou bastante revolta popular em anos recentes<sup>1</sup>.</p>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">p3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb6-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(</span>
<span id="cb6-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(tbl, country <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> sel_acima, year <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2000</span>),</span>
<span id="cb6-4">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> year, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> value, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> index)</span>
<span id="cb6-5">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_hline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yintercept =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray60"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>country) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_manual</span>(</span>
<span id="cb6-10">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> colors,</span>
<span id="cb6-11">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>,</span>
<span id="cb6-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Real House Prices"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Population"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Adult Pop."</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"In some markets, hose prices have detached from pop. growth"</span>,</span>
<span id="cb6-15">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>,</span>
<span id="cb6-16">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Index (2010 = 100)"</span>,</span>
<span id="cb6-17">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">caption =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Source: Real House Price Indexes (BIS), Population (UN).</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">Adult Pop. defined as population from 20-44 years."</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-18">  theme_vini</span>
<span id="cb6-19"></span>
<span id="cb6-20">p3</span></code></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/repost-precos-imoveis-demografia/index_files/figure-html/unnamed-chunk-7-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="américa-latina" class="level3">
<h3 class="anchored" data-anchor-id="américa-latina">América Latina</h3>
<p>Por curiosidade, resolvi olhar os países da América Latina.</p>
<p>No caso do Brasil, vemos que os preços entraram em queda seguindo a recessão de 2014 e, a despeito de uma recuperação recente, ainda estão em níveis mais baixos do que os observados em 2010. De maneira geral, os preços parecem ter ligação nenhuma com o crescimento da população. Vale lembrar que o mercado imobiliário no Brasil é fortemente subsididado e pouco alavancado de maneira geral.</p>
<p>Chile e Colômbia parecem exibir uma tendência similar de crescimento, mas a alta pós-2010 no Chile é assustadora. Em termos reais, os preços dos imóveis quase dobraram em dez anos.</p>
<p>Outro ponto interessante é que os mercado não parecem exibir muito sincronismo (no olho, não parecem séries cointegradas) ao contrário do que se observa em <a href="https://journals.sagepub.com/doi/full/10.1177/0042098014555629?casa_token=GZDm7jR8f0UAAAAA%3AbbnqbFMywKOF1U1Jug1oU2mrE1PASlgW0ZBGL405xMkI2_TAPA62V1iURTfD7uJBics4gMT9dDgI">mercados mais integrados como a Zona do Euro</a>.</p>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">p4 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb7-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(</span>
<span id="cb7-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(tbl, country <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> sel_latam, year <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2000</span>),</span>
<span id="cb7-4">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> year, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> value, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> index)</span>
<span id="cb7-5">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_hline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yintercept =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray60"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>country) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_manual</span>(</span>
<span id="cb7-10">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> colors,</span>
<span id="cb7-11">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>,</span>
<span id="cb7-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Real House Prices"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Population"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Adult Pop."</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"LATAM markets are not synched"</span>,</span>
<span id="cb7-15">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>,</span>
<span id="cb7-16">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Index (2010 = 100)"</span>,</span>
<span id="cb7-17">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">caption =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Source: Real House Price Indexes (BIS), Population (UN).</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">Adult Pop. defined as population from 20-44 years."</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-18">  theme_vini</span>
<span id="cb7-19"></span>
<span id="cb7-20">p4</span></code></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/repost-precos-imoveis-demografia/index_files/figure-html/unnamed-chunk-8-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="todos-os-países" class="level2">
<h2 class="anchored" data-anchor-id="todos-os-países">Todos os países</h2>
<p>Esta análise é ainda bastante preliminar. Ainda que a demografia seja um motor para a demanda imobiliária, outros fatores como oferta de moradia e condições de crédito são importantes demais parecem serem omitidos.</p>
<p>O gráfico abaixo compara a população em 2010/2020 com os preços em 2010/2020. Os países ao lado direito do gráfico, são os países onde houve crescimento populacional. Os países na parte de cima do gráfico são os países onde houve crescimento real do preço dos imóveis. Na média da amostra, destacada como WLD, houve crescimento de ambos.</p>
<p>Países que estão muito para cima como Chile (CHL), Índia (IND) e Estônia (EDT) estão com imóveis muito “caros”. Já em países com França e Finlândia tanto a população como o nível de preço dos imóveis cresceram muito pouco. No caso da Grécia, tanto a população como o preço dos imóveis diminuiu nos últimos dez anos.</p>
<p>O gráfico não me surpreendeu muito, mas esperava que os EUA estivessem mais para cima no gráfico e que o Brasil estivesse ao menos do lado positivo do eixo-x. Isso me sugere que a impressão de que os imóveis no Brasil são ou estão caros tem muito mais a ver com a baixa renda da população.</p>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">p5 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb8-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(</span>
<span id="cb8-3">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">na.omit</span>(tbl_wide),</span>
<span id="cb8-4">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> index_pop, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> index_house)</span>
<span id="cb8-5">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_hline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yintercept =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_vline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xintercept =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_abline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">slope =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">intercept =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> colors[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> highlight)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text_repel</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> iso3c, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> highlight)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">90</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, colors[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>])) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guides</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(</span>
<span id="cb8-16">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Real House Prices x Population (2010/20)"</span>,</span>
<span id="cb8-17">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Population (2010/2020)"</span>,</span>
<span id="cb8-18">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RPPI (2010/2020)"</span>,</span>
<span id="cb8-19">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">caption =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Source: Real House Price Indexes (BIS), Population (UN)."</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-20">  theme_vini</span>
<span id="cb8-21"></span>
<span id="cb8-22">p5</span></code></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/repost-precos-imoveis-demografia/index_files/figure-html/unnamed-chunk-9-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>


</section>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Hong Kong: https://exame.com/economia/as-raizes-economicas-dos-protestos-de-hong-kong/↩︎</p></li>
</ol>
</section></div> ]]></description>
  <category>real-estate</category>
  <category>economia</category>
  <guid>https:://www.restateinsight.com/posts/general-posts/repost-precos-imoveis-demografia/index.html</guid>
  <pubDate>Tue, 20 Jun 2023 03:00:00 GMT</pubDate>
</item>
<item>
  <title>Séries de Tempo no R</title>
  <dc:creator>Vinicius Oike</dc:creator>
  <link>https:://www.restateinsight.com/posts/general-posts/repost-arima-no-r/index.html</link>
  <description><![CDATA[ 




<section id="séries-de-tempo-no-r" class="level1">
<h1>Séries de tempo no R</h1>
<p>Neste post vou explorar um pouco das funções base do R para montar um modelo SARIMA. O <code>R</code> vem “pré-equipado” com um robusto conjunto de funções para lidar com séries de tempo. Inclusive, como se verá, existe uma class específica de objeto para trabalhar com séries de tempo.</p>
</section>
<section id="os-dados" class="level1">
<h1>Os dados</h1>
<p>Como exemplo, vamos usar a série <code>AirPassengers</code>, uma série bastante famosa usada no livro <em>Time Series Analysis</em> de Box &amp; Jenkins (1976). A série apresenta o volume mensal de passagens aéreas internacionais (em milhares) no período 1949-1960.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(AirPassengers, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#023047"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lwd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grid</span>()</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/repost-arima-no-r/index_files/figure-html/unnamed-chunk-2-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Uma maneira comum de avaliar a performance preditiva de modelo é usando uma divisão train/test. Essencialmente, removemos uma parte das observações da nossa amostra para que possamos testar a taxa de acerto das previsões do nosso modelo.</p>
<p>Como estamos no contexto de séries de tempo, é natural remover um percetual das observações finais da série. No caso, uso a função <code>window</code> para remover os últimos dois anos da amostra.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(AirPassengers)</span>
<span id="cb2-2"></span>
<span id="cb2-3">train <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">window</span>(y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">end =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1958</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>))</span>
<span id="cb2-4">test  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">window</span>(y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1959</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span></code></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/repost-arima-no-r/index_files/figure-html/unnamed-chunk-4-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>A rigor, seria mais correto experimentar com várias janelas diferentes e talvez fosse interessante também remover um percentual maior de observações. Até onde sei, não é tão fácil implementar esse tipo de <em>cross-validation</em> apenas usando funções base do R, mas um maneira de fazer isso está exposta no livro <a href="https://otexts.com/fpp3/tscv.html">Forecasting: Principles and Practice</a>.</p>
<section id="modelagem-sarima" class="level2">
<h2 class="anchored" data-anchor-id="modelagem-sarima">Modelagem SARIMA</h2>
<p>Aqui a ideia é experimentar com alguns modelos simples. Em especial, o modelo que Box &amp; Jenkins sugerem para a série é de um SARIMA (0, 1, 1)(0, 1, 1)[12] da forma</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A(1%20-%20%5CDelta)(1%20-%20%5CDelta%5E%7B12%7D)y_%7Bt%7D%20=%20%5Cvarepsilon_%7Bt%7D%20+%20%5Ctheta_%7B1%7D%5Cvarepsilon_%7Bt_1%7D%20+%20%5CTheta_%7B1%7D%5Cvarepsilon_%7Bt-12%7D%0A"></p>
<p>A metodologia correta para a análise seria primeiro fazer testes de raiz unitária para avaliar a estacionaridade da série. Mas só de olhar para as funções de autocorrelação e autocorrelação parcial, fica claro que há algum componente sazonal e que a série não é estacionária.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/repost-arima-no-r/index_files/figure-html/unnamed-chunk-5-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<section id="teste-de-raiz-unitária" class="level3">
<h3 class="anchored" data-anchor-id="teste-de-raiz-unitária">Teste de raiz unitária</h3>
<p>Apenas a título de exemplo, faço um teste Dickey-Fuller (ADF), bastante geral, com constante e tendência temporal linear. Para uma boa revisão metodológica de como aplicar testes de raiz unitária, em partiular o teste ADF, consulte o capítulo de séries não-estacionárias do livro <a href="https://www.wiley.com/en-br/Applied+Econometric+Time+Series,+4th+Edition-p-9781118808566">Applied Econometric Time Series do Enders</a></p>
<p>Aqui, a escolha ótima do lag é feita usando o critério BIC (também conhecido como Critério de Schwarz). Não existe uma função que aplica o teste ADF no pacote base o <code>R</code>. A implementação é feita na função <code>ur.df</code> do pacote <code>urca</code>.</p>
<p>A estatísitica de teste mais relevante é a <code>tau3</code> e vê-se, surpreendentemente, que se rejeita a hipótese nula de raiz unitária. As estatísticas <code>phi2</code> e <code>phi3</code> são testes-F da significânica conjunta dos termos de constante e de tendência temporal. As estatísticas de teste são convencionais e seguem a notação do livro do Enders citado acima e também do clássico livro do <a href="http://www.ru.ac.bd/stat/wp-content/uploads/sites/25/2019/03/504_02_Hamilton_Time-Series-Analysis.pdf">Hamilton</a>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(urca)</span>
<span id="cb3-2">adf_test <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ur.df</span>(y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"trend"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">selectlags =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"BIC"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lags =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span>)</span>
<span id="cb3-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(adf_test)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
############################################### 
# Augmented Dickey-Fuller Test Unit Root Test # 
############################################### 

Test regression trend 


Call:
lm(formula = z.diff ~ z.lag.1 + 1 + tt + z.diff.lag)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.090139 -0.022382 -0.002417  0.021008  0.110003 

Coefficients:
               Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   0.8968049  0.3999031   2.243 0.026859 *  
z.lag.1      -0.1809364  0.0842729  -2.147 0.033909 *  
tt            0.0016886  0.0008609   1.961 0.052263 .  
z.diff.lag1  -0.2588927  0.1134142  -2.283 0.024301 *  
z.diff.lag2  -0.0986455  0.1070332  -0.922 0.358665    
z.diff.lag3  -0.0379799  0.1045583  -0.363 0.717097    
z.diff.lag4  -0.1392651  0.0981271  -1.419 0.158560    
z.diff.lag5  -0.0283998  0.0963368  -0.295 0.768686    
z.diff.lag6  -0.1326313  0.0889223  -1.492 0.138581    
z.diff.lag7  -0.1096365  0.0865862  -1.266 0.208019    
z.diff.lag8  -0.2348880  0.0829892  -2.830 0.005497 ** 
z.diff.lag9  -0.0926604  0.0843594  -1.098 0.274344    
z.diff.lag10 -0.2053937  0.0789245  -2.602 0.010487 *  
z.diff.lag11 -0.1081091  0.0786801  -1.374 0.172127    
z.diff.lag12  0.6633101  0.0752086   8.820 1.54e-14 ***
z.diff.lag13  0.3197783  0.0883636   3.619 0.000443 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.04011 on 114 degrees of freedom
Multiple R-squared:  0.8781,    Adjusted R-squared:  0.8621 
F-statistic: 54.75 on 15 and 114 DF,  p-value: &lt; 2.2e-16


Value of test-statistic is: -2.147 4.9781 3.4342 

Critical values for test statistics: 
      1pct  5pct 10pct
tau3 -3.99 -3.43 -3.13
phi2  6.22  4.75  4.07
phi3  8.43  6.49  5.47</code></pre>
</div>
</div>
<p>Pela análise do correlograma do resíduo da regressão, fica claro que ainda há autocorrelação. Novamente, o mais correto seria aplicar o teste Ljung-Box sobre os resíduos para verificar a presença de autocorrelação conjunta nas primeiras <em>k</em> defasagens, mas este não é o foco deste post. Esta pequena digressão exemplifica como a aplicação destes testes em séries de tempo pode não ser tão direto/simples.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/repost-arima-no-r/index_files/figure-html/unnamed-chunk-7-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Os gráficos abaixo mostram o correlograma da série após tirarmos a primeira diferença e a primeira diferença sazonal. A partir da análise destes correlogramas poderíamos inferir algumas especificações alternativas para modelos SARIMA e aí, poderíamos escolher o melhor modelo usando algum critério de informação.</p>
<p>A metodologia Box &amp; Jenkins de análise de séries de tempo tem, certamente, um pouco de <em>arte</em> e <em>feeling</em>. Não é tão imediato entender como devemos proceder e, na prática, faz sentido experimentar com vários modelos alternativos de ordem baixa como SARIMA(1, 1, 1)(0, 1, 1), SARIMA(2, 1, 0)(0, 1, 1), etc.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/repost-arima-no-r/index_files/figure-html/unnamed-chunk-8-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="os-modelos" class="level3">
<h3 class="anchored" data-anchor-id="os-modelos">Os modelos</h3>
<p>Para não perder muito tempo experimentando com vários modelos vou me ater a três modelos diferentes. Uma função bastante útil é a <code>auto.arima</code> do pacote <code>forecast</code> que faz a seleção automática do melhor modelo da classe SARIMA/ARIMA/ARMA.</p>
<p>Eu sei que o Schumway/Stoffer, autores do ótimo <a href="https://github.com/nickpoison/tsa4">Time Series Analysis and Its Applications</a>, tem um <a href="https://www.stat.pitt.edu/stoffer/tsa4/Rissues.htm">post crítico ao uso</a> do <code>auto.arima</code>. Ainda assim, acho que a função tem seu mérito e costuma ser um bom ponto de partida para a sua análise. Quando temos poucas séries de tempo para analisar, podemos nos dar ao luxo de fazer a modelagem manualmente, mas quando há centenas de séries, é muito conveniente poder contar com o <code>auto.arima</code>.</p>
<p>Como o <code>auto.arima</code> escolhe o mesmo modelo do Box &amp; Jenkins eu experimento com uma especificação diferente. Novamente, a título de exemplo eu comparo ambos os modelos SARIMA com uma regressão linear simples que considera uma tendência temporal linear e uma série de dummies sazonais. O modelo é algo da forma</p>
<p><img src="https://latex.codecogs.com/png.latex?%0Ay_%7Bt%7D%20=%20%5Calpha_%7B0%7D%20+%20%5Calpha_%7B1%7Dt%20+%20%5Csum_%7Bi%20=%201%7D%5E%7B11%7D%5Cbeta_%7Bi%7Ds_%7Bi%7D%20+%20%5Cvarepsilon_%7Bt%7D%0A"></p>
<p>Onde <img src="https://latex.codecogs.com/png.latex?s_%7Bi%7D"> é uma variável indicadora igual a 1 se <img src="https://latex.codecogs.com/png.latex?t"> corresponder ao mês <img src="https://latex.codecogs.com/png.latex?i"> e igual a 0 caso contrário. Vale notar que não podemos ter uma dummy para todos os meses se não teríamos uma matriz de regressores com colinearidade perfeita!</p>
<p>Aqui vou contradizer um pouco o espírito do post novamente para usar o <code>forecast</code>. O ganho de conveniência vem na hora de fazer as previsões. Ainda assim, indico como estimar os mesmos modelos usando apenas funções base do <code>R</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Usando o forecast</span></span>
<span id="cb5-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(forecast)</span>
<span id="cb5-3">model1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">auto.arima</span>(train)</span>
<span id="cb5-4">model2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Arima</span>(train, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">order =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">seasonal =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>))</span>
<span id="cb5-5">model3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tslm</span>(train <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> trend <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> season)</span></code></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Usando apenas funções base</span></span>
<span id="cb6-2">model2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arima</span>(</span>
<span id="cb6-3">  trains,</span>
<span id="cb6-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">order =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb6-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">seasonal =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">order =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">period =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>)</span>
<span id="cb6-6">)</span>
<span id="cb6-7"></span>
<span id="cb6-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extrai uma tendência temporal linear </span></span>
<span id="cb6-9">trend <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">time</span>(train)</span>
<span id="cb6-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Cria variáveis dummies mensais</span></span>
<span id="cb6-11">season <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cycle</span>(train)</span>
<span id="cb6-12">model3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(train <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> trend <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> season)</span></code></pre></div>
</div>
<p>A saída dos modelos segue abaixo. As saídas dos modelos SARIMA não são muito interessantes. Em geral, não é muito comum avaliar nem a significância e nem o sinal dos coeficientes, já que eles não têm muito valor interpretativo. Uma coisa que fica evidente dos dois modelos abaixo é que o primeiro parece melhor ajustado aos dados pois tem valores menores em todos os critérios de informação considerados.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">model1</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Series: train 
ARIMA(0,1,1)(0,1,1)[12] 

Coefficients:
          ma1     sma1
      -0.3424  -0.5405
s.e.   0.1009   0.0877

sigma^2 = 0.001432:  log likelihood = 197.51
AIC=-389.02   AICc=-388.78   BIC=-381</code></pre>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">model2</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Series: train 
ARIMA(1,1,1)(1,1,0)[12] 

Coefficients:
         ar1      ma1     sar1
      0.0668  -0.4518  -0.4426
s.e.  0.3046   0.2825   0.0875

sigma^2 = 0.001532:  log likelihood = 195.14
AIC=-382.28   AICc=-381.89   BIC=-371.59</code></pre>
</div>
</div>
<p>Já o modelo de regressão linear tem uma saída mais interessante. Note que, por padrão, o primeiro mês foi omitido e seu efeito aparece no termo constante. Na tabela abaixo, vemos que há um efeito positivo e significativo, por exemplo, nos meses 6-8 (junho a agosto), que coincidem com o período de férias de verão no hemisfério norte. Já, em novembro (mês 11) parece haver uma queda na demanda por passagens aéreas.</p>
<p>Note que o R quadrado da regressão é extremamente elevado e isso é um indício de que algo está errado. Isto, muito provavelmente é resultado da não-estacionaridade da série.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1">broom<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tidy</span>(model3)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 13 × 5
   term        estimate std.error statistic   p.value
   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
 1 (Intercept)  4.71     0.0191    247.     2.81e-149
 2 trend        0.0106   0.000145   73.2    3.09e- 93
 3 season2     -0.0134   0.0245     -0.549  5.84e-  1
 4 season3      0.120    0.0245      4.91   3.32e-  6
 5 season4      0.0771   0.0245      3.15   2.14e-  3
 6 season5      0.0675   0.0245      2.75   6.93e-  3
 7 season6      0.191    0.0245      7.81   4.23e- 12
 8 season7      0.288    0.0245     11.7    6.32e- 21
 9 season8      0.278    0.0245     11.4    4.36e- 20
10 season9      0.143    0.0245      5.82   6.13e-  8
11 season10     0.00108  0.0245      0.0441 9.65e-  1
12 season11    -0.141    0.0245     -5.77   7.97e-  8
13 season12    -0.0248   0.0245     -1.01   3.14e-  1</code></pre>
</div>
</div>
<p>De fato, olhando para a função de autocorrelação do resíduo do modelo de regressão linear, fica evidente que há autocorrelação. Uma forma de contornar isso seria de incluir um termo ARMA no termo de erro. Novamente, este não é o foco do post e vamos seguir normalmente.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">acf</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">resid</span>(model3))</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/repost-arima-no-r/index_files/figure-html/unnamed-chunk-14-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="comparando-as-previsões" class="level2">
<h2 class="anchored" data-anchor-id="comparando-as-previsões">Comparando as previsões</h2>
<p>A maneira mais prática de trabalhar com vários modelos ao mesmo tempo é agregando eles em listas e aplicando funções nessas listas.</p>
<p>Abaixo eu aplico a função <code>forecast</code> para gerar as previsões 24 períodos a frente nos três modelos. Depois, eu extraio somente a estimativa pontual de cada previsão.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1">models <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(model1, model2, model3)</span>
<span id="cb14-2">yhat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lapply</span>(models, forecast, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">h =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span>)</span>
<span id="cb14-3">yhat_mean <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lapply</span>(yhat, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>mean)</span></code></pre></div>
</div>
<p>Comparamos a performance de modelos de duas formas: (1) olhando para medidas de erro (o quão bem o modelo prevê os dados do <em>test</em>) e (2) olhando para critérios de informação (o quão bem o modelo se ajusta aos dados do <em>train</em>).</p>
<p>Os critérios de informação têm todos uma interpretação bastante simples: quanto menor, melhor. Tipicamente, o AIC tende a escolher modelos sobreparametrizados enquanto o BIC tende a escolher modelos mais parcimoniosos.</p>
<p>Já a comparação de medidas de erro não é tão simples. Pois ainda que um modelo tenha, por exemplo, um erro médio quadrático menor do que outro, não é claro se esta diferença é significante. Uma maneira de testar isso é via o teste Diebold-Mariano, que compara os erros de previsão de dois modelos. Implicitamente, contudo, ele assume que a diferença entre os erros de previsão é covariância-estacionária (também conhecido como estacionário de segunda ordem ou fracamente estacionário). Dependendo do contexto, esta pode ser uma hipótese mais ou menos razoável.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1">compute_error <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(model, test) {</span>
<span id="cb15-2">  y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> test</span>
<span id="cb15-3">    yhat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> model<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>mean</span>
<span id="cb15-4">    train <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> model<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>x</span>
<span id="cb15-5"></span>
<span id="cb15-6">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calcula o erro de previsao</span></span>
<span id="cb15-7">    y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> yhat</span>
<span id="cb15-8">}</span>
<span id="cb15-9"></span>
<span id="cb15-10">compute_error_metrics <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(model, test) {</span>
<span id="cb15-11"></span>
<span id="cb15-12">    y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> test</span>
<span id="cb15-13">    yhat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> model<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>mean</span>
<span id="cb15-14">    train <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> model<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>x</span>
<span id="cb15-15"></span>
<span id="cb15-16">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calcula o erro de previsao</span></span>
<span id="cb15-17">    error <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> yhat</span>
<span id="cb15-18">    </span>
<span id="cb15-19">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Raiz do erro quadrado medio</span></span>
<span id="cb15-20">    rmse <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(error<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span>
<span id="cb15-21">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Erro medio absoluto</span></span>
<span id="cb15-22">    mae <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(error))</span>
<span id="cb15-23">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Erro medio percentual</span></span>
<span id="cb15-24">    mape <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> error <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> y))</span>
<span id="cb15-25">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Root mean squared scaled error</span></span>
<span id="cb15-26">    rmsse <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(error<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">snaive</span>(train)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>mean))</span>
<span id="cb15-27"></span>
<span id="cb15-28">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Devolve os resultados num list</span></span>
<span id="cb15-29">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rmse =</span> rmse, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mae =</span> mae, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mape =</span> mape, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rmsse =</span> rmsse)</span>
<span id="cb15-30">    </span>
<span id="cb15-31"></span>
<span id="cb15-32">}</span>
<span id="cb15-33"></span>
<span id="cb15-34">compute_ics <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(model) {</span>
<span id="cb15-35"></span>
<span id="cb15-36">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extrai criterios de informacao</span></span>
<span id="cb15-37">    aic  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">AIC</span>(model)</span>
<span id="cb15-38">    bic  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">BIC</span>(model)</span>
<span id="cb15-39"></span>
<span id="cb15-40">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Devolve os resultados num list</span></span>
<span id="cb15-41">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">aic =</span> aic, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bic =</span> bic)</span>
<span id="cb15-42"></span>
<span id="cb15-43">} </span>
<span id="cb15-44"></span>
<span id="cb15-45">fcomparison <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lapply</span>(yhat, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(yhat) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">compute_error_metrics</span>(yhat, test))</span>
<span id="cb15-46">icc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lapply</span>(models, compute_ics)</span>
<span id="cb15-47"></span>
<span id="cb15-48">comp_error <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">do.call</span>(rbind.data.frame, fcomparison)</span>
<span id="cb15-49"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(comp_error) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AutoArima"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Manual SARIMA"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"OLS"</span>)</span>
<span id="cb15-50">comp_ics <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">do.call</span>(rbind.data.frame, icc)</span>
<span id="cb15-51"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(comp_ics) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AutoArima"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Manual SARIMA"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"OLS"</span>)</span></code></pre></div>
</div>
<p>A tabela abaixo mostra os critérios AIC e BIC para os três modelos. Em ambos os casos, o SARIMA(0, 1, 1)(0, 1, 1)[12] parece ser o escolhido. Este tipo de feliz coincidência não costuma acontecer frequentemente na prática, mas neste caso ambos os critérios apontam para o mesmo modelo.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1">comp_ics</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                    aic       bic
AutoArima     -389.0155 -380.9970
Manual SARIMA -382.2807 -371.5894
OLS           -342.2930 -303.2681</code></pre>
</div>
</div>
<p>Na comparação de medidas de erro, o SARIMA(0, 1, 1)(0, 1, 1)[12] realmente tem uma melhor performance, seguido pelo OLS e pelo SARIMA(1, 1, 1)(1, 1, 0)[12].</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1">comp_error</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                    rmse        mae     mape      rmsse
AutoArima     0.09593236 0.08959921 1.463477 0.03939512
Manual SARIMA 0.11688549 0.10780460 1.762201 0.04806577
OLS           0.10333715 0.09384411 1.549261 0.04266214</code></pre>
</div>
</div>
<p>Será que esta diferença é significante? Vamos comparar os modelos SARIMA. Pelo teste DM ela é sim. Lembre-se que o teste DM é, essencialmente, um teste Z de que <img src="https://latex.codecogs.com/png.latex?e_%7B1%7D%20-%20e_%7B2%7D%20=%200"> ou <img src="https://latex.codecogs.com/png.latex?e_%7B1%7D%20=%20e_%7B2%7D">, onde os valores são a média dos erros de previsão dos modelos.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1">errors <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lapply</span>(yhat, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(yhat) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">compute_error</span>(yhat, test))</span>
<span id="cb20-2">e1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> errors[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]]</span>
<span id="cb20-3">e2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> errors[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]]</span>
<span id="cb20-4"></span>
<span id="cb20-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dm.test</span>(e1, e2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">power =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Diebold-Mariano Test

data:  e1e2
DM = -4.4826, Forecast horizon = 1, Loss function power = 2, p-value =
0.0001691
alternative hypothesis: two.sided</code></pre>
</div>
</div>
<p>Vale notar que o teste DM serve para comparar os erros de previsão de quaisquer modelos. Como o teste não faz qualquer hipótese sobre “de onde vem” os erros de previsão, ele pode ser utilizado livremente. Vale lembrar também que este teste não deve ser utilizado para escolher o melhor modelo, já que ele compara apenas a capacidade preditiva de dois modelos alternativos.</p>
<p>Outro ponto, também complicado, é de qual a medida de erro que se deve escolher. O teste DM implicitamente usa o erro médio quadrático, mas há várias outras alternativas. <a href="https://otexts.com/fpp3/accuracy.html">Uma breve discussão pode ser vista aqui</a>.</p>
<p>Por fim, o gráfico abaixo mostra as previsões dos modelos alternativos contra a série real.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(test, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylim =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5.8</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">6.5</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#8ecae6"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lwd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"o"</span>)</span>
<span id="cb22-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(yhat_mean[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#ffb703"</span>)</span>
<span id="cb22-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(yhat_mean[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#fb8500"</span>)</span>
<span id="cb22-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(yhat_mean[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#B86200"</span>)</span>
<span id="cb22-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grid</span>()</span>
<span id="cb22-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">legend</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topleft"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb22-7">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Test"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AutoArima"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Arima"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"OLS"</span>),</span>
<span id="cb22-8">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#8ecae6"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#ffb703"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#fb8500"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#B86200"</span>))</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/repost-arima-no-r/index_files/figure-html/unnamed-chunk-20-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="resumo-geral" class="level1">
<h1>Resumo geral</h1>
<p>Algumas conclusões gerais para amarrar este post:</p>
<ol type="1">
<li><p>A metodologia Box-Jenkins não é tão direta. A interpretação do correlograma é muitas vezes incerta e a melhor opção costuma ser testar vários modelos.</p></li>
<li><p>Escolher o melhor modelo não é tão trivial. Uma saída simples é escolher o modelo com menor AIC ou BIC. Ainda assim, é importante levar em conta a capacidade preditiva do modelo.</p></li>
<li><p>Mesmo usando apenas funções base do <code>R</code> já é possível fazer boas análises com séries de tempo.</p></li>
</ol>


</section>

 ]]></description>
  <category>time-series</category>
  <category>tutorial-R</category>
  <category>econometria</category>
  <guid>https:://www.restateinsight.com/posts/general-posts/repost-arima-no-r/index.html</guid>
  <pubDate>Thu, 01 Jun 2023 03:00:00 GMT</pubDate>
  <media:content url="https:://www.restateinsight.com/static/series-tempo-r.svg" medium="image" type="image/svg+xml"/>
</item>
<item>
  <title>Usando fontes com showtext no R</title>
  <dc:creator>Vinicius Oike</dc:creator>
  <link>https:://www.restateinsight.com/posts/general-posts/repost-tutorial-showtext/index.html</link>
  <description><![CDATA[ 




<p>Criar boas visualizações é parte importante de qualquer análise de dados.</p>
<p>A tipografia de um texto deve complementar a mensagem e o tom que se quer comunicar e o mesmo vale para visualizações com dados. A fonte do texto ajuda a transmitir informação e pode comunicar, por exemplo, maior sobriedade, profissionalismo, etc.</p>
<p>O pacote <code>showtext</code>, desenvolvido por <a href="https://github.com/yixuan/showtext">yixuan</a>, facilita a importação e o uso de fontes em gráficos no <code>R</code>. O pacote funciona com uma variedade de extensões de fontes, não sendo limitado como o <code>extrafont</code>, por exemplo, a arquivos <code>.ttf</code>.</p>
<section id="r" class="level1">
<h1>R</h1>
<p>O primeiro passo necessário é instalar o pacote do CRAN usando <code>install.packages()</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Instale o pacote se necessário</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">install.packages</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"extrafont"</span>)</span>
<span id="cb1-3"></span>
<span id="cb1-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Opcionalmente instale a versão em desenvolvimento</span></span>
<span id="cb1-5">remotes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">install_github</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"yixuan/showtext"</span>)</span>
<span id="cb1-6"></span>
<span id="cb1-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(showtext)</span></code></pre></div>
</div>
<p>Importar fontes é bastante simples. Como exemplo vamos importar algumas <a href="https://fonts.google.com">fontes do Google</a> usando a função <code>font_add_google()</code>. Esta função, em geral, leva apenas dois arugmentos. O primeiro argumento deve ser o nome “oficial” da fonte; o segundo argumento é como será o nome desta fonte dentro do R.</p>
<p>No exemplo abaixo vamos importar três fontes: Montserrat, Roboto Condensed e Alice. No primeiro caso vamos manter o mesmo nome da fonte; já nos outros dois vamos usar nomes diferentes.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">font_add_google</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Montserrat"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Montserrat"</span>)</span>
<span id="cb2-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># É possível simplificar o nome da fonte</span></span>
<span id="cb2-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">font_add_google</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Roboto Condensed"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RobCond"</span>)</span>
<span id="cb2-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">font_add_google</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Alice"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"alice"</span>)</span></code></pre></div>
</div>
<p>Também é possível importar fontes que já estão instaladas no seu computador usando a função <code>font_add</code>. Agora a ordem dos arugmentos é invertida: o primeiro argumento define o nome da fonte dentro do <code>R</code> enquanto o segundo argumento é o nome do arquivo que pode ser <code>.ttf</code>, <code>.ttc</code> ou outros.</p>
<p>Em geral, o <code>showtext</code> consegue encontrar corretamente as pastas onde estes arquivos estão armazenados. Caso você tenha problema com isso vai ter de especificar este caminho manualmente com a função <code>font_paths()</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Importar a fonte Helvetica</span></span>
<span id="cb3-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">font_add</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"HelveticaNeue"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"HelveticaNeue.ttc"</span>)</span>
<span id="cb3-3"></span>
<span id="cb3-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Importar a fonte Arial (junto com a versão em negrito, itálico, etc.)</span></span>
<span id="cb3-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">font_add</span>(</span>
<span id="cb3-6">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Arial"</span>,</span>
<span id="cb3-7">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">regular =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Arial.ttf"</span>,</span>
<span id="cb3-8">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bold =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Arial Bold.ttf"</span>,</span>
<span id="cb3-9">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">italic =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Arial Italic.ttf"</span>,</span>
<span id="cb3-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bolditalic =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Arial Bold Italic.ttf"</span>)</span></code></pre></div>
</div>
<p>Para informar ao R que o <code>showtext</code> deve ser utilizado para desenhar o texto dos gráficos é preciso usar a função <code>showtext_auto()</code>. Só é preciso fazer isto uma única vez por sessão. Se você <em>sempre</em> utiliza o <code>showtext</code> você pode considerar incluir esta função no seu <code>.Rprofile</code>, assim o pacote será carregado automaticamente sempre que você abrir uma nova sessão no <code>R</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Indica que o showtext deve ser utilizado para criar as imagens</span></span>
<span id="cb4-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Só precisa ser chamado uma única vez por sessão</span></span>
<span id="cb4-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">showtext_auto</span>()</span></code></pre></div>
</div>
<section id="base-r" class="level2">
<h2 class="anchored" data-anchor-id="base-r">Base R</h2>
<p>Para modificar a fonte dos elementos textuais dos gráficos feitos com o <code>plot()</code> é preciso ajustar o argumento <code>family</code>. Usando as funções base do R, este argumento aparece dentro da função <code>par</code> (que configura vários parâmetros dos gráficos).</p>
<p>O código abaixo mostra como trocar a fonte do gráfico.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Define a fonte padrão do gráfico</span></span>
<span id="cb5-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">par</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"alice"</span>)</span>
<span id="cb5-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Monta um scatter plot de exemplo</span></span>
<span id="cb5-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(mpg <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> wt, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> mtcars, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Milhas por galão"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Peso (ton.)"</span>)</span>
<span id="cb5-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">title</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Peso x eficiência de carros"</span>)</span>
<span id="cb5-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"exemplo de texto"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>)</span>
<span id="cb5-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">legend</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topright"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"exemplo de legenda"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pch =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/repost-tutorial-showtext/index_files/figure-html/unnamed-chunk-6-1.svg" class="img-fluid figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
<p>Note que <em>todos</em> os objetos textuais (título, legenda, etc.) são convertidos para a mesma fonte. Caso se queira fontes diferentes para estes elementos é preciso especificá-los adequadamente. Por exemplo, para trocar somente a fonte do título</p>
<p><code>title("nome_do_titulo", family = "nome_fonte")</code></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(mpg <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> wt, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> mtcars, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Milhas por galão"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Peso (ton.)"</span>)</span>
<span id="cb6-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">title</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Peso x eficiência de carros"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RobCond"</span>)</span>
<span id="cb6-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"exemplo de texto"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Montserrat"</span>)</span>
<span id="cb6-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">legend</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topright"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"exemplo de legenda"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pch =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/repost-tutorial-showtext/index_files/figure-html/unnamed-chunk-7-1.svg" class="img-fluid figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
<p>Vale notar que, uma vez definida a fonte usando a função <code>par</code>, todos os gráficos subsequentes vão usar esta fonte. Para trocar a fonte é preciso usar a função <code>par</code> novamente. Além da fonte também é possível trocar a ênfase (e.g.&nbsp;<code>face = c("bold", "italic")</code>) e também o tamanho da letra (e.g.&nbsp;<code>cex.axis = 1.5</code>, <code>cex.main = 2</code>).</p>
</section>
<section id="ggplot2" class="level2">
<h2 class="anchored" data-anchor-id="ggplot2">ggplot2</h2>
<p>Também é possível trocar a fonte de gráficos feitos com outros pacotes, como o <code>ggplot2</code>. O exemplo abaixo monta um gráfico similar ao que foi feito acima. Modifica-se a fonte dentro da função <code>theme</code>. Esta função é um tanto particular, então vale a pena discorrer um pouco sobre ela. Ela é basicamente usada para modificar elementos do gráfico. Há quatro elementos principais, dos quais só nos interessa um: o <code>element_text</code>. São seis os principais elementos textuais que pode-se modificar:</p>
<ul>
<li><code>axis.text</code> - texto dos eixos (em geral, os números do eixo);</li>
<li><code>axis.title</code> - nome do eixo (e.g.&nbsp;“Milhas por galão” no exemplo acima);</li>
<li><code>legend.text</code> - texto da legenda;</li>
<li><code>legend.title</code> - título da legenda;</li>
<li><code>plot.title</code> - título do gráfico;</li>
<li><code>text</code> - <em>todos</em> os acima.</li>
</ul>
<p>Pode-se ser mais específico com o texto dos eixos usando <code>axis.text.x</code> e <code>axis.text.y</code>, por exemplo. O último dos elementos listados acima funciona como um “coringa”, ele serve para modificar de uma vez só todos os elementos textuais de um gráfico. No exemplo abaixo modifico somente o <code>text</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb7-2"></span>
<span id="cb7-3">p <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> mtcars, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> wt, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> mpg)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stat_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lm"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">formula =</span> y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">poly</span>(x, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">se =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(</span>
<span id="cb7-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Peso (ton.)"</span>,</span>
<span id="cb7-8">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Milhas por galão"</span>,</span>
<span id="cb7-9">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Eficiência e peso de carros"</span>,</span>
<span id="cb7-10">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">subtitle =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Regressão entre o peso de diferentes carros e sua eficiência energética"</span>,</span>
<span id="cb7-11">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">caption =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fonte: Motor Trend US Magazine 1974"</span></span>
<span id="cb7-12">    )</span></code></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">p <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Montserrat"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>))</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/repost-tutorial-showtext/index_files/figure-html/unnamed-chunk-9-1.svg" class="img-fluid figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
<p>O próximo exemplo mostra como modificar alguns dos diferentes elementos do gráfico. Aproveito a variável <code>cyl</code> (cilindradas) para diferenciar os carros em três grupos para que o gráfico agora tenha uma legenda.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">p <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.factor</span>(cyl))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_discrete</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cilindros"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb9-5">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Modifica o texto (números) dos eixos x e y</span></span>
<span id="cb9-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"alice"</span>),</span>
<span id="cb9-7">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Modifica o título do eixo (i.e. Milhas por galão)</span></span>
<span id="cb9-8">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Montserrat"</span>),</span>
<span id="cb9-9">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Modifica o título da legenda (Cilindros)</span></span>
<span id="cb9-10">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"HelveticaNeue"</span>),</span>
<span id="cb9-11">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Modifica o texto da legenda (i.e. 4, 6, 8)</span></span>
<span id="cb9-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"HelveticaNeue"</span>),</span>
<span id="cb9-13">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Modifica o título do gráfico</span></span>
<span id="cb9-14">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RobCond"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)</span>
<span id="cb9-15">    )</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/repost-tutorial-showtext/index_files/figure-html/unnamed-chunk-10-1.svg" class="img-fluid figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
<p>Talvez o jeito mais sensato de usar fontes com o <code>ggplot2</code> seja primeiro especificar uma fonte padrão para o gráfico usando <code>text</code> e depois calibrar as exceções. Os elementos textuais como <code>axis.title</code> e <code>legend.text</code> copiam as propriedades definidas em <code>text</code>.</p>
<p>No exemplo abaixo defino que todos os elementos textuais ser escritos em Arial simples em tamanho 12 na cor <code>"gray20"</code>. Depois disso defino que o título deve ter mais destaque com Arial em negrito (bold) num tamanho maior e numa cor mais escura. Por fim, defino que o rodapé do gráfico seja escrito em fonte menor e em itálico.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">theme_custom <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_light</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb10-3">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Modifica todos os elementos textuais do gráfico</span></span>
<span id="cb10-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Arial"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray20"</span>),</span>
<span id="cb10-5">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Modifica apenas o título</span></span>
<span id="cb10-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray10"</span>),</span>
<span id="cb10-7">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Modifica apenas a nota no rodapé</span></span>
<span id="cb10-8">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.caption =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"italic"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>)</span>
<span id="cb10-9">  )</span>
<span id="cb10-10"></span>
<span id="cb10-11">p <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb10-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.factor</span>(cyl))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_discrete</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cilindros"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-14">  theme_custom</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/repost-tutorial-showtext/index_files/figure-html/unnamed-chunk-11-1.svg" class="img-fluid figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
<p>Por último, também pode ser interessante usar fontes diferentes para representar dados diferentes. Isto é possível usando o argumento <code>family</code> dentro do <code>aes</code>. Da mesma forma, seria possível também representar grupos de dados diferentes com tamanhos de fontes diferentes ou mesmo destacar algum grupo específico com itálico.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1">nomes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">row.names</span>(mtcars)</span>
<span id="cb11-2">mtcars<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>cyl <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.factor</span>(mtcars<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>cyl)</span>
<span id="cb11-3"></span>
<span id="cb11-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> mtcars, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> wt, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> mpg)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> nomes, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Arial"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"alice"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Montserrat"</span>)[cyl]))</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/repost-tutorial-showtext/index_files/figure-html/unnamed-chunk-12-1.svg" class="img-fluid figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="anexo-problemas-com-dpi-e-rmarkdown" class="level2">
<h2 class="anchored" data-anchor-id="anexo-problemas-com-dpi-e-rmarkdown">Anexo: problemas com DPI e RMarkdown</h2>
<p>Apesar de muito conveniente, o <code>showtext</code> não é inteiramente desprovido de problemas. Dois problemas que enfrento com alguma recorrência são diferenças de DPI na hora de exportar gráficos e problemas com RMarkdown.</p>
<p>O problema com o RMarkdown é mais simples. Em versões antigas do RMarkdown e do showtext era necessário adicionar um argumento <code>fig.showtext = TRUE</code> em todos os chunks em que um gráfico usando showtext fosse renderizado. Alternativamente, podia-se modificar esta opção globalmente inserido o seguinte código no início do documento RMarkdown.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1">knitr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>opts_chunk<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set</span>(</span>
<span id="cb12-2">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fig.showtext =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb12-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fig.retina =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb12-4">  )</span></code></pre></div>
</div>
<p>Acredito, mas não tenho certeza, de que este problema sumiu em versões mais recentes dos pacotes, pois com frequência eu esqueço de adicionar estes argumentos mas não encontro problemas na prática.</p>
<p>O problema com o DPI na hora de exportar gráficos é mais complicado. Por problemas de DPI quero dizer quando o showtext “desenha” o texto num DPI diferente do ggplot2. O resultado é que o texto fica ou grande ou pequeno demais. Por padrão o <code>showtext</code> utiliza o DPI em 96.</p>
<p>Vamos montar um gráfico para ilustrar o problema.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1">grafico <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb13-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.factor</span>(cyl))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb13-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_discrete</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cilindros"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb13-4">  theme_custom</span>
<span id="cb13-5"></span>
<span id="cb13-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Exportar o gráfico em alta resolução</span></span>
<span id="cb13-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggsave</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"meu_grafico.jpeg"</span>, grafico, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dpi =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">300</span>)</span></code></pre></div>
</div>
<p>Quando vamos abrir o arquivo que foi exportado temos o resultado abaixo.</p>
<p><img src="https:://www.restateinsight.com/posts/tutorial-showtext/meu_grafico.jpeg" class="image_figure image_featured image_internal image_unprocessed img-fluid" loading="lazy" decoding="async" alt=""></p>
<p>Como a imagem foi salva com DPI mais elevado o texto fica menor do que deveria; em casos mais extremos o texto fica minúsculo a ponto de ser ilegível. Há duas formas de tentar contornar este problema: (1) reduzir o DPI dentro de <code>ggsave</code>; ou (2) modificar o DPI do <code>showtext</code>.</p>
<p>Vamos tentar a primeira solução: modificar o <code>ggsave</code> para o DPI padrão do <code>showtext</code>. Agora o texto está maior mas a proporção dos elementos está péssima! O resultado é pior do que o problema inicial.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Exportar a imagem num dpi menor</span></span>
<span id="cb14-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggsave</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"meu_grafico_96.jpeg"</span>, grafico, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dpi =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">96</span>)</span></code></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/repost-tutorial-showtext/meu_grafico_96.jpeg" class="img-fluid figure-img"></p>
</figure>
</div>
<p>A segunda solução é modificar as opções internas do <code>showtext</code>. Isto é bastante simples e pode ser feito com o <code>showtext_opts(dpi = 300)</code> e chamando novamente a função <code>showtext_auto()</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Ajusta o DPI do showtext</span></span>
<span id="cb15-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">showtext_opts</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dpi =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">300</span>)</span>
<span id="cb15-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># "Ativa" o showtext novamente</span></span>
<span id="cb15-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">showtext_auto</span>()</span>
<span id="cb15-5"></span>
<span id="cb15-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Refaz o gráfico (isto é importante!)</span></span>
<span id="cb15-7">grafico <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb15-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.factor</span>(cyl))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb15-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_discrete</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cilindros"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb15-10">  theme_custom</span>
<span id="cb15-11"></span>
<span id="cb15-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Exporta um novo gráfico</span></span>
<span id="cb15-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggsave</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"meu_grafico_300.jpeg"</span>, grafico, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dpi =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">300</span>)</span></code></pre></div>
</div>
<p>Agora o tamanho do texto está correto e a imagem como um todo está em alta resolução. Um problema é que a imagem ficou bastante grande, mas isto pode ser ajustado variando os argumentos <code>width</code> e <code>height</code> da função <code>ggsave</code>.</p>
<p><img src="https:://www.restateinsight.com/posts/tutorial-showtext/meu_grafico_300.jpeg" class="image_figure image_featured image_internal image_unprocessed img-fluid" loading="lazy" decoding="async" alt=""></p>
<p>Vale notar que, a depender do seu sistema operacional, modificar o DPI padrão do showtext pode distorcer os gráficos dentro do R ou RStudio. Na prática o melhor <em>workflow</em> pode ser de modificar o DPI do showtext apenas no momento de exportar os gráficos.</p>


</section>
</section>

 ]]></description>
  <category>tutorial-R</category>
  <guid>https:://www.restateinsight.com/posts/general-posts/repost-tutorial-showtext/index.html</guid>
  <pubDate>Wed, 10 May 2023 03:00:00 GMT</pubDate>
  <media:content url="https:://www.restateinsight.com/static/tipografia_r.png" medium="image" type="image/png" height="57" width="144"/>
</item>
<item>
  <title>Visualizando o IPCA</title>
  <dc:creator>Vinicius Oike</dc:creator>
  <link>https:://www.restateinsight.com/posts/general-posts/repost-ipca-visualizacao/index.html</link>
  <description><![CDATA[ 




<section id="inflação-no-brasil" class="level1">
<h1>Inflação no Brasil</h1>
<p>A inflação voltou a ser uma pauta, não só no Brasil, mas no mundo todo, nos últimos meses. No Brasil, a combinação de câmbio desvalorizado, desajustes logísticos, crise hídrica e choques de preços externos, culminaram no maior nível de inflação desde 2002.</p>
<p>Mesmo em países avançados, os níveis de inflação estão em altas históricas. Nos Estados Unidos, por exemplo, o nível do CPI está no valor mais alto desde o final dos anos 1970.</p>
<p>Visualizar a magnitude da inflação no Brasil pode ser um pouco desafiador. A série do IPCA é calculada desde 1979. O número de cidades avaliadas pelo índice cresceu no tempo: nos primeiros anos o índice contemplava Rio de Janeiro, Porto Alegre, Belo Horizonte, Recife, São Paulo, Brasília, Belém, Fortaleza, Salvador e Curitiba. Em 1991, Goiânia entra no índice e, mais recentemente, em 2014, Vitória e Campo Grande também entraram no cômputo do índice.</p>
<p>Mais importante do que a variação no número das cidades, é o período hiperinflacionário da década de 1980. Os números da inflação são incomparavelmente mais altos do que os atuais. Como regra, os cortes temporais mais relevantes para enxergar a inflação são Jul/94 (Plano Real), Jul/99 (Regime de Metas de Inflação), Mai/00 (Lei de Responsabilidade Fiscal) e Mai/03 (pós choque de 2002).</p>
<p>Neste post vou mostrar o comportamento da inflação desde 1999.</p>
<section id="pacotes" class="level2">
<h2 class="anchored" data-anchor-id="pacotes">Pacotes</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Os pacotes utilizados</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyr)</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggdist)</span>
<span id="cb1-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(spiralize)</span>
<span id="cb1-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(showtext)</span>
<span id="cb1-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(lubridate)</span>
<span id="cb1-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(GetBCBData)</span>
<span id="cb1-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(forecast)</span></code></pre></div>
</div>
</section>
<section id="importando-os-dados" class="level2">
<h2 class="anchored" data-anchor-id="importando-os-dados">Importando os dados</h2>
<p>Importo os dados diretamente da API do Banco Central usando o pacote <code>GetBCBData</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Importar os dados</span></span>
<span id="cb2-2">ipca <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gbcbd_get_series</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">id =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">433</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">first.date =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.Date</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1998-01-01"</span>))</span></code></pre></div>
</div>
<p>O código abaixo cria alguns elementos que serão necessários para as visualizações.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">grid <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(</span>
<span id="cb3-2">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ref.date =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.Date</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1998-01-01"</span>),<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.Date</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2022-12-01"</span>), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1 month"</span>))</span>
<span id="cb3-3"></span>
<span id="cb3-4">ipca_meta <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(</span>
<span id="cb3-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">year =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1999</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2022</span>,</span>
<span id="cb3-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">meta =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5.5</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>), <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.25</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.75</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.5</span>),</span>
<span id="cb3-7">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">banda =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>)),</span>
<span id="cb3-8">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">banda_superior =</span> meta <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> banda,</span>
<span id="cb3-9">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">banda_inferior =</span> meta <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> banda)</span></code></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">ipca <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> ipca <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb4-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">right_join</span>(grid) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb4-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fill</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb4-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">month =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">month</span>(ref.date, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">abbr =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">locale =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pt_BR"</span>),</span>
<span id="cb4-5">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">year =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">year</span>(ref.date),</span>
<span id="cb4-6">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">value =</span> value <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>,</span>
<span id="cb4-7">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">acum12m =</span> RcppRoll<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">roll_prodr</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> value, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb4-8">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">acum12m =</span> acum12m <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb4-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(ipca_meta) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb4-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">deviation =</span> acum12m <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> meta)</span></code></pre></div>
</div>
</section>
<section id="inflação" class="level2">
<h2 class="anchored" data-anchor-id="inflação">Inflação</h2>
<p>O cálculo do IPCA avalia a variação de preços de uma cesta fixa de bens. A composição desta cesta vem da Pesquisa de Orçamentos Familiares (POF), também feita pelo IBGE, que tem como objetivo representar a “cesta de consumo média” dos brasileiros.</p>
<p>Formalmente, o IPCA é um índice de Laspeyeres que compara o preço de mercado de uma cesta de bens <img src="https://latex.codecogs.com/png.latex?W%20=%20(w_%7B1%7D,%20w_%7B2%7D,%20%5Cdots,%20w_%7Bn%7D)"> no período <img src="https://latex.codecogs.com/png.latex?t"> e compara o preço de mercado desta mesma cesta de bens no período anterior <img src="https://latex.codecogs.com/png.latex?t-1">.</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AI_%7Bt%7D%20=%20%5Cfrac%7B%5Csum_%7Bi%7Dw_%7Bi%7DP_%7Bi,%20t%7D%7D%7B%5Csum_%7Bi%7Dw_%7Bi%7DP_%7Bi,%20t-1%7D%7D%0A"></p>
<p>Na prática, esta cesta de bens agrega um misto de gastos com habitação, alimentos, vestuário, combustíveis, serivços, etc. Como existe uma clara sazonalidade tanto na oferta como na demanda por estes bens, o IPCA também apresenta sazonalidade.</p>
<p>Isso fica claro, quando se visualiza a variação do IPCA mês a mês como no gráfico abaixo. Tipicamente, os meses de nov-dez-jan-fev apresentam valores mais altos do que os meses de mai-jun-jul-ago.</p>
<p>O ponto fora da curva em novembro é referente ao ano de 2002. Ele é resultado, em parte, da incerteza econômica e da enorme desvalorização cambial que se seguiu à primeira eleição do ex-presidente Lula.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ts</span>(ipca<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>value <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1998</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">frequency =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>)</span>
<span id="cb5-2"></span>
<span id="cb5-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggseasonplot</span>(y) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_viridis_d</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sazonalidade do IPCA"</span>,</span>
<span id="cb5-6">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>,</span>
<span id="cb5-7">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bottom"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/repost-ipca-visualizacao/index_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="no-longo-prazo" class="level2">
<h2 class="anchored" data-anchor-id="no-longo-prazo">No longo prazo</h2>
<p>Uma das maneiras de contornar o problema da sazonalidade é acumulando o índice anualmente, pois aí temos o efeito sazonal de todos os meses. O problema é que aí teríamos de sempre comparar anos completos, impossibilitando um diagnóstico da inflação em maio do ano corrente.</p>
<p>A solução é acumular o índice em doze meses, criando um “ano artificial”. A lógica é que, independentemente do momento do tempo em que estamos, contamos o efeito de todos os meses individualmente. Chamando de <img src="https://latex.codecogs.com/png.latex?z_%7Bt%7D"> o índice acumulado e <img src="https://latex.codecogs.com/png.latex?y_%7Bt%7D"> o valor do IPCA no período <img src="https://latex.codecogs.com/png.latex?t"> temos que:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0Az_%7Bt%7D%20=%20%5B(1%20+%20y_%7Bt-12%7D)(1%20+%20y_%7Bt-11%7D)%5Cdots(1%20+%20y_%7Bt-1%7D)%5D%20-%201%0A"></p>
<p>Assim, para o mês de maio de 2022 teríamos</p>
<p><img src="https://latex.codecogs.com/png.latex?%0Az_%7B%5Ctext%7Bmaio/22%7D%7D%20=%20%5B(1%20+%20y_%7B%5Ctext%7Babril/22%7D%7D)(1%20+%20y_%7B%5Ctext%7Bmar/22%7D%7D)%5Cdots(1%20+%20y_%7B%5Ctext%7Bjun/21%7D%7D)%5D%20-%201%0A"></p>
<section id="acumulado-12-meses" class="level3">
<h3 class="anchored" data-anchor-id="acumulado-12-meses">Acumulado 12 meses</h3>
<p>O código abaixo apresenta o histórico do IPCA acumulado em 12 meses junto com a sua média histórica.</p>
<p>Vemos como o período de 2002 é muito fora da curva. Também se nota como o Brasil quase sempre tem uma inflação relativamente alta, próxima de 5-6%. O único período de inflação baixa na série é no período 2017-19.</p>
<p>Vale notar que só faz sentido em falar na “média histórica” de uma série se ela for estacionária.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">avgipca <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(ipca<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>acum12m, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb6-2">label <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Média: "</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(avgipca, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span>
<span id="cb6-3">dftext <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.Date</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2019-01-01"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> label)</span>
<span id="cb6-4"></span>
<span id="cb6-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">na.omit</span>(ipca), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> ref.date, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> acum12m)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_hline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yintercept =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_hline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yintercept =</span> avgipca,</span>
<span id="cb6-9">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> dftext,</span>
<span id="cb6-11">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.Date</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2019-01-01"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> label),</span>
<span id="cb6-12">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Helvetica"</span>,</span>
<span id="cb6-13">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_date</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">date_breaks =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1 year"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">date_labels =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%Y"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Inflação Acumulada em 12 Meses"</span>,</span>
<span id="cb6-16">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>,</span>
<span id="cb6-17">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%"</span>,</span>
<span id="cb6-18">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">caption =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fonte: BCB"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb6-21">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Helvetica"</span>),</span>
<span id="cb6-22">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">angle =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">90</span>))</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/repost-ipca-visualizacao/index_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>A comparação com a média histórica é interessante, mas é mais relevante olhar para a meta de inflação. Desde 1999, o Conselho Monetário Nacional (CMN) define, em geral com 2 anos de antecedência, a meta de inflação que o Banco Central deve perseguir. Este tipo de estrutura institucional é bastante popular mundo afora e há uma sólida básica empírica e teórica que a sustenta.</p>
<p>Basicamente, ao estabelecer antecipadamente uma meta de inflação, o CMN tenta ancorar as expectativas das pessoas na economia. Se a meta for crível, as pessoas tendem a montar planos de negócios, firmar contratos e tomar escolhas tomando a inflação futura como a meta de inflação.</p>
<p>A meta de inflação também incentiva o Banco Central a priorizar o controle dos preços acima de outras prioridades concorrentes.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">historico_meta <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> ipca <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb7-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(ref.date, acum12m, meta, banda_inferior, banda_superior) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb7-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>ref.date) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb7-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">na.omit</span>()</span>
<span id="cb7-5"></span>
<span id="cb7-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(historico_meta, name <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"acum12m"</span>),</span>
<span id="cb7-8">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> ref.date, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> value),</span>
<span id="cb7-9">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#e63946"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(historico_meta, name <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"acum12m"</span>),</span>
<span id="cb7-11">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> ref.date, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> value, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> name)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_hline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yintercept =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_date</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">date_breaks =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1 year"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">date_labels =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%Y"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>,</span>
<span id="cb7-15">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#264653"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#264653"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#2a9d8f"</span>),</span>
<span id="cb7-16">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Banda Inf."</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Banda Sup."</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Meta"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Histórico de Metas de Inflação"</span>,</span>
<span id="cb7-18">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"% (acum. 12 meses)"</span>,</span>
<span id="cb7-19">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>,</span>
<span id="cb7-20">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">caption =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fonte: BCB"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-21">  theme_vini</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/repost-ipca-visualizacao/index_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>No Brasil, o CMN define a meta e também a sua banda superior e inferior. No gráfico acima, vemos que a inflação esteve relativamente dentro da meta no período 2003-2014, ainda que depois de 2008 o índice tenha ficado sempre acima do centro da meta.</p>
<p>Após a alta de 2016 o índice cai para níveis bastante baixos e o CMN inclusive começa a progressivamente reduzir a meta de inflação. Este é o único período desde 1999 em que a inflação fica, em alguns momentos, abaixo da meta.</p>
<p>Evidentemente, a inflação dispara no período recente. O enorme descolamento com a meta põe o sistema em cheque, à medida em que as pessoas acreditam cada vez menos na habilidade do Banco Central em honrar seu compromisso.</p>
</section>
</section>
<section id="enxergando-a-distribuição" class="level2">
<h2 class="anchored" data-anchor-id="enxergando-a-distribuição">Enxergando a distribuição</h2>
<p>Outra maneira de enxergar o IPCA é olhar para a distribuição dos seus valores. O gráfico abaixo é um histograma com um</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(ipca, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> value <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_histogram</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> ..density..), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bins =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">38</span>,</span>
<span id="cb8-3">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#264653"</span>,</span>
<span id="cb8-4">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_hline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yintercept =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_density</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.25</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Distribuição do IPCA mensal"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Densidade"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-9">  theme_vini</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/repost-ipca-visualizacao/index_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Um tipo de visualização interessante é montar um “grid” como o abaixo. Um problema é que a escala de cores acaba um pouco deturpada por causa do período 2002-3.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(ipca, ref.date <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.Date</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1999-01-01"</span>)),</span>
<span id="cb9-2">       <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> month, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> year, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> acum12m)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_tile</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray90"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1999</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2022</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_viridis_c</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">option =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"magma"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-7">  theme_vini</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/repost-ipca-visualizacao/index_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Algum nível de arbitrariedade é necessário para resolver isso. Uma opção é agrupar os dados em grupos. Como a meta mais longa que tivemos foi a de 4.5 com intervalo de 2, monto os grupos baseado nisso. A aceleração recente da inflação, a meu ver, fica mais evidente desta forma. Inclusive, conseguimos enxergar melhor como a inflação recente é mais intensa do que a de 2015-17.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">grupos <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> ipca <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb10-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(ref.date <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.Date</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1999-01-01"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb10-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ipca_group =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">findInterval</span>(acum12m, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.5</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.5</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">6.5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>)),</span>
<span id="cb10-4">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ipca_group =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(ipca_group))</span>
<span id="cb10-5">labels <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt; 2.5"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2.5-4.5"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"4.5-6.5"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"6.5-10"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"10-15"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&gt; 15"</span>)</span>
<span id="cb10-6"></span>
<span id="cb10-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(grupos,</span>
<span id="cb10-8">       <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> month, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> year, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> ipca_group)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_tile</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray90"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1999</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2022</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_viridis_d</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">option =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"magma"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> labels) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-13">  theme_vini</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/repost-ipca-visualizacao/index_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Também podemos plotar a distribuição dos dados a cada ano. Note que a visualização abaixo não é nada convencional do ponto de vista estatístico.</p>
<p>Ainda assim, é interessante ver a dispersão enorme dos valores em 2002-3 e também como a inflação ficou relativamente bem-comportada nos anos seguintes até se tornar mais volátil e enviesada para a direita em 2016.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(ipca, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(year), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> value <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(year))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stat_halfeye</span>(</span>
<span id="cb11-3">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">justification =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,</span>
<span id="cb11-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.width =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, </span>
<span id="cb11-5">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">point_colour =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-6">  </span>
<span id="cb11-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_viridis_d</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">option =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"magma"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guides</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_flip</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_rect</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray80"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>),</span>
<span id="cb11-14">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid.minor =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>())</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/repost-ipca-visualizacao/index_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Por fim, uma visualização que eu acho muito interessante, mas que é ainda menos convencional é de espiral. Eu sinceramente não sei se é possível enxergar muita coisa de interessante desta forma e eu, infelizmente, não entendo o pacote <code>spiralize</code> o suficiente para entender de que forma é possível ajustar a escala das cores.</p>
<p>Fica uma visualização bacana, mas não acho que seja a mais apropriada.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1">ipca <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">na.omit</span>(ipca)</span>
<span id="cb12-2"></span>
<span id="cb12-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">spiral_initialize_by_time</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlim =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">range</span>(ipca<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ref.date),</span>
<span id="cb12-4">                          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">unit_on_axis =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"months"</span>,</span>
<span id="cb12-5">                          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">period =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"year"</span>,</span>
<span id="cb12-6">                          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">period_per_loop =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb12-7">                          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">padding =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cm"</span>))</span>
<span id="cb12-8">                          <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#vp_param = list(x = unit(0, "npc"), just = "left"))</span></span>
<span id="cb12-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">spiral_track</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">height =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>)</span>
<span id="cb12-10">lt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">spiral_horizon</span>(ipca<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ref.date, ipca<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>acum12m, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">use_bar =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb12-11"></span>
<span id="cb12-12">s <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">current_spiral</span>()</span>
<span id="cb12-13">d <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">360</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%%</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">360</span></span>
<span id="cb12-14">month_name <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.character</span>(lubridate<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">month</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">abbr =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">locale =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pt_BR"</span>))</span>
<span id="cb12-15"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span>(i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq_along</span>(d)) {</span>
<span id="cb12-16">  foo <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">polar_to_cartesian</span>(d[i]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">180</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>pi, (s<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>max_radius <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.05</span>)</span>
<span id="cb12-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grid.text</span>(month_name[i], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> foo[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> foo[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">default.unit =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"native"</span>,</span>
<span id="cb12-18">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rot =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(d[i] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> d[i] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">180</span>, d[i] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">90</span>, d[i] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">90</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gp =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gpar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fontsize =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>))</span>
<span id="cb12-19">}</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https:://www.restateinsight.com/posts/general-posts/repost-ipca-visualizacao/index_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>


</section>
</section>

 ]]></description>
  <category>data-visualization</category>
  <category>brasil</category>
  <category>economia</category>
  <category>tutorial-R</category>
  <guid>https:://www.restateinsight.com/posts/general-posts/repost-ipca-visualizacao/index.html</guid>
  <pubDate>Thu, 01 Dec 2022 03:00:00 GMT</pubDate>
  <media:content url="https:://www.restateinsight.com/static/visualizando-ipca.png" medium="image" type="image/png" height="99" width="144"/>
</item>
</channel>
</rss>
