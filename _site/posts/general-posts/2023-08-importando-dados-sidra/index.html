<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Vinicius Oike">
<meta name="dcterms.date" content="2023-08-10">
<meta name="description" content="Importando dados abertos do IBGE via API usando o sidrar no R.">

<title>Vinicius Oike - Importando dados do SIDRA</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

<script src="../../../site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="../../../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="../../../site_libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
<script src="../../../site_libs/pymjs-1.3.2/pym.v1.js"></script>
<script src="../../../site_libs/widgetframe-binding-0.3.1/widgetframe.js"></script>


<link rel="stylesheet" href="../../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">Vinicius Oike</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../blog.html" rel="" target="">
 <span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../my_apps.html" rel="" target="">
 <span class="menu-text">Apps</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../aboutme.html" rel="" target="">
 <span class="menu-text">Sobre</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/viniciusoike" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/viniciusoike" rel="" target=""><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../archive.html" rel="" target="">
 <span class="menu-text">Archive</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Importando dados do SIDRA</h1>
                  <div>
        <div class="description">
          Importando dados abertos do IBGE via API usando o sidrar no R.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">data-science</div>
                <div class="quarto-category">economia</div>
                <div class="quarto-category">tutorial-R</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Vinicius Oike </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">August 10, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#r" id="toc-r" class="nav-link active" data-scroll-target="#r">R</a></li>
  <li><a href="#importando-dados" id="toc-importando-dados" class="nav-link" data-scroll-target="#importando-dados">Importando dados</a>
  <ul class="collapse">
  <li><a href="#variando-os-parâmetros-de-busca" id="toc-variando-os-parâmetros-de-busca" class="nav-link" data-scroll-target="#variando-os-parâmetros-de-busca">Variando os parâmetros de busca</a></li>
  <li><a href="#importando-dados-de-vários-períodos" id="toc-importando-dados-de-vários-períodos" class="nav-link" data-scroll-target="#importando-dados-de-vários-períodos">Importando dados de vários períodos</a></li>
  <li><a href="#importando-muitos-dados" id="toc-importando-muitos-dados" class="nav-link" data-scroll-target="#importando-muitos-dados">Importando muitos dados</a></li>
  </ul></li>
  <li><a href="#refinando-a-busca-em-casos-complexos" id="toc-refinando-a-busca-em-casos-complexos" class="nav-link" data-scroll-target="#refinando-a-busca-em-casos-complexos">Refinando a busca em casos complexos</a>
  <ul class="collapse">
  <li><a href="#tabelas-do-censo" id="toc-tabelas-do-censo" class="nav-link" data-scroll-target="#tabelas-do-censo">Tabelas do Censo</a></li>
  <li><a href="#api-do-sidra" id="toc-api-do-sidra" class="nav-link" data-scroll-target="#api-do-sidra">API do SIDRA</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<p>O SIDRA, ou Sistema IBGE de Recuperação Automática, é um sistema automatizado de coleta de dados do IBGE, que disponbiliza tabelas das várias pesquisas feitas pelo IBGE. O sistema é centralizado no <a href="https://sidra.ibge.gov.br/home/pnadcm">site</a>. Encontrar pesquisas e dados pode não ser fácil e, em geral, exige conhecimento prévio sobre as pesquisas do IBGE. O site oferece uma página de <a href="https://sidra.ibge.gov.br/ajuda">ajuda</a>.</p>
<p>Neste post vou comentar mais especificamente sobre o pacote <code>sidrar</code> que dialoga diretamente com a API do SIDRA para importar tabelas diretamente para dentro do <code>R</code>. O pacote tem duas funções centrais:</p>
<ul>
<li><code>info_sidra()</code> - busca os metadados e informações de uma tabela.</li>
<li><code>get_sidra()</code> - importa uma tabela do SIDRA seguindo um conjunto de parâmetros.</li>
</ul>
<section id="r" class="level1">
<h1>R</h1>
<p>Primeiro, temos que instalar o pacote <code>sidrar</code> e chamá-lo usando a função <code>library()</code>. Além disso, para a primeira parte deste tutorial mostro também como utilizar os pacotes <code>dplyr</code>, <code>tidyr</code> e <code>janitor</code> para limpar os dados.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instale o pacote (caso necessário)</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"sidrar"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Outros pacotes usados neste tutorial</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="fu">c</span>(<span class="st">"janitor"</span>, <span class="st">"dplyr"</span>, <span class="st">"tidyr"</span>))</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"sidrar"</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"janitor"</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"dplyr"</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"tidyr"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="importando-dados" class="level1">
<h1>Importando dados</h1>
<p>Vamos começar olhando para a tabela de estimativas da população dos municípios. A tabela <a href="https://sidra.ibge.gov.br/tabela/6579">6579</a> reúne os dados da pesquisa “Estimativas da População”, uma contagem anual da população de todos os municípios do Brasil.</p>
<p>Primeiro vamos usar a função <code>info_sidra</code> para verificar o conteúdo desta tabela.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">info_sidra</span>(<span class="dv">6579</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$table
[1] "Tabela 6579: População residente estimada"

$period
[1] "2001, 2002, 2003, 2004, 2005, 2006, 2008, 2009, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021"

$variable
   cod                                   desc
1 9324 População residente estimada (Pessoas)

$classific_category
NULL

$geo
     cod                      desc
1 Brazil                Brasil (1)
2 Region         Grande Região (5)
3  State Unidade da Federação (27)
4   City         Município (5.570)</code></pre>
</div>
</div>
<p>A tabela, neste caso, é bastante simples. Os dados são anuais e estão disponíveis de 2001 a 2021. Há apenas uma variável: <code>População residente estimada (Pessoas)</code> com código <code>9324</code>. Por fim, os dados estão desagregados no nível nacional, regional, estadual e municipal.</p>
<p>Vamos importar a população de todos os municipios em 2021. Note que no código abaixo o argumento do ano é inserido como um <code>character</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>pop21 <span class="ot">&lt;-</span> <span class="fu">get_sidra</span>(<span class="dv">6579</span>, <span class="at">period =</span> <span class="st">"2021"</span>, <span class="at">geo =</span> <span class="st">"City"</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>pop21</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A tabela já vem formatada dentro do R.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>pop21 <span class="ot">&lt;-</span> <span class="fu">get_sidra</span>(<span class="dv">6579</span>, <span class="at">period =</span> <span class="st">"2021"</span>, <span class="at">geo =</span> <span class="st">"City"</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(pop21)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Nível Territorial (Código) Nível Territorial Unidade de Medida (Código)
2                          6         Município                         45
3                          6         Município                         45
4                          6         Município                         45
5                          6         Município                         45
6                          6         Município                         45
7                          6         Município                         45
  Unidade de Medida  Valor Município (Código)                  Município
2           Pessoas  22516            1100015 Alta Floresta D'Oeste - RO
3           Pessoas 111148            1100023             Ariquemes - RO
4           Pessoas   5067            1100031                Cabixi - RO
5           Pessoas  86416            1100049                Cacoal - RO
6           Pessoas  16088            1100056            Cerejeiras - RO
7           Pessoas  15213            1100064     Colorado do Oeste - RO
  Ano (Código)  Ano Variável (Código)                     Variável
2         2021 2021              9324 População residente estimada
3         2021 2021              9324 População residente estimada
4         2021 2021              9324 População residente estimada
5         2021 2021              9324 População residente estimada
6         2021 2021              9324 População residente estimada
7         2021 2021              9324 População residente estimada</code></pre>
</div>
</div>
<p>Ainda que os dados não estejam “sujos”, eles não estão num formato agradável para se trabalhar. Vamos fazer uma limpeza básica dos dados. Primeiro, vamos simplificar os nomes das colunas e selecionar apenas as colunas de maior interesse.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>pop21 <span class="ot">&lt;-</span> janitor<span class="sc">::</span><span class="fu">clean_names</span>(pop21)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>pop21 <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">select</span>(pop21, municipio_codigo, municipio, ano, valor)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="table-responsive">
<table class="table table-condensed table-hover table-striped table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: center;" data-quarto-table-cell-role="th">municipio_codigo</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">municipio</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">ano</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">valor</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2</td>
<td style="text-align: center;">1100015</td>
<td style="text-align: center;">Alta Floresta D'Oeste - RO</td>
<td style="text-align: center;">2021</td>
<td style="text-align: center;">22516</td>
</tr>
<tr class="even">
<td style="text-align: left;">3</td>
<td style="text-align: center;">1100023</td>
<td style="text-align: center;">Ariquemes - RO</td>
<td style="text-align: center;">2021</td>
<td style="text-align: center;">111148</td>
</tr>
<tr class="odd">
<td style="text-align: left;">4</td>
<td style="text-align: center;">1100031</td>
<td style="text-align: center;">Cabixi - RO</td>
<td style="text-align: center;">2021</td>
<td style="text-align: center;">5067</td>
</tr>
<tr class="even">
<td style="text-align: left;">5</td>
<td style="text-align: center;">1100049</td>
<td style="text-align: center;">Cacoal - RO</td>
<td style="text-align: center;">2021</td>
<td style="text-align: center;">86416</td>
</tr>
<tr class="odd">
<td style="text-align: left;">6</td>
<td style="text-align: center;">1100056</td>
<td style="text-align: center;">Cerejeiras - RO</td>
<td style="text-align: center;">2021</td>
<td style="text-align: center;">16088</td>
</tr>
<tr class="even">
<td style="text-align: left;">7</td>
<td style="text-align: center;">1100064</td>
<td style="text-align: center;">Colorado do Oeste - RO</td>
<td style="text-align: center;">2021</td>
<td style="text-align: center;">15213</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<p>Note que o nome dos municípios contém também a abreviação do estado ao qual o município pertence. Podemos deixar isto mais claro separando esta informação em duas colunas distintas.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>pop21 <span class="ot">&lt;-</span> tidyr<span class="sc">::</span><span class="fu">separate</span>(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  pop21,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">col =</span> <span class="st">"municipio"</span>,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"nome_muni"</span>, <span class="st">"abr_estado"</span>),</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">sep =</span> <span class="st">" - "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="table-responsive">
<table class="table table-condensed table-hover table-striped table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: center;" data-quarto-table-cell-role="th">municipio_codigo</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">nome_muni</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">abr_estado</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">ano</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">valor</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2</td>
<td style="text-align: center;">1100015</td>
<td style="text-align: center;">Alta Floresta D'Oeste</td>
<td style="text-align: center;">RO</td>
<td style="text-align: center;">2021</td>
<td style="text-align: center;">22516</td>
</tr>
<tr class="even">
<td style="text-align: left;">3</td>
<td style="text-align: center;">1100023</td>
<td style="text-align: center;">Ariquemes</td>
<td style="text-align: center;">RO</td>
<td style="text-align: center;">2021</td>
<td style="text-align: center;">111148</td>
</tr>
<tr class="odd">
<td style="text-align: left;">4</td>
<td style="text-align: center;">1100031</td>
<td style="text-align: center;">Cabixi</td>
<td style="text-align: center;">RO</td>
<td style="text-align: center;">2021</td>
<td style="text-align: center;">5067</td>
</tr>
<tr class="even">
<td style="text-align: left;">5</td>
<td style="text-align: center;">1100049</td>
<td style="text-align: center;">Cacoal</td>
<td style="text-align: center;">RO</td>
<td style="text-align: center;">2021</td>
<td style="text-align: center;">86416</td>
</tr>
<tr class="odd">
<td style="text-align: left;">6</td>
<td style="text-align: center;">1100056</td>
<td style="text-align: center;">Cerejeiras</td>
<td style="text-align: center;">RO</td>
<td style="text-align: center;">2021</td>
<td style="text-align: center;">16088</td>
</tr>
<tr class="even">
<td style="text-align: left;">7</td>
<td style="text-align: center;">1100064</td>
<td style="text-align: center;">Colorado do Oeste</td>
<td style="text-align: center;">RO</td>
<td style="text-align: center;">2021</td>
<td style="text-align: center;">15213</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<p>Por fim, podemos padronizar melhor o nome das colunas. Vamos utilizar as convenções do pacote <code>geobr</code>, por exemplo, e traduzir as variáveis para o inglês.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>pop21 <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  pop21,</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">name_muni =</span> nome_muni,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">abbrev_state =</span> abr_estado,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">code_muni =</span> municipio_codigo,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">year =</span> ano,</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">population =</span> valor)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A tabela final aparece abaixo.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="table-responsive">
<table class="table table-condensed table-hover table-striped table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: center;" data-quarto-table-cell-role="th">code_muni</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">name_muni</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">abbrev_state</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">year</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">population</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2</td>
<td style="text-align: center;">1100015</td>
<td style="text-align: center;">Alta Floresta D'Oeste</td>
<td style="text-align: center;">RO</td>
<td style="text-align: center;">2021</td>
<td style="text-align: center;">22516</td>
</tr>
<tr class="even">
<td style="text-align: left;">3</td>
<td style="text-align: center;">1100023</td>
<td style="text-align: center;">Ariquemes</td>
<td style="text-align: center;">RO</td>
<td style="text-align: center;">2021</td>
<td style="text-align: center;">111148</td>
</tr>
<tr class="odd">
<td style="text-align: left;">4</td>
<td style="text-align: center;">1100031</td>
<td style="text-align: center;">Cabixi</td>
<td style="text-align: center;">RO</td>
<td style="text-align: center;">2021</td>
<td style="text-align: center;">5067</td>
</tr>
<tr class="even">
<td style="text-align: left;">5</td>
<td style="text-align: center;">1100049</td>
<td style="text-align: center;">Cacoal</td>
<td style="text-align: center;">RO</td>
<td style="text-align: center;">2021</td>
<td style="text-align: center;">86416</td>
</tr>
<tr class="odd">
<td style="text-align: left;">6</td>
<td style="text-align: center;">1100056</td>
<td style="text-align: center;">Cerejeiras</td>
<td style="text-align: center;">RO</td>
<td style="text-align: center;">2021</td>
<td style="text-align: center;">16088</td>
</tr>
<tr class="even">
<td style="text-align: left;">7</td>
<td style="text-align: center;">1100064</td>
<td style="text-align: center;">Colorado do Oeste</td>
<td style="text-align: center;">RO</td>
<td style="text-align: center;">2021</td>
<td style="text-align: center;">15213</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<p>A padronização dos nomes traz como vantagem facilitar o <code>join</code> com o shapefile dos municípios usando o pacote <code>geobr</code>.</p>
<section id="variando-os-parâmetros-de-busca" class="level2">
<h2 class="anchored" data-anchor-id="variando-os-parâmetros-de-busca">Variando os parâmetros de busca</h2>
<p>A função <code>get_sidra()</code> permite refinar a query que gera a tabela final que é importada dentro do <code>R</code>. Os principais argumentos são:</p>
<ul>
<li><code>period</code> - escolhe a janela temporal dos dados.</li>
<li><code>variable</code> - escolhe a variável a ser importada.</li>
<li><code>geo</code> - nível geográfico dos dados (e.g.&nbsp;<code>"Brazil"</code>, <code>"City"</code>, <code>"Neighborhood"</code>, etc.).</li>
<li><code>geo.filter</code> - lista com filtros geográficos.</li>
<li><code>classific</code> - classificação dos dados.</li>
<li><code>category</code> - escolhe quais categorias (do <code>classific</code>) importar.</li>
</ul>
<p>De maneira geral, todos os parâmetros acima tem algumas nuances. Vamos explorá-los caso a caso</p>
</section>
<section id="importando-dados-de-vários-períodos" class="level2">
<h2 class="anchored" data-anchor-id="importando-dados-de-vários-períodos">Importando dados de vários períodos</h2>
<p>Para selecionar múltiplos períodos podemos montar um vetor <code>character</code> com os períodos desejados. Para selecionar uma sequência de períodos deve-se montar um string único encadeando os períodos com o sinal de “-”. O código abaixo deve deixar isto mais claro.</p>
<p>Note que se você rodar o código abaixo, provavelmente, vai enfrentar um problema de limite de query. A API do SIDRA restringe o número de linhas que um usuário pode chamar de uma só vez. Assim, para importar bases de dados maiores é preciso montar estratégias para particionar os dados.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Importa os dados de 2010 e de 2020</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>pop <span class="ot">&lt;-</span> <span class="fu">get_sidra</span>(<span class="dv">6579</span>, <span class="at">period =</span> <span class="fu">c</span>(<span class="st">"2010"</span>, <span class="st">"2020"</span>), <span class="at">geo =</span> <span class="st">"City"</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Importa todos os dados de 2010 até 2020 (erro: limite de requisição)</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>pop <span class="ot">&lt;-</span> <span class="fu">get_sidra</span>(<span class="dv">6579</span>, <span class="at">period =</span> <span class="fu">c</span>(<span class="st">"2010-2020"</span>), <span class="at">geo =</span> <span class="st">"City"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Um detalhe curioso é que a função não retorna erros quando o período extrapola os valores disponíveis nos dados. Assim a função abaixo retorna apenas os valores de 2021.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Importa todos os dados de 2021 até 2030</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>pop <span class="ot">&lt;-</span> <span class="fu">get_sidra</span>(<span class="dv">6579</span>, <span class="at">period =</span> <span class="fu">c</span>(<span class="st">"2021-2030"</span>), <span class="at">geo =</span> <span class="st">"City"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A mesma lógica acima vale para quando os dados são mensais ou trimestrais. Considere o exemplo da taxa de desocupação, levantada pela PNADC Trimestral. Note que os períodos estão no formato <code>YYYYQQ</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">info_sidra</span>(<span class="dv">4099</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Vamos importar todos as observações da taxa de desocupação em 2012. Note que agora há múltiplas variáveis na mesma tabela e que o resultado já está em formato “long”.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>unemp <span class="ot">&lt;-</span> <span class="fu">get_sidra</span>(<span class="dv">4099</span>, <span class="at">period =</span> <span class="st">"201201-201204"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(unemp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Nível Territorial (Código) Nível Territorial Unidade de Medida (Código)
2                          1            Brasil                          2
3                          1            Brasil                          2
4                          1            Brasil                          2
5                          1            Brasil                          2
6                          1            Brasil                          2
7                          1            Brasil                          2
  Unidade de Medida Valor Brasil (Código) Brasil Trimestre (Código)
2                 %   8.0               1 Brasil             201201
3                 %   0.9               1 Brasil             201201
4                 %  15.3               1 Brasil             201201
5                 %   0.7               1 Brasil             201201
6                 %  14.0               1 Brasil             201201
7                 %   0.7               1 Brasil             201201
          Trimestre Variável (Código)
2 1º trimestre 2012              4099
3 1º trimestre 2012              4103
4 1º trimestre 2012              4114
5 1º trimestre 2012              4115
6 1º trimestre 2012              4116
7 1º trimestre 2012              4117
                                                                                                                                                                           Variável
2                                                                                             Taxa de desocupação, na semana de referência, das pessoas de 14 anos ou mais de idade
3                                                                   Coeficiente de variação - Taxa de desocupação, na semana de referência, das pessoas de 14 anos ou mais de idade
4                           Taxa combinada de desocupação e de subocupação por insuficiência de horas trabalhadas, na semana de referência, das pessoas de 14 anos ou mais de idade
5 Coeficiente de variação - Taxa combinada de desocupação e de subocupação por insuficiência de horas trabalhadas, na semana de referência, das pessoas de 14 anos ou mais de idade
6                                                     Taxa combinada de desocupação e força de trabalho potencial, na semana de referência, das pessoas de 14 anos ou mais de idade
7                           Coeficiente de variação - Taxa combinada de desocupação e força de trabalho potencial, na semana de referência, das pessoas de 14 anos ou mais de idade</code></pre>
</div>
</div>
<p>Para refinar a busca acima temos de usar o argumento <code>variable</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>unemp <span class="ot">&lt;-</span> <span class="fu">get_sidra</span>(<span class="dv">4099</span>, <span class="at">period =</span> <span class="st">"201201-202203"</span>, <span class="at">variable =</span> <span class="dv">4099</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(unemp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Nível Territorial (Código) Nível Territorial Unidade de Medida (Código)
2                          1            Brasil                          2
3                          1            Brasil                          2
4                          1            Brasil                          2
5                          1            Brasil                          2
6                          1            Brasil                          2
7                          1            Brasil                          2
  Unidade de Medida Valor Brasil (Código) Brasil Trimestre (Código)
2                 %   8.0               1 Brasil             201201
3                 %   7.6               1 Brasil             201202
4                 %   7.1               1 Brasil             201203
5                 %   6.9               1 Brasil             201204
6                 %   8.1               1 Brasil             201301
7                 %   7.5               1 Brasil             201302
          Trimestre Variável (Código)
2 1º trimestre 2012              4099
3 2º trimestre 2012              4099
4 3º trimestre 2012              4099
5 4º trimestre 2012              4099
6 1º trimestre 2013              4099
7 2º trimestre 2013              4099
                                                                               Variável
2 Taxa de desocupação, na semana de referência, das pessoas de 14 anos ou mais de idade
3 Taxa de desocupação, na semana de referência, das pessoas de 14 anos ou mais de idade
4 Taxa de desocupação, na semana de referência, das pessoas de 14 anos ou mais de idade
5 Taxa de desocupação, na semana de referência, das pessoas de 14 anos ou mais de idade
6 Taxa de desocupação, na semana de referência, das pessoas de 14 anos ou mais de idade
7 Taxa de desocupação, na semana de referência, das pessoas de 14 anos ou mais de idade</code></pre>
</div>
</div>
<p>Agora temos a série completa apenas da taxa de desocupação no Brasil. Podemos buscar também a taxa em cada uma das cidades do Brasil.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>unemp <span class="ot">&lt;-</span> <span class="fu">get_sidra</span>(</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="dv">4099</span>,</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">period =</span> <span class="st">"201201-202203"</span>,</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">variable =</span> <span class="dv">4099</span>,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">geo =</span> <span class="st">"City"</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code>  Nível Territorial (Código) Nível Territorial Unidade de Medida (Código)
1                          6         Município                          2
2                          6         Município                          2
3                          6         Município                          2
4                          6         Município                          2
5                          6         Município                          2
6                          6         Município                          2
  Unidade de Medida Valor Município (Código)        Município
1                 %   9.0            1100205 Porto Velho - RO
2                 %  10.4            1200401  Rio Branco - AC
3                 %  12.9            1302603      Manaus - AM
4                 %   9.3            1400100   Boa Vista - RR
5                 %  10.5            1501402       Belém - PA
6                 %  12.6            1600303      Macapá - AP
  Trimestre (Código)         Trimestre Variável (Código)
1             201201 1º trimestre 2012              4099
2             201201 1º trimestre 2012              4099
3             201201 1º trimestre 2012              4099
4             201201 1º trimestre 2012              4099
5             201201 1º trimestre 2012              4099
6             201201 1º trimestre 2012              4099
                                                                               Variável
1 Taxa de desocupação, na semana de referência, das pessoas de 14 anos ou mais de idade
2 Taxa de desocupação, na semana de referência, das pessoas de 14 anos ou mais de idade
3 Taxa de desocupação, na semana de referência, das pessoas de 14 anos ou mais de idade
4 Taxa de desocupação, na semana de referência, das pessoas de 14 anos ou mais de idade
5 Taxa de desocupação, na semana de referência, das pessoas de 14 anos ou mais de idade
6 Taxa de desocupação, na semana de referência, das pessoas de 14 anos ou mais de idade</code></pre>
</div>
</div>
<p>Note, contudo, que temos o resultado somente nas capitais. Apesar do argumento “City” ser o mesmo que usamos na pesquisa de Estimativas da População, aqui o argumento “City” retorna apenas as capitais. Isto acontece porque a PNADC é uma pesquisa que é feita apenas nas capitais brasileiras e não tem uma desagregação a nível municipal para todos os municípios do Brasil. Este importante detalhe não fica evidente e depende do conhecimento prévio do usuário a respeito das pesquisas do IBGE.</p>
</section>
<section id="importando-muitos-dados" class="level2">
<h2 class="anchored" data-anchor-id="importando-muitos-dados">Importando muitos dados</h2>
<p>Como comentei acima, a API do SIDRA tem um limite de linhas nas queries. Isto significa que é preciso montar algumas estratégias para pegar as tabelas em partes menores. Na prática, isto vai depender muito da tabela e da informação que se quer.</p>
<p>O exemplo abaixo é bastante simples mas pode eventualmente ser útil em alguma outra aplicação. O código importa a tabela de estimativas populacionais ano a ano. O mesmo poderia ter sido feito num for-loop, mas prefiro usar o <code>lapply</code> por simplicidade.</p>
<p>Para acelerar o processo pode-se trocar o <code>lapply</code> por <code>parallel::mclapply</code> que roda a função em paralelo. Contudo, na minha experiência, esta estratégia acaba resultando em erros imprevistos. Não sei se isto é resultado de alguma restrição da API. Na prática, é mais seguro evitar o <code>mclapply</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define um vetor com todos os anos da pesquisa</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>periods <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">2001</span><span class="sc">:</span><span class="dv">2021</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Converte para character</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>periods <span class="ot">&lt;-</span> <span class="fu">as.character</span>(periods)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Aplica a função get_sidra a cada elemento de periods (a cada ano)</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>req <span class="ot">&lt;-</span> <span class="fu">lapply</span>(periods, <span class="cf">function</span>(p) <span class="fu">get_sidra</span>(<span class="dv">6579</span>, <span class="at">period =</span> p, <span class="at">geo =</span> <span class="st">"City"</span>))</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Junta o resultado numa única tabela</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(req)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="refinando-a-busca-em-casos-complexos" class="level1">
<h1>Refinando a busca em casos complexos</h1>
<section id="tabelas-do-censo" class="level2">
<h2 class="anchored" data-anchor-id="tabelas-do-censo">Tabelas do Censo</h2>
<p>Tabelas que vem do Censo costumam ter maior complexidade. Considere, por exemplo, a tabela 1378, que retorna a população residente, por situação do domicílio (urbano x rural), sexo e idade, segundo a condição no domicílio e compartilhamento da responsabilidade (responsável, cônjuge, filho, etc.)</p>
<p>O resultado da função abaixo é omitido para poupar espaço pois a saída é muito grande. Em casos como este é muito importante filtrar o resultado para conseguir uma tabela que faça sentido.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">info_sidra</span>(<span class="dv">1378</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Vamos nos focar somente na população residente (var 93) de pessoas responsáveis do domicílio (cod 11941) por bairro de Porto Alegre (4314902).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>resp <span class="ot">&lt;-</span> <span class="fu">get_sidra</span>(</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1378</span>,</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">variable =</span> <span class="dv">93</span>,</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">classific =</span> <span class="fu">c</span>(<span class="st">"c455"</span>),</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">geo =</span> <span class="st">"Neighborhood"</span>,</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">geo.filter =</span> <span class="fu">list</span>(<span class="st">"City"</span> <span class="ot">=</span> <span class="dv">4314902</span>)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Após um pouco de limpeza no nome das colunas podemos ver o resultado abaixo.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="table-responsive">
<table class="table table-condensed table-hover table-striped table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: center;" data-quarto-table-cell-role="th">bairro</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">cond_domi</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">sexo</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">idade</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">situacao_domi</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">valor</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2</td>
<td style="text-align: center;">Medianeira</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">11568</td>
</tr>
<tr class="even">
<td style="text-align: left;">3</td>
<td style="text-align: center;">Medianeira</td>
<td style="text-align: center;">Pessoa responsável</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">4206</td>
</tr>
<tr class="odd">
<td style="text-align: left;">4</td>
<td style="text-align: center;">Medianeira</td>
<td style="text-align: center;">Pessoa responsável - com responsabilidade compartilhada</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">1054</td>
</tr>
<tr class="even">
<td style="text-align: left;">5</td>
<td style="text-align: center;">Medianeira</td>
<td style="text-align: center;">Pessoa responsável - sem responsabilidade compartilhada</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">3152</td>
</tr>
<tr class="odd">
<td style="text-align: left;">6</td>
<td style="text-align: center;">Medianeira</td>
<td style="text-align: center;">Cônjuge ou companheiro(a)</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">2101</td>
</tr>
<tr class="even">
<td style="text-align: left;">7</td>
<td style="text-align: center;">Medianeira</td>
<td style="text-align: center;">Cônjuge ou companheiro(a) - de sexo diferente</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">2094</td>
</tr>
<tr class="odd">
<td style="text-align: left;">8</td>
<td style="text-align: center;">Medianeira</td>
<td style="text-align: center;">Cônjuge ou companheiro(a) - de mesmo sexo</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">7</td>
</tr>
<tr class="even">
<td style="text-align: left;">9</td>
<td style="text-align: center;">Medianeira</td>
<td style="text-align: center;">Filho(a)</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">3429</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10</td>
<td style="text-align: center;">Medianeira</td>
<td style="text-align: center;">Filho(a) - da pessoa responsável e do cônjuge</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">1916</td>
</tr>
<tr class="even">
<td style="text-align: left;">11</td>
<td style="text-align: center;">Medianeira</td>
<td style="text-align: center;">Filho(a) - somente da pessoa responsável</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">1513</td>
</tr>
<tr class="odd">
<td style="text-align: left;">12</td>
<td style="text-align: center;">Medianeira</td>
<td style="text-align: center;">Enteado(a)</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">145</td>
</tr>
<tr class="even">
<td style="text-align: left;">13</td>
<td style="text-align: center;">Medianeira</td>
<td style="text-align: center;">Genro ou nora</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">170</td>
</tr>
<tr class="odd">
<td style="text-align: left;">14</td>
<td style="text-align: center;">Medianeira</td>
<td style="text-align: center;">Pai, mãe, padastro ou madrasta</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">183</td>
</tr>
<tr class="even">
<td style="text-align: left;">15</td>
<td style="text-align: center;">Medianeira</td>
<td style="text-align: center;">Sogro(a)</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">51</td>
</tr>
<tr class="odd">
<td style="text-align: left;">16</td>
<td style="text-align: center;">Medianeira</td>
<td style="text-align: center;">Neto(a)</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">549</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<p>Note que temos a coluna da condição do domicílio desagregada (c455), mas todas as outras (sexo, idade, etc.) estão agregadas.</p>
</section>
<section id="api-do-sidra" class="level2">
<h2 class="anchored" data-anchor-id="api-do-sidra">API do SIDRA</h2>
<p>Então imagine, por exemplo, que queremos esta mesma informação, por grupos de idade. Esta requisição quebra o limite da query. Além disso, os grupos de idade disponíveis são caóticos e não é possível filtrar dentro deste grupo da mesma maneira como fazemos com o argumento <code>variable</code>.</p>
<p>A solução é interagir diretamente com a API do SIDRA! O código acaba sendo bastante complexo/confuso. Muito provavelmente há maneiras de melhorar o código abaixo, mas foi como fiz para conseguir esta informação. Por conveniência chamo explicitamente todos os pacotes que uso. A limpeza dos dados foi a parte mais desafiadora do processo visto que não foi possível transformar o input de JSON para um <code>data.frame</code> de maneira direta.</p>
<p>Em partes, acho que dei o azar de ter escolhido uma tabela especialmente complicada. Se <code>jsonlite::fromJSON(x, simplifyDataFrame = TRUE)</code> tivesse funcionado, o código seria muito mais simples.</p>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Bibliotecas usadas</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyjson)</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jsonlite)</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(geobr)</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Montar a query</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Montar um vetor com o código de todos os bairros de Porto Alegre</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Importa o shapefile de todos os bairros IBGE (2010)</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>bairros <span class="ot">&lt;-</span> geobr<span class="sc">::</span><span class="fu">read_neighborhood</span>()</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>bairros_poa <span class="ot">&lt;-</span> bairros <span class="sc">|&gt;</span> </span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Pega apenas os códigos dos bairros de POA</span></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(code_muni <span class="sc">==</span> <span class="dv">4314902</span>) <span class="sc">|&gt;</span> </span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># O código do bairro tem alguns números sobrando no meio</span></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">code_nb =</span> <span class="fu">paste0</span>(</span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_sub</span>(code_neighborhood, <span class="dv">1</span>, <span class="dv">7</span>),</span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_sub</span>(code_neighborhood, <span class="dv">10</span>, <span class="dv">12</span>))</span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Extrai o vetor com os códgios dos bairros</span></span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>codenb_poa <span class="ot">&lt;-</span> bairros_poa[[<span class="st">"code_nb"</span>]]</span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Colapsa o vetor num único string separado por vírgulas</span></span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>local <span class="ot">=</span> <span class="fu">paste</span>(codenb_poa, <span class="at">collapse =</span> <span class="st">","</span>)</span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Insere o string no formato da API</span></span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>local <span class="ot">=</span> stringr<span class="sc">::</span><span class="fu">str_glue</span>(<span class="st">"localidades=N102[{local}]"</span>)</span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Base do url da API</span></span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a>base <span class="ot">=</span> <span class="st">"https://servicodados.ibge.gov.br/api/v3/agregados"</span></span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Número da tabela</span></span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a>table <span class="ot">&lt;-</span> <span class="dv">1378</span></span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Período da extração (ano)</span></span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a>period <span class="ot">&lt;-</span> <span class="dv">2010</span></span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Código da variável (Pessoas residentes)</span></span>
<span id="cb24-40"><a href="#cb24-40" aria-hidden="true" tabindex="-1"></a>variable <span class="ot">&lt;-</span> <span class="dv">93</span></span>
<span id="cb24-41"><a href="#cb24-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Códigos das classes</span></span>
<span id="cb24-42"><a href="#cb24-42" aria-hidden="true" tabindex="-1"></a>class <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">287</span>, <span class="dv">455</span>)</span>
<span id="cb24-43"><a href="#cb24-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtro das classes (veja info_sidra(1378))</span></span>
<span id="cb24-44"><a href="#cb24-44" aria-hidden="true" tabindex="-1"></a>category <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="dv">1</span>), <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">5</span>), <span class="fu">c</span>(<span class="dv">93087</span><span class="sc">:</span><span class="dv">93100</span>), <span class="fu">c</span>(<span class="dv">11941</span>))</span>
<span id="cb24-45"><a href="#cb24-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Colapsa os strings</span></span>
<span id="cb24-46"><a href="#cb24-46" aria-hidden="true" tabindex="-1"></a>category <span class="ot">&lt;-</span> <span class="fu">sapply</span>(category, paste, <span class="at">collapse =</span> <span class="st">","</span>)</span>
<span id="cb24-47"><a href="#cb24-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Coloca os strings no format da API</span></span>
<span id="cb24-48"><a href="#cb24-48" aria-hidden="true" tabindex="-1"></a>cat_filter <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_glue</span>(<span class="st">"{class}[{category}]"</span>)</span>
<span id="cb24-49"><a href="#cb24-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Colapsa os strings num único string separado pelo operador booleano |</span></span>
<span id="cb24-50"><a href="#cb24-50" aria-hidden="true" tabindex="-1"></a>cat_filter <span class="ot">&lt;-</span> <span class="fu">paste</span>(cat_filter, <span class="at">collapse =</span> <span class="st">"|"</span>)</span>
<span id="cb24-51"><a href="#cb24-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-52"><a href="#cb24-52" aria-hidden="true" tabindex="-1"></a><span class="co"># Monta a query</span></span>
<span id="cb24-53"><a href="#cb24-53" aria-hidden="true" tabindex="-1"></a>query <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_glue</span>(</span>
<span id="cb24-54"><a href="#cb24-54" aria-hidden="true" tabindex="-1"></a>  <span class="st">"{base}/{table}/periodos/{period}/variaveis/{variable}?{local}&amp;classificacao={cat_filter}"</span></span>
<span id="cb24-55"><a href="#cb24-55" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-56"><a href="#cb24-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-57"><a href="#cb24-57" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Importar dados</span></span>
<span id="cb24-58"><a href="#cb24-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-59"><a href="#cb24-59" aria-hidden="true" tabindex="-1"></a><span class="co"># Importar os dados da API</span></span>
<span id="cb24-60"><a href="#cb24-60" aria-hidden="true" tabindex="-1"></a>req <span class="ot">&lt;-</span> httr<span class="sc">::</span><span class="fu">GET</span>(<span class="at">url =</span> query)</span>
<span id="cb24-61"><a href="#cb24-61" aria-hidden="true" tabindex="-1"></a>json <span class="ot">&lt;-</span> httr<span class="sc">::</span><span class="fu">content</span>(req, <span class="at">as =</span> <span class="st">"text"</span>, <span class="at">encoding =</span> <span class="st">"UTF-8"</span>)</span>
<span id="cb24-62"><a href="#cb24-62" aria-hidden="true" tabindex="-1"></a>json <span class="ot">&lt;-</span> jsonlite<span class="sc">::</span><span class="fu">fromJSON</span>(json, <span class="at">simplifyVector =</span> <span class="cn">FALSE</span>)</span>
<span id="cb24-63"><a href="#cb24-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-64"><a href="#cb24-64" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Limpar os dados</span></span>
<span id="cb24-65"><a href="#cb24-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-66"><a href="#cb24-66" aria-hidden="true" tabindex="-1"></a><span class="co"># Simplificar os dados de JSON para um tibble</span></span>
<span id="cb24-67"><a href="#cb24-67" aria-hidden="true" tabindex="-1"></a>valores <span class="ot">&lt;-</span> json <span class="sc">|&gt;</span> </span>
<span id="cb24-68"><a href="#cb24-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread_all</span>() <span class="sc">|&gt;</span> </span>
<span id="cb24-69"><a href="#cb24-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">enter_object</span>(resultados) <span class="sc">|&gt;</span> </span>
<span id="cb24-70"><a href="#cb24-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather_array</span>() <span class="sc">|&gt;</span> </span>
<span id="cb24-71"><a href="#cb24-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread_all</span>() <span class="sc">|&gt;</span> </span>
<span id="cb24-72"><a href="#cb24-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">enter_object</span>(series) <span class="sc">|&gt;</span> </span>
<span id="cb24-73"><a href="#cb24-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather_array</span>() <span class="sc">|&gt;</span> </span>
<span id="cb24-74"><a href="#cb24-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread_all</span>()</span>
<span id="cb24-75"><a href="#cb24-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-76"><a href="#cb24-76" aria-hidden="true" tabindex="-1"></a><span class="co"># Extrair somente os valores da série</span></span>
<span id="cb24-77"><a href="#cb24-77" aria-hidden="true" tabindex="-1"></a>valores <span class="ot">&lt;-</span> valores <span class="sc">|&gt;</span> </span>
<span id="cb24-78"><a href="#cb24-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">|&gt;</span> </span>
<span id="cb24-79"><a href="#cb24-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">serie.2010 =</span> <span class="fu">as.numeric</span>(serie<span class="fl">.2010</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb24-80"><a href="#cb24-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb24-81"><a href="#cb24-81" aria-hidden="true" tabindex="-1"></a>    <span class="at">id_cols =</span> <span class="st">"array.index"</span>,</span>
<span id="cb24-82"><a href="#cb24-82" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> <span class="st">"localidade.id"</span>,</span>
<span id="cb24-83"><a href="#cb24-83" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> <span class="st">"serie.2010"</span></span>
<span id="cb24-84"><a href="#cb24-84" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb24-85"><a href="#cb24-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-86"><a href="#cb24-86" aria-hidden="true" tabindex="-1"></a><span class="co"># Extrair a classificação das variáveis (sexo, idade)</span></span>
<span id="cb24-87"><a href="#cb24-87" aria-hidden="true" tabindex="-1"></a>classificacao <span class="ot">&lt;-</span> json <span class="sc">|&gt;</span> </span>
<span id="cb24-88"><a href="#cb24-88" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread_all</span>() <span class="sc">|&gt;</span> </span>
<span id="cb24-89"><a href="#cb24-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">enter_object</span>(resultados) <span class="sc">|&gt;</span> </span>
<span id="cb24-90"><a href="#cb24-90" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather_array</span>() <span class="sc">|&gt;</span> </span>
<span id="cb24-91"><a href="#cb24-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread_all</span>() <span class="sc">|&gt;</span> </span>
<span id="cb24-92"><a href="#cb24-92" aria-hidden="true" tabindex="-1"></a>  <span class="fu">enter_object</span>(classificacoes) <span class="sc">|&gt;</span> </span>
<span id="cb24-93"><a href="#cb24-93" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather_array</span>() <span class="sc">|&gt;</span> </span>
<span id="cb24-94"><a href="#cb24-94" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread_all</span>()</span>
<span id="cb24-95"><a href="#cb24-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-96"><a href="#cb24-96" aria-hidden="true" tabindex="-1"></a><span class="co"># Extrai somente a coluna com os grupos de idade</span></span>
<span id="cb24-97"><a href="#cb24-97" aria-hidden="true" tabindex="-1"></a>tblage <span class="ot">&lt;-</span> classificacao <span class="sc">|&gt;</span> </span>
<span id="cb24-98"><a href="#cb24-98" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">contains</span>(<span class="st">"93"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb24-99"><a href="#cb24-99" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">|&gt;</span> </span>
<span id="cb24-100"><a href="#cb24-100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(<span class="st">"age_group"</span>, <span class="fu">everything</span>(), <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb24-101"><a href="#cb24-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(age_group <span class="sc">!=</span> <span class="st">""</span>) <span class="sc">|&gt;</span> </span>
<span id="cb24-102"><a href="#cb24-102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb24-103"><a href="#cb24-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-104"><a href="#cb24-104" aria-hidden="true" tabindex="-1"></a><span class="co"># Cria um grid com todas as classificações na ordem correta</span></span>
<span id="cb24-105"><a href="#cb24-105" aria-hidden="true" tabindex="-1"></a>tblclass <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(</span>
<span id="cb24-106"><a href="#cb24-106" aria-hidden="true" tabindex="-1"></a>  <span class="at">situacao_domicilio =</span> <span class="st">"urban"</span>,</span>
<span id="cb24-107"><a href="#cb24-107" aria-hidden="true" tabindex="-1"></a>  <span class="at">resp =</span> <span class="st">"Responsável pelo Domicilio"</span>,</span>
<span id="cb24-108"><a href="#cb24-108" aria-hidden="true" tabindex="-1"></a>  <span class="at">sex =</span> <span class="fu">c</span>(<span class="st">"male"</span>, <span class="st">"female"</span>),</span>
<span id="cb24-109"><a href="#cb24-109" aria-hidden="true" tabindex="-1"></a>  <span class="at">age_group =</span> tblage<span class="sc">$</span>age_group</span>
<span id="cb24-110"><a href="#cb24-110" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-111"><a href="#cb24-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-112"><a href="#cb24-112" aria-hidden="true" tabindex="-1"></a><span class="co"># Junta as classificações com os valores </span></span>
<span id="cb24-113"><a href="#cb24-113" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">cbind</span>(valores, tblclass)</span>
<span id="cb24-114"><a href="#cb24-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-115"><a href="#cb24-115" aria-hidden="true" tabindex="-1"></a><span class="co"># Converte os dados para wide</span></span>
<span id="cb24-116"><a href="#cb24-116" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> tab <span class="sc">|&gt;</span> </span>
<span id="cb24-117"><a href="#cb24-117" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">starts_with</span>(<span class="st">"431"</span>), <span class="at">names_to =</span> <span class="st">"code_nb"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb24-118"><a href="#cb24-118" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(code_nb, situacao_domicilio, resp, sex, age_group, value)</span>
<span id="cb24-119"><a href="#cb24-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-120"><a href="#cb24-120" aria-hidden="true" tabindex="-1"></a><span class="co"># Converte os dados para uma tabela final</span></span>
<span id="cb24-121"><a href="#cb24-121" aria-hidden="true" tabindex="-1"></a>respnb <span class="ot">&lt;-</span> tab <span class="sc">|&gt;</span> </span>
<span id="cb24-122"><a href="#cb24-122" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb24-123"><a href="#cb24-123" aria-hidden="true" tabindex="-1"></a>    <span class="at">id_cols =</span> <span class="fu">c</span>(<span class="st">"code_nb"</span>, <span class="st">"age_group"</span>),</span>
<span id="cb24-124"><a href="#cb24-124" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> <span class="st">"sex"</span>,</span>
<span id="cb24-125"><a href="#cb24-125" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> <span class="st">"value"</span></span>
<span id="cb24-126"><a href="#cb24-126" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb24-127"><a href="#cb24-127" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">total =</span> male <span class="sc">+</span> female)<span class="sc">|&gt;</span> </span>
<span id="cb24-128"><a href="#cb24-128" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(code_nb) <span class="sc">|&gt;</span> </span>
<span id="cb24-129"><a href="#cb24-129" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">total_nb =</span> <span class="fu">sum</span>(total)) <span class="sc">|&gt;</span> </span>
<span id="cb24-130"><a href="#cb24-130" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb24-131"><a href="#cb24-131" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">share_nb =</span> total <span class="sc">/</span> total_nb <span class="sc">*</span> <span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>A tabela abaixo mostra o resultado final do código. A tabela apresenta o número total de pessoas responsáveis por domicílios em grupos de idade quinquenais por sexo e por bairro de Porto Alegre. Além disso, a coluna <code>total_nb</code> traz o número total de pessoas responsáveis por domicílio no bairro e <code>share_nb</code> computa a participação relativa de cada faixa de idade no total do bairro.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="table-responsive">
<table class="table table-condensed table-hover table-striped table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: center;" data-quarto-table-cell-role="th">code_nb</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">age_group</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">male</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">female</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">total</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">total_nb</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">share_nb</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">4314902003</td>
<td style="text-align: center;">20 a 24 anos</td>
<td style="text-align: center;">383</td>
<td style="text-align: center;">406</td>
<td style="text-align: center;">789</td>
<td style="text-align: center;">8757</td>
<td style="text-align: center;">9</td>
</tr>
<tr class="even">
<td style="text-align: center;">4314902005</td>
<td style="text-align: center;">20 a 24 anos</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">7</td>
<td style="text-align: center;">10</td>
<td style="text-align: center;">435</td>
<td style="text-align: center;">2</td>
</tr>
<tr class="odd">
<td style="text-align: center;">4314902007</td>
<td style="text-align: center;">20 a 24 anos</td>
<td style="text-align: center;">214</td>
<td style="text-align: center;">245</td>
<td style="text-align: center;">459</td>
<td style="text-align: center;">9116</td>
<td style="text-align: center;">5</td>
</tr>
<tr class="even">
<td style="text-align: center;">4314902069</td>
<td style="text-align: center;">20 a 24 anos</td>
<td style="text-align: center;">42</td>
<td style="text-align: center;">62</td>
<td style="text-align: center;">104</td>
<td style="text-align: center;">2071</td>
<td style="text-align: center;">5</td>
</tr>
<tr class="odd">
<td style="text-align: center;">4314902009</td>
<td style="text-align: center;">20 a 24 anos</td>
<td style="text-align: center;">331</td>
<td style="text-align: center;">359</td>
<td style="text-align: center;">690</td>
<td style="text-align: center;">13137</td>
<td style="text-align: center;">5</td>
</tr>
<tr class="even">
<td style="text-align: center;">4314902072</td>
<td style="text-align: center;">20 a 24 anos</td>
<td style="text-align: center;">75</td>
<td style="text-align: center;">57</td>
<td style="text-align: center;">132</td>
<td style="text-align: center;">3706</td>
<td style="text-align: center;">4</td>
</tr>
<tr class="odd">
<td style="text-align: center;">4314902068</td>
<td style="text-align: center;">20 a 24 anos</td>
<td style="text-align: center;">163</td>
<td style="text-align: center;">144</td>
<td style="text-align: center;">307</td>
<td style="text-align: center;">8052</td>
<td style="text-align: center;">4</td>
</tr>
<tr class="even">
<td style="text-align: center;">4314902013</td>
<td style="text-align: center;">20 a 24 anos</td>
<td style="text-align: center;">193</td>
<td style="text-align: center;">177</td>
<td style="text-align: center;">370</td>
<td style="text-align: center;">6319</td>
<td style="text-align: center;">6</td>
</tr>
<tr class="odd">
<td style="text-align: center;">4314902012</td>
<td style="text-align: center;">20 a 24 anos</td>
<td style="text-align: center;">31</td>
<td style="text-align: center;">19</td>
<td style="text-align: center;">50</td>
<td style="text-align: center;">2719</td>
<td style="text-align: center;">2</td>
</tr>
<tr class="even">
<td style="text-align: center;">4314902004</td>
<td style="text-align: center;">20 a 24 anos</td>
<td style="text-align: center;">206</td>
<td style="text-align: center;">227</td>
<td style="text-align: center;">433</td>
<td style="text-align: center;">13342</td>
<td style="text-align: center;">3</td>
</tr>
<tr class="odd">
<td style="text-align: center;">4314902032</td>
<td style="text-align: center;">20 a 24 anos</td>
<td style="text-align: center;">261</td>
<td style="text-align: center;">285</td>
<td style="text-align: center;">546</td>
<td style="text-align: center;">12171</td>
<td style="text-align: center;">4</td>
</tr>
<tr class="even">
<td style="text-align: center;">4314902022</td>
<td style="text-align: center;">20 a 24 anos</td>
<td style="text-align: center;">117</td>
<td style="text-align: center;">105</td>
<td style="text-align: center;">222</td>
<td style="text-align: center;">6910</td>
<td style="text-align: center;">3</td>
</tr>
<tr class="odd">
<td style="text-align: center;">4314902071</td>
<td style="text-align: center;">20 a 24 anos</td>
<td style="text-align: center;">49</td>
<td style="text-align: center;">29</td>
<td style="text-align: center;">78</td>
<td style="text-align: center;">NA</td>
<td style="text-align: center;">NA</td>
</tr>
<tr class="even">
<td style="text-align: center;">4314902045</td>
<td style="text-align: center;">20 a 24 anos</td>
<td style="text-align: center;">70</td>
<td style="text-align: center;">56</td>
<td style="text-align: center;">126</td>
<td style="text-align: center;">4190</td>
<td style="text-align: center;">3</td>
</tr>
<tr class="odd">
<td style="text-align: center;">4314902049</td>
<td style="text-align: center;">20 a 24 anos</td>
<td style="text-align: center;">71</td>
<td style="text-align: center;">65</td>
<td style="text-align: center;">136</td>
<td style="text-align: center;">4365</td>
<td style="text-align: center;">3</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<p>Apesar de claramente não ser o foco do post, pareceu um desperdício de esforço não fazer algo com esta informação. O código abaixo agrupa os dados um pouco mais e monta um mapa interativo dos domicílios por grupo de idade da pessoa responsável. Não seria difícil transformar isto num aplicativo para ver esta mesma info nas outras faixas de idade, mas isto fica para outro post.</p>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>bairros <span class="ot">&lt;-</span> geobr<span class="sc">::</span><span class="fu">read_neighborhood</span>(<span class="at">showProgress =</span> <span class="cn">FALSE</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>bairros_poa <span class="ot">&lt;-</span> bairros <span class="sc">|&gt;</span> </span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Pega apenas os códigos dos bairros de POA</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(code_muni <span class="sc">==</span> <span class="dv">4314902</span>) <span class="sc">|&gt;</span> </span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># O código do bairro tem alguns números sobrando no meio</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">code_nb =</span> <span class="fu">paste0</span>(</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    stringr<span class="sc">::</span><span class="fu">str_sub</span>(code_neighborhood, <span class="dv">1</span>, <span class="dv">7</span>),</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>    stringr<span class="sc">::</span><span class="fu">str_sub</span>(code_neighborhood, <span class="dv">10</span>, <span class="dv">12</span>))</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>respnb <span class="ot">&lt;-</span> respnb <span class="sc">|&gt;</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(age_group, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"age_min"</span>, <span class="st">"age_max"</span>), <span class="at">sep =</span> <span class="st">" a "</span>) <span class="sc">|&gt;</span> </span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_generation =</span> <span class="fu">case_when</span>(</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>      age_min <span class="sc">&gt;=</span> <span class="dv">25</span> <span class="sc">&amp;</span> age_min <span class="sc">&lt;</span> <span class="dv">40</span> <span class="sc">~</span> <span class="st">"25-39"</span>,</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>      age_min <span class="sc">&gt;=</span> <span class="dv">40</span> <span class="sc">&amp;</span> age_min <span class="sc">&lt;</span> <span class="dv">60</span> <span class="sc">~</span> <span class="st">"40-59"</span>,</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>      age_min <span class="sc">&gt;=</span> <span class="dv">60</span> <span class="sc">&amp;</span> age_min <span class="sc">&lt;</span> <span class="dv">80</span> <span class="sc">~</span> <span class="st">"60-79"</span>,</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>      age_min <span class="sc">&gt;=</span> <span class="dv">80</span> <span class="sc">~</span> <span class="st">"80+"</span>,</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"&lt;25"</span></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>resp_grouped_nb <span class="ot">&lt;-</span> respnb <span class="sc">|&gt;</span> </span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(code_nb, age_generation) <span class="sc">|&gt;</span> </span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">pop =</span> <span class="fu">sum</span>(total, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(code_nb) <span class="sc">|&gt;</span> </span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">total_nb =</span> <span class="fu">sum</span>(pop)) <span class="sc">|&gt;</span> </span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">share_nb =</span> pop <span class="sc">/</span> total_nb <span class="sc">*</span> <span class="dv">100</span>)</span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a>resp_ages <span class="ot">&lt;-</span> <span class="fu">pivot_wider</span>(</span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a>  resp_grouped_nb,</span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">id_cols =</span> <span class="st">"code_nb"</span>,</span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">names_from =</span> <span class="st">"age_generation"</span>,</span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">names_prefix =</span> <span class="st">"age_"</span>,</span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">values_from =</span> <span class="st">"share_nb"</span></span>
<span id="cb25-39"><a href="#cb25-39" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-40"><a href="#cb25-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-41"><a href="#cb25-41" aria-hidden="true" tabindex="-1"></a>resp_ages <span class="ot">&lt;-</span> janitor<span class="sc">::</span><span class="fu">clean_names</span>(resp_ages)</span>
<span id="cb25-42"><a href="#cb25-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-43"><a href="#cb25-43" aria-hidden="true" tabindex="-1"></a>resp_bairros <span class="ot">&lt;-</span> <span class="fu">left_join</span>(bairros_poa, resp_ages, <span class="at">by =</span> <span class="st">"code_nb"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>O mapa é gerado pelo código abaixo. O mapa mostra o share de domicílios, em cada bairro, que são chefiados por “adultos-jovens”, isto é, de 25 a 39 anos. Nota-se que os bairros que tem maiores percentuais estão mais na periferia da cidade. Alguns bairros de classe alta como Moinhos de Vento, Três Figueiras e Vila Assunção tem os menores percentuais.</p>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tmap)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tmaptools)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="at">mode =</span> <span class="st">"view"</span>)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(resp_bairros) <span class="sc">+</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="st">"age_25_39"</span>,</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">palette =</span> <span class="st">"inferno"</span>,</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.8</span>,</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> <span class="st">"jenks"</span>,</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="dv">7</span>,</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">id =</span> <span class="st">"name_neighborhood"</span>,</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Percentual de domicílios&lt;br&gt;chefiados por pessoas&lt;br&gt;de 25 a 39 anos (%)."</span>,</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">popup.vars =</span> <span class="fu">c</span>(</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Menos de 25 anos"</span> <span class="ot">=</span> <span class="st">"age_25"</span>,</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>      <span class="st">"25 a 39 anos"</span> <span class="ot">=</span> <span class="st">"age_25_39"</span>,</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>      <span class="st">"40 a 59 anos"</span> <span class="ot">=</span> <span class="st">"age_40_59"</span>,</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>      <span class="st">"60 a 79 anos"</span> <span class="ot">=</span> <span class="st">"age_60_79"</span>,</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>      <span class="st">"80 anos ou mais"</span> <span class="ot">=</span> <span class="st">"age_80"</span>),</span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">popup.format =</span> <span class="fu">list</span>(<span class="at">digits =</span> <span class="dv">1</span>),</span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.format =</span> <span class="fu">list</span>(<span class="at">digits =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>() <span class="sc">+</span></span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_basemap</span>(<span class="at">server =</span> <span class="st">"CartoDB.Positron"</span>) <span class="sc">+</span></span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_view</span>(<span class="at">set.view =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">51.179152</span>, <span class="sc">-</span><span class="fl">30.025976</span>, <span class="dv">13</span>))</span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a>leaf <span class="ot">&lt;-</span> <span class="fu">tmap_leaflet</span>(m)</span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a>widgetframe<span class="sc">::</span><span class="fu">frameWidget</span>(leaf, <span class="at">width =</span> <span class="st">"100%"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="htmlwidget-c54b2f67a90b5c0d92b4" style="width:100%;height:415.296px;" class="widgetframe html-widget "></div>
<script type="application/json" data-for="htmlwidget-c54b2f67a90b5c0d92b4">{"x":{"url":"index_files/figure-html//widgets/widget_unnamed-chunk-27.html","options":{"xdomain":"*","allowfullscreen":false,"lazyload":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="viniciusoike/restateinsight" data-repo-id="R_kgDOJ9Lnfw" data-category="General" data-category-id="" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->



</body></html>