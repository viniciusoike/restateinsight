<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Vinicius Oike">
<meta name="dcterms.date" content="2024-07-14">
<meta name="description" content="In this post, I show how to find all Starbucks in Brazil using web scraping in R.">

<title>Vinicius Oike - Finding All Starbucks in Brazil</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<script src="../../../site_libs/cookie-consent/cookie-consent.js"></script>
<link href="../../../site_libs/cookie-consent/cookie-consent.css" rel="stylesheet">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-EJF8PGT67H"></script>

<script type="text/plain" cookie-consent="tracking">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-EJF8PGT67H', { 'anonymize_ip': true});
</script>

<script type="text/javascript" charset="UTF-8">
document.addEventListener('DOMContentLoaded', function () {
cookieconsent.run({
  "notice_banner_type":"simple",
  "consent_type":"implied",
  "palette":"light",
  "language":"en",
  "page_load_consent_levels":["strictly-necessary","functionality","tracking","targeting"],
  "notice_banner_reject_button_hide":false,
  "preferences_center_close_button_hide":false,
  "website_name":""
  });
});
</script> 
  

<link href="../../../site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="../../../site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="../../../site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="../../../site_libs/datatables-binding-0.32/datatables.js"></script>
<script src="../../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="../../../site_libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="../../../site_libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="../../../site_libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>
<link href="../../../site_libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">
<script src="../../../site_libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>
<link href="../../../site_libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="../../../site_libs/leaflet-1.3.1/leaflet.js"></script>
<link href="../../../site_libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="../../../site_libs/proj4-2.6.2/proj4.min.js"></script>
<script src="../../../site_libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="../../../site_libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="../../../site_libs/leaflet-binding-2.2.2/leaflet.js"></script>
<script src="../../../site_libs/leaflet-providers-2.0.0/leaflet-providers_2.0.0.js"></script>
<script src="../../../site_libs/leaflet-providers-plugin-2.2.2/leaflet-providers-plugin.js"></script>


<link rel="stylesheet" href="../../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">Vinicius Oike</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../blog.html" rel="" target="">
 <span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../aboutme.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../cv.html" rel="" target="">
 <span class="menu-text">CV</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../my_apps.html" rel="" target="">
 <span class="menu-text">Apps</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../press.html" rel="" target="">
 <span class="menu-text">Press</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/viniciusoike" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/viniciusoike" rel="" target=""><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../archive.html" rel="" target="">
 <span class="menu-text">Archive</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Finding All Starbucks in Brazil</h1>
                  <div>
        <div class="description">
          In this post, I show how to find all Starbucks in Brazil using web scraping in R.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">starbucks</div>
                <div class="quarto-category">web-scrapping</div>
                <div class="quarto-category">data-science</div>
                <div class="quarto-category">brazil</div>
                <div class="quarto-category">tutorial-R</div>
                <div class="quarto-category">finding</div>
                <div class="quarto-category">english</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Vinicius Oike </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">July 14, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#starbucks" id="toc-starbucks" class="nav-link active" data-scroll-target="#starbucks">Starbucks</a>
  <ul class="collapse">
  <li><a href="#web-scraping" id="toc-web-scraping" class="nav-link" data-scroll-target="#web-scraping">Web scraping</a>
  <ul class="collapse">
  <li><a href="#the-website" id="toc-the-website" class="nav-link" data-scroll-target="#the-website">The website</a></li>
  </ul></li>
  <li><a href="#data-cleaning" id="toc-data-cleaning" class="nav-link" data-scroll-target="#data-cleaning">Data Cleaning</a></li>
  <li><a href="#map" id="toc-map" class="nav-link" data-scroll-target="#map">Map</a></li>
  </ul></li>
  <li><a href="#building" id="toc-building" class="nav-link" data-scroll-target="#building">Building</a>
  <ul class="collapse">
  <li><a href="#finding-each-city" id="toc-finding-each-city" class="nav-link" data-scroll-target="#finding-each-city">Finding each city</a></li>
  <li><a href="#google-places" id="toc-google-places" class="nav-link" data-scroll-target="#google-places">Google Places</a>
  <ul class="collapse">
  <li><a href="#adding-information-using-google-places-api" id="toc-adding-information-using-google-places-api" class="nav-link" data-scroll-target="#adding-information-using-google-places-api">Adding information using Google Places API</a></li>
  <li><a href="#final-map" id="toc-final-map" class="nav-link" data-scroll-target="#final-map">Final Map</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="starbucks" class="level1">
<h1>Starbucks</h1>
<section id="web-scraping" class="level2">
<h2 class="anchored" data-anchor-id="web-scraping">Web scraping</h2>
<p>Web scraping consists of extracting information from a web page. The difficulty or ease of extracting this information depends on how well the page is constructed. In more complex cases, the information may be behind a captcha or within an interactive panel that depends on user input.</p>
<p>In this simple example, I will show how to find the locations of all Starbucks stores in Brazil. The full list of active Starbucks stores can be found on the <a href="https://starbucks.com.br/lojas">Starbucks Brasil website</a>. As usual, we will use the <code>tidyverse</code> along with the <code>rvest</code> and <code>xml2</code> packages.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rvest)   <span class="co"># Used for web scraping and extracting HTML content</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xml2)    <span class="co"># Helps in working with XML and HTML data</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="the-website" class="level3">
<h3 class="anchored" data-anchor-id="the-website">The website</h3>
<p>The full list of active Starbucks stores can be found on the <a href="https://starbucks.com.br/lojas">Starbucks Brasil website</a>. To read the page, we use read_html.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>url <span class="ot">=</span> <span class="st">"https://starbucks.com.br/lojas"</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>page <span class="ot">=</span> xml2<span class="sc">::</span><span class="fu">read_html</span>(url)   <span class="co"># Fetches the HTML content of the page</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The “xpath” shows the path to a specific element on the page. For example, to find the Starbucks logo in the top-left corner of the page, we can use the following code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extracts the HTML element for the logo image</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>page <span class="sc">%&gt;%</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_element</span>(<span class="at">xpath =</span> <span class="st">"/html/body/div[1]/div[1]/header/nav/div/div[1]/a/img"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{html_node}
&lt;img alt="Starbucks Logo" src="/public/img/icons/starbucks-nav-logo.svg"&gt;</code></pre>
</div>
</div>
<p>To learn more about xpaths, you can consult <a href="https://devhints.io/xpath">this cheatsheet</a>.</p>
<p>In general, on well-constructed pages, the name of elements will be quite self-explanatory. In the case above, the “alt” attribute already indicates that the object is the Starbucks logo, and the “src” directs to an image file in svg format called starbucks-nav-logo. Unfortunately, this won’t always be the case. On some pages, elements can be quite confusing.</p>
<p>To extract a specific attribute, we use the <code>html_attr</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>page <span class="sc">%&gt;%</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_element</span>(</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">xpath =</span> <span class="st">"/html/body/div[1]/div[1]/header/nav/div/div[1]/a/img"</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extracts the "src" attribute (URL to the image)</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_attr</span>(<span class="st">"src"</span>)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "/public/img/icons/starbucks-nav-logo.svg"</code></pre>
</div>
</div>
<p>If you combine this last link with “www.starbucks.com.br”, you should arrive at an image of the company’s logo<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://starbucks.com.br/public/img/icons/starbucks-nav-logo.svg" class="img-fluid figure-img" style="width:30.0%"></p>
<figcaption class="figure-caption">Starbucks logo</figcaption>
</figure>
</div>
<p>To find the big list of stores in the left panel, we will take advantage of the fact that the <code>div</code> holding this list has a unique class called <code>"place-list"</code>. It’s easy to verify this directly in your browser. If you use Chrome, for instance, just right-click on the panel and click on Inspect.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/Screenshot 2024-03-23 at 15.20.37.png" class="img-fluid figure-img"></p>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/Screenshot 2024-03-23 at 15.20.47.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>As I mentioned above, things aren’t always well organized. Note that since we want to extract multiple elements and multiple (all) attributes, we use the variants: <code>html_elements</code> and <code>html_attrs</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>list_attr <span class="ot">&lt;-</span> page <span class="sc">%&gt;%</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Selects all divs under "place-list" that hold store info</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_elements</span>(<span class="at">xpath =</span> <span class="st">'//div[@class="place-list"]/div'</span>)  <span class="sc">%&gt;%</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extracts all attributes of the selected elements</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_attrs</span>()  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The extracted object is a list where each element is a text vector containing the following information. We have the store name, latitude/longitude, and the address.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extracts the first store's information from the list</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pluck</span>(list_attr, <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                  class           data-latitude          data-longitude 
"place-item r-place-15"           "-23.5658059"           "-46.6508012" 
              data-name             data-street              data-index 
  "Shopping Top Center" "Avenida Paulista, 854"                     "0" </code></pre>
</div>
</div>
<p>At this point, the web scraping process is complete. Once again, the process was easy because the data is well structured on the Starbucks page. Now, we just need to clean the data.</p>
</section>
</section>
<section id="data-cleaning" class="level2">
<h2 class="anchored" data-anchor-id="data-cleaning">Data Cleaning</h2>
<p>I won’t go in depth about the data cleaning process. Basically, we need to convert each element of the list into a <code>data.frame</code>, stack the results, and then adjust the data types of each column.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the elements into data.frame</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">map</span>(list_attr, \(x) <span class="fu">as.data.frame</span>(<span class="fu">t</span>(x)))</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Stack the results</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(dat)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>clean_dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Rename the columns</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(<span class="sc">~</span><span class="fu">str_remove</span>(.x, <span class="st">"data-"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">lat =</span> latitude, <span class="at">lng =</span> longitude) <span class="sc">%&gt;%</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Select the columns of interest</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(index, name, street, lat, lng) <span class="sc">%&gt;%</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert lat/lng to numeric</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">lat =</span> <span class="fu">as.numeric</span>(lat),</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">lng =</span> <span class="fu">as.numeric</span>(lng),</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">index =</span> <span class="fu">as.numeric</span>(index),</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="fu">str_trim</span>(name)</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="map" class="level2">
<h2 class="anchored" data-anchor-id="map">Map</h2>
<p>The table above is already in a pretty satisfactory format. We can check the data by building a simple map.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(leaflet)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>starbucks <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(clean_dat, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lng"</span>, <span class="st">"lat"</span>), <span class="at">crs =</span> <span class="dv">4326</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="fu">leaflet</span>(starbucks) <span class="sc">%&gt;%</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addTiles</span>() <span class="sc">%&gt;%</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addMarkers</span>(<span class="at">label =</span> <span class="sc">~</span>name) <span class="sc">%&gt;%</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addProviderTiles</span>(<span class="st">"CartoDB"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setView</span>(<span class="at">lng =</span> <span class="sc">-</span><span class="fl">46.65590</span>, <span class="at">lat =</span> <span class="sc">-</span><span class="fl">23.561197</span>, <span class="at">zoom =</span> <span class="dv">12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="leaflet html-widget html-fill-item" id="htmlwidget-4427bb9a4cb13b8ec28b" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-4427bb9a4cb13b8ec28b">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,null,{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"https://openstreetmap.org/copyright/\">OpenStreetMap<\/a>,  <a href=\"https://opendatacommons.org/licenses/odbl/\">ODbL<\/a>"}]},{"method":"addMarkers","args":[[-23.5658059,-23.5631043,-23.5622624,-23.5678355,-23.5703948,-23.5704519,-23.5578455,-23.5669863,-23.5735072,-23.5578647,-23.554083,-23.557714,-23.5462691,-23.5422471,-23.5990249,-23.6025808,-23.5725778,-23.5916617,-23.590703,-23.5949773,-23.5264048,-23.6037897,-23.6012749,-23.5797475,-23.6085754,-23.5075493,-23.6198179,-23.5155249,-23.6291469,-23.5509289,-23.6000175,-23.6000175,-23.5943227,-23.6210905,-23.6232391,-23.622013,-23.5417077,-23.5065898,-23.5614014,-23.6259357,-23.6318236,-23.6764565,-23.5357892,-23.6785695,-23.4881295,-23.5656417,-23.5656417,-23.648587,-23.6677966,-23.5043417,-23.5380357,-23.7232218,-23.5045434,-23.4397236,-23.4397236,-23.4397236,-23.4397236,-23.4397236,-23.4397236,-23.4397236,-23.4397236,-23.1996761,-23.516497,-23.1692949,-23.1893053,-23.9968234,-23.1506704,-23.9765819,-23.029075,-23.0935538,-23.1085718,-23.008205,-23.008205,-23.5419932,-22.8925231,-22.8985604,-23.2166646,-23.200734,-22.8481958,-22.8481958,-22.5709662,-22.7039888,-22.9086762,-22.333694,-21.2256572,-21.2119833,-21.2119833,-22.9274502,-25.429149,-25.42339,-25.536314,-25.4381052,-25.4348889,-25.4409909,-22.761785,-25.4430439,-25.4351398,-25.477753,-22.9976583,-22.9976583,-22.9990216,-22.8778049,-22.814578,-22.814578,-22.9572295,-22.9115509,-22.9044152,-22.9108627,-22.8963793,-26.2544231,-26.3034935,-20.8664455,-26.8636948,-26.9208063,-27.2005951,-19.9625902,-27.5897538,-19.954683,-27.5848478,-27.6151933,-27.6633178,-27.6633178,-27.6633178,-19.8907155,-19.9206819,-19.632283,-19.632283,-18.9100794,-29.9151684,-29.9911,-29.9900775,-16.1183523,-30.0297716,-30.0846697,-15.8697369,-15.8697369,-15.8697369,-15.8414099,-15.7961869,-15.791281,-13.0073567,-12.9817061],[-46.6508012,-46.6543825,-46.6558034,-46.6480931,-46.6611742,-46.6436174,-46.6589521,-46.6421106,-46.6438625,-46.6619304,-46.6526427,-46.6367091,-46.6511418,-46.6576357,-46.6371985,-46.6646968,-46.6956962,-46.6879693,-46.690087,-46.6891929,-46.6807842,-46.6918693,-46.6980412,-46.5943652,-46.6945653,-46.6485458,-46.6268084,-46.6183765,-46.6664283,-46.7219327,-46.71519,-46.71519,-46.7211188,-46.6992423,-46.6987281,-46.7011737,-46.5766182,-46.71854,-46.560424,-46.5795569,-46.7368627,-46.6765647,-46.7711861,-46.6985962,-46.5491937,-46.5049037,-46.5049037,-46.531976,-46.5335636,-46.834366,-46.4563422,-46.543195,-46.8484465,-46.4943769,-46.4943769,-46.4943769,-46.4943769,-46.4943769,-46.4943769,-46.4943769,-46.4943769,-46.889651,-46.179363,-46.8917403,-46.9305805,-46.4090328,-46.9609439,-46.3101659,-46.748908,-46.9713498,-47.0084435,-47.1375685,-47.1375685,-47.4665576,-47.0274271,-47.0528094,-45.8920388,-45.8807905,-47.0631872,-47.0631872,-47.4084298,-47.6498665,-45.3164313,-49.056318,-47.8350124,-47.815878,-47.815878,-43.5748104,-49.2142792,-49.270162,-49.173249,-49.2665602,-49.2818261,-49.2774894,-43.46548,-49.2908478,-49.3167883,-49.2909558,-43.3581268,-43.3581268,-43.3511517,-43.2714867,-43.2435286,-43.2435286,-43.1766264,-43.1758324,-43.1755798,-43.1682727,-43.1212427,-48.8520551,-48.8488585,-49.4144148,-49.0926064,-49.0703179,-48.6149523,-44.1598636,-48.5152812,-44.017025,-48.5451431,-48.6450436,-48.5347161,-48.5347161,-48.5347161,-43.9678135,-43.9201173,-43.961765,-43.961765,-48.2607052,-51.1647481,-51.174939,-51.1770782,-48.3991489,-51.2272536,-51.2458384,-47.9172348,-47.9172348,-47.9172348,-48.0439961,-47.891071,-47.883178,-38.5247216,-38.4646255],null,null,null,{"interactive":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},null,null,null,null,["Shopping Top Center","Shopping Cidade São Paulo","Paulista Trianon","Paulista 500","Jardim Pamplona Shopping","Shopping Patio Paulista","Shopping Center 3","Hospital Beneficência Portuguesa","Eliseu Guilherme","Haddock Lobo","Shopping Frei Caneca","Santander Liberdade","Mackenzie","Shopping Higienopolis","Shopping Metrô Santa Cruz","Lavandisca","Shopping Eldorado","SP Corporate Towers","Shopping JK","Gomes de Carvalho","Bourbon Shopping","Berrini","Cidade Jardim Corporate","Shopping Mooca","Vivo Eco Berrini","Bráz Leme","Shopping Plaza Sul","Shopping Center Norte - Portaria","Aeroporto de Congonhas","Shopping Villa Lobos","Hospital Einstein - Consultórios","Hospital Einstein - Maternidade","João Saad","Shopping Market Place","Shopping Morumbi Térreo","Rochaverá Corporate Towers","Shopping Metrô Tatuapé","Tiete Plaza Shopping","Shopping Anália Franco","Shopping São Caetano","Shopping Morumbi Town","Shopping Interlagos","Super Shopping Osasco","Shopping SP Market","Shopping Internacional de Guarulhos","Shopping Aricanduva","Shopping Aricanduva Quiosque","Grand Plaza Shopping","Shopping ABC","Shopping Tamboré","Shopping Metro Itaquera","Shopping São Bernardo Plaza","Iguatemi Alphaville","Aeroporto GRU -   Terminal 3 Internacional Área Restrita - Portão 306","Aeroporto GRU - Terminal 2 Internacional Embarque Área Restrita - Portão 268","Aeroporto GRU - Terminal 2 Nacional – Praça de Alimentação / Área Pública - ASA E","Aeroporto GRU - Terminal 2 Nacional Oeste / Área Restrita  - Portão 220","Aeroporto GRU - Terminal 3 Internacional  - Área Pública  Check-In H","Aeroporto GRU - Terminal  2 Nacional Leste / Área Restrita  - Portão 258","Aeroporto GRU - Terminal 2 Nacional Oeste / Área Pública  - ASA B","Aeroporto GRU - Terminal 3 Internacional Desembarque - Área Pública","Jundiaí Shopping","Mogi Shopping","Maxi Shopping Jundiaí","Lago Azul km 58 (Sentido Interior)","Litoral Plaza Shopping","Lago Azul km 64","Praia Mar Shopping","Morro Azul","Lago Azul Km 72 (Rodovia Anhanguera)","Outlet Premium Itupeva","Aeroporto Viracopos - Embarque","Aeroporto Viracopos - Desembarque","Iguatemi Esplanada Sorocaba","Iguatemi Campinas","Cambuí","Shopping Vale Sul","Center Vale Shopping","Dom Pedro Flores","Dom Pedro Shopping Livraria","Pátio Limeira","Shopping Piracicaba","Roseira Posto Arco-Íris","Bauru Shopping","Iguatemi Ribeirão","Ribeirão Shopping - Loja","Ribeirão Shopping - Quiosque","ParkShopping Campo Grande","Shopping Jockey Plaza","Shopping Mueller - Curitiba","Aeroporto de Curitiba – Airside","Estação Curitiba","Spot Compact Mall Batel","Shopping Curitiba","Shopping Nova Iguaçu","Pátio Batel","Park Shopping Barigui","Shopping Palladium","Barra Shopping Quiosque","Barra Shopping","Shopping Village Mall","Shopping Nova América","Aeroporto Galeão - T2 Doméstico Embarque Restrito Portão 34","Aeroporto Galeão - Mezanino Área Pública 1° Piso - Terminal 2","Shopping Rio Sul","Cinelândia","Assembleia do Carmo","Aeroporto Santos Dumont","Shopping Plaza Níterói - Térreo","Garten Shopping","Shopping Mueller Joinville","Shopping Iguatemi São José do Rio Preto","Norte Shopping Blumenau","Neumarkt Shopping","Porto Belo Outlet","Partage Betim Shopping","Villa Romana Shopping","Itaú Power","Beiramar Shopping","Continente Shopping","Aeroporto de Florianópolis - Embarque Portão 8","Aeroporto de Florianópolis -  Boulevard","Aeroporto de Florianópolis - Check-In","Del Rey","Boulevard Shopping BH","Piso 1, Check in - BH Aeroporto","Área restrita, sala de embarque - BH Aeroporto","Center Shopping Uberlândia","ParkShopping Canoas","POA Airport Desembarque- área externa 1° piso","POA Airport Embarque Restrito - próximo ao Portão 115","Outlet Premium Brasilia","Galeria Chaves","Barra Shopping Sul","Aeroporto Brasília  - Embarque 1° piso","Aeroporto de Brasília - Portão 10 (Pier Norte)","Aeroporto Brasília  -  Desembarque Térreo","Taguatinga Shopping","Shopping Venâncio","Conjunto Nacional","Shopping Barra","Shopping da Bahia"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addProviderTiles","args":["CartoDB",null,null,{"errorTileUrl":"","noWrap":false,"detectRetina":false}]}],"limits":{"lat":[-30.0846697,-12.9817061],"lng":[-51.2458384,-38.4646255]},"setView":[[-23.561197,-46.6559],12,[]]},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>It’s worth noting that data extracted via web scraping almost always contains some noise. In this case, the data seems relatively clean after a bit of processing. The addresses are not always very informative, like in the case of “Rodovia Hélio Smidt, S/N,” but this happens because many stores are located inside hospitals, shopping malls, or airports.</p>
<p>With this data, we can already perform interesting analyses. For example, we can find out that there are five Starbucks stores just on Avenida Paulista.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>starbucks <span class="sc">%&gt;%</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(street, <span class="st">"Avenida Paulista"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 5 features and 5 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: -46.65895 ymin: -23.56784 xmax: -46.64809 ymax: -23.55785
Geodetic CRS:  WGS 84
# A tibble: 5 × 6
  index name                      street                   lat   lng
* &lt;dbl&gt; &lt;chr&gt;                     &lt;chr&gt;                  &lt;dbl&gt; &lt;dbl&gt;
1     0 Shopping Top Center       Avenida Paulista, 854  -23.6 -46.7
2     1 Shopping Cidade São Paulo Avenida Paulista, 1154 -23.6 -46.7
3     2 Paulista Trianon          Avenida Paulista, 1499 -23.6 -46.7
4     3 Paulista 500              Avenida Paulista, 500  -23.6 -46.6
5     6 Shopping Center 3         Avenida Paulista, 2064 -23.6 -46.7
               geometry
*           &lt;POINT [°]&gt;
1  (-46.6508 -23.56581)
2  (-46.65438 -23.5631)
3  (-46.6558 -23.56226)
4 (-46.64809 -23.56784)
5 (-46.65895 -23.55785)</code></pre>
</div>
</div>
<p>We can also count the number of stores in each airport. Apparently, there are eight stores at Guarulhos Airport, which seems like quite a high number to me.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>starbucks <span class="sc">%&gt;%</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(name, <span class="st">"Aeroporto"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">name_airport =</span> <span class="fu">str_remove</span>(name, <span class="st">"de "</span>),</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">name_airport =</span> <span class="fu">str_extract</span>(name_airport, <span class="st">"(?&lt;=Aeroporto )</span><span class="sc">\\</span><span class="st">w+"</span>),</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">name_airport =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(name_airport), <span class="st">"Confins"</span>, name_airport),</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">.before =</span> <span class="st">"name"</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(name_airport, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 × 2
  name_airport      n
  &lt;chr&gt;         &lt;int&gt;
1 GRU               8
2 Brasília          3
3 Florianópolis     3
4 Confins           2
5 Galeão            2
6 Viracopos         2
7 Congonhas         1
8 Curitiba          1
9 Santos            1</code></pre>
</div>
</div>
<p>Finally, we can note that many Starbucks stores are located inside shopping malls. A simple calculation shows that around 75 stores are located inside malls, close to 50% of the total units<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>starbucks <span class="sc">%&gt;%</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(name, <span class="st">"Shopping|shopping"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nrow</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 75</code></pre>
</div>
</div>
</section>
</section>
<section id="building" class="level1">
<h1>Building</h1>
<section id="finding-each-city" class="level2">
<h2 class="anchored" data-anchor-id="finding-each-city">Finding each city</h2>
<p>From this data, we can add more information. Using the <code>geobr</code> package, we can identify in which cities the stores are located.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>dim_city <span class="ot">=</span> geobr<span class="sc">::</span><span class="fu">read_municipality</span>(<span class="at">showProgress =</span> <span class="cn">FALSE</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>dim_city <span class="ot">=</span> <span class="fu">st_transform</span>(dim_city, <span class="at">crs =</span> <span class="dv">4326</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>sf<span class="sc">::</span><span class="fu">sf_use_s2</span>(<span class="cn">FALSE</span>)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>starbucks <span class="ot">=</span> starbucks <span class="sc">%&gt;%</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_join</span>(dim_city) <span class="sc">%&gt;%</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(<span class="fu">c</span>(name_muni, abbrev_state), <span class="at">.before =</span> lat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we can see which cities have the most Starbucks locations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>starbucks <span class="sc">%&gt;%</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(name_muni, abbrev_state, <span class="at">sort =</span> <span class="cn">TRUE</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 43 × 3
   name_muni      abbrev_state     n
   &lt;chr&gt;          &lt;chr&gt;        &lt;int&gt;
 1 São Paulo      SP              45
 2 Rio De Janeiro RJ              11
 3 Guarulhos      SP               9
 4 Curitiba       PR               8
 5 Brasília       DF               6
 6 Campinas       SP               6
 7 Florianópolis  SC               5
 8 Jundiaí        SP               4
 9 Porto Alegre   RS               4
10 Ribeirão Preto SP               3
# ℹ 33 more rows</code></pre>
</div>
</div>
<p>Ou seja, há mais Starbucks somente na Paulista do que em quase todas as demais cidades do Brasil.</p>
</section>
<section id="google-places" class="level2">
<h2 class="anchored" data-anchor-id="google-places">Google Places</h2>
<section id="adding-information-using-google-places-api" class="level3">
<h3 class="anchored" data-anchor-id="adding-information-using-google-places-api">Adding information using Google Places API</h3>
<p>The Google <a href="https://developers.google.com/maps/documentation/places/web-service/overview">Places API</a> allows access to data from Google Maps. The <code>googleway</code> package integrates this data into <code>R</code> already in tidy format.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(googleway)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I’ll create a simple search to return all Starbucks locations in Brazil. A full search across the entire country would take too long, so I will use the coordinates I found via web scraping as a starting point.</p>
<p>The function below searches for the term “starbucks” at all the points I provide. To simplify, the function returns only a few of the columns.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to grab starbucks info</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>get_starbucks_info <span class="ot">&lt;-</span> <span class="cf">function</span>(lat, lng) {</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Search for 'Starbucks' using the provided latitude and longitude.</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  places <span class="ot">=</span> <span class="fu">google_places</span>(</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">search_string =</span> <span class="st">"starbucks"</span>,   <span class="co"># Search term "starbucks"</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">location =</span> <span class="fu">c</span>(lat, lng)         <span class="co"># Coordinates (lat and lng) for the search</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Define the columns of interest to keep from the results</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>  sel_cols <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"name"</span>,                        <span class="co"># Store name</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"formatted_address"</span>,           <span class="co"># Store address</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"lat"</span>,                         <span class="co"># Latitude</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"lng"</span>,                         <span class="co"># Longitude</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"rating"</span>,                      <span class="co"># Store rating</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">"user_ratings_total"</span>,          <span class="co"># Number of user ratings</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">"business_status"</span>              <span class="co"># Business status (e.g., operational or closed)</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Process the results and select the relevant columns</span></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>  places<span class="sc">$</span>results <span class="sc">%&gt;%</span></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>    tidyr<span class="sc">::</span><span class="fu">unnest</span>(<span class="st">"geometry"</span>) <span class="sc">%&gt;%</span>   <span class="co"># Extract the nested 'geometry' field</span></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>    tidyr<span class="sc">::</span><span class="fu">unnest</span>(<span class="st">"location"</span>) <span class="sc">%&gt;%</span>   <span class="co"># Extract the nested 'location' field (lat and lng)</span></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(dplyr<span class="sc">::</span><span class="fu">all_of</span>(sel_cols))   <span class="co"># Select only the columns of interest</span></span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>O código abaixo roda a função acima em todos os 142 estabelecimentos, encontrados na página oficial do Starbucks Brasil.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove geometry and keep only coordinates</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>coords_starbucks <span class="ot">&lt;-</span> starbucks <span class="sc">%&gt;%</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(index, name, lat, lng)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>starbucks_info <span class="ot">=</span> purrr<span class="sc">::</span><span class="fu">map2</span>(</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>  coords_starbucks<span class="sc">$</span>lat,</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>  coords_starbucks<span class="sc">$</span>lng,</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>  get_starbucks_info</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> starbucks_info <span class="sc">%&gt;%</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(<span class="at">.id =</span> <span class="st">"search_id"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To clean the data, I will keep only the active stores that contain “Starbucks” in their name. Additionally, I will pair the data with my web scraping dataset using <code>st_nearest_feature(x, y)</code>. This function finds the nearest point in <code>y</code> for each point in <code>x</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">|&gt;</span> </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Keep only stores with "Starbucks" in the name and that are operational</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(name, <span class="st">"Starbucks"</span>), business_status <span class="sc">==</span> <span class="st">"OPERATIONAL"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Arrange the results by address</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(formatted_address)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to a spatial data frame using longitude and latitude</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>google_data <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Set coordinate reference system to WGS 84 (EPSG:4326)</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lng"</span>, <span class="st">"lat"</span>), <span class="at">crs =</span> <span class="dv">4326</span>)  </span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the nearest Starbucks locations from the web scraping data (starbucks)</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="co"># for each point in google_data</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>inds <span class="ot">&lt;-</span> <span class="fu">st_nearest_feature</span>(google_data, starbucks)</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the metadata of the nearest points from the web scraping data and</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a><span class="co"># convert to a tibble</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>metadata <span class="ot">&lt;-</span> starbucks <span class="sc">%&gt;%</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(inds) <span class="sc">%&gt;%</span></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span>  <span class="co"># Remove spatial geometry</span></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename the columns in google_data and bind the metadata from the web scraping data</span></span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>google_data <span class="ot">&lt;-</span> google_data <span class="sc">|&gt;</span> </span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">google_name =</span> name, <span class="at">google_address =</span> formatted_address) <span class="sc">|&gt;</span> </span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(metadata)  <span class="co"># Combine google_data with the corresponding metadata</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="final-map" class="level3">
<h3 class="anchored" data-anchor-id="final-map">Final Map</h3>
<p>The interactive map below shows all Starbucks locations in São Paulo. The color of each circle represents its rating, and the size of the circle represents the number of reviews. The units along the Avenida Paulista corridor, for example, have high average ratings and a large number of reviews. One of the worst-rated units seems to be the one near Mackenzie University, which has a rating of 2.1 and 15 reviews. In the Eastern Zone, the store at Shopping Aricanduva also has a slightly lower rating, 3.9 with 158 reviews.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>sp <span class="ot">&lt;-</span> <span class="fu">filter</span>(google_data, name_muni <span class="sc">==</span> <span class="st">"São Paulo"</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>sp <span class="ot">&lt;-</span> sp <span class="sc">|&gt;</span> </span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">rad =</span> <span class="fu">findInterval</span>(user_ratings_total, <span class="fu">c</span>(<span class="dv">25</span>, <span class="dv">100</span>, <span class="dv">1000</span>, <span class="dv">2500</span>, <span class="dv">5000</span>))<span class="sc">*</span><span class="dv">2</span> <span class="sc">+</span> <span class="dv">5</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>pal <span class="ot">&lt;-</span> <span class="fu">colorNumeric</span>(<span class="st">"RdBu"</span>, <span class="at">domain =</span> sp<span class="sc">$</span>rating)</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>labels <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_glue</span>(</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">"&lt;b&gt; {sp$name} &lt;/b&gt; &lt;br&gt;</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="st">   &lt;b&gt; Rating &lt;/b&gt;: {sp$rating} &lt;br&gt;</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a><span class="st">   &lt;b&gt; No Ratings &lt;/b&gt; {sp$user_ratings_total}"</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>labels <span class="ot">&lt;-</span> <span class="fu">lapply</span>(labels, htmltools<span class="sc">::</span>HTML)</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a><span class="fu">leaflet</span>(sp) <span class="sc">|&gt;</span> </span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addTiles</span>() <span class="sc">|&gt;</span> </span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addCircleMarkers</span>(</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">radius =</span> <span class="sc">~</span>rad,</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="sc">~</span><span class="fu">pal</span>(rating),</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> labels,</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">stroke =</span> <span class="cn">FALSE</span>,</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">fillOpacity =</span> <span class="fl">0.5</span></span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addLegend</span>(<span class="at">pal =</span> pal, <span class="at">values =</span> <span class="sc">~</span>rating) <span class="sc">|&gt;</span> </span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addProviderTiles</span>(<span class="st">"CartoDB"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="leaflet html-widget html-fill-item" id="htmlwidget-158b2f43dc61ba81e13a" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-158b2f43dc61ba81e13a">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,null,{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"https://openstreetmap.org/copyright/\">OpenStreetMap<\/a>,  <a href=\"https://opendatacommons.org/licenses/odbl/\">ODbL<\/a>"}]},{"method":"addCircleMarkers","args":[[-23.6258312,-23.6025987,-23.540494,-23.6001382,-23.5660792,-23.5077543,-23.6216876,-23.6037146,-23.6751922,-23.5939569,-23.6012749,-23.5623595,-23.557771,-23.5678371,-23.5921852,-23.5916352,-23.5067423,-23.5728474,-23.6231169,-23.5543597,-23.6796183,-23.5656276,-23.5615563,-23.5509155,-23.6085786,-23.6198309,-23.5733703,-23.5467961,-23.5267749,-23.6230715,-23.5804758,-23.5416758,-23.557903,-23.5668433,-23.5703331,-23.5996307,-23.5992279,-23.5641014,-23.554083,-23.6316949,-23.5426355,-23.5712699,-23.5150714],[-46.6609747,-46.6646925,-46.47097309999999,-46.7153149,-46.5054573,-46.648915,-46.699464,-46.6920752,-46.6771407,-46.72114819999999,-46.6980412,-46.6557082,-46.6588089,-46.6480323,-46.6882035,-46.6903479,-46.7177166,-46.6963698,-46.6986074,-46.6352104,-46.69973969999999,-46.6507967,-46.5598033,-46.7217457,-46.6945597,-46.6270094,-46.6439404,-46.65201380000001,-46.6803088,-46.7012391,-46.5941586,-46.5768715,-46.6618712,-46.6418146,-46.6611372,-46.7151228,-46.63721839999999,-46.652803,-46.6526427,-46.73697060000001,-46.6577249,-46.6436347,-46.6186055],[11,11,7,5,9,9,11,13,9,13,5,15,15,15,9,11,11,15,13,9,9,11,13,11,7,11,13,5,13,9,11,13,15,9,7,9,13,7,11,9,11,9,13],null,null,{"interactive":true,"className":"","stroke":false,"color":["#75B0D3","#347BB7","#D4E6F1","#053061","#A8D0E4","#75B0D3","#266BAF","#266BAF","#579EC9","#347BB7","#F8B799","#266BAF","#347BB7","#347BB7","#75B0D3","#266BAF","#266BAF","#266BAF","#266BAF","#266BAF","#3F8CC0","#347BB7","#347BB7","#347BB7","#266BAF","#347BB7","#347BB7","#67001F","#347BB7","#3F8CC0","#347BB7","#266BAF","#266BAF","#579EC9","#75B0D3","#3F8CC0","#266BAF","#75B0D3","#347BB7","#75B0D3","#347BB7","#3F8CC0","#266BAF"],"weight":5,"opacity":0.5,"fill":true,"fillColor":["#75B0D3","#347BB7","#D4E6F1","#053061","#A8D0E4","#75B0D3","#266BAF","#266BAF","#579EC9","#347BB7","#F8B799","#266BAF","#347BB7","#347BB7","#75B0D3","#266BAF","#266BAF","#266BAF","#266BAF","#266BAF","#3F8CC0","#347BB7","#347BB7","#347BB7","#266BAF","#347BB7","#347BB7","#67001F","#347BB7","#3F8CC0","#347BB7","#266BAF","#266BAF","#579EC9","#75B0D3","#3F8CC0","#266BAF","#75B0D3","#347BB7","#75B0D3","#347BB7","#3F8CC0","#266BAF"],"fillOpacity":0.5},null,null,null,null,["<b> Aeroporto de Congonhas <\/b> <br>\n<b> Rating <\/b>: 4.1 <br>\n<b> No Ratings <\/b> 1250","<b> Lavandisca <\/b> <br>\n<b> Rating <\/b>: 4.4 <br>\n<b> No Ratings <\/b> 2147","<b> Shopping Metro Itaquera <\/b> <br>\n<b> Rating <\/b>: 3.7 <br>\n<b> No Ratings <\/b> 91","<b> Hospital Einstein - Consultórios <\/b> <br>\n<b> Rating <\/b>: 4.8 <br>\n<b> No Ratings <\/b> 6","<b> Shopping Aricanduva Quiosque <\/b> <br>\n<b> Rating <\/b>: 3.9 <br>\n<b> No Ratings <\/b> 158","<b> Bráz Leme <\/b> <br>\n<b> Rating <\/b>: 4.1 <br>\n<b> No Ratings <\/b> 551","<b> Shopping Market Place <\/b> <br>\n<b> Rating <\/b>: 4.5 <br>\n<b> No Ratings <\/b> 1850","<b> Berrini <\/b> <br>\n<b> Rating <\/b>: 4.5 <br>\n<b> No Ratings <\/b> 4206","<b> Shopping Interlagos <\/b> <br>\n<b> Rating <\/b>: 4.2 <br>\n<b> No Ratings <\/b> 197","<b> João Saad <\/b> <br>\n<b> Rating <\/b>: 4.4 <br>\n<b> No Ratings <\/b> 3109","<b> Cidade Jardim Corporate <\/b> <br>\n<b> Rating <\/b>: 3 <br>\n<b> No Ratings <\/b> 11","<b> Paulista Trianon <\/b> <br>\n<b> Rating <\/b>: 4.5 <br>\n<b> No Ratings <\/b> 6118","<b> Shopping Center 3 <\/b> <br>\n<b> Rating <\/b>: 4.4 <br>\n<b> No Ratings <\/b> 8807","<b> Paulista 500 <\/b> <br>\n<b> Rating <\/b>: 4.4 <br>\n<b> No Ratings <\/b> 5672","<b> SP Corporate Towers <\/b> <br>\n<b> Rating <\/b>: 4.1 <br>\n<b> No Ratings <\/b> 118","<b> Shopping JK <\/b> <br>\n<b> Rating <\/b>: 4.5 <br>\n<b> No Ratings <\/b> 2018","<b> Tiete Plaza Shopping <\/b> <br>\n<b> Rating <\/b>: 4.5 <br>\n<b> No Ratings <\/b> 2369","<b> Shopping Eldorado <\/b> <br>\n<b> Rating <\/b>: 4.5 <br>\n<b> No Ratings <\/b> 5396","<b> Shopping Morumbi Térreo <\/b> <br>\n<b> Rating <\/b>: 4.5 <br>\n<b> No Ratings <\/b> 4974","<b> Santander Liberdade <\/b> <br>\n<b> Rating <\/b>: 4.5 <br>\n<b> No Ratings <\/b> 916","<b> Shopping SP Market <\/b> <br>\n<b> Rating <\/b>: 4.3 <br>\n<b> No Ratings <\/b> 409","<b> Shopping Top Center <\/b> <br>\n<b> Rating <\/b>: 4.4 <br>\n<b> No Ratings <\/b> 1433","<b> Shopping Anália Franco <\/b> <br>\n<b> Rating <\/b>: 4.4 <br>\n<b> No Ratings <\/b> 3460","<b> Shopping Villa Lobos <\/b> <br>\n<b> Rating <\/b>: 4.4 <br>\n<b> No Ratings <\/b> 1033","<b> Vivo Eco Berrini <\/b> <br>\n<b> Rating <\/b>: 4.5 <br>\n<b> No Ratings <\/b> 31","<b> Shopping Plaza Sul <\/b> <br>\n<b> Rating <\/b>: 4.4 <br>\n<b> No Ratings <\/b> 1656","<b> Eliseu Guilherme <\/b> <br>\n<b> Rating <\/b>: 4.4 <br>\n<b> No Ratings <\/b> 3127","<b> Mackenzie <\/b> <br>\n<b> Rating <\/b>: 2.1 <br>\n<b> No Ratings <\/b> 15","<b> Bourbon Shopping <\/b> <br>\n<b> Rating <\/b>: 4.4 <br>\n<b> No Ratings <\/b> 2878","<b> Rochaverá Corporate Towers <\/b> <br>\n<b> Rating <\/b>: 4.3 <br>\n<b> No Ratings <\/b> 905","<b> Shopping Mooca <\/b> <br>\n<b> Rating <\/b>: 4.4 <br>\n<b> No Ratings <\/b> 1940","<b> Shopping Metrô Tatuapé <\/b> <br>\n<b> Rating <\/b>: 4.5 <br>\n<b> No Ratings <\/b> 3435","<b> Haddock Lobo <\/b> <br>\n<b> Rating <\/b>: 4.5 <br>\n<b> No Ratings <\/b> 6593","<b> Hospital Beneficência Portuguesa <\/b> <br>\n<b> Rating <\/b>: 4.2 <br>\n<b> No Ratings <\/b> 285","<b> Jardim Pamplona Shopping <\/b> <br>\n<b> Rating <\/b>: 4.1 <br>\n<b> No Ratings <\/b> 85","<b> Hospital Einstein - Consultórios <\/b> <br>\n<b> Rating <\/b>: 4.3 <br>\n<b> No Ratings <\/b> 112","<b> Shopping Metrô Santa Cruz <\/b> <br>\n<b> Rating <\/b>: 4.5 <br>\n<b> No Ratings <\/b> 3830","<b> Shopping Cidade São Paulo <\/b> <br>\n<b> Rating <\/b>: 4.1 <br>\n<b> No Ratings <\/b> 36","<b> Shopping Frei Caneca <\/b> <br>\n<b> Rating <\/b>: 4.4 <br>\n<b> No Ratings <\/b> 1901","<b> Shopping Morumbi Town <\/b> <br>\n<b> Rating <\/b>: 4.1 <br>\n<b> No Ratings <\/b> 327","<b> Shopping Higienopolis <\/b> <br>\n<b> Rating <\/b>: 4.4 <br>\n<b> No Ratings <\/b> 1621","<b> Shopping Patio Paulista <\/b> <br>\n<b> Rating <\/b>: 4.3 <br>\n<b> No Ratings <\/b> 895","<b> Shopping Center Norte - Portaria <\/b> <br>\n<b> Rating <\/b>: 4.5 <br>\n<b> No Ratings <\/b> 4103"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addLegend","args":[{"colors":["#67001F , #C4403B 14.8148148148148%, #F8B799 33.3333333333333%, #F0F4F6 51.8518518518518%, #8FC3DD 70.3703703703704%, #266BAF 88.8888888888889%, #053061 "],"labels":["2.5","3.0","3.5","4.0","4.5"],"na_color":null,"na_label":"NA","opacity":0.5,"position":"topright","type":"numeric","title":"rating","extra":{"p_1":0.1481481481481481,"p_n":0.888888888888889},"layerId":null,"className":"info legend","group":null}]},{"method":"addProviderTiles","args":["CartoDB",null,null,{"errorTileUrl":"","noWrap":false,"detectRetina":false}]}],"limits":{"lat":[-23.6796183,-23.5067423],"lng":[-46.73697060000001,-46.47097309999999]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
</section>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>Web scraping is a popular data extraction technique that allows us to quickly build interesting datasets. In this case, the process was quite simple, but as I mentioned, it can be much more complex.</p>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p><a href="https://starbucks.com.br/public/img/icons/starbucks-nav-logo.svg" class="uri">https://starbucks.com.br/public/img/icons/starbucks-nav-logo.svg</a><a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Here, we are assuming that the “name” tag always includes the word “shopping” if the store is located inside a mall. This number might eventually be underestimated if there are stores inside malls that don’t have the word “shopping” in their name. Strictly speaking, we also haven’t verified whether the “shopping” tag is always associated with an active shopping mall.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="viniciusoike/restateinsight" data-repo-id="R_kgDOJ9Lnfw" data-category="General" data-category-id="" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center"><div class="cookie-consent-footer"><a href="#" id="open_preferences_center">Cookie Preferences</a></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>



</body></html>